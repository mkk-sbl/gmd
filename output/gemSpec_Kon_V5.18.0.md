
Elektronische Gesundheitskarte und Telematikinfrastruktur

### Spezifikation<br>Konnektor

- Klassifizierung: öffentlich
- Referenzierung: gemSpec_Kon
- Revision: 571788
- Stand: 28.11.2022
- Status: freigegeben
- Version: 5.18.0

### Dokumentinformationen

Änderungen zur Vorversion

Anpassungen des vorliegenden Dokumentes im Vergleich zur Vorversion können Sie
der nachfolgenden Tabelle entnehmen.

Dokumentenhistorie

<table><tr><th>
Version

</th><th>
Stand

</th><th>
Kap./ Seite

</th><th>
Grund der Änderung, besondere Hinweise

</th><th>
Bearbeitung

</th></tr><tr><td>
5.1.0

</td><td>
05.10.17

</td><td>
</td><td>
Initialversion Online-Produktivbetrieb (Stufe 2.1)

</td><td>
gematik

</td></tr><tr><td>
5.2.0

</td><td>
18.12.17

</td><td>
</td><td>
Einarbeitung Erratas 1.6.4-1 bis 1.6.4-3, P15.1

</td><td>
gematik

</td></tr><tr><td>
5.3.0

</td><td>
14.05.18

</td><td>
</td><td>
Einarbeitung P15.2, P15.4 und P15.5

</td><td>
gematik

</td></tr><tr><td>
5.4.0

</td><td>
26.10.18

</td><td>
</td><td>
Einarbeitung P15.8 und P15.9

</td><td>
gematik

</td></tr><tr><td>
5.5.0

</td><td>
18.12.18

</td><td>
</td><td>
Einarbeitung P17.1

</td><td>
gematik

</td></tr><tr><td>
5.6.0

</td><td>
15.05.19

</td><td>
</td><td>
Einarbeitung P18.1

</td><td>
gematik

</td></tr><tr><td>
5.7.0

</td><td>
28.06.19

</td><td>
</td><td>
Einarbeitung P19.1

</td><td>
gematik

</td></tr><tr><td>
5.8.0

</td><td>
02.10.19

</td><td>
Einarbeitung P20.1/2

</td><td>
gematik

</td></tr><tr><td>
5.9.0

</td><td>
02.03.20

</td><td>
Einarbeitung P21.1

</td><td>
gematik

</td></tr><tr><td>
5.9.1

</td><td>
26.06.20

</td><td>
Einarbeitung P21.3

</td><td>
gematik

</td></tr><tr><td>
5.9.2

</td><td>
27.08.20

</td><td>
Einarbeitung P21.4

</td><td>
gematik

</td></tr><tr><td>
5.9.3

</td><td>
21.09.20

</td><td>
Einarbeitung P21.5

</td><td>
gematik

</td></tr><tr><td>
5.9.4

</td><td>
05.11.20

</td><td>
Einarbeitung P21.6

</td><td>
gematik

</td></tr><tr><td>
5.10.0

</td><td>
30.06.20

</td><td>
Einarbeitung P22.1

</td><td>
gematik

</td></tr><tr><td>
5.11.0

</td><td>
12.11.20

</td><td>
Einarbeitung Scope-Themen zu R4.0.1

</td><td>
gematik

</td></tr><tr><td>
5.12.0

</td><td>
09.12.20

</td><td>
Einarbeitung P22.5

</td><td>
gematik

</td></tr><tr><td>
5.13.0

</td><td>
30.06.21

</td><td>
Einarbeitung Konn_Maintenance_21.1, _21.2, _21.3 und
gemF_gSMC-K_Laufzeitverlängerung

</td><td>
gematik

</td></tr><tr><td>
5.14.0

</td><td>
02.09.21

</td><td>
Umbenennung der Begriffe "aAdG-NetG" in "WANDA Basic", "aAdG" und "aAdG-NetG-TI"
in"WANDA Smart"

</td><td>
gematik

</td></tr><tr><td>
5.15.0

</td><td>
31.01.22

</td><td>
Einarbeitung Konn_Maintenance_21.6, Einarbeitung CI_Maintenance_21.2:
Ergänzung der Tabelle 3 im Kap. 4.2.1.1.1 um "WANDA Basic" 

</td><td>
gematik

</td></tr><tr><td>
5.16.0

</td><td>
02.05.22

</td><td>
Einarbeitung Konn_Maintenance_22.1 (mit Ausbau der Änderungen aus
gemF_gSMC-K_Laufzeitverlängerung)

</td><td>
gematik

</td></tr><tr><td>
5.17.0

</td><td>
30.06.22

</td><td>
Einarbeitung Konn_Maintenance_22.3

</td><td>
gematik

</td></tr><tr><td>
5.18.0

</td><td>
28.11.22

</td><td>
Einarbeitung Konn_Maintenance_22.4, _22.5, _22.6, redaktionell:
diskriminierungsfreie Sprache (Black-/Whitelist in Deny-/Allowlist)

</td><td>
gematik

</td></tr></table>

### Inhaltsverzeichnis

- [Dokumentinformationen]
- [Inhaltsverzeichnis]
- [1] Einordnung des Dokumentes
  - [1.1] Zielsetzung
  - [1.2] Zielgruppe
  - [1.3] Geltungsbereich
  - [1.4] Abgrenzung des Dokuments
  - [1.5] Methodik
    - [1.5.1] Anforderungen
    - [1.5.2] Offene Punkte
    - [1.5.3] Erläuterungen zur Spezifikation des Außenverhaltens
    - [1.5.4] Erläuterungen zur Dokumentenstruktur und „Dokumentenmechanismen“
      - [1.5.4.1] Modulare Spezifikation über Funktionsmerkmale
      - [1.5.4.2] Technische Use Cases - TUCs
      - [1.5.4.3] Event-Mechanismus
      - [1.5.4.4] Konfigurationsparameter und Zustandswerte
- [2] Systemüberblick
  - [2.1] Logische Struktur
  - [2.2] Sicherer Datenspeicher
  - [2.3] Überblick Konnektoridentität
  - [2.4] Mandantenfähigkeit
  - [2.5] Versionierung
  - [2.6] Fachanwendungen
  - [2.7] Netzseitige Einsatzszenarien
    - [2.7.1] Parameter ANLW_ANBINDUNGS_MODUS
    - [2.7.2] Parameter ANLW_INTERNET_MODUS
  - [2.8] Lokale und entfernte Kartenterminals
  - [2.9] Standalone-Szenario
- [3] Übergreifende Festlegungen
  - [3.1] Allgemeine übergreifende Festlegungen
    - [3.1.1] Dokumentformate
    - [3.1.2] Kartentypen
    - [3.1.3] Übergreifende Festlegungen zum Aufbau von sicheren Verbindungen
  - [3.2] Konnektoridentität und gSMC-K
    - [3.2.1] Organisatorische Anforderungen und Sperrprozesse
  - [3.3] Bootup-Phase
  - [3.4] Betriebszustand
    - [3.4.1] Betriebsaspekte
  - [3.5] Fachliche Anbindung der Clientsysteme
    - [3.5.1] Betriebsaspekte
  - [3.6] Clientsystemschnittstelle
    - [3.6.1] SOAP-Schnittstelle
    - [3.6.2] Statusrückmeldung und Fehlerbehandlung
    - [3.6.3] Transport großer Dokumente
  - [3.7] Verwendung manuell importierter CA-Zertifikate
  - [3.8] Testunterstützung
- [4] Funktionsmerkmale
  - [4.1] Anwendungskonnektor
    - [4.1.1] Zugriffsberechtigungsdienst
      - [4.1.1.1] Funktionsmerkmalweite Aspekte
      - [4.1.1.2] Durch Ereignisse ausgelöste Reaktionen
      - [4.1.1.3] Interne TUCs, nicht durch Fachmodule nutzbar
      - [4.1.1.4] Interne TUCs, auch durch Fachmodule nutzbar
        - [4.1.1.4.1] TUC_KON_000 „Prüfe Zugriffsberechtigung“
      - [4.1.1.5] Operationen an der Außenschnittstelle
      - [4.1.1.6] Betriebsaspekte
    - [4.1.2] Dokumentvalidierungsdienst
      - [4.1.2.1] Funktionsmerkmalweite Aspekte
      - [4.1.2.2] Durch Ereignisse ausgelöste Reaktionen
      - [4.1.2.3] Interne TUCs, nicht durch Fachmodule nutzbar
      - [4.1.2.4] Interne TUCs, auch durch Fachmodule nutzbar
        - [4.1.2.4.1] TUC_KON_080 „Dokument validieren”
      - [4.1.2.5] Operationen an der Außenschnittstelle
      - [4.1.2.6] Betriebsaspekte
    - [4.1.3] Dienstverzeichnisdienst
      - [4.1.3.1] Funktionsmerkmalweite Aspekte
      - [4.1.3.2] Durch Ereignisse ausgelöste Reaktionen
      - [4.1.3.3] Interne TUCs, nicht durch Fachmodule nutzbar
      - [4.1.3.4] Interne TUCs, auch durch Fachmodule nutzbar
        - [4.1.3.4.1] TUC_KON_041 „Einbringen der Endpunktinformationen während der Bootup-Phase“
      - [4.1.3.5] Operationen an der Außenschnittstelle
      - [4.1.3.6] Betriebsaspekte
    - [4.1.4] Kartenterminaldienst
      - [4.1.4.1] Funktionsmerkmalweite Aspekte
      - [4.1.4.2] Durch Ereignisse ausgelöste Reaktionen
      - [4.1.4.3] Interne TUCs, nicht durch Fachmodule nutzbar
        - [4.1.4.3.1] TUC_KON_050 „Beginne Kartenterminalsitzung“
        - [4.1.4.3.2] TUC_KON_054 „Kartenterminal hinzufügen“
        - [4.1.4.3.3] TUC_KON_053 „Paire Kartenterminal“
        - [4.1.4.3.4] TUC_KON_055 „Befülle CT-Object“
      - [4.1.4.4] Interne TUCs, auch durch Fachmodule nutzbar
        - [4.1.4.4.1] TUC_KON_051 „Mit Anwender über Kartenterminal interagieren“
        - [4.1.4.4.2] TUC_KON_056 „Karte anfordern“
        - [4.1.4.4.3] TUC_KON_057 „Karte auswerfen“
        - [4.1.4.4.4] TUC_KON_058 „Displaygröße ermitteln“
      - [4.1.4.5] Operationen an der Außenschnittstelle
        - [4.1.4.5.1] RequestCard
        - [4.1.4.5.2] EjectCard
      - [4.1.4.6] Betriebsaspekte
        - [4.1.4.6.1] Allgemeine Betriebsaspekte
        - [4.1.4.6.2] Kartenterminals pflegen
        - [4.1.4.6.3] Import der Kartenterminal-Informationen
    - [4.1.5] Kartendienst
      - [4.1.5.1] Funktionsmerkmalweite Aspekte
      - [4.1.5.2] Durch Ereignisse ausgelöste Reaktionen
      - [4.1.5.3] Interne TUCs, nicht durch Fachmodule nutzbar
        - [4.1.5.3.1] TUC_KON_001 „Karte öffnen“
      - [4.1.5.4] Interne TUCs, auch durch Fachmodule nutzbar
        - [4.1.5.4.1] TUC_KON_026 „Liefere CardSession“
        - [4.1.5.4.2] TUC_KON_012 „PIN verifizieren“
        - [4.1.5.4.3] TUC_KON_019 „PIN ändern“
        - [4.1.5.4.4] TUC_KON_021 „PIN entsperren“
        - [4.1.5.4.5] TUC_KON_022 „Liefere PIN-Status“
        - [4.1.5.4.6] TUC_KON_027 „PIN-Schutz ein-/ausschalten“
        - [4.1.5.4.7] TUC_KON_023 „Karte reservieren“
        - [4.1.5.4.8] TUC_KON_005 „Card-to-Card authentisieren“
        - [4.1.5.4.9] TUC_KON_202 „LeseDatei“
        - [4.1.5.4.10] TUC_KON_203 „SchreibeDatei“
        - [4.1.5.4.11] TUC_KON_204 „LöscheDateiInhalt“
        - [4.1.5.4.12] TUC_KON_209 „LeseRecord“
        - [4.1.5.4.13] TUC_KON_210 „SchreibeRecord“
        - [4.1.5.4.14] TUC_KON_211 „LöscheRecordInhalt“
        - [4.1.5.4.15] TUC_KON_214 „FügeHinzuRecord“
        - [4.1.5.4.16] TUC_KON_215 „SucheRecord“
        - [4.1.5.4.17] TUC_KON_018 „eGK-Sperrung prüfen“
        - [4.1.5.4.18] TUC_KON_006 „Datenzugriffsaudit eGK schreiben“
        - [4.1.5.4.19] TUC_KON_218 „Signiere“
        - [4.1.5.4.20] TUC_KON_219 „Entschlüssele“
        - [4.1.5.4.21] TUC_KON_200 „SendeAPDU“
        - [4.1.5.4.22] TUC_KON_024 „Karte zurücksetzen“
        - [4.1.5.4.23] TUC_KON_216 „LeseZertifikat“
        - [4.1.5.4.24] TUC_KON_036 „LiefereFachlicheRolle“
      - [4.1.5.5] Operationen an der Außenschnittstelle
        - [4.1.5.5.1] VerifyPin
        - [4.1.5.5.2] ChangePin
        - [4.1.5.5.3] GetPinStatus
        - [4.1.5.5.4] UnblockPin
        - [4.1.5.5.5] EnablePin
        - [4.1.5.5.6] DisablePin
      - [4.1.5.6] Betriebsaspekte
        - [4.1.5.6.1] TUC_KON_025 "Initialisierung Kartendienst"
        - [4.1.5.6.2] Kartenübersicht und PIN-Management
    - [4.1.6] Systeminformationsdienst
      - [4.1.6.1] Funktionsmerkmalweite Aspekte
      - [4.1.6.2] Durch Ereignisse ausgelöste Reaktionen
      - [4.1.6.3] Interne TUCs, nicht durch Fachmodule nutzbar
      - [4.1.6.4] Interne TUCs, auch durch Fachmodule nutzbar
        - [4.1.6.4.1] TUC_KON_256 „Systemereignis absetzen“
        - [4.1.6.4.2] TUC_KON_252 „Liefere KT_Liste“
        - [4.1.6.4.3] TUC_KON_253 „Liefere Karten_Liste“
        - [4.1.6.4.4] TUC_KON_254 „Liefere Ressourcendetails“
      - [4.1.6.5] Operationen an der Außenschnittstelle
        - [4.1.6.5.1] GetCardTerminals
        - [4.1.6.5.2] GetCards
        - [4.1.6.5.3] GetResourceInformation
        - [4.1.6.5.4] Subscribe
        - [4.1.6.5.5] Unsubscribe
        - [4.1.6.5.6] RenewSubscriptions
        - [4.1.6.5.7] GetSubscription
      - [4.1.6.6] Betriebsaspekte
    - [4.1.7] Verschlüsselungsdienst
      - [4.1.7.1] Funktionsmerkmalweite Aspekte
      - [4.1.7.2] Durch Ereignisse ausgelöste Reaktionen
      - [4.1.7.3] Interne TUCs, nicht durch Fachmodule nutzbar
      - [4.1.7.4] Interne TUCs, auch durch Fachmodule nutzbar
        - [4.1.7.4.1] TUC_KON_070 „Daten hybrid verschlüsseln”
        - [4.1.7.4.2] TUC_KON_071 „Daten hybrid entschlüsseln”
        - [4.1.7.4.3] TUC_KON_072 „Daten symmetrisch verschlüsseln”
        - [4.1.7.4.4] TUC_KON_073 „Daten symmetrisch entschlüsseln”
        - [4.1.7.4.5] TUC_KON_075 „Symmetrisch verschlüsseln“
        - [4.1.7.4.6] TUC_KON_076 „Symmetrisch entschlüsseln“
      - [4.1.7.5] Operationen an der Außenschnittstelle
        - [4.1.7.5.1] EncryptDocument
        - [4.1.7.5.2] DecryptDocument
      - [4.1.7.6] Betriebsaspekte
    - [4.1.8] Signaturdienst
      - [4.1.8.1] Funktionsmerkmalweite Aspekte
        - [4.1.8.1.1] Dokumentensignatur
        - [4.1.8.1.2] Signaturrichtlinien
        - [4.1.8.1.3] Signaturzeitpunkt
        - [4.1.8.1.4] Jobnummer
        - [4.1.8.1.5] Komfortsignatur
      - [4.1.8.2] Durch Ereignisse ausgelöste Reaktionen
      - [4.1.8.3] Interne TUCs, nicht durch Fachmodule nutzbar
        - [4.1.8.3.1] TUC_KON_155 „Dokumente zur Signatur vorbereiten”
        - [4.1.8.3.2] TUC_KON_165 „Signaturvoraussetzungen für nonQES prüfen“
        - [4.1.8.3.3] TUC_KON_166 „nonQES Signaturen erstellen“
        - [4.1.8.3.4] TUC_KON_152 "Signaturvoraussetzungen für QES prüfen"
        - [4.1.8.3.5] TUC_KON_154 "QES Signaturen erstellen"
        - [4.1.8.3.6] TUC_KON_168 „Einzelsignatur QES erstellen“
        - [4.1.8.3.7] TUC_KON_158 "Komfortsignaturen erstellen"
      - [4.1.8.4] Interne TUCs, auch durch Fachmodule nutzbar
        - [4.1.8.4.1] TUC_KON_160 „Dokumente nonQES signieren”
        - [4.1.8.4.2] TUC_KON_161 „nonQES Dokumentsignatur prüfen”
        - [4.1.8.4.3] TUC_KON_162 „Kryptographische Prüfung der XML-Dokumentensignatur”
        - [4.1.8.4.4] TUC_KON_150 „Dokumente QES signieren”
        - [4.1.8.4.5] Anforderungen an die Stapelsignatur
        - [4.1.8.4.6] TUC_KON_151 „QES Dokumentensignatur prüfen“
        - [4.1.8.4.7] TUC_KON_170 „Dokumente mit Komfort signieren”
        - [4.1.8.4.8] TUC_KON_171 „Komfortsignatur einschalten”
        - [4.1.8.4.9] TUC_KON_172 „Komfortsignatur ausschalten”
        - [4.1.8.4.10] TUC_KON_173 „Liefere Signaturmodus”
      - [4.1.8.5] Operationen an der Außenschnittstelle
        - [4.1.8.5.1] SignDocument (nonQES und QES)
        - [4.1.8.5.2] VerifyDocument (nonQES und QES)
        - [4.1.8.5.3] StopSignature
        - [4.1.8.5.4] GetJobNumber
        - [4.1.8.5.5] ActivateComfortSignature
        - [4.1.8.5.6] DeactivateComfortSignature
        - [4.1.8.5.7] GetSignatureMode
      - [4.1.8.6] Betriebsaspekte
    - [4.1.9] Zertifikatsdienst
      - [4.1.9.1] Funktionsmerkmalweite Aspekte
      - [4.1.9.2] Durch Ereignisse ausgelöste Reaktionen
      - [4.1.9.3] Interne TUCs, nicht durch Fachmodule nutzbar
        - [4.1.9.3.1] TUC_KON_032 „TSL aktualisieren“
        - [4.1.9.3.2] TUC_KON_031 „BNetzA-VL aktualisieren“
        - [4.1.9.3.3] TUC_KON_040 „CRL aktualisieren“
        - [4.1.9.3.4] TUC_KON_033 „Zertifikatsablauf prüfen“
      - [4.1.9.4] Interne TUCs, auch durch Fachmodule nutzbar
        - [4.1.9.4.1] TUC_KON_037 „Zertifikat prüfen"
        - [4.1.9.4.2] TUC_KON_042 „CV-Zertifikat prüfen“
        - [4.1.9.4.3] TUC_KON_034 „Zertifikatsinformationen extrahieren“
      - [4.1.9.5] Operationen an der Außenschnittstelle
        - [4.1.9.5.1] CheckCertificateExpiration
        - [4.1.9.5.2] ReadCardCertificate
        - [4.1.9.5.3] VerifyCertificate
      - [4.1.9.6] Betriebsaspekte
        - [4.1.9.6.1] TUC_KON_035 „Zertifikatsdienst initialisieren“
    - [4.1.10] Protokollierungsdienst
      - [4.1.10.1] Funktionsmerkmalweite Aspekte
      - [4.1.10.2] Durch Ereignisse ausgelöste Reaktionen
      - [4.1.10.3] Interne TUCs, nicht durch Fachmodule nutzbar
      - [4.1.10.4] Interne TUCs, auch durch Fachmodule nutzbar
        - [4.1.10.4.1] TUC_KON_271 „Schreibe Protokolleintrag“
      - [4.1.10.5] Operationen an der Außenschnittstelle
      - [4.1.10.6] Betriebsaspekte
        - [4.1.10.6.1] TUC_KON_272 „Initialisierung Protokollierungsdienst
    - [4.1.11] TLS-Dienst
      - [4.1.11.1] Funktionsmerkmalweite Aspekte
      - [4.1.11.2] Durch Ereignisse ausgelöste Reaktionen
      - [4.1.11.3] Interne TUCs, nicht durch Fachmodule nutzbar
      - [4.1.11.4] Interne TUCs, auch durch Fachmodule nutzbar
        - [4.1.11.4.1] TUC_KON_110 „Kartenbasierte TLS-Verbindung aufbauen“
        - [4.1.11.4.2] TUC_KON_111 „Kartenbasierte TLS-Verbindung abbauen“
      - [4.1.11.5] Operationen an der Außenschnittstelle
      - [4.1.11.6] Betriebsaspekte
    - [4.1.12] LDAP-Proxy
      - [4.1.12.1] Funktionsmerkmalweite Aspekte
      - [4.1.12.2] Durch Ereignisse ausgelöste Reaktionen
      - [4.1.12.3] Interne TUCs, nicht durch Fachmodule nutzbar
      - [4.1.12.4] Interne TUCs, auch durch Fachmodule nutzbar
        - [4.1.12.4.1] TUC_KON_290 „LDAP-Verbindung aufbauen“
        - [4.1.12.4.2] TUC_KON_291 „Verzeichnis abfragen“
        - [4.1.12.4.3] TUC_KON_292 „LDAP-Verbindung trennen"
        - [4.1.12.4.4] TUC_KON_293 „Verzeichnisabfrage abbrechen"
      - [4.1.12.5] Operationen an der Außenschnittstelle
        - [4.1.12.5.1] Unterstützte LDAPv3 Operationen
      - [4.1.12.6] Betriebsaspekte
    - [4.1.13] Authentifizierungsdienst
      - [4.1.13.1] Funktionsmerkmalweite Aspekte
        - [4.1.13.1.1] Externe Authentisierung
      - [4.1.13.2] Durch Ereignisse ausgelöste Reaktionen
      - [4.1.13.3] Interne TUCs
      - [4.1.13.4] Operationen an der Außenschnittstelle
        - [4.1.13.4.1] ExternalAuthenticate
      - [4.1.13.5] Betriebsaspekte
    - [4.1.14] Betriebsdatenmeldedienst
  - [4.2] Netzkonnektor
    - [4.2.1] Anbindung LAN/WAN
      - [4.2.1.1] Funktionsmerkmalweite Aspekte
        - [4.2.1.1.1] Netzwerksegmentierung
        - [4.2.1.1.2] Routing und Firewall
      - [4.2.1.2] Durch Ereignisse ausgelöste Reaktionen
      - [4.2.1.3] Interne TUCs, nicht durch Fachmodule nutzbar
        - [4.2.1.3.1] TUC_KON_305 „LAN-Adapter initialisieren“
        - [4.2.1.3.2] TUC_KON_306 „WAN-Adapter initialisieren“
        - [4.2.1.3.3] TUC_KON_304 „Netzwerk-Routen einrichten“
      - [4.2.1.4] Interne TUCs, auch durch Fachmodule nutzbar
      - [4.2.1.5] Operationen an der Außenschnittstelle
      - [4.2.1.6] Betriebsaspekte
    - [4.2.2] DHCP-Server
      - [4.2.2.1] Funktionsmerkmalweite Aspekte
      - [4.2.2.2] Durch Ereignisse ausgelöste Reaktionen
      - [4.2.2.3] Interne TUCs, nicht durch Fachmodule nutzbar
      - [4.2.2.4] Interne TUCs, auch durch Fachmodule nutzbar
      - [4.2.2.5] Operationen an der Außenschnittstelle
        - [4.2.2.5.1] Liefere Netzwerkinformationen über DHCP
      - [4.2.2.6] Betriebsaspekte
        - [4.2.2.6.1] TUC_KON_343 „Initialisierung DHCP-Server“
    - [4.2.3] DHCP-Client
      - [4.2.3.1] Funktionsmerkmalweite Aspekte
      - [4.2.3.2] Durch Ereignisse ausgelöste Reaktionen
      - [4.2.3.3] Interne TUCs, nicht durch Fachmodule nutzbar
        - [4.2.3.3.1] TUC_KON_341 „DHCP-Informationen beziehen“
      - [4.2.3.4] Interne TUCs, auch durch Fachmodule nutzbar
      - [4.2.3.5] Operationen an der Außenschnittstelle
      - [4.2.3.6] Betriebsaspekte
    - [4.2.4] VPN-Client
      - [4.2.4.1] Funktionsmerkmalweite Aspekte
      - [4.2.4.2] Durch Ereignisse ausgelöste Reaktionen
      - [4.2.4.3] Interne TUCs, nicht durch Fachmodule nutzbar
        - [4.2.4.3.1] TUC_KON_321 „Verbindung zu dem VPN-Konzentrator der TI aufbauen“
        - [4.2.4.3.2] TUC_KON_322 „Verbindung zu dem VPN-Konzentrator des SIS aufbauen“
      - [4.2.4.4] Interne TUCs, auch durch Fachmodule nutzbar
      - [4.2.4.5] Operationen an der Außenschnittstelle
      - [4.2.4.6] Betriebsaspekte
    - [4.2.5] Zeitdienst
      - [4.2.5.1] Funktionsmerkmalweite Aspekte
      - [4.2.5.2] Durch Ereignisse ausgelöste Reaktionen
      - [4.2.5.3] Interne TUCs, nicht durch Fachmodule nutzbar
      - [4.2.5.4] Interne TUCs, auch durch Fachmodule nutzbar
        - [4.2.5.4.1] TUC_KON_351 “Liefere Systemzeit”
      - [4.2.5.5] Operationen an der Außenschnittstelle
        - [4.2.5.5.1] Sync_Time
      - [4.2.5.6] Betriebsaspekte
        - [4.2.5.6.1] TUC_KON_352 Initialisierung Zeitdienst
    - [4.2.6] Namensdienst und Dienstlokalisierung
      - [4.2.6.1] Funktionsmerkmalweite Aspekte
      - [4.2.6.2] Durch Ereignisse ausgelöste Reaktionen
      - [4.2.6.3] Interne TUCs, nicht durch Fachmodule nutzbar
      - [4.2.6.4] Interne TUCs, auch durch Fachmodule nutzbar
        - [4.2.6.4.1] TUC_KON_361 „DNS-Namen auflösen“
        - [4.2.6.4.2] TUC_KON_362 „Liste der Dienste abrufen“
        - [4.2.6.4.3] TUC_KON_363 „Dienstdetails abrufen“
      - [4.2.6.5] Operationen an der Außenschnittstelle
        - [4.2.6.5.1] GetIPAddress
      - [4.2.6.6] Betriebsaspekte
    - [4.2.7] Optionale Verwendung von IPv6
  - [4.3] Konnektormanagement
    - [4.3.1] Zugang und Benutzerverwaltung des Konnektormanagements
    - [4.3.2] Konnektorname und Versionsinformationen
    - [4.3.3] Konfigurationsdaten: Persistieren sowie Export-Import
    - [4.3.4] Administration von Fachmodulen
    - [4.3.5] Neustart und Werksreset
    - [4.3.6] Leistungsumfänge und Standalone-Szenarios
    - [4.3.7] Online-Anbindung verwalten
    - [4.3.8] Re-Registrierung des Konnektors mit weiterem NK-Zertifikat
    - [4.3.9] Remote Management (Optional)
    - [4.3.10] Software- und Konfigurationsaktualisierung (KSR-Client)
      - [4.3.10.1] Funktionsmerkmalweite Aspekte
      - [4.3.10.2] Durch Ereignisse ausgelöste Reaktionen
      - [4.3.10.3] Interne TUCs, nicht durch Fachmodule nutzbar
        - [4.3.10.3.1] TUC_KON_280 „Konnektoraktualisierung durchführen“
        - [4.3.10.3.2] TUC_KON_281 „Kartenterminalaktualisierung anstoßen“
        - [4.3.10.3.3] TUC_KON_282 „UpdateInformationen beziehen“
        - [4.3.10.3.4] TUC_KON_283 „Infrastruktur Konfiguration aktualisieren“
      - [4.3.10.4] Interne TUCs, auch durch Fachmodule nutzbar
        - [4.3.10.4.1] TUC_KON_285 „UpdateInformationen für Fachmodul beziehen“
        - [4.3.10.4.2] TUC_KON_286 „Paket für Fachmodul laden“
      - [4.3.10.5] Operationen an der Außenschnittstelle
      - [4.3.10.6] Betriebsaspekte
        - [4.3.10.6.1] TUC_KON_284 KSR-Client initialisieren
    - [4.3.11] Konnektorstatus
  - [4.4] Hardware-Merkmale des Konnektors
- [5] Anhang A – Verzeichnisse
  - [5.1] Abkürzungen
  - [5.2] Glossar
  - [5.3] Abbildungsverzeichnis
  - [5.4] Tabellenverzeichnis
  - [5.5] Referenzierte Dokumente
    - [5.5.1] Dokumente der gematik
    - [5.5.2] Weitere Dokumente
- [6] Anhang B – Profilierung der Signatur- und Verschlüsselungsformate (normativ)
  - [6.1] Profilierung der Verschlüsselungsformate
  - [6.2] Profilierung der Signaturformate
  - [6.3] Profilierung VerificationReport
  - [6.4] Profilierung der Dokumentenformate und Nachrichten
- [7] Anhang F – Übersicht Events
- [8] Anhang H – Mapping von „Architektur der TI-Plattform“ auf Konnektorspezifikation
- [9] Anhang I – Umsetzungshinweise (informativ)
  - [9.1] Systemüberblick
    - [9.1.1] – Hinweise zur Sicherheitsevaluierung nach Common Criteria
      - [9.1.1.1] Separationsmechanismen des Konnektors
      - [9.1.1.2] Granularität der TSF
  - [9.2] Übergreifende Festlegungen
    - [9.2.1] Interne Mechanismen
      - [9.2.1.1] Zufallszahlen und Schlüssel
  - [9.3] Funktionsmerkmale
    - [9.3.1] Anwendungskonnektor
      - [9.3.1.1] Administration des Informationsmodells
      - [9.3.1.2] Vorgehensvariante für das Handling von CardSessions
      - [9.3.1.3] Darstellung von Terminal-Anzeigen auf einem Kartenterminal
- [10] Anhang K – Szenarien im dezentralen Umfeld
  - [10.1] Szenario 1: Einfache Installation ohne spezielle Anforderungen und ohne bestehende Infrastruktur
    - [10.1.1] Beschreibung des Szenarios
    - [10.1.2] Voraussetzungen
    - [10.1.3] Auswirkungen
  - [10.2] Szenario 2: Installation mit mehreren Behandlungsräumen
    - [10.2.1] Beschreibung des Szenarios
    - [10.2.2] Voraussetzungen
    - [10.2.3] Auswirkungen
  - [10.3] Szenario 3: Integration in bestehende Infrastruktur ohne Netzsegmentierung
    - [10.3.1] Beschreibung des Szenarios
    - [10.3.2] Voraussetzungen
    - [10.3.3] Auswirkungen
  - [10.4] Szenario 4: Integration in bestehende Infrastruktur mit Netzsegmentierung
    - [10.4.1] Beschreibung des Szenarios
    - [10.4.2] Voraussetzungen
    - [10.4.3] Auswirkungen
  - [10.5] Szenario 5: Zentral gesteckter HBA
    - [10.5.1] Beschreibung des Szenarios
    - [10.5.2] Voraussetzungen
    - [10.5.3] Auswirkung
  - [10.6] Szenario 6: Installation mit zentralem PS
    - [10.6.1] Beschreibung des Szenarios
    - [10.6.2] Voraussetzungen
    - [10.6.3] Auswirkungen
  - [10.7] Szenario 7: Mehrere Mandanten
    - [10.7.1] Beschreibung des Szenarios
    - [10.7.2] Voraussetzungen
    - [10.7.3] Auswirkungen
  - [10.8] Szenario 9: Standalone Konnektor - Physische Trennung
    - [10.8.1] Beschreibung des Szenarios
    - [10.8.2] Voraussetzungen
    - [10.8.3] Auswirkung
- [11] Anhang L – Datentypen von Eingangs- und Ausgangsdaten

### 1 Einordnung des Dokumentes

### 1.1 Zielsetzung

Die vorliegende Spezifikation definiert die Anforderungen zu Herstellung, Test
und Betrieb des Produkttyps Konnektor.

Dieses Dokument beschreibt die dezentrale Komponente zur sicheren Anbindung von
Clientsystemen der Institutionen und Organisationen des Gesundheitswesens an
die Telematikinfrastruktur – den Konnektor. Der Konnektor ist einerseits
verantwortlich für den Zugriff auf die in der Einsatzumgebung befindlichen
Kartenterminals sowie Karten und andererseits für die Kommunikation mit den
zentralen Diensten der TI-Plattform und fachanwendungsspezifischen Diensten.
Aus den Kommunikationsbeziehungen mit Clientsystem, Kartenterminals, Karten und
zentralen Diensten der TI-Plattform und fachanwendungsspezifischen Diensten
resultieren vom Konnektor anzubietende Schnittstellen, die gemeinsam in diesem
Dokument sowie den fachanwendungsspezifischen Fachmodulspezifikationen normativ
geregelt werden. Vom Konnektor genutzte Schnittstellen liegen zumeist in
anderen Verantwortungsbereichen (zentrale TI-Plattform aber auch Schnittstellen
der Kartenterminals und Karten). Diese werden in den übergreifenden
Spezifikationen der TI sowie den Produkttypspezifikationen definiert.

Dieses Dokument regelt somit nur einen Teil des Konnektors (wenngleich auch den
Wesentlichen). Für die Implementierung eines Konnektors ist entsprechend die
Kenntnis aller weiteren Spezifikationen erforderlich. Die Gesamtheit aller für
den Konnektor relevanten Dokumente wird im Produkttypsteckbrief des Konnektors
erhoben.

### 1.2 Zielgruppe

Das Dokument richtet sich an Konnektorhersteller sowie Hersteller und Anbieter
von Produkttypen (dies beinhaltet auch die Anbieter zur G2-Ausschreibung), die
hierzu eine Schnittstelle besitzen.

### 1.3 Geltungsbereich

Dieses Dokument enthält normative Festlegungen zur Telematikinfrastruktur des
Deutschen Gesundheitswesens. Der Gültigkeitszeitraum der vorliegenden Version
und deren Anwendung in Zulassungsverfahren werden durch die gematik GmbH in
gesonderten Dokumenten (z. B. Dokumentenlandkarte, Produkttypsteckbrief,
Leistungsbeschreibung) festgelegt und bekannt gegeben.

Wichtiger Schutzrechts-/Patentrechtshinweis

Die nachfolgende Spezifikation ist von der gematik allein unter technischen
Gesichtspunkten erstellt worden. Im Einzelfall kann nicht ausgeschlossen
werden, dass die Implementierung der Spezifikation in technische Schutzrechte
Dritter eingreift. Es ist allein Sache des Anbieters oder Herstellers, durch
geeignete Maßnahmen dafür Sorge zu tragen, dass von ihm aufgrund der
Spezifikation angebotene Produkte und/oder Leistungen nicht gegen Schutzrechte
Dritter verstoßen und sich ggf. die erforderlichen Erlaubnisse/Lizenzen von
den betroffenen Schutzrechtsinhabern einzuholen. Die gematik GmbH übernimmt
insofern keinerlei Gewährleistungen.

### 1.4 Abgrenzung des Dokuments

Spezifiziert werden in dem Dokument die von dem Produkttyp bereitgestellten
(angebotenen) Schnittstellen. Benutzte Schnittstellen werden hingegen in der
Spezifikation desjenigen Produkttypen beschrieben, der diese Schnittstelle
bereitstellt. Auf die entsprechenden Dokumente wird referenziert.

Die vollständige Anforderungslage für den Produkttyp ergibt sich aus weiteren
Konzept- und Spezifikationsdokumenten, diese sind in dem Produkttypsteckbrief
des Produkttyps Konnektor verzeichnet.

### 1.5 Methodik

### 1.5.1 Anforderungen

Anforderungen als Ausdruck normativer Festlegungen werden durch eine eindeutige
ID sowie die dem RFC 2119 [RFC2119] entsprechenden, in Großbuchstaben
geschriebenen deutschen Schlüsselworte MUSS, DARF NICHT, SOLL, SOLL NICHT,
KANN gekennzeichnet.

Sie werden im Dokument wie folgt dargestellt:

\<AFO-ID\> - \<Titel der Afo\>Text / Beschreibung[ \<=]Dabei umfasst die
Anforderung sämtliche innerhalb der Afo-ID und der Textmarke angeführten
Inhalte.

\<AFO-ID\> - *

Das Zeichen '*' steht hierbei für den Suffix der Anforderung. Es gilt der im
Dokumentenpaket gültige Suffix.

### 1.5.2 Offene Punkte

Zum Zeitpunkt der Spezifikationserstellung konnten nicht alle Details
abschließend geklärt werden, insbesondere, da Abstimmungsbedarf mit der
umsetzenden Industrie besteht. Details, die keine produkttypübergreifenden
Auswirkungen haben und die im Rahmen des Verhandlungsverfahrens mit der
Industrie besprochen werden müssen, werden als „Offene Punkte“ ausgewiesen
und wie folgt im Dokument kenntlich gemacht:

<table><tr><td>
Die XYZ müssen noch definiert werden.

</td></tr></table>

### 1.5.3 Erläuterungen zur Spezifikation des Außenverhaltens

Der Konnektor stellt einen vergleichsweise komplexen Produkttyp dar, dessen
Beschreibung eine Herausforderung darstellt und somit in vielen verschiedenen
Varianten möglich wäre. An dieser Stelle folgen daher wesentliche
Informationen, die das korrekte Verstehen der Spezifikation fördern:

Die Spezifikation des Konnektors ist eine Black-Box-Spezifikation, das heißt
alle Festlegungen dienen ausschließlich der Beschreibung des von der
Komponente verlangten Verhaltens an der Außenschnittstelle.

Normative Festlegungen, die eine Festlegung des inneren Verhalten vermuten
lassen (beispielsweise die Definitionen der Technischen Use Cases - TUCs) sind
nur in so weit normativ, wie ihre Festlegungen auf die Außenschnittstelle
wirken. Sie legen explizit nicht die intern zu verwendende Implementierung
fest. Die Notwendigkeit für diese Art der „scheinbaren internen
Beschreibung“ ergibt sich aus der Komplexität der Gesamtkomponente, sowie
dem Bedarf, wiederholt ähnlich Verhaltensweisen in Außenschnittstellen
darstellen zu müssen. In diesem Fall werden die sich wiederholenden
Verhaltensanteile in internen TUCs zur editoriellen Wiederverwendung gekapselt.
Die konkrete konnektorinterne Modularisierung bleibt dem Hersteller
freigestellt. Insbesondere bleibt es dem Hersteller freigestellt, intern
bereits Mechanismen für kommende Releases zu realisieren, sofern diese an der
Außenschnittstelle keine Auswirkung zeigen.

Die einzige Abweichung von dieser Vorgehensweise ergibt sich für
Sicherheitsaspekte. Hier können interne Vorgänge normativ gefordert sein, die
sich an der Außenschnittstelle nicht manifestieren (Beispiel „Verpflichtung
auf sicheres Löschen eines temporären Schlüssels nach Gebrauch“). In
diesem Fall erfolgt die Überprüfung der Einhaltung dieser Anforderungen im
Rahmen der CC-Evaluierung.

### 1.5.4 Erläuterungen zur Dokumentenstruktur und „Dokumentenmechanismen“

### 1.5.4.1 Modulare Spezifikation über Funktionsmerkmale

Die Beschreibung des Konnektors erfolgt soweit wie möglich modular, d. h. alle
Aspekte, die für einen logischen Bereich relevant sind, werden in einem
Kapitel beschrieben. Diese logischen Bereiche werden als Funktionsmerkmal
bezeichnet.

Funktionsmerkmale kennzeichnet ein eigener Verantwortungsbereich. In diesen
Verantwortungsbereich greifen keine anderen Funktionsmerkmale ein. So kann ein
logischer Bereich vollständig durchdrungen werden, ohne dass in anderen
Kapiteln Anforderungen zu erwarten wären, die das Verhalten des
Funktionsmerkmals beeinflussen. Da zwischen Funktionsmerkmalen Wechselwirkungen
bestehen (Die Erkennung einer gesteckten Karte im Kartenterminaldienst löst
eine Reaktion im Kartendienst aus), wurden zur „dokumententechnischen
Interaktion“ zwischen Funktionsmerkmalen ein interner Event-Mechanismus sowie
Konfigurationsparameter und Zustandswerte eingeführt (siehe Folgekapitel).

Funktionsmerkmale bestehen (bis auf wenige Ausnahmen) immer aus folgenden
Unterkapiteln:

 ---> OL

Die Unterkapitel 1-5 dienen der funktionalen Beschreibung des Funktionsmerkmals.

Punkte, die zum Funktionieren des Funktionsmerkmals relevant sind:
Initialisierungsaspekte, durch den Administrator festzulegenden
Konfigurationsparameter etc., werden im Unterkapitel Betriebsaspekte erfasst.

In jedem Funktionsmerkmal sind immer alle Unterkapitel enthalten, auch wenn es
im konkreten Einzelfall dort keine Inhalte gibt. Diese feste Struktur innerhalb
der Funktionsmerkmale erleichtert die Orientierung und erhöht somit die
Lesbarkeit.

### 1.5.4.2 Technische Use Cases - TUCs

Innerhalb der Funktionsmerkmale in Kapitel 4 erfolgt eine Unterscheidung der
TUCs in solche, die nur durch die Basisdienste des Konnektors aufgerufen werden
dürfen (rein interne TUCs) und solche die neben den Basisdiensten auch durch
Fachmodule genutzt werden dürfen. Diese Unterteilung ergibt sich
ausschließlich aus dem Bedarf der editoriellen Steuerung der verschiedenen
Spezifikationen (Konnektor- und Fachmodulspezifikationen). Es besteht im Rahmen
der Implementierung des Konnektors keine Anforderung diese Trennung intern
durchzusetzen.

Die Beschreibung der TUCs erfolgt nach folgendem Muster:

 ---> UL

Dabei wird innerhalb der TUC-Tabelle in der Zeile „Standardablauf“
ausschließlich der Gut-Durchlauf beschrieben. Fehler, die innerhalb dieses
Ablaufs auftreten können, werden in der Zeile „Fehlerfälle“ erhoben.
Dabei wird auf die jeweilige Schrittnummer innerhalb des Ablaufs referenziert.
In dieser Tabellenzeile werden nur Fehlercodes erhoben, die im jeweiligen
Fehlerfall geworfen werden müssen. Die genauen Festlegungen zu den Fehlern,
neben Fehlercode auch: ErrorType, Severity und Fehlertext, werden in der
Fehlercodetabelle festgelegt.    

Die Spezifikation, in der ein TUC definiert wird, ist an den mittleren drei
Buchstaben der TUC-Referenz zu erkennen:

 ---> UL

Festlegungen zur Schreibweise von Eingangs- und Ausgangsdaten von TUCs

a) Eingangs- und Ausgangsparameter werden in TUC-Tabellen wie folgt beschrieben:

Name des Eingangs- bzw. Ausgangsparameters

gefolgt von(falls definiert):[Datentyp]

gefolgt von(falls zutreffend):

-optional; default: \<Defaultwert\>bzw.

-optional;/\<erklärender Text\>  

Hierbei bedeuten:- optional;kennzeichnet optionale Ein- und Ausgangsparameter

default: \<Defaultwert\>definiert den Defaultwert für den Fall, dass der
Eingangsparameter leer ist bzw. nicht übergeben wurde

/\<erklärender Text\>beschreibt Bedingungen, unter denen der Eingangsparameter
optional ist

    gefolgt von(falls vorhanden):(\<erklärender Text\>)

b) Namen mit kleinem Anfangsbuchstaben bezeichnen Ein- und Ausgangsparameter;
Namen mit großem Anfangsbuchstaben bezeichnen Datentypen.

Beispiel:

<table><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr></table>

Die im Dokument verwendeten Datentypen sind definiert in [Anhang L –
Datentypen von Eingangs- und Ausgangsdaten].

Festlegungen zur Schreibweise des Aufrufs von TUCs

Ein TUC-Aufruf erfolgt nach folgendem Muster:

\<TUC-Bezeichner\> {

   \<TUC-Eingangsparameter Name\> = \<TUC Eingangsparameter Wert\>;

   … }

Beispiel:

TUC_KON_256 {    topic = „CT/DISCONNECTED“;    eventType =
Op;    severity = Info;    parameters = („CtID=$CT.CTID,
Hostname=$CT.HOSTNAME“) }

Vereinfachung:

Ist \<TUC-Eingangsparameter Name\> des aufzurufenden TUCs gleich der Variablen,
die als \< TUC Eingangsparameter Wert\> gesetzt wird, so kann dieser Bezeichner
ohne Zuweisung geschrieben werden.

Beispiel: (cardSession und pinRef sind Eingangsdaten des aufrufenden TUCs):

TUC_KON_022 „Liefere PIN-Status“ {cardSession=cardSession; pinRef=pinRef}

vereinfachte Schreibweise:

TUC_KON_022 „Liefere PIN-Status“ {cardSession; pinRef}

### 1.5.4.3 Event-Mechanismus

Der in Kapitel 4.1.6 spezifizierte Event-Mechanismus zur Unterrichtung von
Clientsystemen wird innerhalb dieser Spezifikation auch zur internen Verzahnung
der einzelnen Funktionsmerkmale eingesetzt. So wird ein Ereignis, das in der
Managementschnittstelle durch Änderung eines Konfigurationsparameters
ausgelöst wird, innerhalb des DHCP-Kapitels als Trigger für eine
Lease-Erneuerung verwendet. Dies bedeutet nicht, dass im Rahmen der
Implementierung intern ein Event-Mechanismus zwischen den Modulen verwendet
werden muss. Auch hier dient die Form der Darstellung (Events) lediglich der
editoriellen Kopplung verschiedener Verhaltensbeschreibungen.

Um den Ursprung eines Events erkennen zu können, verwenden alle Events ein
Haupt-Topic passend zum Funktionsmerkmal: „DHCP/LAN_CLIENT/RENEW” wird im
Funktionsmerkmal DHCP ausgelöst, „CARD/INSERTED” wird im Funktionsmerkmal
Kartendienst ausgelöst usw.     

### 1.5.4.4 Konfigurationsparameter und Zustandswerte

Werte die der Administrator des Konnektors einsehen oder verändern können
muss, werden zusätzlich zu den Festlegungen in Kapitel 4.3 Konnektormanagement
auch pro Funktionsmerkmal in den jeweiligen Unterkapiteln „Betriebsaspekte“
erhoben. DieseKonfigurationsparameterwerden über eine ReferenzID definiert.
Definierte Konfigurationsparameter können in allen Kapiteln der Spezifikation
referenziert werden. Den Ort, an welchem ein solcher Konfigurationsparameter
definiert/erhoben und somit dessen Bedeutung beschrieben wird, lässt sich
über den Präfix der ReferenzID erkennen:CERT_CRL_DOWNLOAD_ADDRESS(also
„Cert“) wird im Zertifikatsdienst definiert,MGM_LU_ONLINE(also „MGM“)
wird im Konnektormanagement definiert usw.

Die ReferenzIDs der Konfigurationsparameter besitzen in ihrer Schreibweise nur
innerhalb des Dokuments Gültigkeit. In der Umsetzung können für die
Konfigurationswerte herstellerspezifische Beschreibungen und Labels verwendet
werden.

Vergleichbar zu diesen Konfigurationsparametern, sindZustandswerte.Auch diese
werden über ReferenzIDs definiert, nur können sie nicht durch den
Administrator verändert oder eingesehen werden. Sie finden nur konnektorintern
Verwendung und sind für die Beschreibung der Verhaltensweise notwendig,
Beispiele sindCTM_CT_LISTfür die Liste der durch den Konnektor verwalteten
Kartenterminals oderCM_CARD_LISTfür die Liste der aktuell erreichbaren Karten.
Zustandswerte verwenden die gleichen Präfixe wie Konfigurationsparameter.

### 2 Systemüberblick

Der Konnektor ist ein Produkttyp der TI gemäß [gemKPT_Arch_TIP#5.3.9].

Er bietet seine Basisdienste sowohl intern den in ihm laufenden Fachmodulen an,
als auch externen Clientsystemen über die Konnektoraußenschnittstellen.

Im lokalen Netz der Einsatzumgebung kommuniziert das Clientsystem mit dem
Konnektor über dessen LAN-seitiges Ethernet-Interface. Alleinig der Konnektor
kommuniziert mit den in lokalen Netzen angeschlossenen Kartenterminals und
Karten. Auch die Kommunikation mit den zentralen Diensten der TI-Plattform und
fachanwendungsspezifischen Diensten erfolgt ausschließlich über den Konnektor
über dessen WAN-seitiges Ethernet-Interface.

Abbildung PIC_KON_116 stellt die Schnittstellen im Umfeld des Konnektors dar.

![Abbildung-1][Abbildung-1]

Die logischen Außenschnittstellen aus [gemKPT_Arch_TIP] werden im Konnektor
technisch vorrangig als SOAP-Schnittstellen ausgeprägt. Von dieser Regel wird
insbesondere bei Netzwerkschnittstellen abgewichen, wenn bereits etablierte
Schnittstellenstandards für Basisdienste existieren (IPsec, TLS, NTP, DNS
etc.). Eine Übersicht der Zuordnung „logische Schnittstellentechnische
Schnittstellen“ findet sich in Anhang H.

Zum Nachweis der Sicherheit müssen Konnektoren im Rahmen der Zulassung nach
Common Criteria gegen die Schutzprofile [PP_NK] und [PP_KON] evaluiert und
zertifiziert werden.

Die zu verwendenden kryptographischen Verfahren und zugehörige Parameter
(z. B. Schlüssellängen) für alle kryptographischen Operationen innerhalb
der Telematikinfrastruktur, werden durch das Dokument „Verwendung
kryptographischer Algorithmen in der Telematikinfrastruktur“ [gemSpec_Krypt]
normativ geregelt.

### 2.1 Logische Struktur

Der Produkttyp Konnektor besitzt eine Vielzahl verschiedenster Operationen und
Verhaltensweisen an seiner Außenschnittstelle. Um sein komplexes
Gesamtverhalten sinnvoll beschreiben zu können, wird der Konnektor innerhalb
dieser Spezifikation logisch unterteilt und strukturiert. Es wird primär
zwischen Anwendungs- und Netzkonnektor unterschieden, begleitet von
Mechanismen, die blockübergreifend beschrieben werden.

Der logische Aufbau des Konnektors ist in Abbildung PIC_KON_117 dargestellt.

 ---> UL

![Abbildung-2][Abbildung-2]

Diese logische Unterteilung schreibt in keiner Art und Weise die spätere
Implementierung durch den Hersteller vor. Der Hersteller kann seine interne
Modularisierung des Konnektors frei wählen. Normativ wirksam ist
ausschließlich das durch die Detailfestlegungen in Summe beschriebene
Verhalten an den Außenschnittstellen des Konnektors als Ganzes.

### 2.2 Sicherer Datenspeicher

Wie im vorherigen Kapitel dargestellt, wird für den Konnektor ein Datenspeicher
angenommen, in welchem der Konnektor alle sicherheitskritischen,
veränderlichen Daten dauerhaft speichert, die für seinen Betrieb relevant
sind. Dieser Datenspeicher sichert die Integrität, Authentizität und
Vertraulichkeit der in ihm hinterlegten Daten bzw. der aus ihm entnommenen
Daten. Alleinig der Konnektor hat auf diesen Datenspeicher Zugriff. Für
folgende, im weiteren Verlauf der Spezifikation anfallende Daten wird
angenommen, dass diese im Sicheren Datenspeicher persistiert werden:

 ---> UL

Ferner stellt der Konnektor den in ihm laufenden Fachmodulen ebenfalls eine
Nutzung dieses Datenspeichers für ihre sensiblen Daten zur Verfügung.

Da es sich bei dem Sicheren Datenspeicher um ein internes Modul handelt, welches
an der Außenschnittstelle nicht testbar ist, werden an dieses Modul im Rahmen
dieser Spezifikation keine Anforderungen erhoben. Da dieses logische Modul aber
essenzielle Sicherheitsfunktionen bietet, ohne die ein Konnektor nicht sicher
betrieben werden kann, werden die Funktionen, die ein Hersteller für sein
Konnektormodell real umsetzt, um die notwendigen sicheren Speicherfunktionen zu
realisieren, im Rahmen der CC-Evaluierung geprüft werden. Näheres hierzu
regeln die Schutzprofile des Konnektors.

### 2.3 Überblick Konnektoridentität

Die Geräteidentität des Konnektors (Konnektoridentität) teilt sich in drei
Identitäten auf:

 ---> UL

In der Regel ergibt sich aus dem Kontext, welche Identität gemeint ist, sodass
in diesen Fällen nur kurz von der Konnektoridentität geschrieben wird.

Die Geräteidentitäten werden durch asymmetrische Schlüssel und
X.509-Zertifikate umgesetzt. In Abhängigkeit vom gewählten kryptographischen
Verfahren werden RSA-Schlüssel bzw. ECC-Schlüssel verwendet.

### 2.4 Mandantenfähigkeit

Den Anforderungen aus [gemKPT_Arch_TIP#TIP1-A_2200] folgend, wird die
Mandantenfähigkeit innerhalb des Konnektors nicht durch eine einzelne
Funktion, sondern durch Berücksichtigung in einer Reihe von Funktionsmerkmalen
umgesetzt.

Die Mandantenfähigkeit wirkt dabei auf:

 ---> UL

### 2.5 Versionierung

Gemäß [gemSpec_OM] müssen Konnektor und Kartenterminals über eine
Versionierung verfügen. Die relevanten Versionsinformationen sind durch das
O&M-Schema ProductInformation.xsd definiert. Ferner definiert [gemSpec_OM],
dass Konnektor und Kartenterminal das Konzept der Firmware-Gruppe verwenden
müssen. Daher verfügen die beiden Produkttypen auch über eine aktuelle
Firmware-Gruppenversion.

Versionsinformationen werden innerhalb des Konnektor an folgenden Stellen ver-
und bearbeitet:

 ---> UL

### 2.6 Fachanwendungen

Der Konnektor ist als Plattformkomponente der TI für die Erbringung von
Basisdiensten verantwortlich. Fachliche Funktionalitäten werden über die
Fachmodule bereitgestellt.

Das Fachmodul wird dabei als integraler Bestandteil des Konnektors verstanden
(Konnektor als Monolith), d. h., die Spezifikationen zu Konnektor (als
Plattformkomponente) und dem Fachmodul sind zwar getrennt, werden aber von
einem Hersteller in einer Gesamtkomponente umgesetzt. Die inneren
Schnittstellen zwischen Fachmodul und Konnektor sind von außen nicht erkennbar.

In dieser Ausbaustufe unterstützt der Konnektor die Fachanwendungen VSDM,
AMTS, NFDM und ePA über jeweils ein Fachmodul.

Neben Fachanwendungen, die über ihr Fachmodul mit einem gesicherten Fachdienst
kommunizieren, unterstützt der Konnektor einen Zugriff von Clientsystemen auf
offene Fachdienste.

### 2.7 Netzseitige Einsatzszenarien

Der Konnektor unterstützt unterschiedliche netzseitige Einsatzszenarien, die in
Anhang K beispielhaft dargestellt sind.

Der Konnektor bietet hierzu Konfigurations-Parameter, die je nach netzseitigem
Einsatzszenario konfiguriert werden müssen.

### 2.7.1 Parameter ANLW_ANBINDUNGS_MODUS

Konfiguration 1: Konnektor als Gateway (ANLW_ANBINDUNGS_MODUS = InReihe):Diese
Konfiguration ist geeignet für Szenarien, in denen der Konnektor zwischen das
lokale Netz und das Internet Access Gateway (IAG) (z. B. Router mit
DSL-/Kabelmodem) geschaltet wird. (vgl. Anhang K, Szenario 1)

Konfiguration 2: Konnektor eingebettet in existierende Infrastruktur
(ANLW_ANBINDUNGS_MODUS = Parallel):Diese Konfiguration ist geeignet für
Szenarien, in denen der Konnektor als weiteres Gerät in die bestehende
Netzwerkinfrastruktur integriert wird. (vgl. Anhang K, Szenario 3)

Aus Sicherheitsgründen soll die Kommunikation der Clientsysteme mit dem
Konnektor hierbei verschlüsselt erfolgen (ANCL_TLS_MANDATORY=Enabled). Falls
diese Kommunikation unverschlüsselt erfolgt (ANCL_TLS_MANDATORY=Disabled),
übernimmt der Nutzer die Verantwortung für die Sicherstellung der
vertraulichen Übertragung.

Für den Einsatz und die Nutzung von DHCP gibt es im Zusammenhang mit diesem
Konfigurationsparameter folgende Möglichkeiten:

 ---> UL

Die DHCP-Konfiguration ist in Konfiguration 1 in aller Regel die folgende: Die
WAN-Seite des Konnektors verwendet den DHCP-Server des bestehenden IAG. An der
LAN-Seite stellt der Konnektor einen DHCP-Server für alle Clients zur
Verfügung.

### 2.7.2 Parameter ANLW_INTERNET_MODUS

Grundsätzlich routet der Konnektor im Modus ANLW_INTERNET_MODUS=SIS alle für
das Internet bestimmten Pakete von Clients, die ihn als Default Gateway
verwenden, in den VPN-Tunnel zum SIS, während er im Modus
ANLW_INTERNET_MODUS=Keiner diese Pakete verwirft.

Im Unterschied zu (ANLW_ANBINDUNGS_MODUS = InReihe) ist die Nutzung des SIS bei
(ANLW_ANBINDUNGS_MODUS = Parallel) optional. Alternativ können auch die
Clients, die den Konnektor als Default Gateway verwenden, per Redirect direkt
ins Internet verwiesen werden (ANLW_INTERNET_MODUS=IAG).

### 2.8 Lokale und entfernte Kartenterminals

Gemäß [gemKPT_Arch_TIP] ermöglicht die Telematikinfrastruktur dem Anwender
die PIN-Eingabe zur Freischaltung eines HBAs oder einer SMC-B wahlweise lokal
oder über das Remote-PIN-Eingabeverfahren durchzuführen. Deshalb
unterscheidet auch der Konnektor zwischen einem lokalen Kartenterminal –
räumlich („in Sichtweite“) dem Arbeitsplatz zugeordnet – und einem
entfernten Kartenterminal.

Ein lokales Kartenterminal befindet sich lokal an einem Arbeitsplatz und kann
von diesem aus genutzt werden. Hingegen ist das entfernte Kartenterminal einem
entfernten oder auch – für zentral steckende Karten – keinem Arbeitsplatz
fest zugewiesen. Ein lokales Kartenterminal kann als sogenanntes Remote-PIN-KT
verwendet werden, um die PIN für eine in einem entfernten Kartenterminal
steckende Karte einzugeben.

### 2.9 Standalone-Szenario

Gemäß § 291 Absatz 2b SGB V müssen „Diese Dienste [zur
Online-Aktualisierung der Versichertendaten auf der eGK] […] auch ohne
Netzanbindung an die Praxisverwaltungssysteme der Leistungserbringer online
genutzt werden können.“

Dies bedeutet, dass der Konnektor ohne ein steuerndes Clientsystem
ereignisgetrieben Fachanwendungen ausführen können muss. Aus Fachsicht
„steht der Konnektor alleine“, ohne Clientsysteme. Die konkreten Aktionen,
die Fachanwendungen in diesen Fällen ausführen, sowie deren Auslöser werden
in den jeweiligen Fachmodulspezifikationen beschrieben.

Ein solcher alleinstehender Konnektor mit Zugang zur TI muss zur Durchführung
der Fachanwendungen durch einen weiteren Konnektor unterstützt werden, der in
direkter Verbindung zum Clientsystem steht, selbst aber keine Online-Anbindung
besitzt.

### 3 Übergreifende Festlegungen

Für die folgenden Inhalte bitte die Hinweise in Kapitel 1.5.3 „Erläuterungen
zur Spezifikation des Außenverhaltens" sowie Kapitel 1.5.4 Erläuterungen zur
Dokumentenstruktur und „Dokumentenmechanismen“ beachten.

In diesem Kapitel werden die Aspekte des Konnektors behandelt, die
Funktionsmerkmalübergreifend geregelt werden müssen.

Die Managementschnittelle/Administrationsoberfläche des Konnektors wird dabei
nicht als übergreifender Aspekt, sondern als eigenes Funktionsmerkmal
gewertet. Die Festlegungen hierzu finden sich entsprechend in Kapitel 4.3.

### 3.1 Allgemeine übergreifende Festlegungen

### 3.1.1 Dokumentformate

Mit dem Aufruf einer Operation, die Dokumente verarbeitet, muss durch den
Aufrufer festgelegt werden können, um welches Dokumentenformat es sich
handelt, damit die unterschiedlichen Formate zur Verarbeitung und etwaigen
Anzeige unterschieden werden können. Die nicht-XML-Formate werden dabei nach
MIME-Typ-Klassen unterschieden:

 ---> UL

Folgende Bezeichner werden verwendet:

Alle_DocFormate:      XML, PDF/A, Text, TIFF, Binär

nonQES_DocFormate:    XML, PDF/A, Text, TIFF, Binär

QES_DocFormate:        XML, PDF/A, Text, TIFF

Für nonQES_DocFormate wird, trotz Gleichheit zu Alle_DocFormate, ein eigener
Referenzbezeichner verwendet, da sich diese Liste noch ändern könnte. TIFF
wird durch [gemKPT_Arch_TIP] nicht für die nonQES verlangt. Die Unterstützung
dieses Formats für nonQES bedeutet jedoch keinen Mehraufwand, da die Routinen
durch QES bereits implementiert sind und nachgenutzt werden können.

##### TIP1-A_4500-02

Der Konnektor MUSS für alle Außenschnittstellen, in denen ein Dokument
verarbeitet wird, Dokumente mit einer Größe \<= 25 MB (26.214.400 Byte)
unterstützen. Der Konnektor DARF NICHT Dokumente mit einer Größe \> 25
MB (26.214.400 Byte) unterstützen. **[\<=]**

##### A_19052-01

Der Konnektor MUSS bei der Verarbeitung von Dokumenten und Nachrichten die
Mindestanforderungen aus TAB_KON_775erfüllen. Wenn vom Aufrufer übergebene
Dokumente oder Nachrichten die vom Konnektor unterstützte Dimensionierung
überschreiten, MUSS der Konnektor die Verarbeitung mit Fehler 4280 abweisen.

Tabelle1Fehlercodes TAB_KON_890 Mindestanforderungen an Dokumente und
Nachrichten

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td>
4280

</td><td>
Security

</td><td>
Error

</td><td>
Dimensionierung des Dokuments nicht unterstützt

</td></tr></table>

**[\<=]**

##### A_22673

Der Konnektor MUSS bei der Verarbeitung von Dokumenten und Nachrichten die
Einhaltung der Vorgaben aus TAB_KON_889sicherstellen. Wenn vom Aufrufer an den
Konnektor übergebene Dokumente oder Nachrichten gegen Vorgaben aus
TAB_KON_778 verstoßen, MUSS der Konnektor die Verarbeitung mit Fehler 4281
abbrechen.

Tabelle2Fehlercodes TAB_KON_891 Unerlaubte Inhalte in Dokumenten und Nachrichten

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td>
4281

</td><td>
Security

</td><td>
Error

</td><td>
Dokument enthält unzulässige Inhalte

</td></tr></table>

**[\<=]**

##### A_22923

Der Konnektor DARF in XML-Dokumenten- und Nachrichten enthaltene Attribute
schemaLocation und noNamespaceSchemaLocation NICHT auswerten. **[\<=]**

##### TIP1-A_4502

Der Konnektor MUSS bei der Verarbeitung von Dokumenten der Formate XML und Text
die Zeichensatzkodierungen UTF-8 und ISO-8859-15 unterstützen. Das
verarbeitete Dokument MUSS der Konnektor mit demselben Zeichensatz kodieren, in
dem das Eingangsdokument kodiert war. **[\<=]**

##### TIP1-A_5541-01

Der Konnektor DARF in Dokumenten eventuell vorhandene Referenzen auf externe
Ressourcen NICHT auflösen, es sei denn es sind Verweise auf im Konnektor
sicher eingebrachte vorliegende Schemata oder dies wird im Einzelfall
normativ gefordert. **[\<=]**

### 3.1.2 Kartentypen

Der Konnektor unterstützt eine Reihe von Kartentypen. Die folgende Tabelle
enthält die Liste der Referenzbezeichner für die verschiedenen Kartentypen,
wie sie im weiteren Verlauf verwendet werden. Die Unterstützung von Karten der
Generation 2 (G2.x: G2.0, G2.1 und höher) beschränkt sich bei diesen auf die
Datenstrukturen und Schlüssel, die aus Gründen der Abwärtskompatibilität zu
den Karten der Generation 1+ vorhanden sind. Eine Ausnahme hiervon bilden die
Geräte-CVCs, die bereits für dieses Release basierend auf ECC verwendet
werden.

<table><tr><th>
ReferenzID Kartentyp

</th><th>
Karten-

generation

</th><th>
Beschreibung

</th></tr><tr><td>
EGK

</td><td>
G1+

</td><td>
Die elektronische Gesundheitskarte gemäß [gemSpec_eGK_P1] und [gemSpec_eGK_P2]

</td></tr><tr><td>
EGK

</td><td>
G2

</td><td>
Die elektronische Gesundheitskarte gemäß [gemSpec_COS] und
[gemSpec_eGK_ObjSys] bzw. [gemSpec_eGK_ObjSys_G2.1]

</td></tr><tr><td>
HBA-qSig

</td><td>
-

</td><td>
HBA-Vorläuferkarte gemäß [HPC-P1] und [HPC-P2]

</td></tr><tr><td>
HBA

</td><td>
G2

</td><td>
Der elektronische Heilberufsausweis (HBA) gemäß [gemSpec_COS] und
[gemSpec_HBA_ObjSys]

</td></tr><tr><td>
SMC-B

</td><td>
G2

</td><td>
Die Institutionskarte Typ B (Secure Module Card) gemäß [gemSpec_COS] und
[gemSpec_SMC-B_ObjSys]

</td></tr><tr><td>
HSM-B

</td><td>
</td><td>
HSM-Variante einer SM-B.

Das HSM-B wird in dieser Fassung als ein oder mehrere virtuelle Kartenterminals
verstanden, in denen virtuelle Karten stecken.

</td></tr><tr><td>
SMC-KT

</td><td>
G2

</td><td>
Die Karte Typ KT (Secure Module Card) gemäß [gemSpec_COS] und
[gemSpec_gSMC-KT_ObjSys]

</td></tr><tr><td>
KVK

</td><td>
-

</td><td>
Die Krankenversichertenkarte gemäß der Spezifikation [KVK]

</td></tr><tr><td>
ZOD_2.0

</td><td>
-

</td><td>
HBA-Vorläuferkarte gemäß [HPC-P1] und [HPC-P2]

</td></tr><tr><td>
UNKNOWN

</td><td>
</td><td>
Eine nicht erkannte Karte oder nicht lesbare Karte

</td></tr><tr><td>
</td><td>
</td><td>
Zusammenfassende ReferenzIDs

</td></tr><tr><td>
HBA-VK

</td><td>
</td><td>
Adressiert die HBA-Vorläuferkarten HBA-qSig und ZOD_2.0.

Wird dieser Referenzbezeichner verwendet, gelten die zugehörigen Aussagen und
Festlegungen für beide Kartentypen.

</td></tr><tr><td>
HBAx

</td><td>
</td><td>
Adressiert sowohl den HBA, als auch die HBA-Vorläuferkarten (HBA-VK)

Wird dieser Referenzbezeichner verwendet, gelten die zugehörigen Aussagen und
Festlegungen für alle drei Kartentypen.

</td></tr><tr><td>
SM-B

</td><td>
</td><td>
Adressiert sowohl eine echte SMC-B als auch eine in einem HSM-B enthaltene
virtuelle SMC-B.

Wird dieser Referenzbezeichner verwendet, gelten die zugehörigen Aussagen und
Festlegungen für beide Typen.

</td></tr></table>

### 3.1.3 Übergreifende Festlegungen zum Aufbau von sicheren Verbindungen

##### TIP1-A_7254

Der Konnektor MUSS beim Aufbau von TLS-gesicherten Verbindungen zu einem
zentralen Dienst der TI-Plattform oder zu einem fachanwendungsspezifischen
Dienst, bei denen eine OCSP-Abfrage des Serverzertifikats nach TUC_PKI_006
erfolgt, neben Fehlerfällen bei folgenden Warnungen gemäß
[gemSpec_PKI#Tab_PKI_274]

 ---> UL

mit Abbruch des Verbindungsaufbaus reagieren. **[\<=]**

In [gemSpec_Krypt#6] wird das Kommunikationsprotokoll zwischen einem Client und
einer Vertrauenswürdigen Ausführungsumgebung (VAU) spezifiziert. Dabei wird
ein sicherer Kanal auf HTTP-Anwendungsschicht zwischen dem Client und der VAU
(Server) aufgebaut. Der Client ist hier ein Fachmodul des Konnektors; der
Server ist ein Fachdienst.

##### A_17225-01

Der Konnektor MUSS für Fachmodule den Aufbau einer sicheren Verbindung zur
Vertrauenswürdigen Ausführungsumgebung (VAU) gemäß Kommunikationsprotokoll
[gemSpec_Krypt#6] unterstützen und das vom Server übergebene Zertifikat wie
folgt prüfen:TUC_KON_037 „Zertifikat prüfen“  {       certificate
= C.FD.AUT;       qualifiedCheck = not_required;     
 offlineAllowNoCheck = false;       policyList  = oid_fd_aut;    
  intendedKeyUsage= intendedKeyUsage(C.FD.AUT);     
 validationMode  = OCSP}Der Konnektor MUSS die vom Fachmodul übergebene
Rolle gegen die aus dem Zertifikat ermittelte Rolle prüfen.   **[\<=]**

##### A_17777

Der Konnektor MUSS für Fachmodule für die Nutzung der
Schlüsselableitungsfunktionalität die sicherheitstechnischen Festlegungen
gemäß [gemSpec_Krypt#3.15.5 Schlüsselableitungsfunktionalität ePA] und
[gemSpec_SGD] bereitstellen. **[\<=]**

Der Gesamtablauf der Schlüsselableitungsfunktionalität gemäß
[gemSpec_SGD#2.3] für den Konnektor als Client ist aufgeteilt zwischen
Basiskonnektor und Fachmodul. Die kryptographischen Vorgaben (u.a.
Durchführung des ECDH, Schlüsselerzeugung, Ver- und Entschlüsselung,
Signaturerzeugung und -prüfung) werden dabei durch den Basiskonnektor
realisiert.

### 3.2 Konnektoridentität und gSMC-K

##### TIP1-A_4503

Der Konnektor MUSSdas geheime Schlüsselmaterial zur
Geräteidentität(ID.NK.VPN, ID.AK.AUT, ID.SAK.AUT)und der Rolle
SAK(C.SAK.AUTD_CVC) über Smartcards des Typs gSMC-Kgemäß
[gemSpec_gSMC-K_ObjSys]nutzen.Der Konnektor MUSS mit einer gSMC-K bestückt
sein. Er KANN mit mehr als einer gSMC-K bestückt sein. **[\<=]**

Die Notwendigkeit, den Konnektor mit mehr als einer gSMC-K zu bestücken, kann
sich aus den Lastanforderungen aus [gemSpec_Perf#4.1.2] ergeben.

##### TIP1-A_4504

Verwendet der Konnektor mehrere gSMC-Ks, DARF eine Administratorinteraktion für
diese Belange NICHT erforderlich sein. **[\<=]**

##### TIP1-A_5543

Der Konnektor DARF Anwender und Administratoren außer bei der Inbetriebnahme
(erstmalig oder nach Werksreset) NICHT auffordern, eine PIN für eine gSMC-K
einzugeben. **[\<=]**

##### TIP1-A_4505

Die gSMC-Kdes Konnektors MÜSSENdurch den Einsatz physikalischer Sperren oder
manipulationssicherer Siegelso mit dem Konnektor verbunden sein,
dassphysischerMissbrauch oder physische Manipulationerkennbar ist. **[\<=]**

gSMC-Ks gemäß [gemSpec_gSMC-K_ObjSys] verfügen über die Möglichkeit zur
nachträglichen Generierung von Schlüsselpaaren und dem Nachladen der
zugehörigen Zertifikate. Dieser Mechanismus wird erst in kommenden Releases
durch den Konnektor unterstützt. Initial sind alle Identitäten bereits einmal
auf der gSMC-K vorhanden.

##### TIP1-A_4506

In Abhängigkeit vom kryptographischen Verfahren MUSSder Konnektor folgende
Objekte der gSMC-K als Quelle seiner Identitäten verwenden:

Tabelle4: TAB_KON_856: Identitäten des Konnektors auf der gSMC-K

<table><tr><th colspan="1" rowspan="2">
Identifier

</th><th colspan="1" rowspan="2">
Verzeichnis

</th><th colspan="2" rowspan="1">
Objekt der gSMC-K in Abhängikeit vom kryptographischen Verfahren

</th></tr><tr><th>
RSA

</th><th>
ECC

</th></tr><tr><td>
ID.NK.VPN

</td><td>
MF/DF.NK

</td><td>
EF.C.NK.VPN.R2048 

</td><td>
EF.C.NK.VPN2.XXXX

</td></tr><tr><td>
ID.AK.AUT

</td><td>
MF/DF.AK

</td><td>
EF.C.AK.AUT.R2048

</td><td>
EF.C.AK.AUT2.XXXX

</td></tr><tr><td>
ID.SAK.AUT

</td><td>
MF/DF.SAK

</td><td>
EF.C.SAK.AUT.R2048

</td><td>
EF.C.SAK.AUT2.XXXX

</td></tr><tr><td>
C.SAK.AUTD_CVC

</td><td>
MF/DF.SAK

</td><td>
-

</td><td>
EF.C.SAK.AUTD_CVC.E256

</td></tr></table>

**[\<=]**

##### A_21849

Der Konnektor MUSS dem Administrator anzeigen, welche Zertifikate aktuell
verwendet werden. Dies gilt für diese Strecken bzw. Anwendungsfälle:
VPN-Tunnel (C.NK.VPN), TLS zum PS (C.AK.AUT oder lokales Zertifikat), TLS zum
KT (C.SAK.AUT) und C2C für SUK (C.SAK.AUTD_CVC und C.CA_SAK.CS). **[\<=]**

### 3.2.1 Organisatorische Anforderungen und Sperrprozesse

##### TIP1-A_5392

Der Hersteller des Konnektors MUSS die Rolle des Kartenherausgebers für in
seinen Konnektoren verbauten gSMC-Ks einnehmen.

Der Hersteller des Konnektors KANN die von ihm verantwortete Personalisierung
der gSMC-K durch einen von ihm zu beauftragenden Dienstleister in seinem Namen
vornehmen lassen. **[\<=]**

##### TIP1-A_5696

Der Hersteller des Konnektors MUSS sich von der korrekten Personalisierung der
herausgegebenen gSMC-K überzeugen. **[\<=]**

##### A_18928

Der Hersteller des Konnektors MUSS die Konnektoren mit einer gSMC-K mit
personalisierten RSA- und ECC-Zertifikaten gemäß TAB_KON_856 ausstatten.
**[\<=]**

##### A_18930

Der Konnektor MUSS unterschiedliche gSMC-K-Personalisierungsvarianten sowohl mit
als auch ohne ECC-Zertifikate für ID.NK.VPN, ID.AK.AUT und ID.SAK.AUT
unterstützen. **[\<=]**

Die Anforderung ist für die Anwendungsfälle Registrierung,
IPsec-Authentisierung und Autorisierung beim VPN-Zugangsdienst,
TLS-Authentisierung zum eHealth-Kartenterminal, TLS-Authentisierung zum
Primärsystem nachzuweisen. Wenn RSA-2048 in der TI abgekündigt wird,
entfällt dadurch die Anforderung.

##### TIP1-A_5393

Der Hersteller des Konnektors MUSS die Zuordnung von Konnektor und jeweils
eingebrachtem C.NK.VPN-Zertifikat mit dem Ziel dokumentieren, anhand eines
Sperrauftrages für einen Konnektor, das zu sperrende C.NK.VPN-Zertifikat
identifizieren zu können. **[\<=]**

Das bedeutet, dass der Konnektorhersteller je Konnektor die für die
Identifikation des C.NK.VPN-Zertifikates relevanten Daten wie z. B.
Seriennummer des Konnektors und Art der verbauten Komponenten, Seriennummer der
gSMC-K, etc. für seinen Sperrprozesse dokumentieren muss.

##### TIP1-A_5394

Der Hersteller des Konnektors MUSS für die von ihm verantworteten Konnektoren
einen Sperrprozess etablieren, unterhalten und der gematik zugänglich machen.

Der Hersteller des Konnektors KANN die operative Durchführung des
Sperrprozesses an Dritte delegieren. **[\<=]**

Sperrberechtigt ist die gematik im Rahmen des Change-Verfahrens (siehe
[gemRL_Betr_TI#5.4).

##### TIP1-A_5395

Der Hersteller des Konnektors MUSS im Rahmen der Change-Durchführung erteilte
Sperraufträge der gematik fristgemäß (gemäß Change-Auftrag) bei dem TSP
X.509 nonQES (Zertifikatsaussteller) umsetzen. **[\<=]**

Dazu bedient er die standardmäßige Schnittstelle zum TSP (siehe
[gemSpec_X.509_TSP#TIP1-A_3643]).

##### TIP1-A_5396

Der Hersteller des Konnektors MUSS vor der Umsetzung des Sperrauftrages für
einen Konnektor die Sperrberechtigung des Beauftragenden prüfen und
verhindern, dass Konnektoren missbräuchlich gesperrt werden. **[\<=]**

##### TIP1-A_5397

Der Hersteller des Konnektors MUSS nach erfolgreicher Prüfung der
Sperrberechtigung des Beauftragenden die Sperrung der entsprechenden
C.NK.VPN-Zertifikate unverzüglich bei dem TSP X.509 nonQES
(Zertifikatsaussteller) beauftragen. **[\<=]**

##### TIP1-A_5398

Der Hersteller des Konnektors DARF NICHT die Sperrung von C.NK.VPN-Zertifikaten
bei dem TSP X.509 nonQES (Zertifikatsaussteller) beauftragen, wenn er nicht
durch einen für den Konnektor Sperrberechtigten dazu beauftragt wurde. **[\<=]**

##### TIP1-A_5399

Der Hersteller des Konnektors MUSS die Durchführung der Sperrung eines
Konnektors protokollieren und der gematik auf Anfrage übermitteln.Dabei
MÜSSEN folgende Informationen protokolliert werden:

 ---> UL

**[\<=]**

Der Hersteller des Konnektors übernimmt im Rahmen der organisatorischen
Sperrung die Aufgabe der Anwenderkommunikation gegenüber den betroffenen
Anwendern. Die Eckpunkte zur Kommunikation sind Bestandteil des Beschlusses zur
Außerbetriebnahme einer Konnektor-Baureihe und im Rahmen des Change-Verfahrens
zwischen den Beteiligten abgestimmt.

##### TIP1-A_5400

Der Hersteller des Konnektors MUSS die Fortführung des Sperrprozesses über die
Einstellung seiner Geschäftstätigkeit hinaus gewährleisten. **[\<=]**

Dies kann bspw. durch Übertragung der Aufgabe an einen Dritten realisiert
werden. Dabei sind die Zuordnungen Konnektor zu Zertifikat gemäß Anforderung
„Dokumentation der Konnektorzertifikatszuordnungen“ zur Verfügung zu
stellen.

Bei der Schlüsselerzeugung für die gSMC-K muss insbesondere auch mit
technischen Maßnahmen die Vertraulichkeit der relevanten Schlüssel
sichergestellt werden:

##### TIP1-A_7225

Der Hersteller des Konnektors, der Schlüssel für die gSMC-K erzeugt, MUSS
diese Schlüssel mittels eines technischen Sicherheitsmoduls (HSM, Chipkarte,
TPM etc.) erzeugen, welches

 ---> OL

Wird für die Schlüsselerzeugung eine Schlüsselableitung verwendet, so MUSS
die Schlüsselableitung die fachlichen Anforderungen aus GS-A_5386 erfüllen.

Es ist zulässig, dass asymmetrische Schlüssel bei der Personalisierung auf der
gSMC-K selbst erzeugt werden und symmetrische Schlüssel mittels einer
Schlüsselableitung erzeugt werden, bei dem sich der Ableitungsschlüssel
(Masterkey) innerhalb eines nach 3. zulässigen Hardwaresicherheitsmoduls
befindet.

Es ist zulässig, sicherheitstechnisch geeignete Maßnahmen zur Sicherstellung
der Verfügbarkeit der Ableitungsschlüssel (Masterkey) umzusetzen (bspw.
Shamir Secret-Sharing-Verfahren).

Der Hersteller des Konnektors MUSS die Schlüsselerzeugung und die
Schlüsselverwaltung in einem Konzept darstellen, das die technischen und
organisatorischen Maßnahmen beschreibt, die den Schutzbedarf der verarbeiteten
Informationsobjekte befriedigen. Der Hersteller des Konnektors MUSS dieses
Konzept der gematik zur Verfügung stellen. **[\<=]**

##### TIP1-A_5703

Der Hersteller des Konnektors, der Daten für die gSMC-K erzeugt (bspw.
Schlüssel), MUSS diese Daten bei der Übertragung zum Kartenpersonalisierer
hinsichtlich Vertraulichkeit, Authentizität und Integrität mit einem
Verfahren nach [gemSpec_Krypt] schützen. **[\<=]**

### 3.3 Bootup-Phase

##### TIP1-A_4507

Da während der Bootup-Phase des Konnektors noch nicht alle
Sicherheitsmechanismen ihre Leistung erbringen können, DÜRFEN die Dienste des
Konnektorswährend dem Bootup über physikalische Schnittstellen von außen
NICHT erreichbar sein. **[\<=]**

##### TIP1-A_4508

Der Konnektor MUSS nach Beendigung der Bootup-Phase die Initialisierung der
Funktionsmerkmale durchlaufen haben. Die Startreihenfolge der Funktionsmerkmale
kann unter Berücksichtigung von TIP1-A_4507 herstellerspezifisch gestaltet
werden.Im Rahmen der Bootup-Phase MÜSSEN folgende TUCs ausgeführt werden:
TUC_KON_025, TUC_KON_035, TUC_KON_272, TUC_KON_341, TUC_KON_343, TUC_KON_352
(die Reihenfolge der TUC-Ausführung ist herstellerspezifisch).Treten während
der Bootup-Phase Fehler auf, so MUSS die Bootup-Phase, sofern möglich,
abgeschlossen werden.Sobald die Bootup-Phase abgeschlossen ist, MUSS
TUC_KON_256 „Systemereignis absetzen“ mit folgenden Parameter aufgerufen
werden:TUC_KON_256 {    topic = "BOOTUP/BOOTUP_COMPLETE";    eventType
= Op;    severity = Info;    } **[\<=]**

Die hier gelisteten TUCs bilden nicht die abschließende Menge der während der
Bootup-Phase zu erfüllenden Anforderungen. In den einzelnen Funktionsmerkmalen
werden weitere Einzelanforderungen erhoben, die als Ausführungszeitpunkt die
Bootup-Phase benennen (siehe Unterkapitel „Betriebsaspekte“ der einzelnen
Funktionsmerkmal-Kapiteln, sowie Kapitel 4.3 Konnektormanagement).

### 3.4 Betriebszustand

##### TIP1-A_4509

Der Konnektor MUSS seinen Betriebszustand gemäß Tabelle TAB_KON_503
Betriebszustand_Fehlerzustandsliste über Fehlerzustände $EC erfassen.

Tritt die in Spalte „Beschreibung“ charakterisierte Fehlersituation eines
Fehlerzustandes $EC ein, wird sein Wert $EC.value = true. Sobald die
Fehlersituation beendet ist, springt der Wert auf $EC.value = false. Die
Fehlerzustände müssen dabei innerhalb der „max. Feststellungszeit“
(Tabellenspalte) erfasst werden. Eine maximale Feststellungszeit von einen Tag
(1 day) verlangt, dass einmal am Tag der Zustand geprüft werden muss,
unabhängig davon, welche TUCs aufgerufen werden. Eine maximale
Feststellungszeit von 1 sec, 10 sec, 1 min und 300 sec verlangt, dass nach der
Feststellung einer Fehlfunktion innerhalb eines TUCs die Zustandsänderung
innerhalb der angegebenen Zeit stattfinden muss.

Nach Abschluss des Boot-Vorgangs müssen sämtliche Fehlerzustände mit einer
„max. Feststellungszeit“ von „1 day“ erfasst worden sein. **[\<=]**

##### TIP1-A_4597

Der Konnektor MUSS zur Unterstützung von Missbrauchserkennungen für alle
Operationen, die in EVT_MONITOR_OPERATIONS gelistet sind und deren Alarmwert \>
0 ist, kontinuierlich folgende Aktivitäten durchlaufen:

 ---> OL

**[\<=]**

Erklärung „Minütlich gleitende 10-Minuten-Summe“: Für die jeweilige
Operation wird die Summe aller OK_Val und NOK_Val der letzten 10 Minuten
gebildet. Diese Summe wird jede Minute neu berechnet.

##### TIP1-A_4512-04

Der Konnektor MUSS per Ereignisdienst TUC_KON_256 über Änderungen des
Betriebszustandes (Tabelle TAB_KON_503 Betriebszustand_Fehlerzustandsliste)
informieren.Der Konnektor muss dazu für jeden Fehlerzustand $EC mit Error
Condition $EC.errorcondition mit verändertem Wert $EC.value den technischen
Anwendungsfall TUC_KON_256 „Systemereignis absetzen“ mit folgenden
Parametern aufrufen:TUC_KON_256 {        topic =
"OPERATIONAL_STATE/$EC.errorcondition";    eventType =
$EC.type;    severity = $EC.severity;    parameters =
(„Value=$EC.value, $EC.parameterlist”)}

Tabelle5: TAB_KON_503 Betriebszustand_Fehlerzustandsliste

<table><tr><th>
 ErrorCondition

(siehe Hinweis 1)

</th><th>
 Beschreibung

</th><th>
Type

</th><th>
Seve

rity

</th><th>
max.

Fest

stell

ungs-

zeit

</th><th>
Parameterlist

(siehe Hinweis 2)

</th></tr><tr><td>
EC_CardTerminal_

Software_Out_Of_

Date ($ctId)

</td><td>
Software auf

Kartenterminal($ctId)

ist nicht aktuell

</td><td>
Op

</td><td>
Info

</td><td>
1 day

</td><td>
CtID=$ctId;

Bedeutung=

$EC.description

</td></tr><tr><td>
EC_CardTerminal_

gSMC-KT_Certificate_ Expires_Soon ($ctId)

</td><td>
Das Zertifikat der gSMC-KT im

Kartenterminal($ctId)

läuft in weniger als 5 Wochen ab

</td><td>
Op

</td><td>
Info

</td><td>
7 days

</td><td>
CtID=$ctId;

Bedeutung=

$EC.description

</td></tr><tr><td>
EC_Connector_

Software_Out_

Of_Date

</td><td>
I_KSRS_Download::list_

Updates

liefert mindestens eine

UpdateInformation mit einer UpdateInformation/Firmware/

FWVersion \> aktuelle Version

der Konnektorsoftware, deren

UpdateInformation/Firmware/

FWPriority = „Kritisch“

</td><td>
Op

</td><td>
Info

</td><td>
1 day

</td><td>
Bedeutung=

$EC.description

</td></tr><tr><td>
EC_FW_Update_Available

</td><td>
I_KSRS_Download::list_

Updates

liefert mindestens eine

UpdateInformation mit einer UpdateInformation/Firmware/

FWVersion \> aktuelle Version

der Konnektor- oder Kartenterminalsoftware

</td><td>
Op

</td><td>
Info

</td><td>
1 day

</td><td>
Bedeutung=

$EC.description

</td></tr><tr><td>
EC_FW_Not_

Valid_Status_

Blocked

</td><td>
Konnektor Firmware muss

aktualisiert werden. Zugang zur

TI momentan nicht erlaubt.

</td><td>
Sec

</td><td>
Fatal

</td><td>
1 day

</td><td>
Bedeutung=

$EC.description

</td></tr><tr><td>
EC_Time_Sync_

Not_Successful

</td><td>
der letzte

Synchronisationsversuch

der Systemzeit war nicht

erfolgreich.

</td><td>
Op

</td><td>
Info

</td><td>
1 sec

</td><td>
LastSyncAttempt=

$lastSyncAttempt

Timestamp;

LastSyncSuccess

=$lastSyncSuccess

Timestamp;

Bedeutung=

$EC.description

</td></tr><tr><td>
EC_TSL_Update_

Not_Successful

</td><td>
das letzte Update der TSL

war nicht erfolgreich.

</td><td>
Op

</td><td>
Info

</td><td>
1 sec

</td><td>
Bedeutung=

$EC.description;

LastUpdateTSL=

$lastUpdateTSL

Timestamp

</td></tr><tr><td>
EC_TSL_Expiring

</td><td>
Systemzeit t mit

t \> NextUpdate-Element der

TSL – 7 Tage und

t \<= NextUpdate-Element

der TSL

</td><td>
Sec

</td><td>
Info

</td><td>
1 day

</td><td>
NextUpdateTSL

=$NextUpdate-

Element der TSL;

Bedeutung=

$EC.description

</td></tr><tr><td>
EC_BNetzA_VL_

Update_

Not_Successful

</td><td>
Das letzte Update der

BNetzA-VL war nicht erfolgreich

</td><td>
Op

</td><td>
Info

</td><td>
1 sec

</td><td>
LastUpdateBNetz

AVL=

$lastUpdateBNetz

AVLTimestamp;

Bedeutung=

$EC.description

</td></tr><tr><td>
EC_ BNetzA_VL_

not_valid

</td><td>
Systemzeit t mit

t \> NextUpdate-Element der

BNetzA-VL

</td><td>
Sec

</td><td>
War

ning

</td><td>
1 day

</td><td>
NextUpdateBNetz

AVL

=$NextUpdate-

Element

der BNetzA-VL;

Bedeutung=

$EC.description

</td></tr><tr><td>
EC_TSL_Trust_

Anchor_Expiring

</td><td>
Gültigkeit des Vertrauensankers

ist noch nicht abgelaufen, läuft

aber innerhalb von 30 Tagen ab.

</td><td>
Sec

</td><td>
Info

</td><td>
1 day

</td><td>
ExpiringDateTrust

Anchor=

Ablaufdatum der

Vertrauensanker

gültigkeit;

Bedeutung=

$EC.description

</td></tr><tr><td>
EC_LOG_

OVERFLOW

</td><td>
Wenn im Rahmen der Regeln

für die rollierende Speicherung

von Logging-Einträgen Einträge

gelöscht werden, die nicht älter

als

SECURITY_LOG_DAYS

,

 

LOG_DAYS bzw. FM_

\<fmName\>_LOG_DAYS sind,

tritt der Fehlerzustand ein.

Der Fehlerzustand kann nur

durch einen Administrator

wieder zurückgesetzt werden.

Unter Protokoll wird die Liste der auslösenden Protokolle angegeben.

</td><td>
Op

</td><td>
War

ning

</td><td>
1 sec

</td><td>
Protokoll=$Protokoll;

Bedeutung=

$EC.description

</td></tr><tr><td>
EC_CRL_Expiring

</td><td>
Systemzeit t \> NextUpdate

der CRL – 3 Tage

</td><td>
Sec

</td><td>
War

ning

</td><td>
1 day

</td><td>
ExpiringDateCRL=

NextUpdate der

CRL;

Bedeutung=

$EC.description

</td></tr><tr><td>
EC_Time_Sync_

Pending_Warning

</td><td>
MGM_LU_ONLINE=Enabled und

keine erfolgreiche

Synchronisation

der Systemzeit seit d Tagen und

d \> NTP_WARN_PERIOD und

d \<= NTP_GRACE_PERIOD.

Nach einer Korrektur oder

Bestätigung der Systemzeit

durch einen Administrator muss

der Konnektor wie nach einer

erfolgreichen Zeitsynchronisation

verfahren, d.h., der Tagezähler

wird auf 0 zurückgesetzt.

</td><td>
Sec

</td><td>
War

ning

</td><td>
1 day

</td><td>
LastSyncSuccess=

$lastSyncSuccess

Timestamp;

Bedeutung=

$EC.description

</td></tr><tr><td>
EC_TSL_Out_

Of_Date_Within_

Grace_Period

</td><td>
Systemzeit t mit

t \> NextUpdate-Element der TSL

und

t \<= NextUpdate-Element

der TSL + CERT_TSL_

DEFAULT_GRACE_

PERIOD_DAYS

und eine neue TSL ist nicht

verfügbar

</td><td>
Sec

</td><td>
War

ning

</td><td>
1 day

</td><td>
NextUpdateTSL

=$NextUpdate-

Element der TSL;

GracePeriodTSL

=CERT_TSL_

DEFAULT_

GRACE_PERIOD_

DAYS;

Bedeutung=

$EC.description

</td></tr><tr><td>
EC_CardTerminal_

Not_Available

($ctId)

</td><td>
Kartenterminal($ctId) ist nicht

verfügbar. Dieser

Betriebszustand

bezieht sich auf die als „aktiv“

gekennzeichneten KTs.  

</td><td>
Op

</td><td>
Error

</td><td>
1 sec

</td><td>
CtID=$ctId;

Bedeutung=

$EC.description

</td></tr><tr><td>
EC_No_VPN_TI_

Connection

</td><td>
Kein sicherer Kanal (VPN) in die Telematikinfrastruktur aufgebaut.

Der Wert 300 sec ist abgeleitet

aus der maximalen

Verbindungsaufbauzeit bei

einem Standortausfall des

VPN-Zugangsdienstes.

</td><td>
Op

</td><td>
Error

</td><td>
300 sec

</td><td>
Bedeutung=

$EC.description

</td></tr><tr><td>
EC_No_VPN_

SIS_Connection

</td><td>
Kein sicherer Kanal (VPN) zu

den Sicheren Internet Services

aufgebaut.

Der Wert 300 sec ist abgeleitet

aus der maximalen

Verbindungsaufbauzeit

bei einem

Standortausfall des

VPN-Zugangsdienstes.

</td><td>
Op

</td><td>
Error

</td><td>
300 sec

</td><td>
Bedeutung=

$EC.description

</td></tr><tr><td>
EC_No_Online_

Connection

</td><td>
Konnektor kann Dienste im

Transportnetz nicht erreichen.

</td><td>
Op

</td><td>
Error

</td><td>
10 sec

</td><td>
Bedeutung=

$EC.description

</td></tr><tr><td>
EC_IP_Adresses_

Not_Available

</td><td>
Die IP-Adressen des

Netzkonnektors sind nicht oder

falsch gesetzt.

</td><td>
Sec

</td><td>
Error

</td><td>
1 sec

</td><td>
Bedeutung=

$EC.description

</td></tr><tr><td>
EC_CRL_Out_Of_

Date

</td><td>
Systemzeit t \> Next Update

der CRL

</td><td>
Sec

</td><td>
Fatal

</td><td>
1 day

</td><td>
NextUpdateCRL=

$NextUpdate der

CRL;

Bedeutung=

$EC.description

</td></tr><tr><td>
EC_Firewall_Not_

Reliable

</td><td>
Firewall-Regeln konnten nicht

fehlerfrei generiert werden oder

beim Laden der Firewall-Regeln

ist ein Fehler aufgetreten.

</td><td>
Sec

</td><td>
Fatal

</td><td>
1 sec

</td><td>
Bedeutung=

$EC.description

</td></tr><tr><td>
EC_Random_

Generator_

Not_Reliable

</td><td>
Der Zufallszahlengenerator kann

die Anforderungen an die zu

erzeugende Entropie

nicht erfüllen.

</td><td>
Sec

</td><td>
Fatal

</td><td>
1 sec

</td><td>
Bedeutung=

$EC.description

</td></tr><tr><td>
EC_Secure_

KeyStore_

Not_Available

</td><td>
Sicherer Zertifikats- und

Schlüsselspeicher des

Konnektors

(gSMC-K oder Truststore)

nicht verfügbar

</td><td>
Sec

</td><td>
Fatal

</td><td>
1 sec

</td><td>
Bedeutung=

$EC.description

</td></tr><tr><td>
EC_Security_

Log_

Not_Writable

</td><td>
Das Sicherheitslog kann nicht

geschrieben werden.

</td><td>
Op

</td><td>
Fatal

</td><td>
1 sec

</td><td>
Bedeutung=

$EC.description

</td></tr><tr><td>
EC_Software_

Integrity_

Check_Failed

</td><td>
Eine oder mehrere

konnektorinterne

Integritätsprüfungen der aktiven Konnektorbestandteile

sind fehlgeschlagen.

</td><td>
Sec

</td><td>
Fatal

</td><td>
1 day

</td><td>
Bedeutung=

$EC.description

</td></tr><tr><td>
EC_Time_

Difference_

Intolerable

</td><td>
Abweichung zwischen

der lokalen Zeit und der

per NTP empfangenen

Zeit bei der

Zeitsynchronisation

größer als NTP_MAX_

TIMEDIFFERENCE.

Nach einer Korrektur oder

Bestätigung der Systemzeit

durch einen Administrator

muss der Konnektor den

Fehlerzustand zurücksetzen.

</td><td>
Sec

</td><td>
Fatal

</td><td>
1 sec

</td><td>
NtpTimedifference=

Zeitabweichung;

NtpMaxAllowed

Timedifference

=NTP_MAX_

TIMEDIFFERENCE;

Bedeutung=

$EC.description

</td></tr><tr><td>
EC_Time_Sync_

Pending_Critical

</td><td>
MGM_LU_ONLINE=

Enabled und

keine erfolgreiche

Synchronisation

der Systemzeit seit d Tagen

und

d \> NTP_GRACE_PERIOD

Nach einer Korrektur oder

Bestätigung der Systemzeit

durch einen Administrator muss

der Konnektor wie nach einer

erfolgreichen

Zeitsynchronisation

verfahren, d.h., der Tagezähler

wird auf 0 zurückgesetzt.

</td><td>
Sec

</td><td>
Fatal

</td><td>
1 day

</td><td>
LastSyncSuccess

=$lastSync

SuccessTimestamp;

NtpGracePeriod=

NTP_GRACE_

PERIOD;

Bedeutung=

$EC.description

</td></tr><tr><td>
EC_TSL_Trust_

Anchor_

Out_Of_Date

</td><td>
Gültigkeit des Vertrauensankers

ist abgelaufen

</td><td>
Sec

</td><td>
Fatal

</td><td>
1 day

</td><td>
ExpiringDateTrust

Anchor=

Ablaufdatum der

Vertrauensanker

gültigkeit;

Bedeutung=

$EC.description

</td></tr><tr><td>
EC_TSL_Out_

Of_Date_

Beyond_Grace_

Period

</td><td>
Systemzeit t mit

t \> NextUpdate-Element

der TSL +

CERT_TSL_DEFAULT_

GRACE_ PERIOD_DAYS

und eine neue TSL ist

nicht verfügbar

</td><td>
Sec

</td><td>
Fatal

</td><td>
1 day

</td><td>
NextUpdateTSL

=$NextUpdate-

Element der TSL;

GracePeriodTSL

=CERT_TSL_

DEFAULT_

GRACE_PERIOD_

DAYS;

Bedeutung=

$EC.description

</td></tr><tr><td>
EC_

CRYPTOP

ERATION_

ALARM

</td><td>
Gemäß TIP1-A_4597 wurde ein

potentieller Missbrauch einer

Kryptooperation erkannt.

Nur der Administrator kann die

Alarmmeldung zurücksetzen.

</td><td>
Sec

</td><td>
War

ning

</td><td>
1 min

</td><td>
Operation=

$Operationsname;

Count=$Summenwert;

Arbeitsplatz=

$\<Liste

operationsaufrufenden workplaceIDs\>;    

Meldung=

’Auffällige Häufung von

Operationsaufrufen

in den

letzten 10 Minuten’

</td></tr><tr><td>
EC_OTHER_

ERROR_

STATE($no)

</td><td>
Herstellerspezifische

Fehlerzustände, die per $no

(von 1 aufsteigend nummeriert)

identifiziert werden.

$Type, $Severity und

$ParameterList legt

der Hersteller

nach Bedarf fest.

</td><td>
$Type

</td><td>
$Sev

erity

</td><td>
\<= 1 day

</td><td>
Bedeutung=

$EC.description

</td></tr><tr><td>
EC_NK_Certificate_Expiring

</td><td>
Das C.NK.VPN-Zertifikat läuft bald ab. 

Systemzeit t \> (Ablaufdatum von C.NK.VPN – 180 Tage)

</td><td>
Sec

</td><td>
Warning

</td><td>
1 day

</td><td>
Iccsn=$Iccsn;

Serial=$Serialnumber;

Bedeutung=

$EC.description

</td></tr><tr><td>
EC_NK_Certificate_Expired

</td><td>
Das C.NK.VPN-Zertifikat ist abgelaufen.

Systemzeit t \> Ablaufdatum von C.NK.VPN 

</td><td>
Sec 

</td><td>
Fatal

</td><td>
1 day

</td><td>
Iccsn=$Iccsn;

Serial=$Serialnumber;

Bedeutung=

$EC.description

</td></tr><tr><td>
EC_TLS_Client_Certificate_Security

</td><td>
Das für die Authentifizierung gegenüber dem Clientsystem konfigurierte
Zertifikat hat ein Sicherheitsniveau von weniger als 120bit. Zu verwenden ist
ein RSA -Zertifikat mit mindestens 3000 bit Schlüssellänge oder ein ECC
Zertifikat.

</td><td>
Sec

</td><td>
Info

</td><td>
1 day

</td><td>
Bedeutung=

$EC.description

</td></tr></table>

Erläuterungen zu TAB_KON_503:

Hinweis 1:

Jeder Fehlerzustand wird durch einen eindeutigen ErrorCondition identifiziert.
Dieser kann einen Parameter enthalten. Sind etwa die Kartenterminals mit
ctId=47 und das mit ctId=93 nicht erreichbar, so lauten die ErrorCondition
„EC_CardTerminal_Not_Available(47)“ und
„EC_CardTerminal_Not_Available(93)“.

Hinweis 2:

EC.description referenziert den Text, der in der Spalte „Beschreibung“ des
Zustandes spezifiziert wurde. **[\<=]**

Unter „kartenbasiert“ sind nicht nur Lösungen mit Smartcards sondern auch
solche mit HSMs (Hardware Security Modules) zu verstehen.

##### A_17085

Wenn MGM_LU_ONLINE=Enabled nicht erfüllt ist, DARF der Konnektor den
Zustand EC_No_VPN_TI_Connection NICHT annehmen. **[\<=]**

##### A_17086

Wenn MGM_LU_ONLINE=Enabled oder ANLW_INTERNET_MODUS=SIS nicht erfüllt ist, DARF
der Konnektor den Zustand EC_No_VPN_SIS_Connection NICHT annehmen. **[\<=]**

##### A_17087

Wenn MGM_LU_ONLINE=Enabled nicht erfüllt ist, DARF der Konnektor den
Zustand EC_No_Online_Connection NICHT annehmen. **[\<=]**

##### A_22970

Der Konnektor MUSS 180 Tage vor Ablauf des aktuell verwendeten
C.NK.VPN-Zertifikats in den Zustand EC_NK_Certificate_Expiring wechseln.
**[\<=]**

##### A_22971

Der Konnektor MUSS mit dem Ablauf des aktuell verwendeten C.NK.VPN-Zertifikats
in den Zustand EC_NK_Certificate_Expired wechseln. **[\<=]**

<table><tr><td>
EC_ Software_ Integrity_ Check_ Failed

</td><td>
EC_ Random_ Generator_ Not_ Reliable

</td><td>
EC_ Security_ Log_ Not_ Writable

</td><td>
EC_ Time_ Sync_ Pending_ Critical

</td><td>
EC_ Time_ Diffe rence_ Intoler able

</td><td>
EC_ CRL_ Out_ Of_ Date

</td><td>
EC_ TSL_ Out_ Of_ Date_ Beyond_ Grace_ Period

</td><td>
EC_ TSL_ Trust_

Anchor_

Out_

Of_

Date

</td><td>
EC_ Secure_ KeyStore_ Not_ Available

</td><td>
EC_ FW_ Not_ Valid_ Status_ Blocked

</td><td>
EC_

NK_

Certificate_

Expired 

</td></tr><tr><td colspan="12">
Technische Use Cases (TUCs) der Basisdienste  
relevant für Fachanwendung und
die Kommunikation mit Weiteren Anwendungen und SIS

</td></tr><tr><td colspan="2">
Zugriffsberechtigungsdienst

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td></tr><tr><td>
TUC_KON_000 Prüfe Zugriffsberechtigung

</td><td>
-

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td></tr><tr><td colspan="2">
Dienstverzeichnisdienst

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td></tr><tr><td>
 

</td><td>
TUC_KON_041 Einbringen der Endpunktinformationen während der Bootup-Phase

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td></tr><tr><td colspan="2">
Kartenterminaldienst

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td></tr><tr><td>
TUC_KON_051 Mit Anwender über Kartenterminal interagieren

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
-

</td><td>
x

</td><td>
-

</td></tr><tr><td colspan="2">
Kartendienst

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td></tr><tr><td>
TUC_KON_005 Card-to-Card authentisieren

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
-

</td><td>
x

</td><td>
-

</td></tr><tr><td>
TUC_KON_006 Datenzugriffsaudit eGK schreiben

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
-

</td><td>
x

</td><td>
-

</td></tr><tr><td>
TUC_KON_018 eGK-Sperrung prüfen

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
-

</td><td>
x

</td><td>
-

</td></tr><tr><td>
TUC_KON_024 Karte zurücksetzen

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
-

</td><td>
x

</td><td>
-

</td></tr><tr><td>
TUC_kON_026 Liefere

CardSession

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
x

</td><td>
-

</td><td>
x

</td><td>
-

</td><td>
-

</td><td>
-

</td></tr><tr><td>
TUC_KON_200 SendeAPDU

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
-

</td><td>
x

</td><td>
-

</td></tr><tr><td>
TUC_KON_202 LeseDatei

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
-

</td><td>
x

</td><td>
-

</td></tr><tr><td>
TUC_KON_203 SchreibeDatei

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
-

</td><td>
x

</td><td>
-

</td></tr><tr><td>
TUC_KON_209 LeseRecord

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
-

</td><td>
x

</td><td>
-

</td></tr><tr><td colspan="12">
Systeminformationsdienst

</td></tr><tr><td>
TUC_KON_256 Systemereignis absetzen

</td><td>
-

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td></tr><tr><td colspan="2">
Verschlüsselungsdienst

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td></tr><tr><td>
TUC_KON_072 Daten symmetrisch verschlüsseln

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
-

</td><td>
x

</td><td>
-

</td></tr><tr><td>
TUC_KON_073 Daten symmetrisch entschlüsseln

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
-

</td><td>
x

</td><td>
-

</td></tr><tr><td colspan="2">
Zertifikatsdienst

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td></tr><tr><td>
 

</td><td>
TUC_KON_034 Zertifikatsinformationen extrahieren

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
-

</td><td>
x

</td><td>
x

</td></tr><tr><td colspan="2">
Protokollierungsdienst

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td></tr><tr><td>
TUC_KON_271 Schreibe Protokolleintrag

</td><td>
-

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td></tr><tr><td colspan="2">
TLS-Dienst 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td></tr><tr><td>
TUC_KON_110 Kartenbasierte TLS-Verbindung aufbauen

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td></tr><tr><td colspan="2">
Verbindung zum VPN-Konzentrator

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td></tr><tr><td rowspan="2">
 

</td><td>
TUC_VPN-ZD_0001 „IPsec Tunnel TI aufbauen”

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td></tr><tr><td>
TUC_VPN-ZD_0002 „IPsec Tunnel SIS aufbauen”

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td></tr><tr><td colspan="1">
</td></tr><tr></tr><tr></tr><tr></tr><tr></tr><tr><td colspan="12">
Operationen der Basisdienste

</td></tr><tr><td colspan="2">
Kartendienst

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td></tr><tr><td>
VerifyPin  

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
-

</td><td>
x

</td><td>
-

</td></tr><tr><td>
UnblockPin  

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
-

</td><td>
x

</td><td>
-

</td></tr><tr><td>
ChangePin 

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
-

</td><td>
x

</td><td>
-

</td></tr><tr><td>
GetPinStatus  

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
-

</td><td>
x

</td><td>
-

</td></tr><tr><td colspan="2">
Systeminformationsdienst

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td></tr><tr><td>
Schnittstelle der Ereignissenke

</td><td>
-

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td></tr><tr><td>
GetCardTerminals

</td><td>
-

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
-

</td></tr><tr><td>
GetCards

</td><td>
-

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
-

</td></tr><tr><td>
GetResourceInformation

</td><td>
-

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
-

</td></tr><tr><td>
Subscribe

</td><td>
-

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
-

</td></tr><tr><td>
RenewSubscription

</td><td>
-

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
-

</td></tr><tr><td>
Unsubscribe

</td><td>
-

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
-

</td></tr><tr><td>
GetSubscription

</td><td>
-

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
-

</td></tr><tr><td colspan="2">
Verschlüsselungsdienst

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td></tr><tr><td>
EncryptDocument

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
-

</td><td>
x

</td><td>
-

</td></tr><tr><td>
DecryptDocument

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
-

</td><td>
x

</td><td>
-

</td></tr><tr><td colspan="2">
 Signaturdienst

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td></tr><tr><td>
SignDocument

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
-

</td><td>
x

</td><td>
-

</td></tr><tr><td>
VerifyDocument

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
-

</td><td>
x

</td><td>
-

</td></tr><tr><td>
GetJobNumber

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
-

</td><td>
x

</td><td>
-

</td></tr><tr><td>
StopSignature

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
-

</td><td>
x

</td><td>
-

</td></tr><tr><td>
ActivateComfortSignature

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
-

</td><td>
x

</td><td>
-

</td></tr><tr><td>
DeactivateComfortSignature

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
-

</td><td>
x

</td><td>
-

</td></tr><tr><td>
GetSignatureMode

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
-

</td><td>
x

</td><td>
-

</td></tr><tr><td colspan="12">
Authentifizierungsdienst   

</td></tr><tr><td>
ExternalAuthenticate

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
-

</td><td>
x

</td><td>
-

</td></tr><tr><td colspan="2">
Zertifikatsdienst

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td></tr><tr><td>
ReadCardCertificate

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
-

</td></tr><tr><td>
CheckCertificateExpiration

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
-

</td></tr><tr><td>
VerifyCertificate

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
x

</td><td>
-

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
-

</td></tr><tr><td colspan="2">
Zeitdienst

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td></tr><tr><td>
I_NTP_Time_Information

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
-

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
-

</td><td>
-

</td></tr><tr><td colspan="2">
Konnektormanagement

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td></tr><tr><td>
Softwareaktualisierung

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td></tr><tr><td>
Protokolleinsicht

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td></tr><tr><td>
Werksreset

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td></tr><tr><td>
Sonstiges

</td><td>
-

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td></tr></table>

In den kritischen Fehlerzuständen, in denen keine TLS-Verbindung ins LAN
aufgebaut werden (EC_Random_Generator_Not_Reliable,
EC_Software_Integrity_Check_Failed, EC_Security_Log_Not_Writable,
EC_Time_Sync_Pending_Critical, EC_Time_Difference_Intolerable,
EC_NK_Certificate_Expired), kann keine Verbindung zu den Kartenterminals
aufgebaut werden. Infolge sind hier keine Kartenoperationen zugelassen.

Wenn keine Verbindung zum VPN-Konzentrator des SIS aufgebaut werden kann, ist
dadurch das Internet nicht über den Konnektor erreichbar. Wenn keine
Verbindung zum VPN-Konzentrator der TI aufgebaut werden kann, sind
Bestandsnetze nicht erreichbar.

Bezüglich der Administration des Konnektors im Zustand EC_FIREWALL_NOT_RELIABLE
ist eine Abstimmung mit der Prüfstelle und der Zertifizierungsstelle notwendig.

##### A_16203

Im Zustand EC_Firewall_Not_Reliable DARF der Konnektor NICHT nutzbar sein.
Möglichkeiten zur Behebung des Zustandes EC_Firewall_Not_Reliable sind mit dem
CC - Evaluierer und Zertifizierer abzustimmen. **[\<=]**

Die Architektur der TI ist so angelegt, dass die Fehlerzustände mit
Severity=Fatal in den Tabellen TAB_KON_504 und TAB_KON_503 mit
vernachlässigbarer Wahrscheinlichkeit von externen Einflüssen abhängen. Die
SLAs für Dienste der zentralen TI-Plattform sind so gefasst, dass diese
schwerwiegend verletzt werden müssten, um dadurch einen Konnektor in einen
solchen kritischen Zustand zu bringen (externer Fehler aus Sicht des
Konnektors). Dass beispielsweise der TSL-Dienst über den Zeitraum der
Grace-Period-TSL (typisch: 7 Tage) nicht erreichbar ist (ErrorCondition
EC_TSL_Out_Of_Date _Beyond_Grace_Period), kann nur bei massiver Verletzung der
für zentrale Dienste festgelegten SLAs eintreten.

Um die konnektorinternen Fehlerquellen zu erfassen, die dazu führen, dass ein
Fehlerzustand mit Severity=Fatal eintritt oder ein anderer Zustand, in dem der
Konnektor nicht verwendbar ist, wird Folgendes gefordert:

##### TIP1-A_5148

Der Konnektorhersteller MUSS den mittleren Zeitabstand zwischen Ausfällen
(MTBF) als Produkteigenschaft ausweisen. Der Konnektor soll einen mittleren
Zeitabstand zwischen Ausfällen (MTBF) von mindestens 50 Jahren haben.

Ein „Ausfall“gilt dann als eingetreten, wenn

 ---> UL

**[\<=]**

Bei einem mittleren Zeitabstand zwischen Ausfällen (MTBF) von 50 Jahren ist die
Wahrscheinlichkeit, dass ein Fehlerzustand mit Severity=Fatal auftritt, kleiner
2 % pro Jahr.

##### TIP1-A_4510-04

Der Konnektor MUSS bei eingetretenem Fehlerzustand aus Tabelle Tab_ Kon_503
Betriebszustand_Fehlerzustandsliste mit Severity=Fatal dafür sorgen, dass von
den Operationen der Basisdienste und Technische Use Cases (TUCs) der
Basisdienste, die relevant für Fachanwendungen sind, nur erlaubte Operationen
und TUCs gestartet und ausgeführt werden.Welche Operationen und TUCs je
eingetretenem Fehlerzustand ausgeführt werden dürfen, legt Tabelle
„TAB_KON_504 Ausführungserlaubnis für Dienste in kritischen
Fehlerzuständen“ fest: Jede Erlaubnis ist dort durch ein „x“
definiert.Abweichend zu Angaben in der Tabelle TAB_KON_504 DÜRFEN folgende
Operationen und TUCs NICHT im Zustand EC_Firewall_Not_Reliable ausgeführt
werden:

 ---> UL

Sind mehrere Fehlerzustände gleichzeitig eingetreten, dürfen nur die
Operationen und TUCs ausgeführt werden, die für alle eingetretenen
Fehlerzustände erlaubt sind. Der Konnektor MUSS Anfragen, die auf Grund eines
kritischen Fehlerzustandes nicht ausgeführt oder abgebrochen werden, mit einem
Fehler (Fehlercode 4002) beantworten.

Tabelle7: TAB_KON_502 Fehlercodes „Betriebszustand“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td>
4002

</td><td>
Security

</td><td>
Fatal

</td><td>
Der Konnektor befindet sich in einem kritischen Betriebszustand

</td></tr></table>

**[\<=]**

### 3.4.1 Betriebsaspekte

Der Konnektor soll per Signaleinrichtung am Konnektor die Fehlerzustände mit
Severity „Error“ und „Fatal“ anzeigen (siehe [TIP1-A_4843]).

##### TIP1-A_4513

Der Konnektor MUSS es dem Administrator ermöglichen, den aktuellen
Betriebszustand einzusehen und Fehlerzustände zurückzusetzen, soweit diese
Möglichkeit in Tabelle „TAB_KON_503 Betriebszustand_Fehlerzustandsliste“
für den jeweiligen Fehlerzustand festgelegt ist.

Ferner MUSS es die Managementschnittstelle dem Administrator ermöglichen,
Konfigurationsänderungen gemäß Tabelle TAB_KON_505 vorzunehmen:

Tabelle8:TAB_KON_505 Konfigurationswerte Missbrauchserkennung

<table><tr><th>
ReferenzID

</th><th>
Belegung

</th><th>
Bedeutung und Administrator-Interaktion

</th></tr><tr><td>
EVT_MONITOR_OPERATIONS

</td><td>
Liste von:

- Operationsname

- OK_Val (Nummer)

- NOK_Val (Nummer)

- Alarmwert (Nummer)

</td><td>
Der Administrator MUSS in der Liste der zur Missbrauchserkennung überwachbaren
Operationen alle Listeneinträge einsehen können. Er MUSS den jeweiligen
Alarmwert editieren können (0-9999, 0=deaktiviert).

OK_VAL und NOK_VAL DÜRFEN durch den Administrator NICHT veränderbar sein.

</td></tr></table>

**[\<=]**

### 3.5 Fachliche Anbindung der Clientsysteme

Für die Schnittstellen des Konnektors zu den Clientsystemen kann gesteuert
werden:

 ---> UL

Dabei werden die folgenden zwei Nutzungsszenariennichtunterschieden:

 ---> UL

Sowohl die Anbindung zur Administration des Konnektors, als auch die Anbindung
zur Nutzung von Bestandsnetzen oder dem gesicherten Internetzugang sind nicht
Gegenstand dieser Schnittstellenfestlegungen. Für die Anbindung zu
Administration wird diese im Kapitel Konnektormanagement beschrieben, für die
Anbindung von Bestandsnetzen bzw. dem gesicherten Internetzugang ist diese Art
der Regelung nicht erforderlich, da es sich dort um Routing-Funktionen handelt.

Die seitens des Administrators einstellbaren Werte und Listen sind, der
allgemeinen Struktur dieses Dokuments folgend, im Unterkapitel 3.4.1
Betriebsaspekte beschrieben.

##### TIP1-A_4514

Der Konnektor MUSS TLS in Richtung der Clientsysteme für alle
Außenschnittstellen der Basisdienste:

 ---> UL

unterstützen.

Ferner MUSS der Konnektor für die SOAP-Endpunkte der Fachmodule TLS
unterstützen.

Der Konnektor MUSS sich mittels ID.AK.AUT gegenüber dem Client authentisieren. **[\<=]**

##### TIP1-A_4515

Der Konnektor MUSS immer TLS-Verbindungsanfragen von Clientsystemen annehmen.

Der Konnektor MUSS bei gesetzter Variable ANCL_TLS_MANDATORY = Enabled den
Verbindungsversuch von Clientsystemen ohne TLS ablehnen. Ausgenommen hiervon
sind Anfragen an den Dienstverzeichnisdienst bei gesetzter Variable
ANCL_DVD_OPEN = Enabled. **[\<=]**

##### TIP1-A_4516

Der Konnektor MUSS zur Client-Authentifizierung die Verfahren Basic
Authentication (Username/Password) [RFC2617] über HTTP/TLS [RFC2818] und
zertifikatsbasierte Client-Authentifizierung (X.509) [gemSpec_PKI#8.3.1.4]
über TLS anbieten.Dabei MUSS für eine erfolgreiche Prüfung bei Basic
Authentication:

 ---> UL

Für eine erfolgreiche Prüfung mit zertifikatsbasierter
Client-Authentifizierung MUSS:

 ---> UL

Schlägt die Prüfung fehl, MUSS der Verbindungsversuch des Clientsystem
abgelehnt werden. **[\<=]**

Bei der Authentisierung des Clientsystems geht es um eine Authentisierung in
zwei Richtungen:

 ---> OL

Für beide Richtungen kann das Clientsystem dasselbe Zertifikat verwenden.

##### TIP1-A_5009

Der Konnektor MUSS für Verbindungen zu Clientsystemen als
Authentifizierungsmethode ausschließlich folgende Varianten erlauben:

 ---> OL

 ---> OL

Alle anderen Verbindungsversuche von Clientsystemen MÜSSEN vom Konnektor
abgelehnt werden. **[\<=]**

Für die Anbindung der Clientsysteme ergeben sich verschiedene
Konfigurationsvarianten bezüglich der Absicherung der Verbindungen zwischen
Konnektor und Clientsystemen. Tabelle TAB_KON_852 listet die Varianten für die
Verbindungen zum Aufruf der WebService-Schnittstellen (Varianten SOAP1 bis
SOAP4), für die Verbindungen zum Senden von Events (Varianten CETP1 und CETP2)
und für Verbindungen zum Abruf des Dienstverzeichnisses (Varianten DVD1, DVD2
und DVD3).

<table><tr><th>
Konfigu-

rations-

variante

</th><th>
ANCL_

TLS_

MAN-

DATORY

</th><th>
ANCL_

CAUT_

MAN-

DATORY

</th><th>
ANCL_

CAUT_

MODE

</th><th>
ANCL_

DVD_

OPEN

</th><th>
Bedeutung

</th></tr><tr><td>
CETP1

</td><td>
Enabled

</td><td>
Irrelevant

</td><td>
Irrelevant

</td><td>
Irrelevant

</td><td>
Der Konnektor sendet Events ausschließlich über TLS.

Er authentisiert sich, wenn ihn das Clientsystem im Rahmen des TLS-Handshakes
dazu auffordert.   

</td></tr><tr><td>
CETP2

</td><td>
Disabled

</td><td>
Irrelevant

</td><td>
Irrelevant

</td><td>
Irrelevant

</td><td>
Der Konnektor sendet Events immer über eine TCP-Verbindung ohne TLS.  

</td></tr><tr><td>
SOAP1

</td><td>
Enabled

</td><td>
Enabled

</td><td>
CERTIFICATE

</td><td>
Irrelevant

</td><td>
Der Konnektor akzeptiert vom Clientsystem nur Aufrufe über TLS. Der Konnektor
verlangt beim TLS-Handshake die Authentisierung des Clientsystems per
Zertifikat.

</td></tr><tr><td>
SOAP2

</td><td>
Enabled

</td><td>
Enabled

</td><td>
PASSWORD

</td><td>
Irrelevant

</td><td>
Der Konnektor akzeptiert vom Clientsystem nur Aufrufe über TLS.  Der Konnektor
prüft auf Anwendungsebene, dass Aufrufer sich per Username/Password 
[RFC2617] authentisieren.

</td></tr><tr><td>
SOAP3

</td><td>
Enabled

</td><td>
Disabled

</td><td>
Irrelevant

</td><td>
Irrelevant

</td><td>
Der Konnektor akzeptiert vom Clientsystem nur Aufrufe über TLS.  Der Konnektor
nimmt keine Clientauthentifizierung vor.

</td></tr><tr><td>
SOAP4

</td><td>
Disabled

</td><td>
Irrelevant

</td><td>
Irrelevant

</td><td>
Irrelevant

</td><td>
Der Konnektor akzeptiert vom Clientsystem sowohl Aufrufe ohne TLS als auch über
TLS. Im zweiten Fall sollte der Konnektor das Clientsystem nicht
authentifizieren, wenn er es aber für den Sonderfall
ANCL_CAUT_MANDATORY=Enabled aktuell tut, sehen wir das nicht als Fehler.

</td></tr><tr><td>
DVD1

</td><td>
Irrelevant

</td><td>
Irrelevant

</td><td>
Irrelevant

</td><td>
Enabled

</td><td>
Zugriff auf Dienstverzeichnisdienst kann über HTTP und HTTPS erfolgen.

</td></tr><tr><td>
DVD2

</td><td>
Enabled

</td><td>
*

</td><td>
*

</td><td>
Disabled

</td><td>
Zugriff auf Dienstverzeichnisdienst kann nur über HTTPS erfolgen.

*) Bzgl. Clientauthentisierung wirken die Schalter wie in SOAP 1, SOAP 2, SOAP 3

</td></tr><tr><td>
DVD3

</td><td>
Disabled

</td><td>
Irrelevant

</td><td>
Irrelevant

</td><td>
Disabled

</td><td>
Zugriff auf Dienstverzeichnisdienst kann über HTTP und HTTPS erfolgen.

</td></tr></table>

Client-Authentisierung bei Nutzung des LDAP-Proxy

Für die Nutzung des LDAP-Proxy gelten abweichende Festlegungen, da viele
Standard LDAP- / Mail-Clients grundsätzlich keine Funktion zur
Client-Authentisierung anbieten. Um die Nutzung des LDAP-Proxy und somit des
VZD der TI dennoch zu ermöglichen, ohne dabei auf eine verpflichtende
Client-Authentisierung für SOAP-Aufrufe zu verzichten, werden für LDAP
gesonderte Regelungen getroffen.

##### A_21224-01

Bei der Verwendung  des LDAP-Proxies im Konnektor, MUSS sich
der Konnektor abhängig von der Stellung der Schalter ANCL_TLS_MANDATORY,
ANCL_CAUT_MANDATORY, ANCL_CAUT_MODE und ANCL_CAUT_LDAP gemäß der Tabelle
TAB_KON_860 verhalten.

Tabelle10: TAB_KON_865-01 Konfigurationsvarianten der Verbindungen zwischen
Konnektor und Clientsystemen bei LDAP

<table><tr><th>
Konfigu-

rations-

variante

</th><th>
ANCL_

TLS_

MAN-

DATORY

</th><th>
ANCL_

CAUT_

MAN-

DATORY

</th><th>
ANCL_

CAUT_

MODE

</th><th>
ANCL_

CAUT_

LDAP

</th><th>
Bedeutung

</th></tr><tr><td>
LDAP1

</td><td>
Enabled

</td><td>
Enabled

</td><td>
Irrelevant

</td><td>
CERTIFICATE

</td><td>
Der Konnektor akzeptiert vom Clientsystem nur Aufrufe über TLS. Der Konnektor
verlangt beim TLS-Handshake bei Nutzung des LDAP-Proxy die Authentisierung des
Clientsystems per Zertifikat.

</td></tr><tr><td>
LDAP2

</td><td>
Enabled

</td><td>
Enabled

</td><td>
Irrelevant

</td><td>
None

</td><td>
Der Konnektor akzeptiert vom Clientsystem nur Aufrufe über TLS.  Der Konnektor
nimmt bei Nutzung des LDAP-Proxy keine Clientauthentifizierung vor. 

</td></tr><tr><td>
LDAP3

</td><td>
Enabled

</td><td>
Disabled

</td><td>
Irrelevant

</td><td>
Irrelevant

</td><td>
Der Konnektor akzeptiert vom Clientsystem nur Aufrufe über TLS.  Der Konnektor
nimmt keine Clientauthentifizierung vor.

</td></tr><tr><td>
LDAP4

</td><td>
Disabled

</td><td>
Irrelevant

</td><td>
Irrelevant

</td><td>
Irrelevant

</td><td>
Der Konnektor akzeptiert vom Clientsystem sowohl Aufrufe ohne TLS als auch über
TLS. Im zweiten Fall sollte der Konnektor das Clientsystem nicht
authentifizieren, wenn er es aber für den Sonderfall
ANCL_CAUT_MANDATORY=Enabled, ANCL_CAUT_LDAP=CERTIFICATE aktuell tut, sehen wir
das nicht als Fehler.

</td></tr></table>

**[\<=]**

Aus A_21224 resultiert direkt, dass als Client-Authentisierung für LDAPS nur
Client-Zertifikate unterstützt werden müssen.Die Authentisierung mit
Username/Passwort wird bei LDAPS nicht unterstützt.

Es sei noch einmal betont, dass TIP1-A_5009 sich nur auf SOAP und CETP
beziehtund TIP1-A_4516 das Basic-Authentication Verfahren nur für HTTP fordert.

### 3.5.1 Betriebsaspekte

Damit sich ein Clientsystem mittels X.509 authentisieren kann, muss es über ein
entsprechendes Zertifikat verfügen. Diese Zertifikate kann der Administrator
entweder mit seinen lokalen Mitteln selbst oder mittels des Konnektors
erzeugen. In beiden Fällen müssen diese Zertifikate sowohl im Clientsystemen
(hier zusammen mit ihren privaten Schlüsseln), als auch im Konnektor vorhanden
sein.

Da es sich um eine lokal begrenzte Authentisierung im Verantwortungsbereich des
Betreibers des lokalen Netzes handelt, werden keine weiteren Vorgaben zu den
Schlüsselspeichern auf Clientsystemseite erhoben. Auch hinsichtlich der
außerhalb des Konnektors erzeugten Zertifikate gelten keine weiteren Vorgaben.
Ferner ist eine Online-Prüfung dieser Zertifikate nicht erforderlich.

##### TIP1-A_4517

Der Konnektor MUSS die Erstellung und den Export von X.509-Zertifikaten für
Clientsysteme und der zugehörigen privaten Schlüssel durch den Administrator
über das Managementinterface ermöglichen. Hierbei MUSS der Konnektor dem
Administrator die Möglichkeit geben, das kryptographische Verfahren RSA-2048
oder ECC-256 auszuwählen. Als Exportformat MUSS PKCS#12 verwendet werden. Die
so erstellten Zertifikate werden zu ANCL_CCERT_LIST angefügt. Der Konnektor
MUSS dem Administrator ferner den Import von konnektorfremden
X.509-Zertifikaten für Clientsysteme über das Managementinterface
ermöglichen. Die so importierten Zertifikate werden zu ANCL_CCERT_LIST
angefügt. **[\<=]**

##### TIP1-A_4518-02

Der Administrator MUSS in der Managementoberfläche die in TAB_KON_506 genannten
Parameter im Managementinterface konfigurieren können.Wird ANCL_TLS_MANDATORY
auf ENABLED gewechselt, MÜSSEN alle nicht per TLS gesicherten
http-Verbindungen geschlossen werden, sobald die in den Verbindungen jeweils
aktuell laufenden Außenschnittstelle-Operationen abgeschlossen wurden, mit
Ausnahme von http-Verbindungen zum Dienstverzeichnisdienst.Der Konnektor MUSS
den Administrator geeignet und verständlich auf seine Verantwortung für die
Sicherung der Kommunikation hinweisen.

Tabelle11: TAB_KON_506-01 Konfigurationsparameter der
Clientsystem-Authentisierung

<table><tr><th>
ReferenzID

</th><th>
Belegung

</th><th>
Bedeutung und Administrator-Interaktion

</th></tr><tr><td>
ANCL_TLS_MANDATORY

</td><td>
Enabled/Disabled

</td><td>
Der Administrator MUSS die verpflichtende Verwendung eines TLS gesicherten
Kanals an- und abschalten können.

Wenn ANLW_ANBINDUNGS_MODUS = Parallel MUSS der Administrator vor dem Disablen
von ANCL_TLS_MANDATORY einen Warnhinweis bestätigen, der ihn über die mit der
Abschaltung verbundenen Risiken informiert und darlegt, dass in diesem Fall der
Nutzer die Verantwortung für die Sicherstellung der vertraulichen Übertragung
übernimmt.

Default-Wert: Enabled

</td></tr><tr><td>
ANCL_CAUT_MANDATORY

</td><td>
Enabled/Disabled

</td><td>
Der Administrator MUSS die verpflichtende Authentifizierung der Clientsysteme
an- und abschalten können.

Default-Wert: Enabled

</td></tr><tr><td>
ANCL_CAUT_MODE

</td><td>
CERTIFICATE /  
PASSWORD

</td><td>
Der Administrator MUSS konfigurieren können, welcher Client
Authentifizierungsmodus genutzt werden kann bzw. genutzt werden muss.

Default-Wert: CERTIFICATE

</td></tr><tr><td>
ANCL_CAUT_LDAP

</td><td>
Enabled/Disabled

</td><td>
Der Administrator MUSS die verpflichtende Authentifizierung der Clientsysteme
für die Nutzung des LDAP-Proxy an- und abschalten können.

Default-Wert: Enabled

</td></tr><tr><td>
ANCL_CCERT_LIST

</td><td>
Liste von

X.509-Zertifikaten zugeordnet zu ClientID

</td><td>
Liste von importierten oder vom Konnektor erzeugten X.509-Zertifikaten und
dazugehörenden Clientsystem IDs. Der Administrator MUSS die Liste der
Zertifikate und den zugehörenden Clientsystemen verwalten können, der Inhalt
der Zertifikate MUSS menschlich lesbar dargestellt werden.  
Es muss für den
Administrator erkennbar sein, welches kryptographische Verfahren (RSA-2048 oder
ECC -256) dem jeweiligen Zertifikat zugrunde liegt.

</td></tr><tr><td>
ANCL_CUP_LIST

</td><td>
Liste von Benutzer/Passwort Kombinationen, zugeordnet zu ClientID

</td><td>
Liste von UserCredentials und dazugehörenden Clientsystem IDs. Der
Administrator MUSS eine Liste von Credentials und zugehörendem Clientsystem
verwalten können. Bei diesen Benutzer-/Passwortkombinationen handelt es sich
nicht um personenbezogene Credentials, sondern um clientbezogene.

</td></tr><tr><td>
ANCL_DVD_OPEN

</td><td>
Enabled/Disabled

</td><td>
Der Administrator MUSS konfigurieren können, ob der Zugriff auf den
Dienstverzeichnisdienst auch dann über einen ungesicherten http-Kanal erfolgen
kann (ENABLED), wenn ANCL_TLS_MANDATORY = ENABLED ist.

Default-Wert: Enabled

</td></tr></table>

**[\<=]**

Damit sich der Konnektor mittels X.509 gegenüber Clientsystemen authentisieren
kann, muss er über ein entsprechendes Zertifikat und dazu passendes
Schlüsselmaterial verfügen. Dieses Zertifikat und Schlüsselmaterial befinden
sich auf der gSMC-K (ID.AK.AUT). Der Administrator hat neben der Konfiguration
zur Nutzung des erneuerten C.AK.AUT , welches vom Konnektor heruntergeladen
wurde, auch mehrere Möglichkeiten, die ID.AK.AUT von der gSMC-K für die
Authentisierung gegenüber den Clientsystemen zu ersetzen:

 ---> UL

Da es sich um eine lokal begrenzte Authentisierung im Verantwortungsbereich des
Betreibers des lokalen Netzes handelt, werden keine weiteren Vorgaben zur
Erstellung und Handhabung in der LE-Umgebung der außerhalb des Konnektors
erzeugten Zertifikate und Schlüssel erhoben. Eine Online-Status-Prüfung
dieser Zertifikate ist nicht erforderlich und nicht vorgesehen.

##### A_21811-01

Der Konnektor MUSS bezüglich selbst generierter und importierter Schlüssel und
Zertifikate für die TLS-Authentisierung gegenüber Primärsystemen die
kryptographischen Vorgaben aus gemSpec_Krypt durchsetzen und bezüglich ECC
sowohl Brainpool- als auch NIST-Kurven unterstützen. **[\<=]**

##### A_21697

Der Konnektor MUSS dem Administrator den Import eines extern generierten
Schlüsselpaars und des dazugehörigen X.509-Zertifikats für die
Authentisierung des Konnektors im Rahmen von TLS-Verbindungen gegenüber
Clientsystemen über das Managementinterface ermöglichen. **[\<=]**

##### A_21698

Der Konnektor MUSS dem Administrator das Einschalten der Verwendung von
importiertem Schlüsselpaar und dazugehörigem X.509-Zertifikat für die
Authentisierung des Konnektors gegenüber Clientsystemen über das
Managementinterface ermöglichen. **[\<=]**

##### A_21699-01

Der Konnektor MUSS die Erstellung eines Schlüsselpaars und eines dazugehörigen
X.509-Zertifikats für die Authentisierung des Konnektors im Rahmen von
TLS-Verbindungen gegenüber den Clientsystemen durch den Administrator über
das Managementinterface ermöglichen. Hierbei MUSS der Konnektor dem
Administrator die Möglichkeit geben, das kryptographische Verfahren
RSA-2048, RSA-3072oder ECC-256 auszuwählen. Ferner MUSS der Konnektor dem
Administrator die Möglichkeit geben, den Hostnamen des Konnektors im
Zertifikat zu vergeben. **[\<=]**

##### A_21701

Der Konnektor MUSS dem Administrator den Export von intern generierten
X.509-Zertifikaten, die für die Authentisierung des Konnektors im Rahmen von
TLS-Verbindungen gegenüber den Clientsystemen verwendet werden,  über das
Managementinterface ermöglichen. Der private Schlüssel verbleibt im
Konnektor. **[\<=]**

##### A_21702

Der Konnektor MUSS dem Administrator das Einschalten der Verwendung von intern
generierten Schlüsseln und X.509-Zertifikaten für die Authentisierung des
Konnektors gegenüber den Clientsystemen über das Managementinterface
ermöglichen. **[\<=]**

##### A_21760-01

Der Konnektor MUSS dem Administrator das Einschalten der Verwendung von
ID.AK.AUTauf der gSMC-K für die Authentisierung des Konnektors gegenüber den
Clientsystemen über das Managementinterface ermöglichen.Der Konnektor MUSS
dabei zur Auswahl das RSA-Zertifikat C.AK.AUT.R2048 und (falls personalisiert)
das ECC-Zertifikat C.AK.AUT2.XXXX anbieten. Das ausgewählte Zertifikat MUSS
sowohl für die Serveridentität an der SOAP-Schnittstelle als auch für die
Clientidentität an der CETP-Schnittstelle verwendet werden. **[\<=]**

##### A_22894

DerHersteller des Konnektors MUSS im Administratorhandbuch erläutern, welche
Abhängigkeiten die unterschiedlichen Konfigurationen zur Authentifizierung
gegenüber den Clientsystemen zu beachten sind.  **[\<=]**

### 3.6 Clientsystemschnittstelle

##### TIP1-A_5401

Alle Schnittstellen, die der Konnektor den Clientsystemen zur Verfügung stellt,
MÜSSEN parallel durch mehrere Aufrufer nutzbar sein. **[\<=]**

### 3.6.1 SOAP-Schnittstelle

Für die Beschreibung der SOAP-Schnittstelle zum Clientsystem wird in dieser
Spezifikation WSDL Version 1.1 [WSDL1.1] eingesetzt. Die Interoperabilität
zwischen verschiedenen SOAP-Implementierungen wird durch die Vorgaben des WS-I
Basic Profile erreicht.

##### A_15601

Der Konnektor MUSS für die an der Clientsystemschnittstelle definierten
Web-Services der Basisdienste [SOAP1.1] verwenden. **[\<=]**

##### TIP1-A_4519

Der Konnektor MUSS die für die Clientsystemschnittstelle definierten
Web-Services konform zu [BasicProfile1.2] anbieten.

Abweichend von R1012 in [BasicProfile1.2] MUSS der Konnektor nur das Character
Encoding UTF-8 unterstützen. Andere Kodierungen MUSS der Konnektor mit einem
Fehler beantworten. **[\<=]**

##### TIP1-A_4519-01

Der Konnektor MUSS die für die Clientsystemschnittstelle definierten
Web-Services der Basisdienste konform zu [BasicProfile1.2] anbieten. **[\<=]**

##### A_15606

Abweichend von R1012 in [BasicProfile1.2] und [BasicProfile2.0] MUSS der
Konnektor nur das Character Encoding UTF-8 unterstützen. Andere Kodierungen
MUSS der Konnektor mit einem Fehler beantworten. **[\<=]**

Da der Konnektor UTF-16 nicht unterstützt, muss das Clientsystem den Request in
UTF-8 kodieren. Diese Festlegungen gelten nur für die eigentliche
SOAP-Nachricht. Sind in der SOAP-Nachricht base64-encodierte XML-Elemente
vorhanden, so können diese XML-Elemente andere Zeichencodierungen aufweisen.

Fachmodule

Fachmodule können für Web-Services, die Clientsystemen bereitgestellt werden,
entweder [SOAP1.1] mit [BasicProfile1.2] oder [SOAP1.2] mit [BasicProfile2.0]
verwenden. Die genaue Ausprägung erfolgt in der jeweiligen
Interfacebeschreibung des Web-Services für das Fachmodul.

##### A_15607

Der Konnektor MUSS für die an der Clientsystemschnittstelle definierten
Web-Services der Fachmodule [SOAP1.1] und [SOAP1.2] unterstützen. Die
SOAP-Version pro Web-Service Endpunkt wird durch die WSDL des jeweiligen
Web-Service definiert. **[\<=]**

##### A_15608

Der Konnektor MUSS für die an der Clientsystemschnittstelle definierten
Web-Services der Fachmodule bei [SOAP1.1] die Profilierung konform zu
[BasicProfile1.2] anbieten. **[\<=]**

##### A_15609

Der Konnektor MUSS für die an der Clientsystemschnittstelle definierten
Web-Services der Fachmodule bei [SOAP1.2] die Profilierung konform zu
[BasicProfile2.0]  anbieten. **[\<=]**

### 3.6.2 Statusrückmeldung und Fehlerbehandlung

Der Konnektor bietet Operationen an der Außenschnittstelle über
SOAP-Webservices an. Treten bei der Ausführung einer Operation Fehler auf, so
werden diese an das aufrufende System gemeldet. Die von den Basisdiensten des
Konnektors angebotenen SOAP-Webservices melden Fehler, die bei der Ausführung
einer Operation auftreten, über eine SOAP-Fault-Nachricht (siehe auch
[gemSpec_OM#3.2.3]).

##### TIP1-A_5058

Der Konnektor MUSS Fehlermeldungen, die im Rahmen einer über die
Außenschnittstelle aufgerufenen Operation auftreten, an das Clientsystem
mittels gematik-SOAP-Faults melden. **[\<=]**

##### TIP1-A_5058-01

Der Konnektor MUSS Fehlermeldungen, die im Rahmen einer über die
Außenschnittstelle aufgerufenen Operation eines Basisdienst-SOAP-Webservices
auftreten, an das Clientsystem mittels gematik-SOAP-Faults melden. **[\<=]**

Treten bei konnektorinternen Operationen (TUCs) Fehler auf, so werden diese an
den Aufrufer (aufrufender TUC oder aufrufende Operation) zurückgegeben. Der
Aufrufer kann den aufgetretenen Fehler in seinem Kontext neu interpretieren.
Das bedeutet insbesondere, dass ein Error eines aufgerufenen TUCs nicht
zwingend zum Abbruch des aufrufenden TUCs bzw. der aufrufenden Operation
führen muss. So ist es dem Aufrufer möglich, einen Error als Warnung zu
interpretieren und an den eigenen internen oder externen Aufrufer
zurückzumelden. Diese dabei erzeugte Fehlerkette wird in Form einer
Fehler-Trace-Struktur abgebildet, um eine Nachverfolgung von Fehlern zu
ermöglichen.

Operationen an der Außenschnittstelle können die Fehlerkette zu
Informationszwecken in der SOAP-Antwort an das Clientsystem senden. Dazu
enthält jede SOAP-Antwort das Element Status, dass gemäß dem XML-Schema
[ConnectorCommon.xsd] aufgebaut ist (siehe auch Abbildung PIC_KON_107
XML-Struktur des Status-Elements einer SOAP-Antwort).

![Abbildung-3][Abbildung-3]

Schlägt eine Operation fehl, so wird eine SOAP-Fault-Meldung an das
Clientsystem versendet. Im Erfolgsfall wird das Status-Element in die
Antwortnachricht an das Clientsystem aufgenommen. Ist der Fehler-Trace leer
(Element GERROR:Error ist nicht vorhanden), so wird CONN:Result auf OK gesetzt.
Andernfalls, d. h. wenn in GERROR:Trace Fehler der Schwere Info oder Warning
(zu Informationszwecken) enthalten sind, wird CONN:Result auf Warning gesetzt.

##### TIP1-A_4521

Der Konnektor MUSS Fehler protokollieren, die in fachlichen und technischen
Abläufen von der gematik spezifiziert oder herstellerspezifisch definiert
sind und den Schweregrad (Severity) Warning, Error oder Fatal haben. Zur
Nachvollziehbarkeit des Fehlers MÜSSEN Fehlerursache, fachliche und technische
Auslöser des Fehlverhaltens aus den Protokolleinträgen erkennbar sein. 
**[\<=]**

##### A_14159

Der Konnektor MUSS bei der Rückgabe von Fehlermeldungen an der
Außenschnittstelle sicherstellen, dass im letzten“ GERROR:Trace“-Element
der GERROR-Struktur ein von der gematik spezifizierter Fehler steht. Die
GERROR-Struktur kann weitere gematik- und herstellerspezifische Fehler
enthalten. **[\<=]**

In der Regel ist es ausreichend, wenn die GERROR-Struktur an der
Außenschnittstelle nur ein Element „GERROR:Trace“ mit einem gematik-Fehler
enthält.

Wenn für eine Fehlersituation kein Fehlercode spezifiziert ist, kann ein
herstellerspezifischer Fehler zur Detaillierung verwendet werden. In diesem
Fall muss ein passender gematik-Fehler als letztes GERROR:Trace-Element
gewählt werden.  Bei Fehlern in technischen Abläufen kann Fehlercode 4001
als letztes GERROR:Trace-Element verwendet werden. Die Wahl des letzten
GERROR:Trace-Elements ist mit der gematik abzustimmen.

Zur Struktur von Fehlermeldungen siehe auch [gemSpec_OM#GS-A_3856-*].

### 3.6.3 Transport großer Dokumente

SOAP Message Transmission Optimization Mechanism (MTOM) ermöglicht den direkten
Transport von binären Daten in Webservices, d.h. ohne dass eine zur Laufzeit
aufwändige Verpackung der binären Daten in ein Base64-XML-Element notwendig
wird. Auf die Definition der Webservices und ihre Funktionalität hat dieser
Optimierungsmechanismus keinen Einfluss. Der Einsatz von MTOM dient der
Verbesserung des Performance-Verhaltens für große Dokumente.

Das Clientsystem kann die Optimierung des Transports großer Dokumente per SOAP
Message Transmission Optimization Mechanism (MTOM) anstoßen. In den
WSDL-Dateien werden keine MTOM Serialization Policy Assertion [WS-MTOMPolicy]
eingebettet.

##### TIP1-A_5694

Der Konnektor KANN SOAP Message Transmission Optimization Mechanism (MTOM)
gemäß [MTOM] unterstützen.

Wenn der Konnektor MTOM unterstützt, MUSS er MTOM für Signatur- und
Verschlüsselungsdienst unterstützen, DARF aber NICHT MTOM für andere Dienste
unterstützen.

Wenn der Konnektor MTOM unterstützt, MUSS er, vergleichbar dem Einsatz des
Attributs wsp:Optional="true" einer MTOM Serialization Policy Assertion
[WS-MTOMPolicy], genau dann MTOM für die Antwortnachricht verwenden, wenn
entweder

 ---> UL

**[\<=]**

##### TIP1-A_5694-02

Der Konnektor KANN SOAP Message Transmission Optimization Mechanism (MTOM)
gemäß [MTOM-SOAP1.1] für Basisdienste unterstützen. **[\<=]**

##### TIP1-A_5694-03

Der Konnektor MUSS SOAP Message Transmission Optimization Mechanism (MTOM)
gemäß [MTOM-SOAP1.1] für Basisdienste unterstützen. **[\<=]**

##### A_15786

Wenn der Konnektor MTOM für Basisdienste unterstützt, MUSS er MTOM für
Signatur- und Verschlüsselungsdienst unterstützen, DARF aber NICHT MTOM für
andere Dienste unterstützen. **[\<=]**

##### A_15610

Wenn der Konnektor MTOM unterstützt, MUSS er, vergleichbar dem Einsatz des
Attributs wsp:Optional="true" einer MTOM Serialization Policy Assertion
[WS-MTOMPolicy], genau dann MTOM für die Antwortnachricht verwenden, wenn
entweder

 ---> UL

**[\<=]**

##### A_15611

Der Konnektor MUSS SOAP Message Transmission Optimization Mechanism (MTOM)
gemäß [MTOM] für Fachmodule unterstützen, wenn es in der
Schnittstellenbeschreibung des Fachmodules explizit gefordert wird. **[\<=]**

### 3.7 Verwendung manuell importierter CA-Zertifikate

TI-fremde X.509-Zertifikate werden im Rahmen des Verschlüsselungsdienstes
verwendet. Um den Vertrauensraum für diese Zertifikate abzubilden, erlaubt der
Konnektor, X.509-CA-Zertifikate zu diesen TI-fremden X.509-Zertifikaten in eine
interne Liste (CERT_IMPORTED_CA_LIST) zu importieren.

Der Konnektor kann dann im Rahmen der Hybridverschlüsselung den symmetrischen
Schlüssel empfängerspezifisch mit dessem TI-fremden X.509-Zertifikat
verschlüsseln. Die TI-fremden Zertifikate dürfen nicht zu einem anderen Zweck
als diesem eingesetzt werden.

##### TIP1-A_5433

Der Konnektor DARF End-Entity-Zertifikate, die lediglich gegen manuell
importierte X.509-CA-Zertifikate geprüft werden, die von CAs außerhalb der TI
stammen (CERT_IMPORTED_CA_LIST), NICHT für andere Zwecke als zur hybriden
Verschlüsselung von Dokumenten verwenden. **[\<=]**

Die Berücksichtigung der CA-Zertifikate aus CERT_IMPORTED_CA_LIST muss auf
folgende Anwendungsfälle beschränkt werden:

1. Prüfung eines Zertifikates im Rahmen der hybriden Verschlüsselung

2. Prüfung eines Zertifikates im Rahmen eines Aufrufes der Operation
"VerifyCertificate"

##### TIP1-A_5660

Das Handbuch des Konnektors MUSS sinngemäß folgende Hinweise enthalten:

 ---> UL

**[\<=]**

### 3.8 Testunterstützung

Gemäß Testkonzept der TI [gemKPT_Test#TIP1-A_6526] muss ein Hersteller eines
Konnektors seine Modelle in verschiedenen Ausführungen vorsehen: für
Testumgebung, für die Referenzumgebung und für die Produktivumgebung.Damit
trotz dieser Forderung die Firmware je Konnektorversion für alle Umgebungen
identisch ist, wird die Erkennung der Umgebung an die gSMC-K gebunden. Die
Konnektor-Firmware muss zwischen den Umgebungen PU und RU/TU unterscheiden. Die
gSMC-K besitzt hierzu den Datencontainer MF/EF.EnvironmentSettings, der die
jeweilige Umgebungskennung enthält (PU bzw. TU/RU). Die Umgebungskennung wird
read-only auf der gSMC-K gespeichert.

##### TIP1-A_4981

Der Produkttyp Konnektor MUSS sowohl in der Testumgebung (TU), der
Referenzumgebung (RU) wie auch der Produktivumgebung (PU) betreibbar sein.Die
Information, ob eine Konnektorinstanz in der TU/RU oder PU betrieben wird, MUSS
der Konnektor dem File MF/EF.EnvironmentSettings der gSMC-K entnehmen.Abhängig
von der ermittelten Betriebsumgebung MÜSSEN die Konfigurationswerte gemäß
Tabelle TAB_KON_812 verwendet werden.

Tabelle12: TAB_KON_812 Umgebungsabhängige Konfigurationsparameter

<table><tr><th>
Betriebs

umgebung

</th><th>
Konfigurations

parameter

</th><th>
Konfigurations

wert

</th><th>
Beschreibung

</th></tr><tr><td rowspan="4">
PU

</td><td>
NET_TI_

ZENTRAL

</td><td>
siehe [gemSpec_Net#Tab_

Adrkonzept_Produktiv]

</td><td>
Siehe TAB_KON_680.

Dieser Wert MUSS für den Administrator über die Managementschnittstelle
einsehbar, DARF aber NICHT änderbar sein.

</td></tr><tr><td>
NET_TI_

GESICHERTE_FD

</td><td>
siehe [gemSpec_Net#Tab_

Adrkonzept_Produktiv]

</td><td>
Siehe TAB_KON_680.

Dieser Wert MUSS für den Administrator über die Managementschnittstelle
einsehbar, DARF aber NICHT änderbar sein.

</td></tr><tr><td>
NET_TI_

OFFENE_FD

</td><td>
siehe [gemSpec_Net#Tab_

Adrkonzept_Produktiv]

</td><td>
Siehe TAB_KON_680.

Dieser Wert MUSS für den Administrator über die Managementschnittstelle
einsehbar, DARF aber NICHT änderbar sein.

</td></tr><tr><td>
DNS_TOP_

LEVEL_DOMAIN_TI

</td><td>
telematik.

</td><td>
Siehe TAB_KON_731.

Dieser Wert MUSS für den Administrator über die Managementschnittstelle
einsehbar, DARF aber NICHT änderbar sein.

</td></tr><tr><td rowspan="4">
RU/TU

</td><td>
NET_TI_

ZENTRAL

</td><td>
siehe [gemSpec_Net# Tab_Adrkonzept_Test]

</td><td>
Siehe TAB_KON_680.

Dieser Wert MUSS für den Administrator über die Managementschnittstelle mit
dem Konfigurationswert voreingestellt und änderbar sein.

</td></tr><tr><td>
NET_TI_

GESICHERTE_FD

</td><td>
siehe [gemSpec_Net#

Tab_Adrkonzept_Test]

</td><td>
Siehe TAB_KON_680.

Dieser Wert MUSS für den Administrator über die Managementschnittstelle mit
dem Konfigurationswert voreingestellt und änderbar sein.

</td></tr><tr><td>
NET_TI_

OFFENE_FD

</td><td>
siehe [gemSpec_Net# Tab_Adrkonzept_Test]

</td><td>
Siehe TAB_KON_680.

Dieser Wert MUSS für den Administrator über die Managementschnittstelle mit
dem Konfigurationswert voreingestellt und änderbar sein.

</td></tr><tr><td>
DNS_TOP_

LEVEL_

DOMAIN_TI

</td><td>
telematik-test.

</td><td>
Siehe TAB_KON_731.

Dieser Wert MUSS für den Administrator über die Managementschnittstelle
einsehbar, aber nicht änderbar sein.

</td></tr></table>

**[\<=]**

##### TIP1-A_4707

Der Produkttyp Konnektor MUSS auch in der Test- und Referenzumgebung betrieben
werden können. Dafür MUSS der Vertrauensanker des Konnektors für diese
Umgebung ausgetauscht werden können. Dies KANN durch Lieferung eines neuen
Konnektors oder durch Austausch der gSMC-K durch den Hersteller ermöglicht
werden. Der Hersteller MUSS sicherstellen, dass Konnektoren ausschließlich mit
den zu ihrer Einsatzumgebung gehörenden Vertrauensankern ausgestattet werden. **[\<=]**

##### TIP1-A_4982

Die Administrationsoberfläche MUSS, wenn der Konnektor in der Testumgebung (TU)
oder Referenzumgebung (RU) betrieben wird, die Umgebungsbezeichnung zu jeder
Zeit erkennbar in der Managementschnittstelle anzeigen.

Die Anzeige eines Betriebs in der Produktivumgebung DARF NICHT explizit
angezeigt werden. **[\<=]**

### 4 Funktionsmerkmale

Für die folgenden Inhalte bitte die Hinweise in Kapitel 1.5.3 „Erläuterungen
zur Spezifikation des Außenverhaltens„ sowie Kapitel 1.5.4 Erläuterungen
zur Dokumentenstruktur und „Dokumentenmechanismen“ beachten.

### 4.1 Anwendungskonnektor

### 4.1.1 Zugriffsberechtigungsdienst

Der Zugriffsberechtigungsdienst ist ein interner Dienst. Er ermöglicht es
Operationen eine Prüfung auf Zugriffsberechtigung für die von ihnen
benötigten Ressourcen durchzuführen. Die Prüfung erfolgt direkt nach Aufruf
einer Operation des Konnektors durch das Clientsystem und basiert auf den im
Clientaufruf enthaltenen Parametern.

Der Zugriffsberechtigungsdienst definiert über ein Informationsmodell die
erlaubten Zugriffsmöglichkeiten. Um dies zu erreichen, modelliert es Mandanten
und ordnet ihnen Clientsysteme sowie die vom Konnektor verwalteten externen
Ressourcen (Kartenterminal mit Slots, Arbeitsplatz mit SMC-Bs) zu. Diese durch
einen Administrator persistent zu modellierenden Entitäten und Beziehungen
beinhalten die erlaubten Zugriffswege vom Clientsystem über Arbeitsplatz zum
Kartenterminal und dessen Slots. Sie werden im Konnektor administrativ
konfiguriert.

Neben diesen persistenten Entitäten und Beziehungen bildet das Modell auch die
in den Slots temporär gesteckten Karten und die zugehörigen Kartensitzungen
als transiente Entitäten und Beziehungen ab.

Abbildung PIC_Kon_100 stellt das Informationsmodell dar. Die persistenten
Entitäten haben einen grünen Hintergrund, die transienten einen weißen.

Tabelle TAB_KON_507 beschreibt die Entitäten und legt ihren
Identitätsschlüssel fest. Tabelle TAB_KON_508 beschreibt die Attribute.
Tabelle TAB_KON_509 beschreibt die Entitätsbeziehungen und referenziert dabei
die in Abbildung PIC_Kon_100 durch Zahlen in eckigen Klammern markierten
Beziehungen. Tabelle TAB_KON_510 definiert Constraints, die zusätzlich zu den
in Abbildung PIC_Kon_100 definierten Kardinalitäten gelten. Die Constraints
werden mittels Object Constraint Language (OCL) definiert.

### 4.1.1.1 Funktionsmerkmalweite Aspekte

##### TIP1-A_4522

Der KonnektorMUSS die Entitäten, Attribute und Beziehungen des
Informationsmodells intern vorhalten, dabei für die Einhaltung der definierten
Constraints sorgen und die persistenten Entitäten und Beziehungen dauerhaft
speichern. Der Konnektor MUSS dabei eine Mindestanzahl von 999 Mandanten
unterstützen.

Das Informationsmodell ist definiert durch das UML-Diagramm „PIC_Kon_100
Informationsmodell des Konnektors„ und die Tabelle „TAB_KON_510
Informationsmodell Constraints“. Der Konnektor darf nur Daten in sein
Informationsmodell übernehmen, die alle Eigenschaften des Informationsmodells,
insbesondere die Constraints, erfüllen.

Die Entitäten werden in Tabelle „TAB_KON_507 Informationsmodell
Entitäten“beschrieben, die Attribute in Tabelle „TAB_KON_508
Informationsmodell Attribute“und die Beziehungen in Tabelle „TAB_KON_509
Informationsmodell Entitätenbeziehungen“. **[\<=]**

Hinweis zu den Bezeichnern der Entitäten und ihrer Attribute: Im Folgenden
beginnen Entitäten mit einem Großbuchstaben, Attribute mit einem
Kleinbuchstaben. Werden die Entitäten und Attribute in XML-Dokumenten
verwendet, so beginnen die zugeordneten XML-Elementbezeichner grundsätzlich
mit einem Großbuchstaben und verwenden den englischen Begriff, der im
Folgenden in Klammern angegeben ist, wenn zur besseren Lesbarkeit im Modell ein
deutscher Begriff verwendet wird.

![Abbildung-4][Abbildung-4]

<table><tr><th>
Entität

</th><th>
persistent/

transient

</th><th>
Identitätsschlüssel

</th><th>
Beschreibung

</th></tr><tr><td>
Mandant

</td><td>
persistent

</td><td>
mandantId

</td><td>
Zu Mandanten und Mandantenfähigkeit siehe Kapitel Mandantenfähigkeit.

</td></tr><tr><td>
Clientsystem

</td><td>
persistent

</td><td>
clientSystemId

</td><td>
Unter einem Clientsystem wird hier ein einzelnes oder eine Gruppe von Systemen
verstanden, welche im LAN der Einsatzumgebung auf die
Clientsystem-Schnittstelle des Konnektors zugreifen.

</td></tr><tr><td>
CS-AuthMerkmal

(CS-AuthProperty)

</td><td>
persistent

</td><td>
csAuthId

</td><td>
Das Authentifizierungsmerkmal dient der Authentifizierung, wenn sich das
Clientsystem gegenüber dem Konnektor authentisiert. Der Identitätsschlüssel
csAuthId wird bei der Administration vergeben

</td></tr><tr><td>
Arbeitsplatz

(Workplace)

</td><td>
persistent

</td><td>
workplaceId

</td><td>
alle dem Konnektor bekannten Arbeitsplätze

</td></tr><tr><td>
Kartenterminal

(CardTerminal)

</td><td>
persistent

</td><td>
ctId

</td><td>
alle dem Konnektor bekannten Kartenterminals.

</td></tr><tr><td>
KT-Slot

(CT-Slot)

</td><td>
persistent

</td><td>
ctId,

slotNo

</td><td>
Die sich in den Kartenterminals befindenden Chipkartenslots (Functional Unit
Type 00)

</td></tr><tr><td>
Karte

(Card)

</td><td>
transient

</td><td>
cardHandle

oder

iccsn

</td><td>
Die in den Kartenterminals steckenden Smartcards des Gesundheitswesens, die
persönliche Identitäten oder Rollen repräsentieren (eGK, HBA, SMC-B).

Karten, die nur Geräteidentitäten tragen (gSMC-K, gSMC-KT) werden in diesem
Modell nicht betrachtet.

Karten im Sinne dieses Informationsmodells existieren maximal so lange, wie sie
im Kartenterminal stecken. Die aktuell im System steckenden Karten werden vom
Clientsystem über das cardHandle adressiert. Die iccsn erlaubt eine dauerhafte
Adressierung einer Karte.

Für den Kartentyp „SM-B“ kann hier auch eine in einem HSM-B enthaltene
virtuelle SMC-B abgebildet werden.

</td></tr><tr><td>
Kartensitzung

(CardSession)

</td><td>
transient

</td><td>
siehe

konkrete

Kartensitzungen

</td><td>
Kartensitzungen stellen ein wesentliches Konzept im Sicherheitsmodell des
Konnektors dar. Eine Kartensitzung verwaltet einen aktuellen logischen
Sicherheitsstatus einer Karte. Die Kartensitzungen sind einer Karte fest
zugewiesen.

Zu einer Karte kann es mehrere Kartensitzungen geben, die voneinander logisch
unabhängige Sicherheitsstatus einer Karte verwalten.

Der Konnektor führt alle Zugriffe auf eine Karte im Kontext einer Kartensitzung
zu dieser Karte aus.

Das Attribut logischerKanal bezeichnet den logischen Kanal zur Karte, der im
Rahmen der Kartensitzung verwendet wird (gemäß Standard [7816–4]).

</td></tr><tr><td>
Kartensitzung_eGK

(CardSession_eGK)

</td><td>
transient

</td><td>
cardHandle

</td><td>
Kartensitzung für eine eGK. Die KVK ist im Modell nicht explizit dargestellt.
Soweit anwendbar, gelten für die KVK die gleichen Aussagen wie für die eGK.

</td></tr><tr><td>
Kartensitzung_SM-B

(CardSession_SM-B)

</td><td>
transient

</td><td>
cardHandle, mandantId

</td><td>
Kartensitzung für eine SM-B

</td></tr><tr><td>
Kartensitzung_HBAx

(CardSession_HBAx)

</td><td>
transient

</td><td>
cardHandle, clientSystemId,

userId

</td><td>
Kartensitzung für einen HBAx.

Unter dem Typ „HBAx“ sind auch die Vorläuferkarten wie „HBA-qSig” und
„ZOD_2.0“ inkludiert.

</td></tr><tr><td>
SM-B_Verwaltet

(SM-B_managed)

</td><td>
persistent

</td><td>
iccsn

</td><td>
SM-Bs müssen im Gegensatz zu den übrigen Karten im Konnektor vor ihrer
Verwendung persistent im Informationsmodell als

„SM-B_Verwaltet“ per Administration aufgenommen werden.

Dies gilt auch für die in einem HSM-B enthaltenen virtuellen SMC-Bs.

</td></tr><tr><td>
CS_AP

</td><td>
persistent

</td><td>
mandantId, clientSystemId, workplaceId

</td><td>
CS_AP legt die von einem Clientsystem pro Mandanten nutzbaren Arbeitsplätze
fest. Ein Clientsystem kann dabei mehrere Arbeitsplätze bedienen. Ebenso
können Arbeitsplätze von mehreren Clientsystemen, auch gleichzeitig, genutzt
werden, z. B. bei zwei unterschiedlichen, voneinander unabhängigen
Praxisprogrammen.

</td></tr><tr><td>
Remote-PIN-KT

</td><td>
persistent

</td><td>
mandantId, workplaceId, ctId

</td><td>
Remote-PIN-KT legt pro Mandant und Arbeitsplatz fest, über welches
Kartenterminal eine Remote PIN-Eingabe erfolgen soll, wenn an diesem
Arbeitsplatz die PIN-Eingabe für eine Karte erforderlich ist, die nicht in
einem dem Arbeitsplatz lokal zugeordneten Kartenterminal steckt.

</td></tr><tr><td>
AuthState

</td><td>
transient

</td><td>
cardHandle, (clientSystemId),

(userId),

ref

</td><td>
Zu einer Kartensitzung gibt es höhere AuthorizationStates, die durch (type
=C2C) Freischaltung oder durch PIN-Eingabe (type=CHV) erreicht werden können.

Für eGK G2.0 wird der Zustand der MRPINs nicht in AuthState gespeichert.

</td></tr></table>

<table><tr><th>
Attribut

</th><th>
Beschreibung

</th></tr><tr><td>
cardHandle

</td><td>
Das Identifikationsmerkmal einer Karte für die Dauer eines Steckzyklusses. Es
wird mit dem Entfernen der Karte aus dem Kartenterminal ungültig. Es wird
automatisch vom Konnektor vergeben.

</td></tr><tr><td>
clientSystemId

</td><td>
Das Identifikationsmerkmal eines Clientsystems. Es wird per Administration dem
Mandanten im Clientsystem und im Konnektor zugeordnet.

</td></tr><tr><td>
csAuthId

</td><td>
Das Identifikationsmerkmal eines Authentifizierungsmerkmals.

</td></tr><tr><td>
ctId

</td><td>
Das Identifikationsmerkmal eines Terminals. Es ist eine fixe Eigenschaft des
Kartenterminals.

</td></tr><tr><td>
iccsn

</td><td>
Die Seriennummer einer Karte. Sie identifiziert eine Karte dauerhaft.

</td></tr><tr><td>
isHSM

</td><td>
Attribut der Entitäten Karte und SM-B_Verwaltet. Es ist false, wenn eine echte
Smardcard abgebildet wird und true, wenn es sich um eine virtuelle SMC-B
handelt, die in einem HSM-B enthalten ist.

</td></tr><tr><td>
isPhysical

</td><td>
Attribut des Kartenterminals das den Wert „Ja“ hat, wenn es sich um ein
tatsächlich existierendes Kartenterminal handelt. Ist der Wert „Nein“,
dann handelt es sich um ein logisches Kartenterminal im Zusammenhang mit einem
HSM-B.

</td></tr><tr><td>
logicalChannel

</td><td>
Referenz auf ein Objekt, das einen logischen Kanal repräsentiert.

</td></tr><tr><td>
mandantId

</td><td>
Das Identifikationsmerkmal eines Mandanten. Es wird per Administration dem
Mandanten im Clientsystem und im Konnektor zugeordnet.

</td></tr><tr><td>
ref

</td><td>
Das Identifikationsmerkmal eines AuthState zu einer gegebenen Kartensitzung. Im
Falle C2C handelt es sich um die KeyRef (mit einer bestimmten Rolle) und in
Falle CHV um eine referenzierte PIN.

</td></tr><tr><td>
slotNo

</td><td>
Das Identifikationsmerkmal eines Slot für ein bestimmtes Kartenterminal. Diese
fortlaufende Nummer ist eine fixe Eigenschaft des Kartenterminals. Sie beginnt
bei 1.

</td></tr><tr><td>
type

</td><td>
Als Kartenattribut: Typ einer Karte. Im Folgenden berücksichtigte Werte:
„HBAx“, „SM-B“, „EGK“.

Als Attribute eines AuthState: Typ des AuthState. „C2C“ steht für
gegenseitige Kartenauthentisierung. „CHV“ steht für Card Holder
Verification per PIN-Eingabe.

</td></tr><tr><td>
userId

</td><td>
Das Identifikationsmerkmal des Nutzers im Clientsystem (Die userId wird durch
das Clientsystem vergeben und verwaltet).

Die userId wird im Kontext eine Kartensitzung_HBAx vom Konnektor verwendet, um
als Bestandteil des Identitätsschlüssels die Kartensitzung_HBAx zu
identifizieren.

</td></tr><tr><td>
workplaceId

</td><td>
Das Identifikationsmerkmal eines Arbeitsplatzes. Es wird per Administration dem
Mandanten im Clientsystem und im Konnektor zugeordnet.

</td></tr></table>

<table><tr><th>
Entitätenbeziehung

</th><th>
persistent/

transient

</th><th>
Beschreibung

</th></tr><tr><td>
Authentifikationsmerkmale des Clientsystems [1]

</td><td>
persistent

</td><td>
Diese Relation legt für jedes Clientsystem eine Menge von
Authentisierungsmerkmalen fest. Mit einem dieser Authentisierungsmerkmale muss
sich ein Client gegenüber dem Konnektor authentisiert haben, um als das
entsprechende Clientsystem vom Konnektor akzeptiert zu werden.

</td></tr><tr><td>
Clientsysteme des Mandanten [2]

</td><td>
persistent

</td><td>
Diese Relation weist Clientsystemen Mandanten zu.

</td></tr><tr><td>
Arbeitsplätze des Mandanten [3]

</td><td>
persistent

</td><td>
Diese Relation weist Arbeitsplätze Mandanten zu.

Arbeitsplätze können von mehreren Mandanten genutzt werden. Z. B. kann ein von
mehreren Mandanten genutzter gemeinsamer Empfang als ein Arbeitsplatz
modelliert werden.

</td></tr><tr><td>
Kartenterminals des Mandanten [5]

</td><td>
persistent

</td><td>
Diese Relation weist Kartenterminals Mandanten zu.

</td></tr><tr><td>
Lokale Kartenterminals [6]

</td><td>
persistent

</td><td>
Diese Relation erfasst die Kartenterminals, die sich lokal an einem Arbeitsplatz
befinden und von diesem genutzt werden können. Die Modellierung lässt es zu,
dass Kartenterminals mehreren Arbeitsplätzen lokal zugewiesen werden. Jeder an
der TI teilnehmende Arbeitsplatz wird in der Regel mindestens ein lokales
Kartenterminal benötigen.

</td></tr><tr><td>
Entfernte Kartenterminals [7]

</td><td>
persistent

</td><td>
Diese Relation beschreibt, auf welche Kartenterminals Arbeitsplätze (remote)
zugreifen dürfen. Dies ist für zentral steckende Karten vorgesehen.

</td></tr><tr><td>
Slot eines Kartenterminals [8]

</td><td>
persistent

</td><td>
Die Zuordnung von Slots zu einem Kartenterminal ergibt sich automatisch aus den
Eigenschaften des Kartenterminals.

</td></tr><tr><td>
SM-B_Verwaltet eines Mandanten [9]

</td><td>
persistent

</td><td>
Diese Relation legt fest, welche verwalteten

SM-Bs einem Mandanten zugeordnet sind.

</td></tr><tr><td>
Kartenterminal-Slot, in dem eine Karte steckt [10]

</td><td>
transient

</td><td>
Sobald eine Karte in ein Kartenterminal gesteckt wird, ergibt sich implizit eine
Relation der Karte zu dem Slot, in dem sie steckt, [6] und indirekt über [4]
zum Kartenterminal.

</td></tr><tr><td>
Mandant der Kartensitzung

SM-B [11]

</td><td>
transient

</td><td>
Beim Anlegen einer Kartensitzung SM-B wird diese immer dem zugreifenden
Mandanten zugeordnet.

</td></tr><tr><td>
Arbeitsplatz der Kartensitzung eGK [12]

</td><td>
transient

</td><td>
Eine Kartensitzung eGK ist immer einem Arbeitsplatz zugeordnet.

</td></tr><tr><td>
Karte einer Kartensitzung [13]

</td><td>
transient

</td><td>
Jeder Kartensitzung ist genau einer Karte zugeordnet.

</td></tr><tr><td>
Gesteckte SM-B [14]

</td><td>
transient

</td><td>
Wird eine SM-B gesteckt und handelt es sich um eine verwaltete SM-B, ergibt sich
über die iccsn die Zuordnung.

</td></tr><tr><td>
Freischaltung einer Karte [15]

</td><td>
transient

</td><td>
Diese Relation erfasst die Freischaltung einer Karte durch eine andere Karte.

</td></tr><tr><td>
Bindung der Kartensitzung_HBAx an Clientsystem [16]

</td><td>
transient

</td><td>
Kartensitzungen HBAx sind einem Clientsystem zugeordnet.

</td></tr><tr><td>
AuthState pro Kartensitzung [17]

</td><td>
transient

</td><td>
Eine Kartensitzung kann erhöhte Sicherheitszustände (Authorization State)
haben.

</td></tr></table>

<table><tr><th>
#

</th><th>
Beschreibung

</th><th>
Definition mittels OCL

(Die Constraints werden im UML ergänzenden Standard OCL definiert.)

</th></tr><tr><td>
C1

</td><td>
Eine eGK muss eine oder keine Kartensitzung haben.

</td><td>
context

Karte

inv

: self.type = "eGK" implies

  self.kartensitzung.size() \<= 1

</td></tr><tr><td>
C2

</td><td>
Wenn zwei Kartensitzungen einer HBAx dem gleichen Clientsystem zugeordnet sind
und ihre userIds gleich sind, dann müssen die beiden Kartensitzungen identisch
sein.

</td><td>
context

Kartensitzung-HBAx

inv

: forAll(k1, k2 : Kartensitzung-HBAx |

  k1.karte = k2.karte

   

and k1.clientsystem = k2.clientsystem

   

and k1.userId = k2.userId

   

implies

  k1 = k2)

</td></tr><tr><td>
C3

</td><td>
Wenn zwei SM-B-Kartensitzungen einer Karte dem gleichen Mandanten zugeordnet
sind, dann müssen die beiden Kartensitzungen identisch sein.

</td><td>
context

Kartensitzung-SM-B

inv

: forAll(k1, k2 : Kartensitzung-SM-B |

  k1.karte = k2.karte

   

and k1.mandant = k2.mandant implies

  k1 = k2)

</td></tr><tr><td>
C4

</td><td>
Die Seriennummer iccsn einer Karte muss eindeutig sein.

</td><td>
context

Karte

inv

: Karte.allInstances -\>

     isUnique(iccsn)

</td></tr><tr><td>
C5

</td><td>
Die Seriennummer iccsn einer Karte muss für die vom Konnektor verwalteten

SM-Bs eindeutig sein.

</td><td>
context

SM-B_Verwaltet

inv

: SM-B_Verwaltet.allInstances -\>  

     isUnique(iccsn)

</td></tr><tr><td>
C6

</td><td>
Das CardHandle einer Karte muss eindeutig sein.

</td><td>
context

Karte

inv

: Karte.allInstances -\>

     isUnique(cardHandle)

</td></tr><tr><td>
C7

</td><td>
Die Identifikationsnummer des Clientsystems muss eindeutig sein.

</td><td>
context

Clientsystem

inv

: Clientsystem.allInstances -\>

     isUnique(clientSystemId)

</td></tr><tr><td>
C8

</td><td>
Die Identifikationsnummer des Mandanten muss eindeutig sein.

</td><td>
context

Mandant

inv

: Mandant.allInstances -\>

     isUnique(mandantId)

</td></tr><tr><td>
C9

</td><td>
Die Identifikationsnummer des Arbeitsplatzes muss eindeutig sein.

</td><td>
context

Arbeitsplatz

inv

: Arbeitsplatz.allInstances -\>

     isUnique(workplaceId)

</td></tr><tr><td>
C10

</td><td>
Die Identifikationsnummer des Kartenterminals muss eindeutig sein.

</td><td>
context

Kartenterminal

inv

: Kartenterminal.allInstances -\>

     isUnique(ctId)

</td></tr><tr><td>
C11

</td><td>
Die Identifikationsnummer (slotNo) des Kartenterminal-Slots für ein gegebenes
Kartenterminal muss eindeutig sein.

</td><td>
context

Kartenterminal

inv

: self.kT-Slot -\>

     isUnique(slotNo)

</td></tr><tr><td>
C12

</td><td>
Es muss gewährleistet sein, dass nur Arbeitsplätze und Clientsysteme einander
im Rahmen eines Mandanten zugeordnet werden, die diesem Mandanten selbst
zugeordnet sind.

</td><td>
context

CS-AP

inv

: self.arbeitsplatz.mandant.includes(          

      self.mandant)

inv

: self.clientsystem.mandant.includes(          

      self.mandant)

</td></tr><tr><td>
C13

</td><td>
Es muss gewährleistet sein, dass nur Kartenterminals und Arbeitsplätze
einander im Rahmen eines Mandanten zur Remote-PIN-Eingabe zugeordnet werden,
die diesem Mandanten selbst zugeordnet sind.

</td><td>
context

Remote-PIN-KT

inv

: self.arbeitsplatz.mandant.includes(          

      self.mandant)

inv

: self.kartenterminal.mandant.includes(          

      self.mandant)

</td></tr><tr><td>
C14

</td><td>
Zur Remote-PIN-Eingabe muss ein

lokales

Kartenterminal ausgewählt sein.

</td><td>
context

Remote-PIN-KT

inv

: self.arbeitsplatz

     .localKartenterminal

     .includes(self.kartenterminal)

inv

: not self.arbeitsplatz

     .entferntKartenterminal

     .includes(self.kartenterminal)

</td></tr><tr><td>
C15

</td><td>
Zur Remote-PIN-Eingabe darf pro Mandanten und Arbeitsplatz nicht mehr als ein
Kartenterminal ausgewählt werden.

</td><td>
context

Remote-PIN-KT

inv

: forAll(r1, r2 : Remote-PIN-KT |

  r1.arbeitsplatz = r2.arbeitsplatz

   

and r1.mandant = r2.mandant implies

  r1 = r2)

</td></tr><tr><td>
C16

</td><td>
Eine Kartensitzung-HBAx muss immer eine zugehörige userId haben.

</td><td>
context

Kartensitzung-HBAx

inv

: self.userId \<\> null

</td></tr></table>

Hinweis zur Remote-PIN-Eingabe: Constraints C14 und C15 legen fest, dass auch im
Fall mehrerer lokaler Kartenterminals an einem Arbeitsplatz nur eines (oder
keines) dieser Kartenterminals pro Mandant für die Remote-PIN-Eingabe im
Informationsmodell konfiguriert wird.

##### TIP1-A_4523

Der Konnektor MUSS seine Entscheidungen zur Zugriffsberechtigung basierend auf
den aktuellen, realen statischen wie transienten Entitäten und Beziehungen des
Informationsmodells treffen. Veränderungen an der statischen Definition (durch
den Administrator), sowie Veränderungen an den Entitäten (Änderung der
Verfügbarkeit und Zustandsänderung von Karten, Kartenterminals und
Clientsystemen) MÜSSEN bei Zugriffsanfragen unmittelbare Auswirkung auf die
Entscheidung des Zugriffsberechtigungsdienstes zur Folge haben. **[\<=]**

### 4.1.1.2 Durch Ereignisse ausgelöste Reaktionen

Keine.

### 4.1.1.3 Interne TUCs, nicht durch Fachmodule nutzbar

Keine.

### 4.1.1.4 Interne TUCs, auch durch Fachmodule nutzbar

### 4.1.1.4.1 TUC_KON_000 „Prüfe Zugriffsberechtigung“

Vor Ausführung jeder Operation an der Außenschnittstelle muss der Konnektor
prüfen, ob die Operation ausgeführt werden darf (Autorisierung). Diese
Prüfung auf Zugriffsberechtigung wird in TUC_KON_000 „Prüfe
Zugriffsberechtigung“ gekapselt.

TUC_KON_000 „Prüfe Zugriffsberechtigung“ hat als Aufrufparameter den
Aufrufkontext der Operation (siehe Abbildung PIC_KON_101), optional das
cardHandle einer Karte, optional eine Kartenterminal-ID ctId und optional die
Steuerungsparameter „needCardSession“ sowie „allWorkplaces“. Über den
Steuerungsparameter „needCardSession“ wird festgelegt, ob zu den
CardHandles im Rahmen der Operationsausführung eine Kartensitzung benötigt
wird. Über den Steuerungsparameter „allWorkplaces“. wird festgelegt, ob
die Auswertung im Rahmen der Operation arbeitsplatzübergreifend für alle vom
Mandanten für das angegebene Clientsystem erreichbaren Kartenterminals
erfolgen soll.

![Abbildung-5][Abbildung-5]

##### TIP1-A_4524-03

Der Konnektor MUSS den technischen Use Case TUC_KON_000 „Prüfe
Zugriffsberechtigung“ umsetzen.

Tabelle17: TAB_KON_511-01 – TUC_KON_000 „Prüfe Zugriffsberechtigung“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_000 ”Prüfe Zugriffsberechtigung”

</td></tr><tr><td>
Beschreibung

</td><td>
Es wird geprüft, ob eine Autorisierung im Rahmen der angegebenen 

Eingangsdaten erteilt wird. Die Autorisierung wurde erteilt, wenn der TUC 

erfolgreich durchlaufen wurde (kein Abbruch durch Fehlermeldung).“

</td></tr><tr><td>
Eingangs- anforderungen

</td><td>
keine

</td></tr><tr><td>
Auslöser und Vorbedingungen

</td><td>
Aufruf einer Operation des Konnektors durch das Clientsystem.

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Nachbedingungen

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
 1. Prüfe, ob die Pflichtparameter (mandantId, clientSystemId, workplaceId) 

     vollständig gesetzt sind.  
 2. Falls ANCL_CAUT_MANDATORY =
Enabled, dann prüfe, ob die gemäß  
     [TIP1-A_4516] unter
Berücksichtigung von [TIP1-A_5009] und [A_21224] durchgeführte         
   Authentifizierung über ein dem Clientsystem zugeordnetes CS-AuthMerkmal
erfolgte.  
 3. Ermittle Zugriffsregel R zu den Aufrufparametern:  
3.1.    
Falls der Parameter cardHandle nicht null ist, muss das Kartenobjekt  
    
des Informationsmodells Karte(cardHandle) ermittelt werden.  
3.2.     Zu
den Parametern (ctId, cardHandle, needCardSession,  
    allWorkplaces) muss
mittels Tabelle „TAB_KON_513 Zugriffsregeln  
    Regelzuordnung“ die
Zugriffsregel R ermittelt werden.  
 4. Prüfe die Bedingungen der in Schritt
3 ermittelten Regel R:  
4.1.     Zur Regel R muss die relevante Spalte in
Tabelle „TAB_KON_514   
     Zugriffsregeln Definition“ ermittelt
werden.  
4.2.     Jede Zeile, die in der Spalte R ein „x“ hat, muss
geprüft werden:  
    4.2.1     Prüfe, ob die in Spalte
„Bedingung“ mittels OCL formulierte   
            Bedingung
für die Eingangsdaten erfüllt ist.

</td></tr><tr><td>
Varianten/  
Alternativen

</td><td>
2.  
Bei einem Aufruf mit einem cardHandle zu den Kartentypen SMC-KT und 

UNKNOWN wird Schritt 3 in folgender Variante durchlaufen:  
Ermittle
Zugriffsregel R zu den Aufrufparametern:  
3.1.    ctId wird zum cardHandle
bestimmt  
  Zu den Parametern (  
        ctId, 

        cardHandle = null,  
        needCardSession = false, 

        allWorkplaces = false)  
muss mittels Tabelle „TAB_KON_513
Zugriffsregeln Regelzuordnung“ die  
Zugriffsregel R ermittelt werden.

</td></tr><tr><td>
Fehlerfälle

</td><td>
Fehler im Ablauf (Standardablauf oder Varianten) führen in den folgend 

ausgewiesenen Schritten zu einem Abbruch der Verarbeitung mit den 

ausgewiesenen Fehlercodes:  
(1)       Es sind nicht alle
Pflichtparameter gesetzt,  
               Fehlercode: 4021 

(2)       Clientsystem aus dem Aufrufkontext nicht authentifiziert, 

               Fehlercode: 4204  
(3.1)    Karte nicht als
gesteckt identifiziert,  
               Fehlercode: 4008 

(3.2)    Zu den Parametern konnte keine Regel ermittelt werden, 

               Fehlercode: 4019  
(4.2.1) Bedingung nicht
erfüllt  
               Fehlercode: wie in Spalte
„ErrorCode“ der geprüften Zeile aus  
               Tabelle
„TAB_KON_514-01 Zugriffsregeln Definition“

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
PIC_KON_118 Aktivitätsdiagramm zu „TUC_KON_000 Prüfe Zugriffsberechtigung“

</td></tr></table>

**[\<=]**

Eine Beschreibung aller Zugriffsregeln gibt Tabelle TAB_KON_512.

<table><tr><th>
Regel

</th><th>
Beschreibung

</th></tr><tr><td>
R1

</td><td>
Innerhalb des Mandanten m darf das Clientsystem cs verwendet werden.

</td></tr><tr><td>
R2

</td><td>
Innerhalb des Mandanten m darf das Clientsystem cs auf das Kartenterminal kt
zugreifen.

</td></tr><tr><td>
R3

</td><td>
Innerhalb des Mandanten m darf das Clientsystem cs den Arbeitsplatz ap nutzen.

</td></tr><tr><td>
R4

</td><td>
Innerhalb des Mandanten m darf das Clientsystem cs über den Arbeitsplatz ap auf
das Kartenterminal kt zugreifen.

</td></tr><tr><td>
R5

</td><td>
Innerhalb des Mandanten m darf das Clientsystem cs über den Arbeitsplatz ap auf
die lokal gesteckte eGK zugreifen. Eine Kartensitzung wird nicht benötigt.

</td></tr><tr><td>
R6

</td><td>
Innerhalb des Mandanten m darf das Clientsystem cs über den Arbeitsplatz ap auf
die lokal gesteckte eGK zugreifen. Eine Kartensitzung wird benötigt. Wenn
bereits eine Kartensitzung besteht, ist sichergestellt, dass sie vom
Arbeitsplatz ap gestartet wurde.

</td></tr><tr><td>
R7

</td><td>
Innerhalb des Mandanten m darf das Clientsystem cs über den Arbeitsplatz ap auf
die SM-B zugreifen. Es wird dabei sichergestellt, dass es sich um eine im
Mandanten verwaltete SM-B handelt.

</td></tr><tr><td>
R8

</td><td>
Innerhalb des Mandanten m darf das Clientsystem cs auf den HBAx zugreifen. Eine
Kartensitzung wird nicht benötigt.

</td></tr><tr><td>
R9

</td><td>
Innerhalb des Mandanten m darf das Clientsystem cs auf den HBAx zugreifen. Eine
Kartensitzung wird benötigt. Wenn bereits Kartensitzungen zum HBAx bestehen,
wird der Zugriff auf den HBAx verhindert, wenn es eine Kartensitzung zum selben
Clientsystem, aber einer anderen UserId gibt, deren Sicherheitszustand erhöht
ist.

</td></tr></table>

![Abbildung-6][Abbildung-6]

Welche Zugriffsregel für einen gegebenen Satz an Aufrufparametern anzuwenden
ist, wird in Tabelle TAB_KON_513 ermittelt. Die Pflichtfelder mandantId,
clientSystemId und workplaceId und das optionale Feld userId sind zwar für die
Auswertung der Regeln wichtig, tragen aber nicht zur Auswahl der Regel bei und
sind daher in der Tabelle nicht vorhanden. Zur Auswahl einer Regel ist relevant,

 ---> UL

<table><tr><th>
Parameter

</th><th>
R1

</th><th>
R2

</th><th>
R3

</th><th>
R4

</th><th>
R5

</th><th>
R6

</th><th>
R7

</th><th>
R8

</th><th>
R9

</th></tr><tr><td>
ctId

</td><td>
null

</td><td>
not

null

</td><td>
null

</td><td>
not

null

</td><td>
</td><td>
</td><td>
</td><td>
</td><td>
</td></tr><tr><td>
cardHandle

</td><td>
null

</td><td>
null

</td><td>
null

</td><td>
null

</td><td>
not

null

</td><td>
not

null

</td><td>
not

null

</td><td>
not

null

</td><td>
not

null

</td></tr><tr><td>
Karte(cardHandle).type

</td><td>
</td><td>
</td><td>
</td><td>
</td><td>
eGK

oder

KVK

</td><td>
eGK

oder

KVK

</td><td>
</td><td>
</td><td>
</td></tr><tr><td>
Karte(cardHandle).type

</td><td>
</td><td>
</td><td>
</td><td>
</td><td>
</td><td>
</td><td>
SM-B

</td><td>
</td><td>
</td></tr><tr><td>
Karte(cardHandle).type

</td><td>
</td><td>
</td><td>
</td><td>
</td><td>
</td><td>
</td><td>
</td><td>
HBAx

</td><td>
HBAx

</td></tr><tr><td>
needCardSession

</td><td>
false

</td><td>
false

</td><td>
false

</td><td>
false

</td><td>
false

</td><td>
true

</td><td>
true

oder

false

</td><td>
false

</td><td>
true

</td></tr><tr><td>
allWorkplaces

</td><td>
true

</td><td>
true

</td><td>
false

</td><td>
false

</td><td>
false

</td><td>
false

</td><td>
false

</td><td>
false

</td><td>
false

</td></tr></table>

Tabelle TAB_KON_514 definiert einzelne Bedingungen, ordnet sie den Regeln zu und
definiert ErrorCodes für den Fall, dass eine Bedingung nicht erfüllt ist.

Die Bedingungen in Tabelle TAB_KON_514 sind wie folgt gruppiert:

 ---> UL

Die Fehlercodes mit Beschreibung, ErrorType und Severity Tabelle TAB_KON_515.

<table><tr><th>
</th><th>
Bedingung

(siehe Hinweis 1)

</th><th>
R1

</th><th>
R2

</th><th>
R3

</th><th>
R4

</th><th>
R5

</th><th>
R6

</th><th>
R7

</th><th>
R8

</th><th>
R9

</th><th>
Error Code

</th></tr><tr><td rowspan="6">
Entitä

t

(siehe Hinweis 2)

</td><td>
inv : userId \<\> null

</td><td>
</td><td>
</td><td>
</td><td>
</td><td>
</td><td>
</td><td>
</td><td>
</td><td>
x

</td><td>
4003

</td></tr><tr><td>
let m : Mandant =

Mandant(mandantId)

inv : m \<\> null

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
4021 an der Außenschnittstelle  
4004 im Protokoll  
(siehe Hinweis 3)

</td></tr><tr><td>
let cs : Clientsystem

    = Clientsystem

(

clientSystemId

)

inv : cs \<\> null

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
4021 an der Außenschnittstelle  
4005 im Protokoll  
(siehe Hinweis 3)

</td></tr><tr><td>
let ap : Arbeitsplatz

    = Arbeitsplatz

(workplaceId)

inv : ap \<\> null

</td><td>
 

</td><td>
</td><td>
 x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
4021 an der Außenschnittstelle  
4006 im Protokoll  
(siehe Hinweis 3)

</td></tr><tr><td>
let kt : Kartenterminal

    = Kartenterminal

(ctId)

inv : kt \<\> null

</td><td>
 

</td><td>
 x

</td><td>
</td><td>
x

</td><td>
</td><td>
</td><td>
</td><td>
</td><td>
</td><td>
4007

</td></tr><tr><td>
let k : Karte = Karte

(cardHandle)

inv :  k \<\> null

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
4008

</td></tr><tr><td rowspan="4">
Mandant

bezug

</td><td>
let m : Mandant =

Mandant(mandantId)

let cs : Clientsystem

    = Clientsystem

(

clientSystemId

)

inv : cs.mandant.

includes(m)

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
4010

</td></tr><tr><td>
let m : Mandant =

Mandant(mandantId)

let ap : Arbeitsplatz

    = Arbeitsplatz

(workplaceId)

inv :  ap.mandant.

includes(m)

</td><td>
 

</td><td>
</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
4011

</td></tr><tr><td>
let m : Mandant =

Mandant(mandantId)

let kt : Kartenterminal

  = Kartenterminal(ctId)

inv : kt.mandant.

includes(m)

</td><td>
 

</td><td>
 x

</td><td>
</td><td>
x

</td><td>
</td><td>
</td><td>
</td><td>
</td><td>
</td><td>
4012

</td></tr><tr><td>
let m : Mandant =

Mandant(mandantId)

let k : Karte =

Karte(cardHandle)

inv : k.kT-Slot.

kartenterminal.mandant

       .includes(m)

</td><td>
</td><td>
</td><td>
</td><td>
</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
4012

</td></tr><tr><td rowspan="7">
Relation

</td><td>
let k : Karte =

Karte(cardHandle)

inv : k.SM-B_Verwaltet

\<\> null

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
x

</td><td>
 

</td><td>
 

</td><td>
4009

</td></tr><tr><td>
let m : Mandant =

Mandant(mandantId)

let k : Karte =

Karte(cardHandle)

inv : k.SM-B_Verwaltet

.mandant

      -\> includes(m)

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
x

</td><td>
 

</td><td>
 

</td><td>
4013

</td></tr><tr><td>
let m : Mandant =

Mandant(mandantId)

let cs : Clientsystem

    = Clientsystem

(

clientSystemId

)

let ap : Arbeitsplatz

    = Arbeitsplatz

(workplaceId)

inv : CS_AP.allInstances

-\> exists(c : CS_AP |

          c.mandant = m

          and

c.arbeitsplatz = ap

          and

c.clientsystem = cs)

</td><td>
 

</td><td>
</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
4014

</td></tr><tr><td>
let ap : Arbeitsplatz

    = Arbeitsplatz

(workplaceId)

let kt : Kartenterminal

    = Kartenterminal

(ctId)

inv :

  ap.lokalKartenterminal

.includes(kt) or   

  ap.entferntKarten

terminal

.includes(kt)

</td><td>
 

</td><td>
 

</td><td>
</td><td>
x

</td><td>
 

</td><td>
 

</td><td>
</td><td>
</td><td>
</td><td>
4015

</td></tr><tr><td>
let ap : Arbeitsplatz

    = Arbeitsplatz

(workplaceId)

let kt : Kartenterminal

= Karte(cardHandle).kT-Slot.kartenterminal

inv :

  ap.lokalKartenterminal

.includes(kt) or   

  ap.entferntKarten

terminal

.includes(kt)

</td><td>
</td><td>
</td><td>
</td><td>
</td><td>
</td><td>
</td><td>
x

</td><td>
x

</td><td>
x

</td><td>
4015

</td></tr><tr><td>
let m : Mandant = Mandant

(mandantId)

let kt : Kartenterminal

    = Kartenterminal(ctId)

let cs : Clientsystem = Clientsystem

(

clientSystemId

)

inv : CS_AP.allInstances

-\> exists(c : CS_AP |

c.arbeitsplatz

.lokalKartenterminal

   .includes(kt) or

c.arbeitsplatz

.entferntKartenterminal

   .includes(kt)

and c.mandant = m

and c.arbeitsplatz.mandant

.includes(m)

and c.clientsystem = cs)

</td><td>
</td><td>
x

</td><td>
</td><td>
</td><td>
</td><td>
</td><td>
</td><td>
</td><td>
</td><td>
4020

</td></tr><tr><td>
let ap : Arbeitsplatz

    = Arbeitsplatz

(workplaceId)

let kt : Kartenterminal

= Karte(cardHandle).kT-Slot.kartenterminal

inv : ap.lokalKartenterminal

.includes(kt)

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
x

</td><td>
x

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
4016

</td></tr><tr><td rowspan="2">
Karten

sitzungen

</td><td>
let ap : Arbeitsplatz

    = Arbeitsplatz

(workplaceId)

let k : Karte =

Karte(cardHandle)

inv : k.kartensitzung

      -\> not exists(ks : Kartensitzung |

           ks.arbeitsplatz

\<\> ap)

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
</td><td>
x

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
4017

</td></tr><tr><td>
let k : Karte = Karte

(cardHandle)

let cs : Clientsystem

    = Clientsystem

(

clientSystemId

)

inv : k.kartensitzung  

  -\>  not exists

(ks : Kartensitzung |  

            ks

.clientsystem = cs and

            ks

.userId \<\> userId and

            ks

.authState.size() \> 0

      )

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
 

</td><td>
</td><td>
x

</td><td>
4018

</td></tr></table>

Erläuterungen zu TAB_KON_514-01:

Hinweis 1:Jede Bedingung ist als Constraint mittels OCL definiert, ist einzeln
prüfbar und hat als Eingangsparameter mandantId, clientSystemId, workplaceId,
ctId, cardHandle und userId.

Hinweis 2:Zur Bezeichnung einer Objektinstanz, die im Informationsmodell
vorhanden ist, wird die Notation \<\<Entitätsbezeichner\>\>(\<\<Komma
separierte Liste der Identitätsschlüssel\>\> verwendet.

Hinweis 3:  
Bei manchen Bedingungen gibt es unterschiedliche Fehlermeldungen
für die Außenschnittstelle und für die interne Protokollierung. Dann wird
folgende Notation in Spalte "Error Code" verwendet:

"\<\<Fehlercode\>\> an der Außenschnittstelle" für den Fehlercode, der über
die Außenschnittstelle zurückgegeben werden muss

"\<\<Fehlercode\>\> im Protokoll" für den Fehlercode, der für die interne
Protokollierung verwendet werden muss. 

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4003

</td><td>
Technical

</td><td>
Error

</td><td>
Keine User-ID angegeben, die zur Identifikation der Kartensitzung_HBAx benötigt
wird.

</td></tr><tr><td>
4004

</td><td>
Technical

</td><td>
Error

</td><td>
Ungültige Mandanten-ID

</td></tr><tr><td>
4005

</td><td>
Technical

</td><td>
Error

</td><td>
Ungültige Clientsystem-ID

</td></tr><tr><td>
4006

</td><td>
Technical

</td><td>
Error

</td><td>
Ungültige Arbeitsplatz-ID

</td></tr><tr><td>
4007

</td><td>
Technical

</td><td>
Error

</td><td>
Ungültige Kartenterminal-ID

</td></tr><tr><td>
4008

</td><td>
Technical

</td><td>
Error

</td><td>
Karte nicht als gesteckt identifiziert

</td></tr><tr><td>
4009

</td><td>
Security

</td><td>
Error

</td><td>
SM-B ist dem Konnektor nicht als SM-B_Verwaltet bekannt

</td></tr><tr><td>
4010

</td><td>
Security

</td><td>
Error

</td><td>
Clientsystem ist dem Mandanten nicht zugeordnet

</td></tr><tr><td>
4011

</td><td>
Security

</td><td>
Error

</td><td>
Arbeitsplatz ist dem Mandanten nicht zugeordnet

</td></tr><tr><td>
4012

</td><td>
Security

</td><td>
Error

</td><td>
Kartenterminal ist dem Mandanten nicht zugeordnet

</td></tr><tr><td>
4013

</td><td>
Security

</td><td>
Error

</td><td>
SM-B_Verwaltet ist dem Mandanten nicht zugeordnet

</td></tr><tr><td>
4014

</td><td>
Security

</td><td>
Error

</td><td>
Für den Mandanten ist der Arbeitsplatz nicht dem Clientsystem zugeordnet

</td></tr><tr><td>
4015

</td><td>
Security

</td><td>
Error

</td><td>
Kartenterminal ist weder lokal noch entfernt vom Arbeitsplatz aus zugreifbar

</td></tr><tr><td>
4016

</td><td>
Security

</td><td>
Error

</td><td>
Kartenterminal ist nicht lokal vom Arbeitsplatz aus zugreifbar

</td></tr><tr><td>
4017

</td><td>
Security

</td><td>
Error

</td><td>
Die eGK hat bereits eine Kartensitzung, die einem anderen Arbeitsplatz
zugeordnet ist.

</td></tr><tr><td>
4018

</td><td>
Security

</td><td>
Error

</td><td>
Der HBAx hat mindestens eine Kartensitzung zu einer anderen UserId, deren
Sicherheitszustand erhöht ist.

\<sup\>(\</sup\>

\<sup\>Sicherheitszustand wird bei PIN-Eingabe erhöht.)\</sup\>

</td></tr><tr><td>
4019

</td><td>
Technical

</td><td>
Error

</td><td>
Zu den Parametern konnte keine Regel ermittelt werden.

</td></tr><tr><td>
4020

</td><td>
Security

</td><td>
Error

</td><td>
Kartenterminal ist weder lokal noch entfernt über irgendeinen dem Clientsystem
zugeordneten Arbeitsplatz aus zugreifbar

</td></tr><tr><td>
4021

</td><td>
Technical

</td><td>
Error

</td><td>
Es sind nicht alle Pflichtparameter mandantId, clientSystemId, workplaceId
gefüllt.

</td></tr><tr><td>
4204

</td><td>
Security

</td><td>
Error

</td><td>
Clientsystem aus dem Aufrufkontext konnte nicht authentifiziert werden.

</td></tr></table>

Hinweis zu Fehler 4018: Sicherheitszustand wird bei PIN-Eingabe erhöht.

### 4.1.1.5 Operationen an der Außenschnittstelle

Keine

### 4.1.1.6 Betriebsaspekte

##### TIP1-A_4525

Der Konnektor MUSS mit Abschluss der Bootup-Phase den Ist-Zustand transienter
Entitäten und Beziehungen des Informationsmodells erfasst haben. **[\<=]**

##### TIP1-A_4526

Für die Administration MUSS der Konnektor eine Administrationsoberfläche zur
Pflege des Informationsmodells zur Verfügung stellen. Die Oberfläche muss es
ermöglichen, sämtliche persistente Entitäten undBeziehungen des durch
Abbildung„PIC_Kon_100 Informationsmodell des Konnektors“und Tabelle
„TAB_KON_510Informationsmodell Constraints“ definierten Informationsmodells
initial anzulegen, zu ändern und zu löschen. **[\<=]**

Im Anhang I „Umsetzungshinweise“ werden Empfehlungen zur Umsetzung der
Administration des Informationsmodells gegeben.

### 4.1.2 Dokumentvalidierungsdienst

Der Dokumentvalidierungsdienst ist ein Dienst, der nur intern genutzt wird,
d. h., dass dessen definierte Verhaltensweisen nur in anderen TUCs des
Konnektors nachgenutzt werden. Er bietet Schnittstellen zum Validieren von
Dokumenten an. Dabei werden diejenigen spezifischen Dokumentformate
unterstützt, die an den Außenschnittstellen anderer Dienste wie Signatur- und
Verschlüsselungsdienst auftreten können (Alle_DocFormategemäß Kapitel 3).

Die jeweils gültigen XML-Schemas der Fachmodule werden den Herstellern von der
gematik bereitgestellt.

### 4.1.2.1 Funktionsmerkmalweite Aspekte

##### A_18780

Der Konnektor DARF Dokumente im PDF/A-3 Format NICHT unterstützen. **[\<=]**

### 4.1.2.2 Durch Ereignisse ausgelöste Reaktionen

Keine.

### 4.1.2.3 Interne TUCs, nicht durch Fachmodule nutzbar

Keine

### 4.1.2.4 Interne TUCs, auch durch Fachmodule nutzbar

### 4.1.2.4.1 TUC_KON_080 „Dokument validieren”

##### TIP1-A_4527-04

Der Konnektor MUSS den technischen Use Case TUC_KON_080 „Dokument
validieren” umsetzen.

Tabelle22: TAB_KON_143 – TUC_KON_080 „Dokument validieren“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_080 „Dokument validieren“

</td></tr><tr><td>
Beschreibung

</td><td>
Dieser TUC prüft das Format eines Dokuments und führt
dokumententyp-spezifische Validierungen durch. Unterstützt werden

Alle_DocFormate(

außer „Binär“).

</td></tr><tr><td>
Auslöser

</td><td>
 ---> UL

</td></tr><tr><td>
Vorbedingungen

</td><td>
keine

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

Optional für XML-Dokumente:

 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Nachbedingungen

</td><td>
Keine

</td></tr><tr><td>
Standardablauf

</td><td>
Validierung der Dokumente auf Typkonformität

Der Konnektor führt je nach Format des Dokuments (documentFormat) eine der
folgenden Prüfungen durch:

A) XML-Dokumentvalidierung

Im Fall eines XML-Dokuments prüft der Konnektor:

 ---> UL

B) PDF/A-Dokumentvalidierung

PDF/A-Dokumente werden geprüft, ob sie sich als PDF/A Dokumente in ihren
PDF/A-Metadaten ausweisen. Es werden alle PDF/A-1 und PDF/A-2 konformen
Dokumente unterstützt, einschließlich PDF/A-1A, PDF/A-1B, PDF/A-2A,
PDF/A-2B, PDF/A-2U.  
Beispiele:  
\<pdfaid:part
xmlns:pdfaid="http://www.aiim.org/pdfa/ns/id/"\>1\</pdfaid:part\> 

\<rdf:Description rdf:about="" xmlns:pdfaid="http://www.aiim.org/pdfa/ns/id/"
pdfaid:part="1" pdfaid:conformance="B"/\>  
C) TIFF-Dokumentvalidierung

Der Konnektor prüft, ob das Dokument an Hand seiner ersten 8 Byte als
TIFF-Dokument [TIFF6] zu identifizieren ist.

D) MIME-Dokumentvalidierung

Die Struktur von MIME-Dokumenten wird entsprechend [MIME] validiert.

E) Text-Dokumentvalidierung

Der Konnektor prüft die Konformität zum im Dokumentenformat vorgegebenen
Character-Encoding.

Für Binärdokumente findet keine Validierung statt.

Hinweis: Byte-order-marks (BOM) sind im Rahmen von UTF-8 kodierten Dokumenten
gemäß UTF8 Standard ([RFC3629], Kapitel 6) erlaubt, aber nicht
notwendigerweise im Dokument vorhanden.

Validierung der Dokumentformate

Der Konnektor prüft für das Dokument, ob die Vorgaben zu Dokumenten aus
Kapitel 3.1.1 "Dokumentformate" eingehalten sind.

</td></tr><tr><td>
Varianten/  
Alternativen

</td><td>
keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
Standardablauf:

Bei der Dokumentenvalidierung protokolliert der TUC alle aufgetretenen Fehler im
Rückgabewert documentValidationProtocol.

Validierung der Dokumente auf Typkonformität

(



A) Fehlerfälle bei XML-Dokumentvalidierung

Wenn keine Schemata übergeben wurden (xmlSchemas oder signaturePolicyIdentifier
nicht vorhanden): Fehlercode 4193

Wenn eines der übergebenen Schemata selbst nicht wohlgeformt oder invalide ist,
wird Fehlercode 4026 gemeldet.

Wenn das XML-Dokument nicht wohlgeformt ist, wird Fehlercode 4022 gemeldet.

Das XML-Dokument ist nicht valide in Bezug auf das zur Validierung benutzte
Schema (xmlSchemas bzw. signaturePolicyIdentifier): Fehlercode 4023.

(



B) Fehlerfälle bei PDF/A-Dokumentvalidierung

Bei fehlgeschlagener Validierung: Fehlercode 4024, Dokumentformat = PDF/A

(



C) Fehlerfälle bei TIFF-Dokumentvalidierung

Bei fehlgeschlagener Validierung: Fehlercode 4024, Dokumentformat = TIFF

(



D) Fehlerfälle bei MIME-Dokumentvalidierung

Bei fehlgeschlagener Validierung: Fehlercode 4024, Dokumentformat = MIME

(



E) Fehlerfälle bei Text-Dokumentvalidierung

Bei fehlgeschlagener Validierung: Fehlercode 4024, Dokumentformat = Text 

Validierung der Dokumentformate

Bei Verletzung einer Vorgabe aus Kapitel 3.1.1 bricht der Konnektor die
Verarbeitung mit einem entsprechenden Fehlercode ab.

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
keine

</td></tr></table>

Tabelle23: TAB_KON_144 Fehlercodes TUC_KON_080 „Dokument validieren“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Case

s und Fehlercodes aus Kapitel 3.1.1 

können folgende weitere Fehlercodes auftreten:

</td></tr><tr><td>
4022

</td><td>
Security

</td><td>
Error

</td><td>
XML-Dokument nicht wohlgeformt

</td></tr><tr><td>
4023

</td><td>
Security

</td><td>
Error

</td><td>
XML-Dokument nicht valide in Bezug auf XML-Schema

</td></tr><tr><td>
4024

</td><td>
Security

</td><td>
Error

</td><td>
Formatvalidierung fehlgeschlagen (\<Dokumentformat\>)

Der Parameter Dokumentformat kann die Werte XML, PDF/A, TIFF, MIME und Text
annehmen.

</td></tr><tr><td>
4026

</td><td>
Security

</td><td>
Error

</td><td>
XML-Schema nicht valide

</td></tr><tr><td>
4193

</td><td>
Security

</td><td>
Warning

</td><td>
kein XML-Schema für XML-Dokument vorhanden

</td></tr></table>

**[\<=]**

### 4.1.2.5 Operationen an der Außenschnittstelle

Keine

### 4.1.2.6 Betriebsaspekte

Keine

### 4.1.3 Dienstverzeichnisdienst

Der Dienstverzeichnisdienst liefert dem aufrufenden Clientsystem sowohl
Informationen über die Version und Produktkenndaten des Konnektors, als auch
die SOAP-Endpunkte, über die das Clientsystem die einzelnen Dienstoperationen
erreichen kann.

### 4.1.3.1 Funktionsmerkmalweite Aspekte

Die Endpunkte der Basisdienste werden in WSDL spezifiziert. Diese Endpunkte und
weitere konnektormodellspezifische Informationen werden dem Clientsystem in
Form eines Dienstverzeichnisdienstes gesammelt angeboten.

Der prinzipielle Ablauf sieht dabei folgendermaßen aus:

Das Clientsystem ruft beim Initialisieren des Systems mit HTTP-GET die
vordefinierte URL:     https://\<ANLW_LAN_IP_ADDRESS oder    
MGM_KONN_HOSTNAME\>/connector.sds oderhttp://\<ANLW_LAN_IP_ADDRESS oder
MGM_KONN_HOSTNAME\>/connector.sdsdes Konnektors auf.

Der Konnektor stellt die Liste der Dienste, der Versionen und die Endpunkte der
Dienste in einem XML-Dokument zusammen. Jeder über SOAP erreichbare
Basisdienst des Konnektors wird in dieser Liste geführt. Ferner können
Fachmodule ihre eigenen Endpunkte über TUC_KON_041 „Einbringen der
Endpunktinformationenwährend der Bootup-Phase“ einbringen. Die so erstellte
Liste der Dienste wird als Antwort an das Clientsystem übergeben.

Das Clientsystem prüft, ob die gewünschten Dienste und Versionen unterstützt
werden und merkt sich die Endpunkte der Dienste für die späteren Aufrufe.
Danach kann das Clientsystem diese Dienstendpunkte nach Bedarf aufrufen.

##### TIP1-A_4528

Der Konnektor MUSS den Dienstverzeichnisdienst anbieten. Dieser Dienst
veröffentlicht
auf:    https://$ANLW_LAN_IP_ADDRESS oder $MGM_KONN_HOSTNAME\>/connector.sds
oder    
http://$ANLW_LAN_IP_ADDRESS oder $MGM_KONN_HOSTNAME\>/connector.sds.

Die Datei MUSS über https erreichbar sein.

Wenn (ANCL_DVD_OPEN = Enabled) oder (ANCL_TLS_MANDATORY = Disabled) MUSS die
Datei auch über http erreichbar sein. **[\<=]**

##### TIP1-A_4529-02

Das XML-Dokument, welches als „connector.sds“ dem Aufrufer zurückgeliefert
wird, MUSS gemäß dem Schema „conn/ServiceDirectory.xsd“ formatiert
sein.conn/ServiceDirectory.xsdreferenziert die Schemata
„tel/version/ProductInformation.xsd“ (siehe [gemSpec_OM]) und
„conn/ServiceInformation.xsd“.TAB_KON_516, TAB_KON_517 und TAB_KON_518
beschreiben die Elemente der zu verwendenden Schemastruktur.

Tabelle24: TAB_KON_516 Basisanwendung Dienstverzeichnisdienst

<table><tr><th>
Name

</th><th>
ConnectorServiceDirectory

</th></tr><tr><td>
Version

</td><td>
3.1.0 (XSD-Version)

</td></tr><tr><td>
Namensraum

</td><td>
Siehe GitHub

</td></tr><tr><td>
Namensraum-Kürzel

</td><td>
CONN

</td></tr><tr><td>
Operationen

</td><td>
Lesen der vom Konnektor unterstützten Dienste

</td></tr><tr><td>
WSDL

</td><td>
Keine

</td></tr><tr><td>
Schema

</td><td>
ServiceDirectory.xsd

</td></tr></table>

Tabelle25: TAB_KON_517 Schemabeschreibung Produktinformation
(ProductInformation.xsd)

![Img-007][Img-007]

<table><tr><th colspan="2">
</th></tr><tr><td>
Element

</td><td>
Bedeutung

</td></tr><tr><td>
ProductInformation/InformationDate

</td><td>
Datum der Informationsabfrage über das Produkt

</td></tr><tr><td>
ProductInformation/ProductTypeInformation/

ProductType

</td><td>
Produkttyp (Konnektor)

</td></tr><tr><td>
ProductInformation/ProductTypeInformation/

ProductTypeVersion

</td><td>
Produkttypversion des Konnektormodells

</td></tr><tr><td>
ProductInformation/ProductIdentification/

ProductVendorID

</td><td>
ID des Konnektorherstellers

</td></tr><tr><td>
ProductInformation/ProductIdentification/

ProductCode

</td><td>
Produktkürzel

</td></tr><tr><td>
ProductInformation/ProductIdentification/

ProductVersion/Local/HWVersion

</td><td>
Hardwareversion des Konnektormodells

</td></tr><tr><td>
ProductInformation/ProductIdentification/

ProductVersion/Local/FWVersion

</td><td>
Firmwareversion des Konnektormodells

</td></tr><tr><td>
ProductInformation/ProductMiscellaneous/

ProductVendorName

</td><td>
Name des Konnektorherstellers

</td></tr><tr><td>
ProductInformation/ProductMiscellaneous/

ProductName

</td><td>
Produktname

</td></tr></table>

Tabelle26: TAB_KON_518 Schemabeschreibung Serviceinformation
(Serviceinformation.xsd)

<table><tr><th colspan="2">
![Img-008][Img-008]

</th></tr><tr><td>
Element

</td><td>
Bedeutung

</td></tr><tr><td>
ServiceInformation/Service

</td><td>
Element beschreibt einen Dienst oder ein Fachmodul

</td></tr><tr><td>
ServiceInformation/Service/@Name

</td><td>
Name des Dienstes. Dieser Wert korrespondiert mit dem Feld „Name“ aus der
jeweiligen Basisanwendung/Dienstbeschreibung (englischer Dienstname in Tabelle

 TAB_KON_798

).

</td></tr><tr><td>
ServiceInformation/Service/Abstract

</td><td>
eine kurze textuelle Beschreibung des Dienstes/Fachmoduls

</td></tr><tr><td>
ServiceInformation/Service/Versions

</td><td>
die Liste der unterstützten Versionen

</td></tr><tr><td>
ServiceInformation/Service/Versions/Version

</td><td>
Beschreibung der Dienstversion/Fachmodulversion

</td></tr><tr><td>
ServiceInformation/ Service/Versions/Version/@TargetNamespace

</td><td>
der Namensraum der Dienst-/Fachmodulversion

</td></tr><tr><td>
ServiceInformation/Service/Versions/Version/@Version

</td><td>
Vollständige Versionsnummer (Konnektordienstversion) des Dienstes/Fachmoduls.
Dieser Wert entspricht dem Wert „WSDL-Version“ des jeweiligen Dienstes
in Tabelle

TAB_KON_798

.

</td></tr><tr><td>
ServiceInformation/Service/Versions/Version/Abstract

</td><td>
Eine kurze textuelle Beschreibung dieser Version des Dienstes/Fachmoduls

</td></tr><tr><td>
ServiceInformation/ Service/Versions/Version/EndpointTLS/@Location

</td><td>
Absoluter URL des über TLS erreichbaren Dienstes.

</td></tr><tr><td>
ServiceInformation/ Service/Versions/Version/Endpoint/@Location

</td><td>
Absoluter URL des erreichbaren Dienstes (ohne TLS).

</td></tr><tr><td>
ServiceInformation/ Service/Versions/Version/WSDL/@Location

</td><td>
(optional) Absoluter URL der WSDL-Beschreibung

</td></tr></table>

**[\<=]**

##### TIP1-A_4530

Die URLs der Dienste KÖNNEN herstellerspezifisch aufgebaut werden. **[\<=]**

### 4.1.3.2 Durch Ereignisse ausgelöste Reaktionen

Keine.

### 4.1.3.3 Interne TUCs, nicht durch Fachmodule nutzbar

Keine

### 4.1.3.4 Interne TUCs, auch durch Fachmodule nutzbar

Da der Konnektor als Black-Box mit inkludierten Fachmodulen ohne erkennbare
Innenschnittstellen spezifiziert wird, stellt der folgende TUC lediglich einen
Mechanismus zur editoriellen Kopplung der Fachmodulspezifikationen mit der
Konnektorspezifikation dar:

### 4.1.3.4.1 TUC_KON_041 „Einbringen der Endpunktinformationen während der Bootup-Phase“

##### TIP1-A_4531

Der Dienstverzeichnisdienst des Konnektors MUSS es den Fachmodulen ermöglichen,
die zum jeweiligen Fachmodul gehörenden Endpunkte während der Bootup-Phase
des Konnektors in den Dienstverzeichnisdienst einzubringen.

Tabelle27: TAB_KON_519 - TUC_KON_041 „Einbringen der Endpunktinformationen
während der Bootup-Phase“

<table><tr><th>
Element

</th><th>
Beschreibung

</th></tr><tr><td>
Name

</td><td>
TUC_KON_041 „Einbringen der Endpunktinformationen

während der Bootup-Phase“

</td></tr><tr><td>
Beschreibung

</td><td>
Fachmodule MÜSSEN ihre Endpunktinformationen während der Bootup-Phase in den
Dienstverzeichnisdienst einbringen können.

</td></tr><tr><td>
Auslöser und Vorbedingungen

</td><td>
Keine

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor, Fachmodule

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
Die übergebenen Serviceinformationen des Fachmoduls werden in die
Gesamtstruktur „connector.sds“ aufgenommen.

Falls beim Speichern der eingebrachten Endpunktinformationen ein Fehler
auftritt, wird Fehler 4027 ausgelöst.

</td></tr><tr><td>
Varianten/Alternativen

</td><td>
Keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
4027: Die Endpunktinformationen konnten nicht übernommen werden.

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
Keine

</td></tr></table>

Tabelle28: TAB_KON_520 Fehlercodes TUC_KON_041 „Einbringen der
Endpunktinformationen während der Bootup-Phase“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td>
4027

</td><td>
Technical

</td><td>
Error

</td><td>
Die Endpunktinformationen konnten nicht übernommen werden.

</td></tr></table>

**[\<=]**

### 4.1.3.5 Operationen an der Außenschnittstelle

##### TIP1-A_4532

Der Dienstverzeichnisdienst des Konnektors MUSS die in Tabelle TAB_KON_521
Schnittstelle der Basisanwendung Dienstverzeichnisdienst beschriebene
Schnittstelle anbieten.

Tabelle29: TAB_KON_521 Schnittstelle der Basisanwendung Dienstverzeichnisdienst

<table><tr><th>
Dienstname

</th><th colspan="2">
ConnectorServiceDirectory

</th></tr><tr><td>
Beschreibung

</td><td colspan="2">
Der Aufruf liefert Angaben über den Hersteller, über das Konnektormodell und
die Liste der Dienste, Konnektordienstversionen (KDV) und Endpunkte der Dienste.

</td></tr><tr><td>
Aufruf

</td><td colspan="2">
GET /connector.sds HTTP/1.1Host: ANLW_LAN_IP_ADDRESS oder MGM_KONN_HOSTNAME

</td></tr><tr><td rowspan="9">
Rückgabe

</td><td colspan="2">
Das Antwortdokument ist in der SchemadateiServiceDirectory.xsdbeschrieben.

</td></tr><tr><td colspan="2">
ConnectorServices

</td></tr><tr><td colspan="2">


</td></tr><tr><td>
Name

</td><td>
Beschreibung

</td></tr><tr><td>
ProductInformation

</td><td>
Kurzbeschreibung des Konnektormodells

</td></tr><tr><td>
ServiceInformation

</td><td>
Beschreibung der Dienste

</td></tr><tr><td colspan="2">
ProductInformation:Das Schema wird inTAB_KON_517 beschrieben. Die Felder sind
gemäß [gemSpec_OM] zu befüllen und gemäß dem
Schema„ProductInformation.xsd“zu formatieren.

</td></tr><tr><td colspan="2">
TLS-Mandatory: Boolean Wert der festlegt, ob die Verwendung eines TLS-Kanals
für Dienstaufrufe verpflichtend ist.Definierende Variable ist:
ANCL_TLS_MANDATORYClientAutMandatory: Boolean Wert der festlegt, ob Client
Authentifizierung verpflichtend ist.Definierende Variable ist:
ANCL_CAUT_MANDATORY.

</td></tr><tr><td colspan="2">
ServiceInformation:Das Schema wird inTAB_KON_518 beschrieben. Die Felder sind
gemäß dem SchemaServiceInformation.xsdzu formatieren.Falls
(ANCL_CAUT_MANDATORY = Enabled) oder (ANCL_TLS_MANDATORY = Enabled), MUSS die
Rückgabedatei ausschließlich https-Endpunkte enthalten.

</td></tr><tr><td>
Fehlercodes

</td><td colspan="2">
Die Standard HTTP1.1 Fehlercodes [RFC2616]

</td></tr><tr><td>
Vorbedingungen

</td><td colspan="2">
Keine

</td></tr><tr><td>
Nachbedingungen

</td><td colspan="2">
Keine

</td></tr><tr><td>
Hinweise

</td><td colspan="2">
Keine

</td></tr></table>

​​ **[\<=]**

### 4.1.3.6 Betriebsaspekte

##### TIP1-A_4533

Mit Abschluss der Bootup-Phase MUSS der Dienstverzeichnisdienst an der
Außenschnittstelle die vollständige Liste aller Services bereitstellen, die
der Anwendungskonnektor den Clientsystemen anbietet, inklusive der Services der
Fachmodule. **[\<=]**

### 4.1.4 Kartenterminaldienst

Die Aufgabe des Kartenterminaldienstes ist das Management aller vom Konnektor
adressierbaren Kartenterminals. Dies umfasst alle administrativen Prozesse
(insbesondere das Pairing, vgl. [gemSpec_KT#2.5.2]). Ferner kapselt der
Kartenterminaldienst die Zugriffe auf Kartenterminals durch Basisdienste und
Fachmodule.

Für die TLS-Verbindungen zu den Kartenterminals muss der Konnektor die Vorgaben
aus [gemSpec_Krypt#3.3.2] und hinsichtlich ECC-Migration die Vorgaben aus
[gemSpec_Krypt#5] befolgen.

Innerhalb des Kartenterminaldienstes werden folgende Präfixe für Bezeichner
verwendet:

 ---> UL

Der Kartenterminaldienst verwaltet hinsichtlich der Kartenterminals mindestens
die in der informativen Tabelle TAB_KON_522 Parameterübersicht des
Kartenterminaldienstes ausgewiesenen Parameter, weitere herstellerspezifische
Parameter sind möglich. Die normative Festlegung wann welche Parameter mit
welchen Werten belegt werden, erfolgt in den folgenden Abschnitten und
Unterkapiteln.

Dabei beschrieben CTM_xyz-Bezeichner Parameter, die den Dienst als Ganzes
betreffen. Zu jedem Kartenterminal selbst werden dessen Parameter in einem
CT-Object gekapselt. Die folgende Tabelle zeigt die Attribute der jeweiligen
CT-Objekte über Punktschreibweise.

<table><tr><th>
ReferenzID

</th><th>
Belegung

</th><th>
Zustandswerte

</th></tr><tr><td>
CTM_CT_LIST

</td><td>
Liste von

CT-Objekten

</td><td>
Eine Liste von Repräsentanzen (CT-Objects) der dem Konnektor bekannten
Kartenterminals.

</td></tr><tr><td>
Pro CTM_CT_LIST

Eintrag:

</td><td>
</td><td>
</td></tr><tr><td>
Gerätekenndaten

</td><td>
</td><td>
</td></tr><tr><td>
CT.CTID

</td><td>
Identifier

</td><td>
Eindeutige, statische Identifikation des Kartenterminals

</td></tr><tr><td>
CT.IS_PHYSICAL

</td><td>
Ja/Nein

</td><td>
Kennzeichnung, ob es sich um ein physisches oder logisches Kartenterminal
handelt, zur Unterscheidung von eHealth-Kartenterminals und HSM-Bs.

Da dieser Unterschied gemäß der aktuellen HSM-B-Lösung für den Konnektor
transparent ist, wird der Parameter in dieser Spezifikation immer auf „Ja“
gesetzt.

Der Parameterwert „Nein“ ist für zukünftige Nutzung vorgesehen.

</td></tr><tr><td>
CT.MAC_ADRESS

</td><td>
MAC-Adresse

</td><td>
Die MAC-Adresse des Kartenterminals

</td></tr><tr><td>
CT.HOSTNAME

</td><td>
String

</td><td>
SICCT-Terminalname des Kartenterminals, auch als FriendlyName bezeichnet

</td></tr><tr><td>
CT.IP_ADRESS

</td><td>
IP-Adresse

</td><td>
Die IP-Adresse des Kartenterminals

</td></tr><tr><td>
CT.TCP_PORT

</td><td>
Portnummer

</td><td>
Der TCP-Port des SICCT-Kommandointerpreters des Kartenterminals

</td></tr><tr><td>
CT.SLOTCOUNT

</td><td>
Nummer

</td><td>
Anzahl der Slots des Kartenterminals

</td></tr><tr><td>
CT.SLOTS_USED

</td><td>
Liste

</td><td>
Liste der aktuell mit Karten belegten Slots

</td></tr><tr><td>
CT.PRODUCT

INFORMATION

</td><td>
Inhalt

ProductIn

formation.xsd

</td><td>
Die Herstellerinformationen zum Kartenterminal gemäß [gemSpec_OM]

</td></tr><tr><td>
CT.EHEALTH_

INTERFACE_VERSION

</td><td>
Version

</td><td>
Die EHEALTH-Interface-Version des Kartenterminals, die mittels GET STATUS aus
dem Element VER des Discretionary Data Objects ermittelt wurde.

</td></tr><tr><td>
CT.VALID_VERSION

</td><td>
Boolean

</td><td>
True, wenn die Version des Kartenterminals (CT.EHEALTH_INTERFACE_VERSION) durch
den Konnektor unterstützt wird, d.h. zu den in CTM_SUPPORTED_KT_VERSIONS passt

Default-Wert = false

</td></tr><tr><td>
CT.DISPLAY_CAPABILITIES

</td><td>
Datenstruktur

</td><td>
Displayeigenschaften wie in der Struktur Display Capabilities Data Object in
[SICCT#5.5.10.17] beschrieben

</td></tr><tr><td>
Pairingdaten

</td><td>
</td><td>
</td></tr><tr><td>
CT.SMKT_AUT

</td><td>
X.509-Cert

</td><td>
C.SMKT.AUT-Zertifikat des Kartenterminals, gespeichert im Rahmen des Pairings

</td></tr><tr><td>
CT.SHARED_SECRET

</td><td>
</td><td>
ShS.KT.AUT, gespeichert im Rahmen des Pairings

</td></tr><tr><td>
Verbindungsdaten

</td><td>
</td><td>
</td></tr><tr><td>
CT.CORRELATION

</td><td>
bekannt

zugewiesen

gepairt

aktiv

aktualisierend

</td><td>
Der Korrelationsstatus zum Konnektor:

 ---> UL

</td></tr><tr><td>
CT.CONNECTED

</td><td>
Ja/Nein

</td><td>
Der Verfügbarkeitsstatus des Kartenterminals (Ja = nach Aufbau der
TLS-Verbindung und erfolgter zweiter Authentifizierung)

</td></tr><tr><td>
CT.ACTIVEROLE

</td><td>
User/Admin

</td><td>
Benutzerrolle, die für die aktuelle Session verwendet wird

</td></tr><tr><td>
KT-Admin-Credentials

</td><td>
</td><td>
</td></tr><tr><td>
CT.ADMIN_USERNAME

</td><td>
String

</td><td>
Username des Administrators am KT

</td></tr><tr><td>
CT.ADMIN_PASSWORD

</td><td>
String

</td><td>
Password des Administrators am KT

</td></tr></table>

Zum besseren Verständnis sind die Zustände, die ein Kartenterminal einnehmen
kann, im nachfolgenden Zustandsdiagramm PIC_KON_071 dargestellt.

![Abbildung-7][Abbildung-7]

### 4.1.4.1 Funktionsmerkmalweite Aspekte

##### TIP1-A_4534

Der Kartenterminaldienst MUSS Kartenterminals nach der
eHealth-KartenterminalSpezifikation [gemSpec_KT] unterstützen. **[\<=]**

Zur Unterstützung von HSM-Bs benötigt der Konnektor virtuelle Kartenterminals
(CT.IS_PHYSICAL=Nein), in denen virtuelle SMC-Bs „stecken“ können (siehe
Kapitel 4.1.4). Diese Kartenterminals werden innerhalb des
Zugriffsberechtigungsdienstes sowie des Systeminformationsdienstes wie normale
Kartenterminals berücksichtigt. Weitere Details zu den logischen
Kartenterminals finden sich im Kapitel Betriebsaspekte.

##### TIP1-A_4535

DerKartenterminaldienst MUSS logische Kartenterminals mit logischen Slots
unterstützen. Zu jedem verwalteten HSM (siehe Kartendienst) MUSS der Konnektor
ein oder mehrere logische Kartenterminal mit folgenden Bedingungen vorhalten:

 ---> UL

**[\<=]**

##### TIP1-A_4536

Der Kartenterminaldienst MUSS jede mit einem Kartenterminal etablierte
Verbindung durch Nutzung des in [SICCT#6.1.4.5] definierten Keep-Alive
Mechanismus halten.Der Konnektor MUSS für das Heartbeat-Interval gemäß
[SICCT#6.1.4.5] den Wert CTM_KEEP_ALIVE_INTERVAL verwenden und beim Ausbleiben
von Terminal-Antworten eines Kartenterminals nach der Anzahl
von  CTM_KEEP_ALIVE_TRY_COUNT Versuchen die Netzwerkverbindung zu diesem
Kartenterminal beenden. **[\<=]**

##### TIP1-A_6725

Der Konnektor MUSS steuern, dass Textanzeigen am Kartenterminal nur so lange
angezeigt werden, wie sie im jeweiligen Anwendungskontext benötigt werden. **[\<=]**

Ziel der Textanzeigen am Kartenterminal ist die Kommunikation mit dem Benutzer
zur Unterstützung der Anwendungsfälle. Die Anzeige am Kartenterminal muss
daher einen engen zeitlichen Bezug zum jeweiligen Anwendungskontext haben.

Nachrichten, deren Anwendungskontext mit einem Event beendet werden, wie etwa
die Aufforderung zum Stecken der Karte im Kontext von TUC_KON_056, deren
inhaltliche Berechtigung mit dem Stecken der Karte erlischt, (ebenso zum Ziehen
der Karte im Rahmen von TUC_KON_057) müssen sofort gelöscht werden, wenn das
Event eintritt.  

Nachrichten, deren Lebensdauer nicht durch ein natürliches Event beendet wird,
müssen eine vordefinierte Lebensdauer erhalten, die per Konfiguration an die
Bedürfnisse der Leistungserbringer anpassbar sein sollte. Das gilt für
Ergebnisanzeigen oder Anzeigen von Fehlern.

##### TIP1-A_4537

Tritt ein Timeout ein oder wird eine Netzwerkverbindung zu einem
Kartenterminal(oder zu einem HSM, welches einem logischen Kartenterminal
zugeordnet ist) beendet oder zurückgesetzt und ist CT.CONNECTED = Ja, so MUSS
der Konnektor:

 ---> UL

**[\<=]**

##### TIP1-A_4538

Sind in CTM_CT_LIST Kartenterminals mit CT.CONNECTED=Nein und CT.VALID_VERSION =
True und CT.CORRELATION = „aktiv“ und istCTM_SERVICE_DISCOVERY_CYCLE\>0,
MUSS der Konnektor im ZeitabstandCTM_SERVICE_DISCOVERY_CYCLE-Minutenentweder
eine Service Discovery-Nachricht an alle KTs als Broadcast oderan jedes
einzelne dieser unverbundenen KTs als Unicast senden. **[\<=]**

##### TIP1-A_4538-02

Sind in CTM_CT_LIST Kartenterminals mit CT.CONNECTED=Nein und CT.VALID_VERSION =
True und CT.CORRELATION = „aktiv“ und istCTM_SERVICE_DISCOVERY_CYCLE\>0,
MUSS der Konnektor im ZeitabstandCTM_SERVICE_DISCOVERY_CYCLE-Minuten an jedes
einzelne dieser unverbundenen KTs eine Service-Discovery-Nachricht als Unicast
senden. **[\<=]**

##### TIP1-A_6478

Der Kartenterminaldienst DARF SICCT-bzw. EHEALTH-Kommandos NICHT an ein
Kartenterminal senden, wenn für dieses Kartenterminal CT.CONNECTED=Nein
gesetzt ist. Ausgenommen hiervon sind die in TAB_KON_785 gelisteten EHEALTH-
bzw. SICCT-Kommandos. **[\<=]**

<table><tr><th>
SICCT-Kommando

</th></tr><tr><td>
SICCT CT INIT CT SESSION

</td></tr><tr><td>
SICCT CT CLOSE SESSION

</td></tr><tr><td>
SICCT GET STATUS

</td></tr><tr><td>
SICCT SET STATUS

</td></tr><tr><td>
SICCT CT DOWNLOAD INIT

</td></tr><tr><td>
SICCT CT DOWNLOAD DATA

</td></tr><tr><td>
SICCT CT DOWNLOAD FINISH

</td></tr><tr><td>
EHEALTH TERMINAL AUTHENTICATE

</td></tr></table>

##### TIP1-A_4539

Das Ziehen einer Karte während einer Kartenaktion DARF NICHT dazu führen, dass
das verwaltete Kartenterminal im Anschluss durch den Konnektor nicht weiter
genutzt werden kann.Die entsprechende Ressource MUSS nach Erkennung der
Fehlersituation freigegeben werden. Ein manuelles Eingreifen DARF NICHT
erforderlich sein. **[\<=]**

##### TIP1-A_5408

Der Konnektor MUSS beim Anfordern und Auswerfen von Karten die folgenden
Display-Nachrichten für die Anzeige im Kartenterminal verwenden, wenn der
Aufrufer keine konkrete Display-Nachricht übergeben hat. Der Verweis auf den
Kartenterminal-Slot SOLL in der Display-Nachricht entfallen, wenn es keine
Slot-Auswahl am Kartenterminal gibt.

Tabelle32: TAB_KON_727 Terminalanzeigen beim Anfordern und Auswerfen von Karten

<table><tr><th>
Kontext

</th><th>
Kartentyp

</th><th>
Terminal-Anzeige

</th></tr><tr><td rowspan="4">
Karte anfordern

</td><td>
EGK

</td><td>
Bitte•0x0BeGK•0x0Bin  
•0x0BSLOT X•0x0Bstecken

</td></tr><tr><td>
HBA,  
HBAx,  
HBA-qSig

</td><td>
Bitte•0x0BHBA•0x0Bin  
•0x0BSLOT X•0x0Bstecken

</td></tr><tr><td>
SMC-B

</td><td>
Bitte•0x0BSMC-B•0x0Bin  
•0x0BSLOT X•0x0Bstecken

</td></tr><tr><td>
sonstiger  
Kartentyp  
oder kein explizit angegebener Kartentyp

</td><td>
Bitte•0x0BKarte•0x0Bin  
•0x0BSLOT X•0x0Bstecken

</td></tr><tr><td rowspan="4">
Karte auswerfen

</td><td>
EGK

</td><td>
Bitte•0x0BeGK•0x0Baus  
•0x0BSLOT X•0x0Bentnehmen

</td></tr><tr><td>
HBA,  
HBAx,  
HBA-qSig

</td><td>
Bitte•0x0BHBA•0x0Baus  
•0x0BSLOT X•0x0Bentnehmen

</td></tr><tr><td>
SMC-B

</td><td>
Bitte•0x0BSMC-B•0x0Baus  
•0x0BSLOT X•0x0Bentnehmen

</td></tr><tr><td>
sonstiger  
Kartentyp  
oder kein explizit angegebener Kartentyp

</td><td>
Bitte•0x0BKarte•0x0Bentnehmen

</td></tr></table>

**[\<=]**

### 4.1.4.2 Durch Ereignisse ausgelöste Reaktionen

##### TIP1-A_4540

Der Konnektor MUSS Service Announcement für das Auffinden von Kartenterminals
entsprechend [SICCT] und [gemSpec_KT] unterstützen. Der Konnektor MUSS
Dienstbeschreibungspakete auf UDP
PortCTM_SERVICE_ANNOUNCEMENT_PORTentgegennehmen.

Erhält er ein solchesDienstbeschreibungspaket, MUSS er

 ---> UL

**[\<=]**

##### TIP1-A_4541

Der Kartenterminaldienst MUSS auf SICCT-Ereignisnachrichten „Slot-Ereignis –
Karte eingesteckt“ ([SICCT#6.1.4.4], TAG ‚84’) wie folgt reagieren:

 ---> UL

**[\<=]**

##### TIP1-A_4542

Der Kartenterminaldienst MUSSauf SICCT-Ereignisnachrichten „Slot-Ereignis –
Karte entfernt“ ([SICCT#6.1.4.4], TAG ‚85’) wie folgt reagieren:

 ---> UL

**[\<=]**

##### TIP1-A_4543

Tritt der Event"KSR/UPDATE/START"mit „Target=KT“ ein, MUSS der Konnektor:

 ---> UL

**[\<=]**

##### TIP1-A_4544

Tritt der Event "KSR/UPDATE/END"mit „Target=KT“ ein, MUSS der Konnektor:

 ---> UL

**[\<=]**

### 4.1.4.3 Interne TUCs, nicht durch Fachmodule nutzbar

### 4.1.4.3.1 TUC_KON_050 „Beginne Kartenterminalsitzung“

##### TIP1-A_4545-03

Der Konnektor MUSS den technischen Use Case „Beginne Kartenterminalsitzung”
gemäß TUC_KON_050 umsetzen.

Tabelle33: TAB_KON_039 – TUC_KON_050 „Beginne Kartenterminalsitzung“

<table><tr><th>
Element

</th><th>
Beschreibung

</th></tr><tr><td>
Name

</td><td>
TUC_KON_050 „Beginne Kartenterminalsitzung“

</td></tr><tr><td>
Beschreibung

</td><td>
TUC_KON_050 baut eine TLS-Verbindung vom Konnektor zum Kartenterminal auf und
beginnt eine SICCT-Sitzung. Anschließend erfolgt die 2. Authentifizierung des
Kartenterminals (Prüfung SharedSecret).

</td></tr><tr><td>
Auslöser

</td><td>
 ---> UL

</td></tr><tr><td>
Vorbedingungen

</td><td>
ctId ist in CTM_CT_LIST vorhanden

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor, Kartenterminal

</td></tr><tr><td>
Ausgangsdaten

</td><td>
keine

</td></tr><tr><td>
Nachbedingungen

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
Setze CT = CTM_CT_LIST(ctId)

1.       Wenn CT.IS_PHYSICAL = Nein:

       prüfen, ob role = „User“

                      Wenn CT.CONNECTED =

                                   Ja: TUC endet
erfolgreich

                                   Nein:

                                      - Verbindung zu HSM in
Slot 1 aufbauen

                                      - weiter mit Schritt 9

2.       Wenn CT.CONNECTED = Ja

      prüfen, ob CT.ACTIVEROLE = role

                      Ja: TUC endet erfolgreich

                      Nein:

                         - Schließen der Cardterminal Session mit
dem

                             Kartenterminalkommando
SICCT CLOSE CT

                             SESSION,

                        - weiter ab Schritt 6 (halten der
TLS-Verbindung und

                             nur Wechsel der Session)

3.       Aufbau einer TLS-Verbindung mit dem Kartenterminal unter

    Verwendung von ID.SAK.AUT. Dabei Prüfung des KT-Zertifikats

   mittels

    TUC_KON_037 {

          certificate= C.SMKT.AUT;

          qualifiedCheck=not_required;

          offlineAllowNoCheck=true;

          policyList= oid_smkt_aut;

          intendedKeyUsage= intendedKeyUsage(C.SMKT.AUT);

          intendedExtendedKeyUsage=id-kp-serverAuth;

          validationMode=NONE }

4.       Wenn CT.CORRELATION \<=„zugewiesen“:

     a.              Öffne eine Cardterminal Session mit dem

             Kartenterminalkommando SICCT INIT CT SESSION (siehe

            [SICCT#5.10]) mit leerem Username, Password und Session

            ID

     b.              Nur Verbindung in niedriger Korrelation,
daher setze

             CT.CONNECTED = Nein, um fachliche Nutzung des KT zu

             verhindert

     c.              beende TUC erfolgreich

5.       Prüfe, ob das Zertifikat aus der TLS-Verbindung mit den zum

    Kartenterminal gespeicherten Referenzdaten (CT.SMKT_AUT)

   übereinstimmt.  
     a.  Läuft das Zertifikat CT.SMKT_AUT (oder
C.SMKT.AUT, sie müssen hier identisch sein) in weniger als 35 Tagen ab, so
geht der Konnektor in den Betriebszustand

EC_CardTerminal_gSMC-KT_Certificate_Expires_Soon (ctId) über.

6.       Parallelisierung

     a.              Generierung eines zufälligen Werts
(Challenge) mit

             mindestens 16 Byte Länge gemäß [gemSpec_Krypt#2.2]

            (siehe [gemSpec_KT#DO_KT_0004]),

     b.              Öffnen einer Cardterminal Session mit dem

            Kartenterminalkommando SICCT INIT CT SESSION (siehe

            [SICCT#5.10]) mit

                      -               ctId als Adressat

                      -               Wenn role = User

                               dann mit leerem Username,
Password und

                              Session ID

                        Wenn role = „Admin

                               dann mit leerer Session ID aber
mit

                              CT.ADMIN_USERNAME und

                               CT.ADMIN_PASSWORD

7.       Senden der Challenge mittels Kartenterminalkommando

    EHEALTH TERMINAL AUTHENTICATE (siehe

   [gemSpec_KT#3.7.2]) in der Ausprägung VALIDATE mit:

      -               Kartenterminal als Empfänger

      -               und mit der in Schritt 6a generierten
Challenge im

            Shared Secret Challenge DO

8.       Prüfe Antwort des Kartenterminals, ob sie einen korrekten

    Hashwert über Challenge und angehängtes

  

CT.SHARED_SECRET

gemäß [gemSpec_KT#SEQ_KT_0002]

    Schritt 4-5 enthält

9.       Setze:

      a.             CT.ACTIVEROLE = $role

      b.             CT.CONNECTED = Ja

10 .     Wenn TLS-Verbindung neu aufgebaut werden musste, rufe

     TUC_KON_256 {

           topic = „CT/CONNECTED“;

           eventType = „Op“;

           severity = Info;

           parameters = („CtID=$CT.CTID,

                 Hostname=$CT.HOSTNAME“) }

11.      Ermittle alle im KT gesteckten Karten und befülle entsprechend

       CT.SLOTS_USED

Für jeden in CT.SLOTS_USED gelisteten Slot X zur weiteren internen

Bearbeitung TUC_KON_256{

     topic = „CT/SLOT_IN_USE“;

     eventType = Op;

     severity = Info;

     parameters = („CtID=$CT.CTID, SlotNo=$CT.SLOTS_USED[X]“);

     doLog = false;

     doDisp = false }

rufen.

</td></tr><tr><td>
Varianten/

Alternativen

</td><td>
Keine.

</td></tr><tr><td>
Fehlerfälle

</td><td>
Fehler in den folgenden Schritten des Ablaufs führen zu:

Aufruf von TUC_KON_256 {

      topic = "CT/TLS_ESTABLISHMENT_FAILURE";

      eventType = $ErrorType;

      severity = $Severity;

      parameters = („CtID=$CT.ID, Name=$CT.HOSTNAME,

                            Error=$Fehlercode,
Bedeutung=$Fehlertext“) }

Abbruch der Verarbeitung mit den ausgewiesenen Fehlercodes

(



1): Admin-Rolle für logische KTs nicht möglich (hätte bei korrekter

Implementierung nicht stattfinden dürfen), Fehlercode: 4032

(



1): Verbindungsaufbau zu HSM fehlgeschlagen, Fehlercode: 4032

(



3): Fehler im TLS-Verbindungsaufbau bzw. Zertifikatsprüfung,

Fehlercode: 4028

und setze CT.CONNECTED auf „Nein“

(



3): TLS-Verbindung konnte nicht innerhalb von

CTM_TLS_HS_TIMEOUT Sekunden aufgebaut werden , Fehlercode:

4028 und setze CT.CONNECTED auf „Nein“

(



5): Präsentiertes Zertifikat nicht das aus dem Pairing, Fehlercode:

4029

und setze CT.CORRELATION auf „gepairt“

und setze CT.CONNECTED auf „Nein“

und terminiere TLS-Verbindung

(



6b): Hinterlegte KT-Admin-Credentials fehlerhaft, Fehlercode: 4030

und in die User-Session zurückzuwechseln (damit das KT für den

normalen Fachbetrieb weiterhin zur Verfügung steht)

(



8): Prüfung auf Nachweis SharedSecret fehlgeschlagen, Fehlercode

4029

und setze CT.CORRELATION auf „gepairt“

und setze CT.CONNECTED auf „Nein“

und terminiere TLS-Verbindung

</td></tr><tr><td>
Nichtfunktionale

Anforderungen

</td><td>
keine

</td></tr><tr><td>
Zugehörige

Diagramme

</td><td>
Abbildung PIC_KON_110 Aktivitätsdiagramm zu „Beginne

Kartenterminalsitzung

</td></tr></table>

![Img-010][Img-010]

Abbildung8: PIC_KON_110 Aktivitätsdiagramm zu „Beginne
Kartenterminalsitzung“

Tabelle34: TAB_KON_523 Fehlercodes TUC_KON_050 „Beginne
Kartenterminalsitzung“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4028

</td><td>
Technical

</td><td>
Error

</td><td>
Fehler beim Versuch eines Verbindungsaufbaus zu KT

</td></tr><tr><td>
4029

</td><td>
Security

</td><td>
Error

</td><td>
Fehler bei der KT-Authentisierung. KT möglicherweise manipuliert

</td></tr><tr><td>
4030

</td><td>
Security

</td><td>
Error

</td><td>
Admin-Werte für KT fehlerhaft

</td></tr><tr><td>
4032

</td><td>
Technical

</td><td>
Error

</td><td>
Verbindung zu HSM konnte nicht aufgebaut werden

</td></tr></table>

**[\<=]**

### 4.1.4.3.2 TUC_KON_054 „Kartenterminal hinzufügen“

##### TIP1-A_4546

Der Konnektor MUSS den technischen Use Case TUC_KON_054 „Kartenterminal
hinzufügen“ umsetzen.

Tabelle35: TAB_KON_524 – TUC_KON_054 „Kartenterminal hinzufügen“

<table><tr><th>
Element

</th><th>
Beschreibung

</th></tr><tr><td>
Name

</td><td>
TUC_KON_054 „Kartenterminal hinzufügen“

</td></tr><tr><td>
Beschreibung

</td><td>
Dieser TUC nimmt ein neues Kartenterminal in die zentrale Verwaltung auf
(CTM_CT_LIST) oder aktualisiert die Einträge zu einem bereits erfassten
Kartenterminal.

</td></tr><tr><td>
Auslöser

</td><td>
 ---> UL

</td></tr><tr><td>
Vorbedingungen

</td><td>
 ---> UL

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor, Kartenterminal

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Nachbedingungen

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
1.   Sofern optionale Parameter nicht übergeben wurden oder

      Mode\<\>AutoAdded, ermittle Port, MAC und Hostname via Service

      Discovery als UDP/IP-Unicast an IP-Adresse und Port

     

CTM_SERVICE_DISCOVERY_PORT

2.   Finde CT in CTM_CT_LIST über MAC-Adresse

3.   Wenn MAC-Adresse nicht in CTM_CT_LIST:

a)         Erzeuge neuen CT-Object-Eintrag in CTM_CT_LIST und

              -                Generiere eindeutige
CT.CTID

              -                setzte CT.MAC_ADRESS
auf MAC-Adresse

              -                Setze CT.CORRELATION
=„bekannt“

              -                Setze CT.CONNECTED =
„Nein“

b)         Wenn Mode= ManuallyAdded setze CT.CORRELATION

       =„zugewiesen“

4.   Wenn CT.CONNECTED = Ja und (IP-Adresse \<\> CT.IP_ADRESS

      oder TCP-Port \<\> CT.TCP_PORT),

      beende TLS-Verbindung und setze CT.CONNECTED = „Nein“

5.  Befülle: CT.IP_ADRESS, CT.Hostname, CT.TCP_PORT

6.  Wenn CT.CORRELATION\>=„zugewiesen“ rufe TUC_KON_055

     „Befülle CT-Object“

</td></tr><tr><td>
Varianten/

Alternativen

</td><td>
Keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
Fehler im Ablauf (Standardablauf oder Varianten) führen in den folgend
ausgewiesenen Schritten zu einem Abbruch der Verarbeitung mit den ausgewiesenen
Fehlercodes:

(



1)  Keine Antwort innerhalb

CTM_SERVICE_DISCOVERY_TIMEOUT

,

          Fehlercode: 4033

(



1)  Ermittelte MAC-Adresse weicht von übergebener MAC-Adresse

          ab, Fehlercode: 4035

(



1)  Ermittelter Hostname-Adresse weicht von übergebenem Hostname

         ab, Fehlercode: 4036

(



2)  Wenn Mode=ManuallyModified und nicht gefunden, Fehlercode:

          4037

Zusätzlich im Abbruchfall:

-        Aufruf von TUC_KON_256 {

         topic = "CT/CT_ADDING_ERROR"; 

         eventType = $ErrorType;

         severity = $Severity;

         parameters = („IP=$IP-Adresse, Name=$HOSTNAME,

            Error=$Fehlercode, Bedeutung=$Fehlertext“) }

-        Keine Veränderung an CTM_CT_LIST

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige

Diagramme

</td><td>
keine

</td></tr></table>

Tabelle36: TAB_KON_525 Fehlercodes TUC_KON_054 „Kartenterminal hinzufügen“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4033

</td><td>
Technical

</td><td>
Error

</td><td>
Kartenterminal antwortet nicht, Zufügen fehlgeschlagen

</td></tr><tr><td>
4035

</td><td>
Technical

</td><td>
Error

</td><td>
Angegebener IP-Adresse gehört zu einer anderen MAC-Adresse als die, die
übergeben wurde. Angaben zur MAC prüfen

</td></tr><tr><td>
4036

</td><td>
Technical

</td><td>
Error

</td><td>
Angegebener IP-Adresse gehört zu einem anderen Hostname als der, der übergeben
wurde. Angaben zum Hostname prüfen

</td></tr><tr><td>
4037

</td><td>
Technical

</td><td>
Error

</td><td>
Verwaltung der Kartenterminals inkonsistent

</td></tr></table>

**[\<=]**

### 4.1.4.3.3 TUC_KON_053 „Paire Kartenterminal“

##### TIP1-A_4548-02

DerKonnektor MUSS den technischen Use Case „Paire Kartenterminal” gemäß
TUC_KON_053 umsetzen.

Tabelle37: TAB_KON_041 – TUC_KON_053 „Paire Kartenterminal“

<table><tr><th>
Element

</th><th>
Beschreibung

</th></tr><tr><td>
Name

</td><td>
TUC_KON_053 „Paire Kartenterminal“

</td></tr><tr><td>
Beschreibung

</td><td>
TUC_KON_053 führt das Pairing zwischen dem Konnektor und einem
eHealth-Kartenterminal durch.

</td></tr><tr><td>
Auslöser

</td><td>
Dialoge zur Administration des Konnektors. Der Administrator hat ein
Kartenterminal im Dialog der Managementschnittstelle ausgewählt und das
Pairing aufgerufen.

</td></tr><tr><td>
Vorbedingungen

</td><td>
 ---> UL

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor, Kartenterminal

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Nachbedingungen

</td><td>
 -  CT.CORRELATION = „aktiv“, wenn Pairing erfolgreich

  - CT.CORRELATION = „zugewiesen“, wenn Pairing nicht erfolgreich

 -  CT.CONNECTED = „Ja“, wenn Pairing erfolgreich

</td></tr><tr><td>
Standardablauf

</td><td>
Setze CT = CTM_CT_LIST(ctId)

1.   Prüfe

CT.VALID_VERSION = true

2.   Aufbau einer TLS-Verbindung mit dem Kartenterminal unter

      Verwendung von ID.SAK.AUT. Dabei:

  a.           Speichern des präsentierten KT-Zertifikats in

        CT.SMKT_AUT

  b.           Prüfung des KT-Zertifikats mittels TUC_KON_037{

                   certificate = C.SMKT.AUT;

                   qualifiedCheck = not_required;

                   offlineAllowNoCheck = true;

                   policyList = oid _smkt_aut;

                   intendedKeyUsage=

 i

ntendedKeyUsage(C.SMKT.AUT);

                   intendedExtendedKeyUsage = id-kp-serverAuth;

                   validationMode = NONE }

3.   Der Konnektor entnimmt den Fingerprint dem KT-Zertifikat und stellt

      dies dem Administrator im Dialog der Managementschnittstelle dar.

      Der Konnektor fordert den Administrator auf, den Fingerprint zu

      akzeptieren oder zurückzuweisen.

4.  Wenn der Administrator den Fingerprint bestätigt,

        a.             generiert der Konnektor einen neuen
Schlüssel, das

              Shared Secret ShS.KT.AUT gemäß [gemSpec_Krypt#2.2]

              (siehe [gemSpec_KT#3.7]) und speichert es in

             

CT.SHARED_SECRET

        b.            und eröffnet der Konnektor mit dem

              Kartenterminalkommando SICCT INIT CT SESSION (siehe

              [SICCT#5.10]) mit

                       -             ctId als
Adressat

                       -             und mit
leerem Username, Password und

                         Session ID

             eine Cardterminal Session.

5.   Der Konnektor sendet mittels Kartenterminalkommando EHEALTH

      TERMINAL AUTHENTICATE (siehe [gemSpec_KT#3.7.2]) in der

      Ausprägung CREATE mit

         -           ctId als Empfänger

         -           und mit dem in Schritt 4.a generierten
Schlüssel im

            Shared Secret DO und der Display Message

           

„KT:$CT.MAC_ADRESS MIT

      KON:$MGM_KONN_HOSTNAME PAIREN OK?“

, wobei die

             MAC-Adresse mit Trenner im folgenden Format dargestellt

             werden MUSS: „AABBCC:DDEEFF“

 das Shared Secret an das Kartenterminal.

6.   Der Konnektor prüft ob in der Antwort des Kartenterminals eine

      korrekte Signatur des Shared Secrets gemäß

     [gemSpec_KT#SEQ_KT_0001] Schritt 7, ausgeführt mit dem

     Schlüssel zum Zertifikat CT.SMKT_AUT vorliegt.

7. 

CT.CORRELATION

wird auf „gepairt“ gesetzt

8.   TLS-Verbindung, die zum Pairen diente, beenden und zuvor das

      Kartenterminalkommando SICCT CLOSE CT SESSION mit ctId als

      Adressat senden

9.   Automatischer Zustandsübergang

CT.CORRELATION

= „gepairt“

      nach „aktiv“ (implizite Aktion des Administrators durch Aufruf von

     TUC_KON_053).

10. „Arbeits“-TLS-Verbindung neu aufbauen durch Aufruf

      TUC_KON_050 { ctId; role = „User“}

</td></tr><tr><td>
Varianten/

Alternativen

</td><td>
(



4): weist der Administrator den Fingerprint in Schritt 3 ab, wird

        TUC_KON_053 nach Ausführung folgender Aktivitäten beendet:

   4.1.a)    Löschen von CT.SMKT_AUT

   4.1.b)    Abbau der TLS-Verbindung, Setzen von CT.CONNECTED

                auf „Nein“

</td></tr><tr><td>
Fehlerfälle

</td><td>
Fehler in den folgenden Schritten des Ablaufs führen zu:

  a)             Aufruf von TUC_KON_256 {

                   topic = "CT/ERROR";

                   eventType = $ErrorType;

                   severity = $Severity;

                   parameters = („CtID=$ctId,
Name=$CT.HOSTNAME,

                      Error=$Fehlercode,

                      Bedeutung=$Fehlertext“);

                   doDisp = false }

  b)              Löschen von CT.SMKT_AUT, CT.SHARED_SECRET

  c)              Direkte Anzeige der Fehlermeldung für den
Administrator

  d)              Abbruch der Verarbeitung mit den ausgewiesenen

         Fehlercodes

(



1) Version des KT wird nicht unterstützt, Fehlercode: 4042

(2b) Zertifikat ist zeitlich nicht gültig,  
         Fehlercode:
1021 (CERTIFICATE_NOT_VALID_TIME)  
(



2) Fehler im TLS Verbindungsaufbau bzw. Zertifikatsprüfung,

         Fehlercode: 4040

(



4b) Fehler in SICCT INIT CT SESSION, Fehlercode: 4041 mit

        Angabe des SICCT-Fehlers

(



5) Fehler in EHEALTH TERMINAL AUTHENTICATE, Fehlercode:

         4041 mit Angabe des SICCT-Fehlers

(



6) Signaturprüfung fehlgeschlagen, Fehlercode: 4041

</td></tr><tr><td>
Zugehörige

Diagramme

</td><td>
Siehe PIC_KON_057

</td></tr></table>

Tabelle38: TAB_KON_113 Fehlercodes TUC_KON_053 „Paire Kartenterminal“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4040

</td><td>
Security

</td><td>
Error

</td><td>
Fehler beim Versuch eines Verbindungsaufbaus zum KT

</td></tr><tr><td>
4041

</td><td>
Technical

</td><td>
Error

</td><td>
Fehler im Pairing, SICCT-Fehler

\<sup\>(Nur wenn dieser Fehler wegen eines Fehlers auf\</sup\>

\<sup\>der SICCT-Schnittstelle auftritt, ist der SICCT-Fehlercode mit
anzugeben.)\</sup\>

: \<SICCT-Fehler\>

</td></tr><tr><td>
4042

</td><td>
Technical

</td><td>
Error

</td><td>
Die Version des Kartenterminals wird nicht unterstützt

</td></tr></table>

Hinweis zu Fehler 4041:

Nur wenn dieser Fehler wegen eines Fehlers auf der SICCT-Schnittstelle auftritt,
ist der SICCT-Fehlercode mit anzugeben.

![Abbildung-9][Abbildung-9]

Abbildung9: PIC_KON_057 Aktivitätsdiagramm zu „PaireKartenterminal“ **[\<=]**

### 4.1.4.3.4 TUC_KON_055 „Befülle CT-Object“

##### TIP1-A_4985

Der Konnektor MUSS den technischen Use Case TUC_KON_055 „Befülle CT-Object“
umsetzen.

Tabelle39: TAB_KON_526 – TUC_KON_055 „Befülle CT-Object“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_055 „Befülle CT-Object“

</td></tr><tr><td>
Beschreibung

</td><td>
Dieser TUC befüllt ein vorhandenes CT-Object aus CTM_CT_LIST mit den aktuellen
Produktinformationen, die vom Kartenterminal bezogen werden und prüft, ob die
Version des Kartenterminals unterstützt wird.

</td></tr><tr><td>
Auslöser

</td><td>
 ---> UL

</td></tr><tr><td>
Vorbedingungen

</td><td>
 ---> UL

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor, Kartenterminal

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Nachbedingungen

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
Setze CT = CTM_CT_LIST(ctId)

 ---> OL

   

Eintrag gefunden:

         Die dritte Stelle der KT-Version ist im Vergleich 

                                        
zur dritten Stelle im gefundenen Eintrag:

                                         
   

\>=:    Setze Result = True

                                         
   

\<:    Setze Result = False

   

Kein Eintrag gefunden:

 Setze Result = False

 ---> OL

</td></tr><tr><td>
Varianten/  
Alternativen

</td><td>
(-\>5) Wenn CT.CORRELATION="aktiv", kann die in (1) aufgebaute Verbindung
bestehen bleiben.

</td></tr><tr><td>
Fehlerfälle

</td><td>
-\> 2) Kartenterminal antwortet mit einer spezifischen Fehlermeldung, Fehlercode
\<gemäß [SICCT]\>

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
keine

</td></tr></table>

**[\<=]**

### 4.1.4.4 Interne TUCs, auch durch Fachmodule nutzbar

### 4.1.4.4.1 TUC_KON_051 „Mit Anwender über Kartenterminal interagieren“

##### TIP1-A_4547

Der Konnektor MUSS den technischen Use Case „Mit Anwender über Kartenterminal
interagieren” gemäß TUC_KON_051 umsetzen.

Tabelle40: TAB_KON_112 – TUC_KON_051 „Mit Anwender über Kartenterminal
interagieren“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_051 „Mit Anwender über Kartenterminal interagieren“

</td></tr><tr><td>
Beschreibung

</td><td>
Der TUC ermöglicht es, Meldungen an das Display eines Kartenterminals zu senden
oder Eingaben vom Benutzer über das PIN-Pad eines Kartenterminals abzufragen
(unter Anzeige einer Meldung).

</td></tr><tr><td>
Auslöser

</td><td>
Fachmodul im Konnektor oder anderer technischer Use Case ruft diesen Use Case
auf.

</td></tr><tr><td>
Vorbedingungen

</td><td>
 ---> UL

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor, Kartenterminal

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Nachbedingungen

</td><td>
Wenn Mode=OutputKeep bleibt Data auf dem Display des KT stehen

</td></tr><tr><td>
Standardablauf

</td><td>
Setze CT = CTM_CT_LIST(ctId)

 ---> OL

</td></tr><tr><td>
Varianten/  
Alternativen

</td><td>
 ---> UL

</td></tr><tr><td>
Fehlerfälle

</td><td>
Fehler in den folgenden Schritten des Ablaufs führen zum Aufruf von TUC_KON_256
{  
      topic = "CT/ERROR";  
      eventType = $ErrorType;  
     
severity = $Severity;  
      parameters = („CtID=$ctId,
Name=$CT.HOSTNAME,  
                           
Error=$Fehlercode, Bedeutung=$Fehlertext“) }

(



1) Display und PinPad des Kartenterminals sind aktuell belegt (PIN, 

        Eingabe, andere Ausgabe etc.), Fehlercode: 4039

(



1) Kartenterminal antwortet mit einer spezifischen Fehlermeldung, 

         Fehlercode \<gemäß [SICCT]\>

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
Keine

</td></tr></table>

Tabelle41: TAB_KON_114 Fehlercodes TUC_KON_051 „Mit Anwender über
Kartenterminal interagieren“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4039

</td><td>
Technical

</td><td>
Error

</td><td>
Kartenterminal durch andere Nutzung aktuell belegt

</td></tr></table>

**[\<=]**

### 4.1.4.4.2 TUC_KON_056 „Karte anfordern“

##### TIP1-A_5409

Der Konnektor MUSS den technischen Use Case „Karte anfordern” gemäß
TUC_KON_056 umsetzen.

Tabelle42: TAB_KON_723 - TUC_KON_056 „Karte anfordern“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_056 „Karte anfordern“

</td></tr><tr><td>
Beschreibung

</td><td>
Der TUC ermöglicht es, die Aufforderung zum Karte-Stecken an das Kartenterminal
zu senden und dabei eine Meldung zum Anzeigen im Display des Kartenterminals
mitzugeben.

</td></tr><tr><td>
Auslöser

</td><td>
Fachmodul im Konnektor oder Operation RequestCard ruft diesen Use Case auf.

</td></tr><tr><td>
Vorbedingungen

</td><td>
</td></tr><tr><td>
Eingangsdaten

</td><td>
-      ctId  
     (Kartenterminalidentifikator)  
- slotId  
   
(Nummer des Kartenslots)  
  -   cardType - optional  
- displayMessage –
optional    
    (Text zur Darstellung am Kartenterminal, Länge durch KT
begrenzt)  
-     timeOut  
    (Wartezeit in Sekunden)

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor, Kartenterminal

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Nachbedingungen

</td><td>
Im Erfolgsfall enthält die CM_CARD_LIST ein neues CARD-Objekt des geforderten
Typs.

</td></tr><tr><td>
Standardablauf

</td><td>
Setze CT = CTM_CT_LIST(ctId)

 ---> OL

In allen Fällen liegt in CM_CARD_LIST ein neues CARD-Objekt vor.

 ---> OL

</td></tr><tr><td>
Varianten/  
Alternativen

</td><td>
Die Ausgabe einer Display-Nachricht entfällt, wenn der adressierte Slot bereits
eine gesteckte Karte enthält.

</td></tr><tr><td>
Fehlerfälle

</td><td>
Fehler in den folgenden Schritten des Ablaufs führen zu Aufruf von TUC_KON_256
{  
      topic = "CT/ERROR";  
      eventType = $ErrorType;  
     
severity = $Severity;  
      parameters = („CtID=$ctId,
Name=$CT.HOSTNAME,  
                              
Error=$Fehlercode, Bedeutung=$Fehlertext“) }  
(2)    Display des
Kartenterminals ist aktuell belegt, Fehlercode: 4039  
(2)    Fehler
beim Zugriff auf das Kartenterminal, Fehlercode: 4044 

(2)    Ungültige Kartenterminal-ID: Fehlercode: 4007 

(2)    Ungültige Kartenslot-ID: Fehlercode: 4097 

(2)    Kartenterminal nicht aktiv, Fehlercode: 4221 

(2)    Kartenterminal ist nicht verbunden, Fehlercode: 4222 

(2)    Kartenterminal antwortet mit einer spezifischen Fehlermeldung, 

           Fehlercode \<gemäß [SICCT]\>  
(4)    Timeout.
Es wurde keine Karte innerhalb der angegebenen  
          
Zeitspanne gesteckt, Fehlercode: 4202  
(5)    Falscher Kartentyp,
Fehlercode: 4051

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
Keine

</td></tr></table>

Tabelle43: TAB_KON_724 Fehlercodes TUC_KON_056 „Karte anfordern“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4039

</td><td>
Technical

</td><td>
Error

</td><td>
Kartenterminal durch andere Nutzung aktuell belegt

</td></tr><tr><td>
4044

</td><td>
Technical

</td><td>
Error

</td><td>
Fehler beim Zugriff auf das Kartenterminal

</td></tr><tr><td>
4051

</td><td>
Technical

</td><td>
Error

</td><td>
Falscher Kartentyp

</td></tr><tr><td>
40

07

</td><td>
Technical

</td><td>
Error

</td><td>
Ungültige Kartenterminal-ID

</td></tr><tr><td>
4097

</td><td>
Technical

</td><td>
Error

</td><td>
Ungültige Kartenslot-ID

</td></tr><tr><td>
4202

</td><td>
Technical

</td><td>
Error

</td><td>
Timeout. Es wurde keine Karte innerhalb der angegebenen Zeitspanne gesteckt.

</td></tr><tr><td>
4221

</td><td>
Technical

</td><td>
Error

</td><td>
Kartenterminal nicht aktiv

</td></tr><tr><td>
4222

</td><td>
Technical

</td><td>
Error

</td><td>
Kartenterminal ist nicht verbunden

</td></tr></table>

**[\<=]**

### 4.1.4.4.3 TUC_KON_057 „Karte auswerfen“

##### TIP1-A_5410

Der Konnektor MUSS den technischen Use Case „Karte auswerfen” gemäß
TUC_KON_057 umsetzen.

Tabelle44: TAB_KON_725 – TUC_KON_057 „Karte auswerfen“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_057 „Karte auswerfen“

</td></tr><tr><td>
Beschreibung

</td><td>
Der TUC ermöglicht es, das SICCT-Kommando zum Auswerfen der Karte an das
Kartenterminal zu senden und dabei eine Meldung zum Anzeigen im Display des
Kartenterminals mitzugeben, die den Benutzer zum Entnehmen der Karte auffordert.

</td></tr><tr><td>
Auslöser

</td><td>
Fachmodul im Konnektor oder Operation EjectCard ruft diesen Use Case auf.

</td></tr><tr><td>
Vorbedingungen

</td><td>
</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor, Kartenterminal

</td></tr><tr><td>
Ausgangsdaten

</td><td>
keine

</td></tr><tr><td>
Nachbedingungen

</td><td>
Durch das Entfernen der Karte wird das Ereignis „Karte entfernt“ ausgelöst,
worauf der Konnektor reagiert [TIP1-A_4562].

</td></tr><tr><td>
Standardablauf

</td><td>
Setze CT = CTM_CT_LIST(ctId)

 ---> OL

</td></tr><tr><td>
Varianten/  
Alternativen

</td><td>
Auch im Falle, dass nach der internen Buchführung des Konnektors in dem
angegebenen Slot des Kartenterminals keine Karte steckt, MUSS der Konnektor das
SICCT-Kommando SICCT EJECT ICC an das Kartenterminal senden. Meldet das
Kartenterminal keinen Fehler, so meldet auch der Konnektor keinen Fehler und es
kann davon ausgegangen werden, dass sich keine Karte mehr in dem Slot befindet.

</td></tr><tr><td>
Fehlerfälle

</td><td>
Fehler in den folgenden Schritten des Ablaufs führen zu Aufruf von TUC_KON_256
{  
      topic = "CT/ERROR";  
      eventType = $ErrorType;  
   
  severity = $Severity;  
      parameters = („CtID=$CtID,
Name=$CT.HOSTNAME, 

                              
Error=$Fehlercode, Bedeutung=$Fehlertext“) }

(



1) Die Karte ist fremdreserviert, Fehlercode 4093

(



3) Display des Kartenterminals ist aktuell belegt, Fehlercode: 4039

(



3) Fehler beim Zugriff auf das Kartenterminal, Fehlercode: 4044

(



3) Karte deaktiviert, aber nicht entnommen, Fehlercode: 4203

(



3) Ungültige Kartenterminal-ID: Fehlercode: 40

07

(



3) Ungültige Kartenslot-ID: Fehlercode: 4097

(



3) Kartenterminal nicht aktiv, Fehlercode: 4221

(



3) Kartenterminal ist nicht verbunden, Fehlercode: 4222

(



3) Kartenterminal antwortet mit einer spezifischen Fehlermeldung, 

        Fehlercode \<gemäß [SICCT]\>

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
Keine

</td></tr></table>

Tabelle45: TAB_KON_796 Fehlercodes TUC_KON_057 „Karte auswerfen“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4039

</td><td>
Technical

</td><td>
Error

</td><td>
Kartenterminal durch andere Nutzung aktuell belegt

</td></tr><tr><td>
4044

</td><td>
Technical

</td><td>
Error

</td><td>
Fehler beim Zugriff auf das Kartenterminal

</td></tr><tr><td>
4203

</td><td>
Technical

</td><td>
Error

</td><td>
Karte deaktiviert, aber nicht entnommen

</td></tr><tr><td>
4093

</td><td>
Technical

</td><td>
Error

</td><td>
Karte wird in einer anderen Kartensitzung exklusiv verwendet

</td></tr><tr><td>
40

07

</td><td>
Technical

</td><td>
Error

</td><td>
Ungültige Kartenterminal-ID

</td></tr><tr><td>
4097

</td><td>
Technical

</td><td>
Error

</td><td>
Ungültige Kartenslot-ID

</td></tr><tr><td>
4221

</td><td>
Technical

</td><td>
Error

</td><td>
Kartenterminal nicht aktiv

</td></tr><tr><td>
4222

</td><td>
Technical

</td><td>
Error

</td><td>
Kartenterminal ist nicht verbunden

</td></tr></table>

**[\<=]**

### 4.1.4.4.4 TUC_KON_058 „Displaygröße ermitteln“

##### A_17473

Der Konnektor MUSS den technischen Use Case „Displaygröße ermitteln“
gemäß TUC_KON_058 umsetzen.

Tabelle46: TAB_KON_854 – TUC_KON_058 „Displaygröße ermitteln“

<table><tr><th>
Element

</th><th>
Beschreibung

</th></tr><tr><td>
Name

</td><td>
TUC_KON_058 „Displaygröße ermitteln“

</td></tr><tr><td>
Beschreibung

</td><td>
Der TUC liefert den Inhalt der Variable CT.DISPLAY_CAPABILITIES zurück.

</td></tr><tr><td>
Auslöser

</td><td>
Fachmodul im Konnektor ruft diesen Use Case auf.

</td></tr><tr><td>
Vorbedingungen

</td><td>
</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
CT.DISPLAY_CAPABILITIES

</td></tr><tr><td>
Nachbedingungen

</td><td>
Keine

</td></tr><tr><td>
Standardablauf

</td><td>
Setze CT = CTM_CT_LIST(ctId)

 ---> OL

</td></tr><tr><td>
Varianten/

Alternativen

</td><td>
Keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
Fehler in den folgenden Schritten des Ablaufs führen zu Aufruf von TUC_KON_256 {

      topic = "CT/ERROR";

      eventType = $ErrorType;

      severity = $Severity;

      parameters = („CtID=$CtID, Name=$CT.HOSTNAME,

                               Error=$Fehlercode,
Bedeutung=$Fehlertext“) }

(



2) CT.DISPLAY_CAPABILITIES ist nicht belegt, Fehlercode 4254

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
Keine

</td></tr></table>

Tabelle47: TAB_KON_855 Fehlercodes TUC_KON_058 „Displaygröße ermitteln“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td>
4254

</td><td>
Technical

</td><td>
Error

</td><td>
Keine Displaygröße für das Kartenterminal definiert

</td></tr></table>

**[\<=]**

### 4.1.4.5 Operationen an der Außenschnittstelle

##### TIP1-A_5411-02

Der Konnektor MUSS Clientsystemen den Basisdienst Kartenterminaldienst anbieten.

Tabelle48: TAB_KON_722 Basisdienst Kartenterminaldienst

<table><tr><th>
Name

</th><th colspan="2">
CardTerminalService

</th></tr><tr><td>
Version (KDV)

</td><td colspan="2">
1.1.0 (WSDL-Version) 1.1.2 (XSD-Version)

</td></tr><tr><td>
Namensraum

</td><td colspan="2">
Siehe GitHub

</td></tr><tr><td>
Namensraum-Kürzel

</td><td colspan="2">
CT für Schema und CTW für WSDL

</td></tr><tr><td rowspan="3">
Operationen

</td><td>
Name

</td><td>
Kurzbeschreibung

</td></tr><tr><td>
RequestCard

</td><td>
Karte anfordern

</td></tr><tr><td>
EjectCard

</td><td>
Karte auswerfen

</td></tr><tr><td>
WSDL

</td><td colspan="2">
CardTerminalService.wsdl

</td></tr><tr><td>
Schema

</td><td colspan="2">
CardTerminalService.xsd

</td></tr></table>

**[\<=]**

### 4.1.4.5.1 RequestCard

##### TIP1-A_5412

Der Konnektor MUSS an der Außenschnittstelle eine Operation RequestCard, wie in
Tabelle TAB_KON_716 Operation RequestCard beschrieben, anbieten.

Tabelle49: TAB_KON_716 Operation RequestCard

<table><tr><th>
Name

</th><th colspan="2">
RequestCard

</th></tr><tr><td>
Beschreibung

</td><td colspan="2">
Liefert die Information zu einer Karte, die in dem Slot eines Kartenterminals
steckt oder innerhalb einer bestimmten Zeit (Timeout) gesteckt wird.

</td></tr><tr><td rowspan="7">
Aufruf-parameter

</td><td colspan="2">
![Img-012][Img-012]

</td></tr><tr><td>
Name

</td><td>
Beschreibung

</td></tr><tr><td>
CCTX:Context

</td><td>
MandantId, CsId, WorkplaceId verpflichtend

</td></tr><tr><td>
CT:Slot

</td><td>
Adressiert

den Slot eines Kartenterminals über die Identifikation des Kartenterminal

CARDCMN:CtId

und die Nummer des Slots

CARDCMN:SlotId

</td></tr><tr><td>
CARDCMN:

CardType

</td><td>
Ein

Kartentyp aus {EGK, KVK, HBAx, SM-B}

als optionaler Filter. Wenn angegeben, werden nur Karten vom spezifizierten Typ
zurückgegeben.

</td></tr><tr><td>
CT:DisplayMsg

</td><td>
Diese Nachricht wird am Display des Kartenterminals angezeigt, um den Nutzer zum
Stecken der Karte aufzufordern.

</td></tr><tr><td>
CT:TimeOut

</td><td>
Die Zeit in sec, die maximal gewartet wird bis zum Stecken einer Karte. Wird
dieser Parameter nicht übergeben, SOLL der Konnektor den Wert

20

sec verwenden. Optional KANN dieser Default-Wert im Konnektor konfigurierbar
sein.

</td></tr><tr><td rowspan="5">
Rückgabe

</td><td colspan="2">
![Img-013][Img-013]

</td></tr><tr><td>
Name

</td><td>
Beschreibung

</td></tr><tr><td>
CONN:Status

</td><td>
Enthält den Ausführungsstatus der Operation (siehe

3.5.2)

</td></tr><tr><td>
CT:AlreadyInserted

</td><td>
Dieses optionale Flag gibt an, ob die Karte bereits vor der Anfrage steckte
(Wert true) oder erst auf Anforderung dieses Aufrufs gesteckt wurde (Wert false
oder Element nicht vorhanden).

</td></tr><tr><td>
CARD:Card

</td><td>
Falls eine Karte gesteckt ist, werden Information zur Karte zurückgegeben
(siehe 4.1.6.5.2)

</td></tr><tr><td>
Vorbedingung

</td><td colspan="2">
keine

</td></tr><tr><td>
Nachbedingung

</td><td colspan="2">
keine

</td></tr></table>

Der Ablauf der Operation RequestCard ist in Tabelle TAB_KON_717 Ablauf
RequestCard beschrieben.

Tabelle50: TAB_KON_717 Ablauf RequestCard

<table><tr><th>
Nr.

</th><th>
Aufruf Technischer Use Case oder Interne Operation

</th><th>
Beschreibung

</th></tr><tr><td>
1.

</td><td>
checkArguments

</td><td>
Die übergebenen Werte werden auf Konsistenz und Gültigkeit überprüft. Treten
hierbei Fehler auf, so bricht die Operation mit Fehler 4000 ab. Wird die
Operation für einen nicht unterstützten Kartentypen aufgerufen, so bricht die
Operation mit Fehler 4058 ab.

</td></tr><tr><td>
2.

</td><td>
TUC_KON_000 „Prüfe Zugriffs-berechtigung“

</td><td>
Prüfung der Zugriffsberechtigung durch den Aufruf

TUC_KON_000 {

      mandantId = $context.mandantId;

      clientSystemId = $context.clientsystemId;

      workplaceId = $context.workplaceId;

      ctId = $Slot.CtId;

      needCardSession=false;

      allWorkplaces=false }

Tritt bei der Prüfung ein Fehler auf, so bricht die Operation mit dem
Fehlercode aus TUC_KON_000 ab.

</td></tr><tr><td>
3.

</td><td>
TUC_KON_056 „Karte anfordern“

</td><td>
Anforderung der Karte vom Kartenterminal durch Aufruf

TUC_KON_056(

      ctId = $Slot.CtId;

      slotId = $Slot.SlotId;

      $cardType;

      displayMessage = $DisplayMsg;

      $timeOut)

</td></tr></table>

Tabelle51: TAB_KON_718 Fehlercodes „RequestCard“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4000

</td><td>
Technical

</td><td>
Error

</td><td>
Syntaxfehler

</td></tr><tr><td>
4058

</td><td>
Security

</td><td>
Error

</td><td>
Aufruf nicht zulässig

</td></tr></table>

**[\<=]**

### 4.1.4.5.2 EjectCard

##### TIP1-A_5413

Der Konnektor MUSS an der Außenschnittstelle eine Operation EjectCard, wie in
Tabelle TAB_KON_719 Operation EjectCard beschrieben, anbieten.

Tabelle52: TAB_KON_719 Operation EjectCard

<table><tr><th>
Name

</th><th colspan="2">
EjectCard

</th></tr><tr><td>
Beschreibung

</td><td colspan="2">
Beendet die Kommunikation mit der Karte und wirft sie aus, falls das
Kartenterminal eine solche mechanische Funktion hat.

</td></tr><tr><td rowspan="7">
Aufruf-parameter

</td><td colspan="2">
![Img-014][Img-014]

</td></tr><tr><td>
Name

</td><td>
Beschreibung

</td></tr><tr><td>
Context

</td><td>
MandantId, CsId, WorkplaceId verpflichtend

</td></tr><tr><td>
CONN:

CardHandle

</td><td>
Adressiert die Karte, die ausgeworfen werden soll.

</td></tr><tr><td>
CT:Slot

</td><td>
Adressiert alternativ den Slot eines Kartenterminals, aus dem die Karte
ausgeworfen werden soll. Die Adressierung erfolgt über die Identifikation des
Kartenterminal

CARDCMN:CtId

und die Nummer des Slots

CARDCMN:SlotId.

</td></tr><tr><td>
CT:

DisplayMsg

</td><td>
Diese Nachricht wird am Display des Kartenterminals angezeigt, um den Nutzer zum
entnehmen der Karte aufzufordern.

</td></tr><tr><td>
CT:TimeOut

</td><td>
Die Zeit in msec, die maximal gewartet wird bis eine Karte gezogen ist. Wird
dieser Parameter nicht übergeben, SOLL der Konnektor den Wert 20 sec
verwenden. Optional KANN dieser Default-Wert im Konnektor konfigurierbar sein.

</td></tr><tr><td rowspan="3">
Rückgabe

</td><td colspan="2">
![Img-015][Img-015]

</td></tr><tr><td>
Name

</td><td>
Beschreibung

</td></tr><tr><td>
Status

</td><td>
Enthält den Ausführungsstatus der Operation (siehe 3.5.2)

</td></tr><tr><td>
Vorbedingung

</td><td colspan="2">
keine.

</td></tr><tr><td>
Nachbedingung

</td><td colspan="2">
keine.

</td></tr></table>

Der Ablauf der Operation EjectCard ist in Tabelle TAB_KON_720 Ablauf EjectCard
beschrieben.

Tabelle53: TAB_KON_720 Ablauf EjectCard

<table><tr><th>
Nr.

</th><th>
Aufruf Technischer Use Case oder Interne Operation

</th><th>
Beschreibung

</th></tr><tr><td>
1.

</td><td>
checkArguments

</td><td>
Die übergebenen Werte werden auf Konsistenz und Gültigkeit überprüft. Treten
hierbei Fehler auf, so bricht die Operation mit Fehler 4000 ab.

</td></tr><tr><td>
2.

</td><td>
TUC_KON_000 „Prüfe Zugriffs-berechtigung“

</td><td>
Ist $cardHandle vorgegeben, so wird $ctId als Id des Kartenterminals bestimmt,
in dem die Karte steckt.

Prüfung der Zugriffsberechtigung durch den Aufruf TUC_KON_000 {

      mandantId = $Context.MandantId;

      clientSystemId = $Context.ClientSystemId;

      workplaceId = $Context.WorkplaceId;

      ctId = $Slot.CtId

                bzw. ctId = CM_CARD_LIST($CardHandle).CTID;

      needCardSession = false;

      allWorkplaces = false }

Tritt bei der Prüfung ein Fehler auf, bricht die Operation mit Fehlercode aus
TUC_KON_000 ab.

</td></tr><tr><td>
3.

</td><td>
TUC_KON_057 „Karte auswerfen“

</td><td>
Wurde EjectCard mit dem Parameter Slot aufgerufen: Veranlassen des
Kartenauswurfs am Kartenterminal durch Aufruf TUC_KON_057 {

      ctId = $Slot.CtId;

      slotId = $Slot.Slotid;

      displayMessage = $DisplayMsg;

      $timeOut }

Wurde EjectCard mit dem Parameter CardHandle aufgerufen: Veranlassen des
Kartenauswurfs am Kartenterminal durch Aufruf TUC_KON_057 {

      ctId = CM_CARD_LIST($CardHandle).CTID;

      slotId = CM_CARD_LIST ($CardHandle).SLOTNO; ;

      displayMessage = $DisplayMsg;

      $timeOut }

</td></tr></table>

Tabelle54: TAB_KON_721 Fehlercodes Operation „EjectCard“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4000

</td><td>
Technical

</td><td>
Error

</td><td>
Syntaxfehler

</td></tr><tr><td>
4203

</td><td>
Technical

</td><td>
Error

</td><td>
Karte deaktiviert, aber nicht entnommen

</td></tr><tr><td>
4101

</td><td>
Technical

</td><td>
Error

</td><td>
Karten-Handle ungültig

</td></tr></table>

**[\<=]**

### 4.1.4.6 Betriebsaspekte

### 4.1.4.6.1 Allgemeine Betriebsaspekte

##### TIP1-A_4549

Während des Bootvorgangs, nach dem Einlesen der persistierten Informationen des
Kartenterminaldienstes MUSS der Konnektor für jedes Kartenterminal CT in
CTM_CT_LIST:

 ---> UL

**[\<=]**

Hinweis: Bei der Initialiserung des Kartenterminaldienstes liest der Konnektor
noch nicht die Karten, um zu ermitteln, welche Karten gesteckt sind. Dies
erfolgt erst bei Initialisierung des Kartendienstes.

##### TIP1-A_4550

Die Managementschnittstelle MUSS es einem Administrator ermöglichen
Konfigurationsänderungen gemäß Tabelle TAB_KON_527 vorzunehmen:

Tabelle55: TAB_KON_527 Konfigurationswerte eines Kartenterminalobjekts

<table><tr><th>
ReferenzID

</th><th>
Belegung

</th><th>
Bedeutung und Administrator-Interaktion

</th></tr><tr><td>
CTM_SERVICE_DISCO  
VERY_PORT

</td><td>
Portnummer

</td><td>
Der Administrator MUSS die Portnummer eingeben können, auf der die KTs im
lokalen Netz auf Dienstanfragen hören.

Default-Wert=4742

</td></tr><tr><td>
CTM_SERVICE_DISCO  
VERY_TIMEOUT

</td><td>
X Sekunden

</td><td>
Der Administrator MUSS die Anzahl Sekunden eingeben können, die der Konnektor
auf Antworten zu Service-Discovery-Anfragen wartet.

Default-Wert=3

</td></tr><tr><td>
CTM_SERVICE_ANNOU  
NCEMENT_PORT

</td><td>
Portnummer

</td><td>
Der Administrator MUSS die Portnummer eingeben können, auf der der Konnektor
auf Dienstbeschreibungspakete hört.

Default-Wert=4742

</td></tr><tr><td>
CTM_SERVICE_DISCO  
VERY_CYCLE

</td><td>
X Minuten

</td><td>
Der Administrator MUSS die Anzahl Minuten einstellen können, in denen der
Konnektor wiederholt Service Discovery Nachrichten absetzt.

Default-Wert=10,

0=Deaktiviert

</td></tr><tr><td>
CTM_KEEP_ALIVE_IN  
TERVAL

</td><td>
X Sekunden

</td><td>
Intervall in Sekunden in den Keep-Alive-Nachrichten an das Kartenterminal
gesendet werden

Der Administrator MUSS diesen Wert im vorgegebenen Bereich anpassen können.

Wertebereich:1-10

Default-Wert=10

</td></tr><tr><td>
CTM_KEEP_ALIVE_TR  
Y_COUNT

</td><td>
Anzahl der Versuche

</td><td>
Anzahl von aufeinander folgenden, nicht beantworteten Keep-Alive-Nachrichten,
nach denen ein Timeout der TLS-Verbindung festgestellt wird

Der Administrator MUSS diesen Wert im

vorgegebenen Bereich anpassen können.

Wertebereich:3-10

Default-Wert=3

</td></tr><tr><td>
CTM_TLS_HS_TIMEOUT

</td><td>
X Sekunden

</td><td>
Der Administrator MUSS die Anzahl Sekunden eingeben können, die der Konnektor
auf den TLS-Verbindungsaufbau zum Kartenterminal wartet (Handshake-Timeout).

Wertebereich:1-60

Default-Wert=10

</td></tr></table>

**[\<=]**

##### TIP1-A_4986

Die Managementschnittstelle MUSS es einem Administrator ermöglichen die
Informationsparameter gemäß Tabelle TAB_KON_528 einzusehen:

Tabelle56: TAB_KON_528 Informationsparamter des Kartenterminaldienstes

<table><tr><th>
ReferenzID

</th><th>
Belegung

</th><th>
Bedeutung und Administrator-Interaktion

</th></tr><tr><td>
CTM_SUPPORTED_KT_  
VERSIONS

</td><td>
Liste von EHEALTH-Interface-Versionen

</td><td>
Der Administrator MUSS die Liste der vom Konnektor unterstützten
modellunabhängigen EHEALTH-Interface-Versionen einsehen können.

</td></tr></table>

**[\<=]**

### 4.1.4.6.2 Kartenterminals pflegen

Im Folgenden werden die Administratorinteraktionen beschrieben, die zum
Hinzufügen, Pairen, Bearbeiten und Löschen von Kartenterminals innerhalb der
CTM_CT_LIST angeboten werden müssen. Eine Aktualisierung der Kartenterminals
mit neuer Firmware wird in Kapitel 4.3.9 beschrieben.

##### TIP1-A_4551

Die Managementschnittstelle MUSS es einem Administrator ermöglichen die Liste
der verwalteten und neu entdeckten Kartenterminals einzusehen (CTM_CT_LIST). **[\<=]**

##### TIP1-A_4552

Die Managementschnittstelle MUSS es einem Administrator ermöglichen zu jedem
CT-Object-Eintrag in CTM_CT_LIST mit CT.CONNECTED=Nein und CT.CORRELATION=aktiv
einen manuellen Verbindungsaufbau
überTUC_KON_050 {ctId=CtID;role=„User“}auszulösen. **[\<=]**

##### TIP1-A_4553

Die Managementschnittstelle MUSS es einem Administrator ermöglichen zu jedem
CT-Object-Eintrag in CTM_CT_LIST die Werte gemäß Tabelle TAB_KON_529 einsehen
zu können:Zu jedem Eintrag MUSS der Administrator TUC_KON_055 „Befülle
CT-Object“ auslösen können.

Tabelle57: TAB_KON_529 Anzeigewerte zu einem Kartenterminalobjekt

<table><tr><th>
ReferenzID

</th><th>
Belegung

</th><th>
Bedeutung und Administrator-Interaktion

</th></tr><tr><td>
Geräte  
kenndaten

</td><td>
</td><td>
</td></tr><tr><td>
CT.CTID

</td><td>
Identifier

</td><td>
Eindeutige, statische Identifikation des Kartenterminals

</td></tr><tr><td>
CT.IS_PHYSICAL

</td><td>
Ja/Nein

</td><td>
Kennzeichnung, ob es sich um ein logisches oder physisches Kartenterminal handelt

(siehe auch TAB_KON_522 Parameterübersicht des Kartenterminaldienstes)

</td></tr><tr><td>
CT.MAC_ADRESS

</td><td>
MAC-Adresse

</td><td>
die MAC-Adresse des Kartenterminals

</td></tr><tr><td>
CT.HOSTNAME

</td><td>
String

</td><td>
SICCT-Terminalname des Kartenterminals, auch als FriendlyName bezeichnet

</td></tr><tr><td>
CT.IP_ADRESS

</td><td>
IP-Adresse

</td><td>
die IP-Adresse des Kartenterminals

</td></tr><tr><td>
CT.TCP_PORT

</td><td>
Portnummer

</td><td>
der TCP-Port des SICCT-Kommandointerpreters des Kartenterminals

</td></tr><tr><td>
CT.SLOTCOUNT

</td><td>
Nummer

</td><td>
Anzahl der Slots des Kartenterminals

</td></tr><tr><td>
CT.SLOTS_USED

</td><td>
Liste

</td><td>
Liste der mit Karten belegten Slots

</td></tr><tr><td>
CT.PRODUCT  
INFORMATION

</td><td>
Inhalt Product  
Information.xsd

</td><td>
die Herstellerinformationen zum Kartenterminal gemäß [gemSpec_OM]

</td></tr><tr><td>
CT.EHEALTH_  
INTERFACE_  
VERSION

</td><td>
Version

</td><td>
Die EHEALTH-Interface-Version des Kartenterminals, die mittels des
SICCT-Kommandos GET STATUS aus dem Element VER des Discretionary Data Objects
ermittelt wurde

</td></tr><tr><td>
CT.VALID_  
VERSION

</td><td>
Boolean

</td><td>
True, wenn die Version des Kartenterminals (CT.EHEALTH_INTERFACE_VERSION) durch
den Konnektor unterstützt wird, d.h. zu den in CTM_SUPPORTED_KT_VERSIONS passt

</td></tr><tr><td>
Pairingdaten

</td><td>
</td><td>
</td></tr><tr><td>
CT.SMKT_AUT

</td><td>
X.509-Cert

</td><td>
C.SMKT.AUT-Zertifikat des Kartenterminals, gespeichert im Rahmen des Pairings

</td></tr><tr><td>
Verbindungs  
daten

</td><td>
</td><td>
</td></tr><tr><td>
CT.  
CORRELATION

</td><td>
bekannt

zugewiesen

gepairt

aktiv

aktualisierend

</td><td>
Der Korrelationsstatus zum Konnektor:

 ---> UL

</td></tr><tr><td>
CT.CONNECTED

</td><td>
Ja/Nein

</td><td>
Der Verfügbarkeitsstatus des Kartenterminals (Ja = nach Aufbau der
TLS-Verbindung und erfolgter zweiter Authentifizierung)

</td></tr><tr><td>
CT.ACTIVEROLE

</td><td>
User/Admin

</td><td>
Benutzerrolle, die für die aktuelle Session verwendet wird

</td></tr><tr><td>
KT-Admin-Credentials

</td><td>
</td><td>
</td></tr><tr><td>
CT.ADMIN_  
USERNAME

</td><td>
String

</td><td>
Username des Administrators am KT

</td></tr></table>

**[\<=]**

##### TIP1-A_4554

Die Managementschnittstelle MUSS es einem Administrator ermöglichen zu jedem
CT-Object-Eintrag in CTM_CT_LIST die Werte gemäß Tabelle TAB_KON_530 ändern
zu können:Zur Überprüfung der veränderten Parameter auf Korrektheit MUSS
nach Änderung von CT.IP_ADRESS, TCP_PORT oder HOSTNAME TUC_KON_054 mit Mode=
ManuallyModified und allen vorhandenen CT-Parametern aufgerufen werden. Endet
der Aufruf von TUC_KON_054 mit einem Fehler, MUSS der Konnektor die geänderten
Konfigurationswerte auf ihren Ausgangswert zurücksetzen.

Tabelle58: TAB_KON_530 Konfigurationswerte eines Kartenterminalobjekts

<table><tr><th>
ReferenzID

</th><th>
Belegung

</th><th>
Bedeutung und Administrator-Interaktion

</th></tr><tr><td>
CT.IP_ADRESS

</td><td>
IP-Adresse

</td><td>
Der Administrator MUSS für KTs mit CT.IS_PHYSICAL=Ja die IPv4-Adresse des
Kartenterminals eingeben können.

</td></tr><tr><td>
CT.TCP_PORT

</td><td>
Portnummer

</td><td>
Der Administrator MUSS für KTs mit CT.IS_PHYSICAL=Ja den TCP-Port des
SICCT-Kommandointerpreters des Kartenterminals eingeben können.

</td></tr><tr><td>
CT.HOSTNAME

</td><td>
String

</td><td>
Der Administrator MUSS den SICCT-Terminalnamen (Hostname) - auch als
FriendlyName bezeichnet - des Kartenterminals eingeben können.

</td></tr><tr><td>
CT.ADMIN_USERNAME

</td><td>
String

</td><td>
Der Administrator MUSS für KTs mit CT.IS_PHYSICAL=Ja den Username des
KT-Administrators des Kartenterminals eingeben können.

</td></tr><tr><td>
CT.ADMIN_PASSWORD

</td><td>
String

</td><td>
Der Administrator MUSS für KTs mit CT.IS_PHYSICAL=Ja das Password des
KT-Administrators des Kartenterminals eingeben können.

</td></tr></table>

**[\<=]**

##### TIP1-A_6477

Die Managementschnittstelle MUSS es einem Administrator ermöglichen, ein
Service Discovery entsprechend [SICCT] auszulösen, um neue Kartenterminals
hinzuzufügen. **[\<=]**

##### TIP1-A_4555

Die Managementschnittstelle MUSS es einem Administrator ermöglichen für neue
Kartenterminals CT-Objects manuell in CTM_CT_LIST aufzunehmen.Hierzu MUSS der
Administrator für das neue Kartenterminal folgende Werte eingeben können:

 ---> UL

Bestätigt der Administrator seine Eingaben, MUSS TUC_KON_054 mit
Mode=ManuallyAdded und allen eingegebenen Parametern aufgerufen werden. **[\<=]**

Als Sicherung gegen den unbemerkten Austausch von Kartenterminals oder deren
Identitäten wird das gSMC-KT über den Konnektor logisch an das
eHealth-Kartenterminal gebunden. Dieser Vorgang wird als Pairing von
Kartenterminal und gSMC-KT bezeichnet und ist ausführlich in [gemSpec_KT]
beschrieben.

##### TIP1-A_4556

Die Managementschnittstelle MUSS es einem Administrator ermöglichen alle
Kartenterminals mitCT.CORRELATION= „zugewiesen“ in einer Liste einzusehen
und für einen ausgewählten Eintrag mit CT.VALID_VERSION=True TUC_KON_053
auslösen zu können. **[\<=]**

##### TIP1-A_4557

Die Managementschnittstelle MUSS es einem Administrator ermöglichen zu einem
Kartenterminal aus CTM_CT_LIST für KTs mit CT.IS_PHYSICAL=Ja den Wert für
CT.CORRELATION nach folgenden Mustern zu ändern:

 ---> UL

**[\<=]**

##### TIP1-A_5698

Die Managementschnittstelle MUSS einem Administrator die Möglichkeit bieten,
Kartenterminals aus der Liste der Kartenterminals (CTM_CT_LIST) zu entfernen.
**[\<=]**

### 4.1.4.6.3 Import der Kartenterminal-Informationen

Im Rahmen des Konnektormanagements müssen die Konfigurationsdaten des
Konnektors ex- und importiert werden können (siehe Kapitel 4.3.3). Eine
Sonderstellung nimmt dabei der Import von Kartenterminalinformationen ein, da
hier im Rahmen des Imports folgende Interaktion mit dem Administrator
erforderlich ist:

##### TIP1-A_5011

Der Konnektor MUSS vor der endgültigen Aktivierung der importierten
Kartenterminalkonfiguration folgende zusätzliche Schritte ausführen:

 ---> OL

**[\<=]**

### 4.1.5 Kartendienst

Innerhalb des Kartendienstes werden folgende Präfixe für Bezeichner verwendet:

 ---> UL

Der Konnektor verwaltet eine Liste aller Karten (CM_CARD_LIST), die in die vom
Konnektor verwalteten Kartenterminals gesteckt sind (CTM_CT_LIST). Alle
Ereignisse und Operationen, die sich auf Karten beziehen, werden durch diesen
Basisdienst gekapselt.

Für jede gesteckte Karte vergibt er einen eindeutigen Identifikator (im
weiteren Text CardHandle bezeichnet), mit dem diese Karte adressiert werden
kann, um zu diesen oder mit diesen Karten Operationen auszuführen. Dieses
Handle ist gültig bis zum Entfernen der Karte aus dem Kartenterminal.

Um die in [gemSpec_Perf] geforderten Zeiten für kartenbezogene Operationen
erreichen zu können, kann es erforderlich sein, dass der Konnektor möglichst
viele Informationen der Karten cached. Hierzu gehören Steuerdaten wie Extended
Length, Version etc. aber auch Zertifikate der Karte (X.509 und CVC). Da es
sich bei Caching um einen internen Mechanismus handelt, der sich nicht auf das
funktionale Außenverhalten von TUCs oder Operationen auswirkt, wird das
Caching nicht weiter beschrieben oder explizit gefordert. Es kann aber
Anforderungen aus Sicherheitssicht bezüglich des Cachings geben (insbesondere
hinsichtlich der erlaubten Caching-Dauer). Die Einhaltung dieser Vorgaben wird
im Rahmen der CC-Evaluierung geprüft werden.

Der Kartendienst verwaltet mindestens die in der informativen Tabelle
TAB_KON_531 ausgewiesenen Parameter, weitere herstellerspezifische Parameter
sind möglich. Die normative Festlegung wann welche Parameter wie belegt
werden, erfolgt in den folgenden Abschnitten und Unterkapiteln.

<table><tr><th>
ReferenzID

</th><th>
Belegung

</th><th>
Zustandswerte

</th></tr><tr><td>
CM_CARD_LIST

</td><td>
Liste von Card-Objekten

</td><td>
Eine Liste von Repräsentanzen (CardObjects) der dem Konnektor bekannten Karten.

Die Attribute der Card-Objekte sind im Folgenden gelistet.

</td></tr><tr><td>
CARD.CARDHANDLE

</td><td>
</td><td>
vom Konnektor vergebenen eindeutigen Identifikator (Handle).

</td></tr><tr><td>
CARD.CTID

</td><td>
</td><td>
Kartenterminal, in dem die Karte steckt

</td></tr><tr><td>
CARD.SLOTNO

</td><td>
</td><td>
Slot, in dem die Karte steckt

</td></tr><tr><td>
CARD.ICCSN

</td><td>
</td><td>
ICCSN der Karte (sofern auslesbar),

</td></tr><tr><td>
CARD.TYPE

</td><td>
</td><td>
Typ der Karte gemäß Tabelle TAB_KON_500 Wertetabelle Kartentypen

</td></tr><tr><td>
CARD.CARDVERSION

</td><td>
</td><td>
die Versionsinformationen zum Produkttyp der Karte und den gespeicherten
Datenstrukturen gemäß [gemSpec_Karten_Fach_TIP].

</td></tr><tr><td>
CARD.CARDVERSION.

COSVERSION

</td><td>
</td><td>
Produkttypversion des COS

</td></tr><tr><td>
CARD.CARDVERSION.

OBJECTSYSTEMVERSION

</td><td>
</td><td>
Produkttypversion des Objektsystems

</td></tr><tr><td>
CARD.CARDVERSION.

CARDPTPERSVERSION

</td><td>
</td><td>
Produkttypversion der Karte bei Personalisierung

</td></tr><tr><td>
CARD.CARDVERSION.

DATASTRUCTUREVERSION

</td><td>
</td><td>
Version der Speicherstrukturen (aus EF.Version)

</td></tr><tr><td>
CARD.CARDVERSION.

LOGGINGVERSION

</td><td>
</td><td>
Version der Befüllvorschrift für EF.Logging

</td></tr><tr><td>
CARD.CARDVERSION.

ATRVERSION

</td><td>
</td><td>
Version der Befüllvorschrift für EF.ATR

</td></tr><tr><td>
CARD.CARDVERSION.

GDOVERSION

</td><td>
</td><td>
Version der Befüllvorschrift für EF.GDO

</td></tr><tr><td>
CARD.CARDVERSION.

KEYINFOVERSION

</td><td>
</td><td>
Version der Befüllvorschrift für KeyInfo

</td></tr><tr><td>
CARD.INSERTTIME

</td><td>
Timestamp

</td><td>
Zeitpunkt, an dem die Karte gesteckt wurde

</td></tr><tr><td>
CARD.CARDHOLDERNAME

</td><td>
String

</td><td>
Name des Karteninhabers bzw. der Institution/Organisation (subject.commonName)

</td></tr><tr><td>
CARD.KVNR

</td><td>
String

</td><td>
Versicherten-ID (unveränderbarer Teil der KVNR)

</td></tr><tr><td>
CARD.

CERTEXPIRATIONDATE

</td><td>
</td><td>
Ablaufdatum des AUT-Zertifikats der Karte

</td></tr><tr><td>
CARD.CARDSESSION_

LIST

</td><td>
Liste von CardSession-Objekten

</td><td>
Eine Liste von Repräsentanzen (CardSession-Objects) der pro Karte vorhandenen
Kartensitzungen.

Die Attribute der CardSession-Objekte sind im Folgenden gelistet.

Das Tripel aus MandantID, CSID und UserID bildet den Kontext ab, in welchem
diese Kartensitzung initiiert wurde.

</td></tr><tr><td>
CARDSESSION.

AUTHSTATE

</td><td>
Liste von Einträgen aus a)C2C:KeyRef, Role

oder

b) CHV: PINRef

</td><td>
Liste von erreichten Sicherheitszuständen.

Jeder einzelne Sicherheitszustand kann entweder über C2C gegen KeyRef (mit
einer bestimmten Rolle gemäß [gemSpec_PKI_TI#Tab_PKI_918]) oder Card Holder
Verification (CHV) gegen eine referenzierte PIN erreicht worden sein.

Für eGK G2.0 wird der Zustand der MRPINs nicht in AuthState gespeichert.

</td></tr><tr><td>
CARDSESSION.

MANDANTID

</td><td>
</td><td>
Mandant-ID

</td></tr><tr><td>
CARDSESSION.CSID

</td><td>
</td><td>
Clientsystem-ID

</td></tr><tr><td>
CARDSESSION.USERID

</td><td>
</td><td>
Nutzer-ID

</td></tr><tr><td>
CARDSESSION.AUTHBY

</td><td>
Referenz auf CardSession

</td><td>
Kartensitzung, über die diese Karte freigeschaltet wurde (nur für eGK belegt)

</td></tr><tr><td>
CARDSESSION.  
SIGNMODE

</td><td>
„PIN“ oder  
„Comfort“

</td><td>
Signaturmodus  
„PIN“: Komfortsignaturmodus ist für die CardSession
ausgeschaltet  
"Comfort“: Komfortsignaturmodus ist für die CardSession
eingeschaltet  
Default-Wert=“PIN“  
Nur relevant für den HBA  
Eine
HBA-CardSession mit eingeschaltetem Komfortsignaturmodus wird im Folgenden als
Komfortsignatursession bezeichnet.

</td></tr></table>

### 4.1.5.1 Funktionsmerkmalweite Aspekte

##### TIP1-A_4988-02

Der Konnektor MUSS für eGK, HBA, SMC-B, gSMC-KT und gSMC-K Karten der
Generation 2 unterstützen. Karten der Generation 2 sind alle Karten, deren
Version des dem aktiven Objektsystem zugrundeliegenden Produkttyps (Tag
‘C1‘ in EF.Version2) den Wert 4.x.y hat, wobei x,y in {0, …, 255}.Der
Konnektor DARF eGKs der Generation \< 2 (also 1 und 1+) NICHT unterstützen.
eGKs der Generation \< 2 werden im Konnektor als CARD.TYPE = UNKNOWN
geführt.Bei Karten der Generation 2

 ---> UL

**[\<=]**

Es kann notwendig sein, Karten der Generation 2 (G2) näher zu bezeichnen. In
diesem Fall wird in G2.0- und G2.1-Karten unterschieden. Wird von Karten der
Generation 2 gesprochen, so gilt die Festlegung für G2.x (G2.0, G2.1 und
höher) des betrachteten Kartentyps.

##### TIP1-A_4558

Sofern der Konnektor Daten gesteckter Karten cached, so DÜRFEN diese Daten von
HBAx und SM-B NICHT länger als 24 Stunden gecached werden.

Der Konnektor DARF Daten der eGK NICHT über den Steckzyklus der Karte
hinauscachen.Ausnahme: Eine Cachingdauer über den Steckzyklus der eGK hinaus
wird voneiner Fachanwendung gefordert und durch die Fachmodulspezifikation
dieser Fachanwendung definiert. **[\<=]**

##### TIP1-A_6031

Der Konnektor DARF NICHT selbsttätig die SM-B und deren Sicherheitszustände
zurücksetzen, auch nicht, wenn die Daten der SM-B nach Ablauf der
24-Stunden-Frist neu in den Cache eingelesen werden. **[\<=]**

##### TIP1-A_4559

Der Konnektor DARF NICHT auf das DF.KT einer gSMC-KT zugreifen. **[\<=]**

##### TIP1-A_4560

Der Konnektor MUSS alle Zugriffe auf Karten ausCM_CARD_LIST,die den
Sicherheitszustand der Karte erhöhen können oder einen erhöhten
Sicherheitszustand der Karte voraussetzen, im Kontext einer Kartensitzung zu
dieser Karte durchführen (CARD.CARDSESSION). Ausgenommen hiervon ist der
Zugriff durch das CMS(bzw. VSDD)auf die eGK.

Der Konnektor MUSS sicherstellen, dass in einer Kartensitzung nur dann auf einen
erhöhten Sicherheitszustand einer Karte zugegriffen werden kann, wenn die zur
Erreichung dieses Sicherheitszustandes erforderlichen Authentisierungen
(PIN-Verifikation, C2C-Rollen-Authentisierung etc.) in dieser verwendeten
Kartensitzung erfolgreich durchgeführt wurden.

Der Konnektor MUSS Authentisierungen in einer Kartensitzung so durchführen,
dass in anderen KartensitzungenvorhandeneSicherheitszustände nicht beeinflusst
werden. (Eine falsche PIN-Eingabe in einer Kartensitzung darf
denerhöhtenSicherheitszustand einer anderen Sitzung nicht zurücksetzen etc.).

Der Konnektor SOLL die Verwaltung der Sicherheitsstatus der Kartensitzungen so
über die Nutzung logischer Kartenkanäle umsetzen, dass PIN-Verifikationen,
die für die Dauer der Kartensitzung Gültigkeit haben, nicht unnötig
wiederholt werden müssen. **[\<=]**

Für die TUCs zur PIN-Eingabe, Änderung und Entsperrung sind Festlegungen
hinsichtlich der auf dem Kartenterminal anzuzeigenden Meldungen erforderlich.
Die folgende Tabelle definiert diese Terminalanzeigen gemäß [SICCT#5.5.10.19].

##### TIP1-A_4561-02

Der Konnektor MUSS im Rahmen des interaktiven PIN-Handlings die folgenden
Displaymessages für die Anzeige im Kartenterminal verwenden:

Tabelle60: TAB_KON_090 Terminalanzeigen beim Eingeben der PIN am Kartenterminal

<table><tr><td>
Karte/  
Kontext

</td><td>
PIN-Referenz

</td><td>
I/O

</td><td>
Terminal-Anzeige

</td><td>
ANW

(max.Anz. Zeichen)

</td></tr><tr><td>
eGK

/PIN-Eingabe für Vertreter-PIN

</td><td>
PIN.AMTS_REP

</td><td>
I

</td><td>
Vertreter-PIN•

0x0B

für•

0x0B

ANW

0x0F

Vertr-PIN:

</td><td>
22

</td></tr><tr><td>
eGK

/PIN-Eingabe für Vertreter-PIN ändern

</td><td>
PIN.AMTS_REP

</td><td>
I

</td><td colspan="2">
Vertreter-PIN•

0x0B

ändern

0x0F

PIN.eGK:

</td></tr><tr><td>
eGK

/PIN-Eingabe für Vertreter-PIN entsperren

</td><td>
PIN.AMTS_REP

</td><td>
I

</td><td colspan="2">
Vertreter-PIN•

0x0

entsperren

0x0F

PIN.eGK:

</td></tr><tr><td>
eGK

/PIN-Eingabe für PIN-Schutz einschalten

</td><td>
MRPIN.NFD, MRPIN.DPE, MRPIN.AMTS,

MRPIN.GDD

</td><td>
I

</td><td>
PIN-Schutz•

0x0B

ANW•

0x0B

einschalten

0x0F

PIN.eGK:

</td><td>
16

</td></tr><tr><td>
eGK

/PIN-Eingabe für PIN-Schutz abschalten

</td><td>
MRPIN.NFD, MRPIN.DPE, MRPIN.AMTS,

MRPIN.GDD

</td><td>
I

</td><td>
PIN-Schutz•

0x0B

ANW•

0x0B

abschalten

0x0F

PIN.eGK:

</td><td>
16

</td></tr><tr><td>
eGK

/Sonstige

</td><td>
ALLE (außer PIN.AMTS_REP)

</td><td>
I

</td><td>
PIN•

0x0B

für•

0x0B

ANW

0x0F

PIN.eGK:

</td><td>
32

</td></tr><tr><td rowspan="2">
HBAx

</td><td>
PIN.CH

</td><td>
I

</td><td colspan="2">
Eingabe•

0x0B

Freigabe-PIN•

0x0B

HBA

0x0F

PIN.HBA:

</td></tr><tr><td>
PIN.QES  
(Signatur auslösen)

</td><td>
I

</td><td colspan="2">
#

UVW-XYZ

•

0x0B

Eingabe•

0x0B

Signatur- PIN•

0x0B

HBA

0x0F

PIN.QES:

</td></tr><tr><td>
HBA

</td><td>
PIN.QES (Komfortsignatur aktivieren)

</td><td>
I

</td><td colspan="2" rowspan="1">
Komfortsignatur•0x0Baktivieren•0x0BHBA

 0x0F

PIN.QES:

</td></tr><tr><td>
SMC-B

</td><td>
PIN.SMC

</td><td>
I

</td><td colspan="2">
Eingabe•

0x0B

PIN•SMC-B•

0x0B

SLOT:

X

0x0F

PIN.SMC:

</td></tr><tr><td>
ANDERE

</td><td>
BELIEBIG

</td><td>
I

</td><td colspan="2">
        Herstellerspezifisch

</td></tr><tr><td>
Erfolgreiche PIN-Eingabe

</td><td>
ALLE

</td><td>
O

</td><td colspan="2">
PIN•

0x0B

erfolgreich•

0x0B

verifiziert!

</td></tr><tr><td>
Fehlerhafte PIN-Eingabe

</td><td>
ALLE

</td><td>
O

</td><td colspan="2">
PIN•

0x0B

falsch•

0x0B

oder•

0x0B

gesperrt!

</td></tr><tr><td>
PUK-Eingabe

</td><td>
eGK

PUK.CH

</td><td>
I

</td><td colspan="2">
Eingabe•

0x0B

Versicherten-

0x0B

PUK

0x0F

PUK.eGK:

</td></tr><tr><td>
</td><td>
HBAx

PUK.CH

</td><td>
I

</td><td colspan="2">
Eingabe•

0x0B

Freigabe

-

PUK•

0x0B

HBA

0x0F

PUK.HBA:

</td></tr><tr><td>
</td><td>
HBAx

PUK.QES

</td><td>
I

</td><td colspan="2">
Eingabe•

0x0B

Signatur

-

PUK•

0x0B

HBA

0x0F

PUK.QES:

</td></tr><tr><td>
</td><td>
SMC-B

PUK.SMC

</td><td>
I

</td><td colspan="2">
Eingabe•

0x0B

PUK•SMC-B•

0x0B

SLOT:

X

0x0F

PUK.SMC:

</td></tr><tr><td>
Erfolgreiche PUK-Eingabe

</td><td>
ALLE

</td><td>
O

</td><td colspan="2">
PIN•

0x0B

erfolgreich•

0x0B

entsperrt!

</td></tr><tr><td>
Fehlerhafte PUK-Eingabe

</td><td>
ALLE

</td><td>
O

</td><td colspan="2">
PUK•

0x0B

falsch•

0x0B

oder•

0x0B

gesperrt!

</td></tr><tr><td>
Eingabe einer neuen PIN

</td><td>
eGK

ALLE (außer PIN.AMTS_REP)

</td><td>
I

</td><td colspan="2">
Eingabe•

0x0Bn

eue•

0x0B

Versicherten-

0x0B

PIN•

0x0B

(6-8•Ziffern)

0x0F

PIN.eGK:

</td></tr><tr><td>
</td><td>
eGK

PIN.AMTS_REP

</td><td>
I

</td><td colspan="2">
Eingabe•

0x0B

neue•

0x0B

Vertreter-PIN•

0x0B

(6-8•Ziffern)

0x0F

Vertr-PIN:

</td></tr><tr><td>
</td><td>
HBAx

PIN.CH

</td><td>
I

</td><td colspan="2">
Eingabe•

0x0B

n

eue•

0x0B

Freigabe-PIN•

0x0B

HBA•

0x0B

(6-8•Ziffern)

0x0F

PIN.HBA:

</td></tr><tr><td>
</td><td>
HBAx

PIN.QES

</td><td>
I

</td><td colspan="2">
Eingabe•

0x0B

neue•

0x0B

Signatur-PIN•

0x0B

HBA•

0x0B

(6-8•Ziffern)

0x0F

PIN.QES:

</td></tr><tr><td>
</td><td>
SMC-B

PIN.SMC

</td><td>
I

</td><td colspan="2">
Eingabe•

0x0B

neue•

0x0B

PIN•SMC-B•

0x0B

SLOT:

X

•

0x0B

(6-8•Ziffern)

0x0F

PIN.SMC:

</td></tr><tr><td rowspan="4">
Eingabe einer Transport-PIN

</td><td>
eGK

PIN.CH

</td><td>
I

</td><td colspan="2">
Eingabe•

0x0B

Transport

-

0x0B

Versicherten-

0x0B

PIN

0x0F

T-PIN.eGK:

</td></tr><tr><td>
HBAx

PIN.CH

</td><td>
I

</td><td colspan="2">
Eingabe•

0x0B

Transport-

0x0B

PIN•

0x0B

HBA

0x0F

T-PIN.HBA:

</td></tr><tr><td>
HBAx

PIN.QES

</td><td>
I

</td><td colspan="2">
Eingabe•

0x0B

Transport

-

0x0B

PIN•

0x0B

HBA

0x0F

T-PIN.QES:

</td></tr><tr><td>
SMC-B

PIN.SMC

</td><td>
I

</td><td colspan="2">
Eingabe•

0x0B

Transport-

0x0B

PIN•SMC-B•

0x0B

SLOT:

X

0x0F

T-PIN.SMC:

</td></tr><tr><td rowspan="5">
Wieder-holung einer neuen PIN

</td><td>
eGK

PIN.CH

</td><td>
I

</td><td colspan="2">
Eingabe•

0x0B

Versicherten-

0x0B

PIN•

0x0B

wiederholen!

0x0F

PIN.eGK:

</td></tr><tr><td>
eGK

PIN.AMTS_REP

</td><td>
I

</td><td colspan="2">
Eingabe•

0x0B

neue•

0x0B

Vertreter-PIN•

0x0B

wiederholen!

0x0F

Vertr-PIN:

</td></tr><tr><td>
HBAx

PIN.CH

</td><td>
I

</td><td colspan="2">
Eingabe•

0x0B

für•HBA•

0x0B

wiederholen!

0x0F

PIN.HBA:

</td></tr><tr><td>
HBAx

PIN.QES

</td><td>
I

</td><td colspan="2">
Eingabe•

0x0B

für•HBA•

0x0B

wiederholen!

0x0F

PIN.QES:

</td></tr><tr><td>
SMC-B

PIN.SMC

</td><td>
I

</td><td colspan="2">
Eingabe•

0x0B

PIN

.

SMC•

0x0B

SLOT:

X

•

0x0B

wiederholen!

0x0F

PIN.SMC:

</td></tr><tr><td>
Ungleichheit bei der Wieder-holung der Eingabe der neuen PIN

</td><td>
ALLE

</td><td>
O

</td><td colspan="2">
PINs•

0x0B

nicht•

0x0B

identisch!•

0x0B

Abbruch!

</td></tr><tr><td>
Erfolgreiche PIN-Änderung

</td><td>
ALLE

</td><td>
O

</td><td colspan="2">
PIN•0x0Berfolgreich•0x0Bgeändert!

</td></tr><tr><td colspan="5">
Anzeigen am lokalen Terminal beim Remote-PIN-Verfahren für das Ergebnis der
Verschlüsselung durch die gSMC-KT

</td></tr><tr><td>
Erfolgreiche Verschlüsselung

</td><td>
ALLE

</td><td>
O

</td><td colspan="2">
Eingabe•0x0Bwird•0x0Bbearbeitet.

</td></tr><tr><td>
Fehler bei der Verschlüsselung

</td><td>
ALLE

</td><td>
O

</td><td colspan="2">
Eingabe•0x0Bfehlgeschlagen.

</td></tr></table>

**[\<=]**

Hinweise zu den Terminalanzeigen bei PIN-Eingaben und zu obiger Tabelle:

 ---> UL

In den Technischen Use Cases TUC_KON_012 „PIN verifizieren“, TUC_KON_019
„PIN ändern“, TUC_KON_021 „PIN entsperren“ wird das
Remote-PIN-Verfahren verwendet, sofern die Zielkarte in einem als für den
Arbeitsplatz entfernt definiertem Kartenterminal steckt (siehe Kap. 4.1.1.1,
Relation [7]). In diesem Fall erfolgt die Nutzerinteraktion am Remote-PIN-KT
von workplaceId (PinInputKT). Dabei wendet der Konnektor das folgende Verfahren
an:

##### TIP1-A_5012

Der Konnektor MUSS das Remote-PIN Verfahren im Sinne der BSI TR-03114
unterstützen. Abweichend von der TR-03114 MUSS statt der SMC-A eine gSMC-KT
verwendet werden.Der Konnektor MUSS für die PIN-Objekte: HBA.PIN.CH,
HBA.PUK.CH, HBA.PIN.QES, HBA.PUK.QES, SM-B.PIN.SMC und SM-B.PUK.SMC das
Remote-PIN Verfahren unterstützen. Für alle anderen Karten und PIN-Objekte
DARF das Verfahren NICHT verwendet werden.Für die Interaktion mit dem Anwender
MÜSSEN die Display Messages entsprechend TAB_KON_090 Terminalanzeigen beim
Eingeben der PIN am Kartenterminal verwendet werden.Der Ablauf für eine
PIN-Operation gegen eine Zielkarte MUSS in diesen logischen Schritten erfolgen:

 ---> OL

Fehlermeldung: Ein Fehler in der Verarbeitung führt zum Abbruch mit Fehlercode
4053 „Remote-PIN nicht möglich“ (Security, Error). **[\<=]**

Hinweis: Derzeit schlägt die Freischaltung der SMC-B durch
Card-2-Card-Authentisierung ohne Fehlermeldung fehl. Der Sicherheitszustand der
SMC-B wird nicht verändert. Diese Einschränkung betrifft TUC_KON_005
„Card-to-Card authentisieren“ (TAB_KON_096).

### 4.1.5.2 Durch Ereignisse ausgelöste Reaktionen

##### TIP1-A_4562

Empfängt der Kartendienst das Ereignis „CT/SLOT_FREE“, so MUSS der
Konnektor:

 ---> UL

**[\<=]**

##### TIP1-A_4563

Empfängt der Kartendienst das Ereignis „CT/SLOT_IN_USE“, so MUSS der
Konnektor für die Karte, die über dieim Ereignis gemeldeten ParameterCtID und
SlotNo adressiert ist, über TUC_KON_001 ein neues CardObject in CM_CARD_LIST
anlegen. **[\<=]**

### 4.1.5.3 Interne TUCs, nicht durch Fachmodule nutzbar

### 4.1.5.3.1 TUC_KON_001 „Karte öffnen“

##### TIP1-A_4565

Der Konnektor MUSS den technischen Use Case „Karte öffnen“ gemäß
TUC_KON_001 umsetzen.

Tabelle61: TAB_KON_734 – TUC_KON_001 „Karte öffnen“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_001 „Karte öffnen“

</td></tr><tr><td>
Beschreibung

</td><td>
Der TUC initialisiert ein Card-Object basierend auf einer physikalischen Karte
und fügt es CM_CARD_LIST zu. Die Karte kann erst im Anschluss unter Verwendung
des erzeugten CardHandles verwendet werden.

</td></tr><tr><td>
Auslöser

</td><td>
Der Kartenterminaldienst meldet das Belegen eines KT-Slots

</td></tr><tr><td>
Vorbedingungen

</td><td>
 ---> UL

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Karte, Kartenterminal, Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
Keine

</td></tr><tr><td>
Standardablauf

</td><td>
1. Prüfe, ob unter ctId und slotId ein Eintrag in CM_CARD_LIST  
   
vorhanden ist. Wenn bereits ein Eintrag vorhanden ist, lösche diesen.  
2.
Erzeuge neuen Card-Object-Eintrag in CM_CARD_LIST und  
a)      Generiere
CARD.CARDHANDLE. mit folgenden Anforderungen:  
           
-               Das CardHandle MUSS innerhalb CM_CARD_LIST 

                 eindeutig sein.  
           
-               Ein ungültig gewordenes CardHandle DARF
innerhalb  
                 von 48h NICHT als neues CardHandle
vergeben werden.  
b)      Befülle CARD.CTID und CARD.SLOTNO mit den
Eingangsdaten  
c)      Ermittle und befülle (soweit durch Karte
unterstützt) die folgenden  
     Daten:  
           
-               CARD.ICCSN  
           
-               CARD.TYPE (mögliche Werte siehe Tabelle 

                 TAB_KON_500 Wertetabelle Kartentypen) 

            -               CARD.CARDVERSION 

            -               CARD.INSERTTIME
(=aktuelle Systemzeit)  
            -              
CARD.CARDHOLDERNAME (aus X.509-AUT-  
                 
Zertifikat)  
            -               CARD.KVNR
(nur für eGK, aus C.CH.AUT:  
                 
unveränderbarer Teil der KVNR)  
           
-               CARD.CERTEXPIRATIONDATE (=validity aus X.509- 

                  AUT-Zertifikat)  
X.509-AUT-Zertifikat
bezeichnet für eGK das C.CH.AUT-Zertifikat, für HBAx das C.HP.AUT-Zertifikat
und für SMC-B das C.HCI.AUT-Zertifikat.  
3. Rufe TUC_KON_256{ 

           topic = „CARD/INSERTED“;  
          
eventType = Op;  
           severity = Info; 

           parameters = \<Params\>}  
     mit \<Params\>
belegt aus dem CARD-Object:  
„CardHandle=$, CardType=$, CardVersion=$,
ICCSN=$,CtID=$,  
SlotID=$, InsertTime=$, CardHolderName=$, KVNR=$, 

CertExpirationDate=$“  
In CardVersion sind die Werte  
   - COSVERSION
und  
   - OBJECTSYSTEMVERSION  
aus CARD.CARDVERSION einzutragen. Für eGK
G1+ ist zusätzlich die  
   - DATASTRUCTUREVERSION  
aus CARD.CARDVERSION
einzutragen. CardVersion kann weitere Werte  
aus CARD.CARDVERSION enthalten.

</td></tr><tr><td>
Varianten/  
Alternativen

</td><td>
Im Falle der KVK gibt es kein EF.ATR, EF.GDO und EF.DIR. Es wird daher  
 
lediglich der ATR ausgewertet, den das Kartenterminal beim Stecken der  
 
Karte liefert.

</td></tr><tr><td>
Fehlerfälle

</td><td>
(-\> 2c) Karte/Kartenterminal antwortet mit einer spezifischen Fehlermeldung,
Fehlercode \<gemäß [gemSpec_COS]/[SICCT]\>  
Auch im Fehlerfall wird Schritt
3 durchlaufen. Wenn nicht alle zu einem Kartentyp notwendigen Daten von der
Karte gelesen werden konnten, dann wird Schritt 3 mit CardType=UNKNOWN
ausgeführt.  
Auch im Fehlerfall wird Schritt 3 durchlaufen. Wenn nicht alle
zu einem Kartentyp notwendigen Daten von der Karte gelesen werden konnten, dann
wird Schritt 3 mit CardType=UNKNOWN ausgeführt.

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
Keine

</td></tr></table>

**[\<=]**

### 4.1.5.4 Interne TUCs, auch durch Fachmodule nutzbar

### 4.1.5.4.1 TUC_KON_026 „Liefere CardSession“

##### TIP1-A_4566

Der Konnektor MUSS den technischen Use Case „Liefere CardSession“ gemäß
TUC_KON_26 umsetzen.

Tabelle62: TAB_KON_735 - TUC_KON_026

<table><tr><th>
Element

</th><th>
Beschreibung

</th></tr><tr><td>
Name

</td><td>
TUC_KON_026 „Liefere CardSession“

</td></tr><tr><td>
Beschreibung

</td><td>
Dieser Use Case gibt auf Grund der übergebenen Parameter die zugehörige
CardSession zurück. Ist für die Parameterkombination noch keine CardSession
vorhanden, wird eine neue erzeugt und im zugehörigen Card-Object hinterlegt.

</td></tr><tr><td>
Auslöser

</td><td>
 ---> UL

</td></tr><tr><td>
Vorbedingungen

</td><td>
Keine

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

</td></tr><tr><td>
Varianten/  
Alternativen

</td><td>
(3) Wenn keine CardSession für diese Parameter vorhanden: 

 1.                    erzeuge neue CardSession in Card. 

        CARDSESSION_LIST 

 2.                    Befülle CARDSESSION.MANDANTID,
.CSID und  
        .USERID mit Übergabeparametern

</td></tr><tr><td>
Fehlerfälle

</td><td>
(2) Karte bereits reserviert, Fehlercode 4093

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
keine

</td></tr></table>

Tabelle63: TAB_KON_824 Fehlercodes TUC_KON_026 „Liefere CardSession“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td>
4093

</td><td>
Technical

</td><td>
Error

</td><td>
Karte wird in einer anderen Kartensitzung exklusiv verwendet

</td></tr></table>

**[\<=]**

Hinweis zu TAB_KON_735 - TUC_KON_026: Die WorkplaceId wird als
Eingangsparameter nicht benötigt. Bereits TUC_KON_000 stellt sicher, dass eine
eGK jeweils nur von einem einzigen Arbeitsplatz aus angesprochen werden kann.

### 4.1.5.4.2 TUC_KON_012 „PIN verifizieren“

##### TIP1-A_4567

Der Konnektor MUSS den technischen Use Case „PIN verifizieren“ gemäß
TUC_KON_012 umsetzen.

Tabelle64: TAB_KON_087 – TUC_KON_012 „PIN verifizieren“

<table><tr><th>
Element

</th><th>
Beschreibung

</th></tr><tr><td>
Name

</td><td>
TUC_KON_012 „PIN verifizieren“

</td></tr><tr><td>
Beschreibung

</td><td>
Dieser Use Case führt die Verifikation einer PIN einer Karte durch. Dabei wird
der Anwender am Display des Kartenterminals aufgefordert, die PIN einzugeben.
Dies erfolgt am PIN-Pad des Kartenterminals.

Remote-PIN-Eingabe wird dabei automatisch unterstützt.

</td></tr><tr><td>
Auslöser

</td><td>
 ---> UL

</td></tr><tr><td>
Vorbedingungen

</td><td>
Karte unterstützt die übergebene pinRef

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Karte, Kartenterminal, Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
1.         Ermittle Card = CM_CARD_LIST(CardSession)

2.         Prüfe, dass der Karte entweder kein Lock zugeordnet ist oder

     der Aufrufer das Karten-Lock besitzt.

3.         Wenn PinTyp(pinRef) = PIN.QES oder

     VerificationType = Mandatorisch 6.

4.         Wenn pinRef in CARDSESSION.AUTHSTATE vorhanden:

        pinResult = OK;

5.         Prüfe TUC_KON_022 „Liefere PIN-Status“

        a.        „VERIFYABLE“; 

        b.        „DISABLED“: pinResult = OK;

6.         Ermittle PinInputKT: Wenn Card.ctId ein dem

     Arbeitsplatz(workplaceId) lokal zugeordnetes Kartenterminal ist

     (siehe Relation [6], Kapitel 4.1.1.1)

        a.            Setze PinInputKT = Card.CtID

        b.            sonst „lokales Kartenterminal, das für
die Remote-PIN-

               Eingabe zu verwenden ist“: PinInputKT =

               Arbeitsplatz(workplaceId)

.

remote-PIN-KT(mandantId)

7.         Atomare Operation: PIN verifizieren inkl. Eventing und

     Ergebnisvermerk

     a.             Rufe TUC_KON_256 {

               topic = „CARD/PIN/VERIFY_STARTED“;

               eventType = Op;

               severity =Info;

               parameters = („CardHandle=$, CardType=$,

                         ICCSN=$, CtID=$, SlotID=$,

                         PinRef=$, PinInputCtID=$PinInputKT“,

               doLog=false)}

     b.             Pin-Verifikation über „Perform
Verification“ ([SICCT]) mit

         Display Messages gemäß Kontext in TAB_KON_090

          Terminalanzeigen beim Eingeben der PIN am Kartenterminal, bei

          eGK ersetze „ANW“ durch actionName in Display Message.

          Wenn PinInputKT=Card.CtID dann PIN Verifikation direkt an

          Card.CtID, ansonsten Remote-PIN-Eingabe gemäß (TIP1-

          A_5012)

     c.             Setze pinResult in Abhängigkeit von
Ergebnis Perform

          Verification:

                -         pinResult = OK für
erfolgreiche Prüfung

                -         pinResult = ERROR für
Nutzer-Abbruch oder

                  Bearbeitungsfehler (siehe Fehlerfälle)

           -              pinResult = REJECTED für
falsche PIN;

                  leftTries = x (bei Kartenantwort ´63 Cx´,
x \> 0)

                -         pinResult = BLOCKED für
gesperrte PIN (bei

                  Kartenantwort ´63 C0´)

     d.            Rufe TUC_KON_256 {

              topic = „CARD/PIN/VERIFY_FINISHED“;

              eventType = Op;

              severity = Info;

              parameters = („CardHandle=$, CardType=$,

                         ICCSN=$, CtID=$, SlotID=$,
PinRef=$,

                         PinInputCtID=$PinInputKT,
Result=$pinResult“);

              doLog = false }

    e.             befülle CARDSESSION.AUTHSTATE mit pinRef und

          Ergebnis der PIN-Prüfung

8.         Liefere pinResult zurück

</td></tr><tr><td>
Varianten/

Alternativen

</td><td>
Schritt 7e: Für eGK G2.0 wird der Zustand der MRPINs nicht in AuthState
gespeichert.

</td></tr><tr><td>
Fehlerfälle

</td><td>
Schritt 7 wird mit allen Teilschritten durchlaufen. Ein als Fehler ausgewiesener
Zustand führt erst nach Schritt 7e zum Abbruch des TUCs. Fehleingaben zählen
explizit nicht zu den Fehlerzuständen, sondern werden auf das Ergebnis
REJECTED oder BLOCKED abgebildet.

    * Karte antwortet nicht innerhalb von CARD_TIMEOUT_CARD

          Sekunden, Fehlercode 4094

  (



2) Karte ist fremd reserviert, Fehlercode 4093

  (



5) Rückgabewert=

          - VERIFIED, Fehlercode 4001

          - TRANSPORT_PIN oder EMPTY_PIN, Fehlercode 4065

          - BLOCKED, Fehlercode 4063

  (



6b) kein Remote-PIN-KT zugeordnet, Fehlercode 4092

  (-\>6b) Card.TYP=eGK und Card.CtID ist nicht dem durch workplaceId

          bezeichneten Arbeitsplatz lokal zugeordnet: Fehlercode 4053

  (



7) Timeout bei PIN Eingabe: Fehlercode 4043

  (



7) Abbruch durch Nutzer: Fehlercode 4049

  (



7) Sind das für die PIN-Eingabe benötigte Kartenterminal oder

          benötigte Teile davon (PIN Pad, Display) durch einen anderen

          zeitgleich im Konnektor ablaufenden Vorgang reserviert, so
bricht

          der Use Case mit Fehler 4060 ab.

  (



7) Rückgabewert=

         - transportgeschützt (Transport-PIN oder Leer-PIN), Fehlercode

         4065

  (



7b) Ungültige PIN-Referenz; Fehlercode 4072

  (



7b) Karte/Kartenterminal antwortet mit einer spezifischen

         Fehlermeldung, Fehlercode \<gemäß [gemSpec_COS]/[SICCT]\>

Zusätzliche Fehlerfälle ergeben sich aus der Remote-PIN-Eingabe gemäß
(TIP1-A_5012)

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
</td></tr><tr><td>
Zugehörige 

Diagramme

</td><td>
Abbildung PIC_KON_111 Aktivitätsdiagramm zu „PIN verifizieren“

</td></tr></table>

![Img-016][Img-016]

Abbildung10: PIC_KON_111 Aktivitätsdiagramm zu „PIN verifizieren“

Tabelle65: TAB_KON_089 Fehlercodes TUC_KON_012 „PIN verifizieren“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4001

</td><td>
Technical

</td><td>
Error

</td><td>
Interner Fehler

</td></tr><tr><td>
4043

</td><td>
Technical

</td><td>
Warning

</td><td>
Timeout bei der PIN-Eingabe

</td></tr><tr><td>
4049

</td><td>
Technical

</td><td>
Error

</td><td>
Abbruch durch den Benutzer

</td></tr><tr><td>
4053

</td><td>
Security

</td><td>
Error

</td><td>
Remote-PIN nicht möglich

</td></tr><tr><td>
4060

</td><td>
Technical

</td><td>
Error

</td><td>
Ressource belegt

</td></tr><tr><td>
4063

</td><td>
Security

</td><td>
Error

</td><td>
PIN bereits gesperrt (BLOCKED)

</td></tr><tr><td>
4065

</td><td>
Technical

</td><td>
Warning

</td><td>
PIN ist transportgeschützt, Änderung erforderlich

</td></tr><tr><td>
4072

</td><td>
Technical

</td><td>
Error

</td><td>
Ungültige PIN-Referenz

PinRef

</td></tr><tr><td>
4092

</td><td>
Technical

</td><td>
Error

</td><td>
Remote-PIN-KT benötigt aber für diesen Arbeitsplatz nicht definiert

</td></tr><tr><td>
4093

</td><td>
Technical

</td><td>
Error

</td><td>
Karte wird in einer anderen Kartensitzung exklusiv verwendet

</td></tr><tr><td>
4094

</td><td>
Technical

</td><td>
Error

</td><td>
Timeout beim Kartenzugriff aufgetreten

</td></tr></table>

**[\<=]**

### 4.1.5.4.3 TUC_KON_019 „PIN ändern“

##### TIP1-A_4568

Der Konnektor MUSS den technischen Use Case „PIN ändern“ gemäß
TUC_KON_019 umsetzen.

Tabelle66: TAB_KON_736 – TUC_KON_019 „PIN ändern“

<table><tr><th>
Element

</th><th>
Beschreibung

</th></tr><tr><td>
Name

</td><td>
TUC_KON_019 „PIN ändern“

</td></tr><tr><td>
Beschreibung

</td><td>
Dieser Use Case führt die Änderung einer PIN einer Karte durch. Dabei wird der
Anwender am Display des Kartenterminals aufgefordert, alte und neue PIN
einzugeben.

Remote-PIN-Eingabe wird dabei automatisch unterstützt.

</td></tr><tr><td>
Auslöser

</td><td>
 ---> UL

</td></tr><tr><td>
Vorbedingungen

</td><td>
Karte unterstützt die übergebene pinRef

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Karte, Kartenterminal, Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

</td></tr><tr><td>
Varianten/

Alternativen

</td><td>
Schritt 4: Für eGK G2.0 gilt:

    Wenn pinRef=PIN.AMTS_REP, dann

       rufe TUC_KON_012 „PIN verifizieren“ {

              cardSession;

              workplaceId;

              pinRef=MRPIN.AMTS;

              actionName= „”;

              mandatorisch}

Schritt 7e: Für eGK G2.0 wird der Zustand der MRPINs nicht in AuthState
gespeichert.

</td></tr><tr><td>
Fehlerfälle

</td><td>
Schritt 7 wird mit allen Teilschritten durchlaufen. Ein als Fehler ausgewiesener
Zustand führt erst nach Schritt 7e zum Abbruch des TUCs.

* Karte antwortet nicht innerhalb von CARD_TIMEOUT_CARD Sekunden,

   Fehlercode 4094

(



2) Karte ist fremd reserviert, Fehlercode 4093

      

(



3) pinStatus=BLOCKED: Fehlercode 4063

(



5) sourceCardSession benötigt aber leer, Fehlercode 4071

(



6b) kein Remote-PIN-KT zugeordnet, Fehlercode 4092

(-\>6b) Card.TYP=eGK und Card.CtID ist nicht dem durch workplaceId

      bezeichneten Arbeitsplatz lokal zugeordnet: Fehlercode 4053

(



7b) neue PIN zu kurz/lang: Fehlercode 4068

(



7b) zweite neue PIN\<\> erste neue PIN: Fehlercode 4067

      

(



7b) Timeout bei PIN-Eingabe: Fehlercode 4043.

(



7b) Abbruch durch Nutzer: Fehlercode 4049.

(



7b) Ist das Kartenterminal oder Teile davon (PIN-Pad, Display) durch

      einen anderen Vorgang reserviert: Fehlercode 4060

(



7b) kein PIN-Pad am Kartenterminal verfügbar: Fehlercode 4066

(



7b) Ungültige PIN-Referenz; Fehlercode 4072

(



7b) Karte antwortet mit einer spezifischen Fehlermeldung, Fehlercode

      \<Kartenfehlercode gemäß [gemSpec_COS]\>

Zusätzliche Fehlerfälle ergeben sich aus der Remote-PIN-Eingabe gemäß
(TIP1-A_5012)

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
keine

</td></tr></table>

Tabelle67: TAB_KON_093 Fehlercodes TUC_KON_019 „PIN ändern“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4043

</td><td>
Technical

</td><td>
Warning

</td><td>
Timeout bei der PIN-Eingabe

</td></tr><tr><td>
4049

</td><td>
Technical

</td><td>
Error

</td><td>
Abbruch durch den Benutzer

</td></tr><tr><td>
4053

</td><td>
Security

</td><td>
Error

</td><td>
Remote-PIN nicht möglich

</td></tr><tr><td>
4060

</td><td>
Technical

</td><td>
Error

</td><td>
Ressource belegt

</td></tr><tr><td>
4063

</td><td>
Security

</td><td>
Error

</td><td>
PIN bereits blockiert (BLOCKED)

</td></tr><tr><td>
4066

</td><td>
Technical

</td><td>
Error

</td><td>
PIN Pad nicht verfügbar

</td></tr><tr><td>
4067

</td><td>
Security

</td><td>
Error

</td><td>
neue PIN nicht identisch

</td></tr><tr><td>
4068

</td><td>
Security

</td><td>
Error

</td><td>
neue PIN zu kurz/zu lang

</td></tr><tr><td>
4071

</td><td>
Technical

</td><td>
Error

</td><td>
keine Karte für C2C-Auth gesetzt

</td></tr><tr><td>
4072

</td><td>
Technical

</td><td>
Error

</td><td>
ungültige PIN-Referenz

PinRef

</td></tr><tr><td>
4092

</td><td>
Technical

</td><td>
Error

</td><td>
Remote-PIN-KT benötigt aber für diesen Arbeitsplatz nicht definiert

</td></tr><tr><td>
4093

</td><td>
Technical

</td><td>
Error

</td><td>
Karte wird in einer anderen Kartensitzung exklusiv verwendet

</td></tr><tr><td>
4094

</td><td>
Technical

</td><td>
Error

</td><td>
Timeout beim Kartenzugriff aufgetreten

</td></tr></table>

**[\<=]**

### 4.1.5.4.4 TUC_KON_021 „PIN entsperren“

##### TIP1-A_4569-02

Der Konnektor MUSS den technischen Use Case „PIN entsperren“ gemäß
TUC_KON_021 umsetzen.

Tabelle68: TAB_KON_236 – TUC_KON_021 „PIN entsperren“

<table><tr><th>
Element

</th><th>
Beschreibung

</th></tr><tr><td>
Name

</td><td>
TUC_KON_021 „PIN entsperren“

</td></tr><tr><td>
Beschreibung

</td><td>
Dieser Use Case setzt den Fehlbedienungszähler für diese PIN in der Karte auf
seinen Anfangswert zurück und es wird optional eine neue PIN gesetzt.

Remote-PIN-Eingabe wird dabei automatisch unterstützt.

</td></tr><tr><td>
Auslöser

</td><td>
 ---> UL

</td></tr><tr><td>
Vorbedingungen

</td><td>
Karte unterstützt die übergebene pinRef

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

setNewPin (true/false) - Angabe, ob eine neue PIN gesetzt oder die aktuelle
weiterverwendet werden soll. Default = false

sourceCardSession -

optional/wenn eGK G1+

(CardSession der Karte, die für die Card-to-Card-Authentisierung bei
Entsperrung der PIN einer eGK der Generation 1+ verwendet werden soll)

</td></tr><tr><td>
Komponenten

</td><td>
Karte, Kartenterminal, Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

</td></tr><tr><td>
Varianten/

Alternativen

</td><td>
Schritt 4: Für eGK G2.0 gilt:

    Wenn pinRef=PIN.AMTS_REP,  dann

       rufe TUC_KON_012 „PIN verifizieren“ {

              cardSession;

              workplaceId;

              pinRef=MRPIN.AMTS;

              actionName= „”;

              mandatorisch}

</td></tr><tr><td>
Fehlerfälle

</td><td>
Schritt 7 wird mit allen Teilschritten durchlaufen. Ein als Fehler ausgewiesener
Zustand führt erst nach Schritt 7d zum Abbruch des TUCs.

  * Karte antwortet nicht innerhalb von CARD_TIMEOUT_CARD

         Sekunden, Fehlercode 4094

  (



2) Karte wird in einer anderen Kartensitzung exklusiv

         verwendet, Fehlercode 4093

  (



5) sourceCardSession benötigt aber leer, Fehlercode 4071  

  (



6b) kein Remote-PIN-KT zugeordnet, Fehlercode 4092

  (



6b) Card.TYP=eGK und Card.CtID ist nicht dem durch workplaceId

         bezeichneten Arbeitsplatz lokal zugeordnet: Fehlercode 4053

  (



7b) blockierte PUK: Fehlercode 4064

  (



7b) neue PIN zu kurz/lang: Fehlercode 4068

  (



7b) zweite neue PIN\<\> erste neue PIN: Fehlercode 4067

  (



7b) Timeout bei PIN Eingabe: Fehlercode 4043.

  (



7b) Abbruch durch Nutzer: Fehlercode 4049.

  (



7b) Ist das Kartenterminal oder Teile davon (PIN-Pad, Display) durch

        einen anderen Vorgang reserviert: Fehlercode 4060

  (



7b) Karte/Kartenterminal antwortet mit einer spezifischen

        Fehlermeldung, Fehlercode \<gemäß [gemSpec_COS]/[SICCT]\>

  (



7b) Ungültige PIN-Referenz; Fehlercode 4072.

Zusätzliche Fehlerfälle ergeben sich aus der Remote-PIN-Eingabe gemäß
(TIP1-A_5012)

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
Keine

</td></tr></table>

Tabelle69: TAB_KON_193 Fehlercodes TUC_KON_021 „PIN entsperren“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4043

</td><td>
Technical

</td><td>
Warning

</td><td>
Timeout bei der PIN-Eingabe

</td></tr><tr><td>
4049

</td><td>
Technical

</td><td>
Error

</td><td>
Abbruch durch den Benutzer

</td></tr><tr><td>
4053

</td><td>
Security

</td><td>
Error

</td><td>
Remote-PIN nicht möglich

</td></tr><tr><td>
4060

</td><td>
Technical

</td><td>
Error

</td><td>
Ressource belegt

</td></tr><tr><td>
4064

</td><td>
Security

</td><td>
Error

</td><td>
alte PIN bereits blockiert (hier: PUK)

</td></tr><tr><td>
4067

</td><td>
Security

</td><td>
Error

</td><td>
neue PIN nicht identisch

</td></tr><tr><td>
4068

</td><td>
Security

</td><td>
Error

</td><td>
neue PIN zu kurz/zu lang

</td></tr><tr><td>
4072

</td><td>
Technical

</td><td>
Error

</td><td>
ungültige PIN-Referenz

PinRef

</td></tr><tr><td>
4092

</td><td>
Technical

</td><td>
Error

</td><td>
Remote-PIN-KT benötigt aber für diesen Arbeitsplatz nicht definiert

</td></tr><tr><td>
4093

</td><td>
Technical

</td><td>
Error

</td><td>
Karte wird in einer anderen Kartensitzung exklusiv verwendet

</td></tr><tr><td>
4094

</td><td>
Technical

</td><td>
Error

</td><td>
Timeout beim Kartenzugriff aufgetreten

</td></tr></table>

**[\<=]**

### 4.1.5.4.5 TUC_KON_022 „Liefere PIN-Status“

##### TIP1-A_4570

Der Konnektor MUSS den technischen Use Case „Liefere PIN-Status“ gemäß
TUC_KON_022 umsetzen.

Tabelle70TAB_KON_532 – TUC_KON_022 „Liefere PIN-Status“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_022 „Liefere PIN-Status“

</td></tr><tr><td>
Beschreibung

</td><td>
Dieser Use Case prüft den Zustand eines PIN-Objekts einer Karte im Kontext
einer CardSession.

</td></tr><tr><td>
Auslöser

</td><td>
 ---> UL

</td></tr><tr><td>
Vorbedingungen

</td><td>
Karte unterstützt die übergebene pinRef

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Karte, Kartenterminal, Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
 1.         Ermittle Card = CM_CARD_LIST(cardSession)  
 2.      
  Prüfe, dass der Karte entweder kein Lock zugeordnet ist oder der 

       Aufrufer das Karten-Lock besitzt.  
 3.         pinRef
in CardSession.AUTHSTATE vorhanden:  
   a) Ja:    Setze pinStatus =
VERIFIED oder DISABLED (wie in  
                AUTHSTATE) 

   b) Nein:Aufruf der Kartenoperation „GET PIN STATUS“, Antwort der 

                Karte wird ausgewertet: 

                a.             ´90 00´ (NoError:
Verifiziert ): pinStatus =  
                    
VERIFYABLE  (da nicht in dieser CardSession verifiziert) 

                b.             ´62 C1´: pinStatus
= TRANSPORT_PIN  
                c.             ´62
C7´: pinStatus = EMPTY_PIN (Leer-PIN)  
               
d.             ´63 Cx´: pinStatus = VERIFYABLE  (mit 1\<= x \<=
3);  
                    LeftTries=x 

                e.             ´63 C0´: pinStatus
= BLOCKED; leftTries=0  
               
f.              ´62 D0´: pinStatus = DISABLED (Verifikation
nicht  
                    erforderlich, da PIN-Schutz
ausgeschaltet);  
                    cardSession.AUTHSTATE
aktualisieren  
                g.             
Antwortet die Karte mit einer Fehlermeldung, bricht 

                    der TUC ab.  
Liefere leftTries nur in
den Fällen d und e zurück.

</td></tr><tr><td>
Varianten/  
Alternativen

</td><td>
</td></tr><tr><td>
Fehlerfälle

</td><td>
* Karte antwortet nicht innerhalb von CARD_TIMEOUT_CARD Sekunden,  
      
Fehlercode 4094  
(3b) pinRef nicht gefunden: Fehlercode 4072

</td></tr><tr><td>
Zugehörige  
Diagramme

</td><td>
keine

</td></tr></table>

Tabelle71: TAB_KON_091 Fehlercodes TUC_KON_022 „Liefere PIN-Status“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4072

</td><td>
Technical

</td><td>
Error

</td><td>
ungültige PIN-Referenz

PinRef

</td></tr><tr><td>
4094

</td><td>
Technical

</td><td>
Error

</td><td>
Timeout beim Kartenzugriff aufgetreten

</td></tr></table>

**[\<=]**

### 4.1.5.4.6 TUC_KON_027 „PIN-Schutz ein-/ausschalten“

##### TIP1-A_5486

Der Konnektor MUSS den technischen Use Case TUC_KON_027 „PIN-Schutz
ein-/ausschalten“ umsetzen.

Tabelle72: TAB_KON_240 - TUC_KON_027 „PIN-Schutz ein-/ausschalten”

<table><tr><th>
Element

</th><th>
Beschreibung

</th></tr><tr><td>
Name

</td><td>
TUC_KON_027 „PIN-Schutz ein-/ausschalten”

</td></tr><tr><td>
Beschreibung

</td><td>
Schaltet das Erfordernis, die PIN zu verifizieren, ein bzw. aus.

Diese Operation wird nur unterstützt für PINs der EGK G2 gemäß
[gemSpec_eGK_ObjSys]; für sie können folgende Kommandos auf das
Passwortobjekt angewendet werden:

 ---> UL

</td></tr><tr><td>
Auslöser

</td><td>
 ---> UL

</td></tr><tr><td>
Vorbedingungen

</td><td>
Karte unterstützt die übergebene pinRef

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
 1. Ermittle Card = CM_CARD_LIST(cardSession)

 2. Prüfe, dass der Karte entweder kein Lock zugeordnet ist oder der

     Aufrufer im Besitz des Karten-Locks ist.

 3. Prüfe Card.Type = EGK und Generation ≥ 2

 4. Prüfe pinRef = MRPIN.AMTS und Card.Type = EGK

               und Generation \> 2.0

 5. Wenn enable

A: =true:

        Atomare Operation: PIN bearbeiten inkl. Eventing und

        Ergebnisvermerk

         a.            Rufe TUC_KON_256 {

                   topic = „CARD/PIN/ENABLE_STARTED“;

                   eventType = Op;

                   severity = Info;

                   parameters = („CardHandle=$, CardType=$,

                              ICCSN=$, CtID=$, SlotID=$,
PinRef=$,

                              PinInputCtID=$PinInputKT“);

                   doLog =

false }

         b.            Aufruf des Kartenterminalkommandos
„SICCT PERFORM

             VERIFICATION“ mit der Kartenoperation „ENABLE

             VERIFICATION REQUIREMENT” als Command-To-Perform. Es

              ist der Parameter P1=’00’ (mit
Benutzerverifikation) zu

             verwenden. Die Anzeige am KT erfolgt entsprechend

             TAB_KON_090 Terminalanzeigen beim Eingeben der PIN am

              Kartenterminal. Ersetze in displayMessage „ANW“
entsprechend

             ANW(pinRef) gemäß Tabelle TAB_KON_838.

          c.           Setze pinResult in Abhängigkeit von
Ergebnis Perform

             Verification:

                    -          pinResult = OK für
erfolgreiche Änderung

                    -          pinResult = ERROR
für Nutzer-Abbruch oder

                     Bearbeitungsfehler (siehe Fehlerfälle)

                -              pinResult = REJECTED
für falsche PIN;

                     leftTries = x (bei Kartenantwort ´63
Cx´, x \> 0)

                -              pinResult = BLOCKED
für gesperrte PIN (bei

                     Kartenantwort ´63 C0´)

         d.           Rufe TUC_KON_256 {

                   topic =„CARD/PIN/ENABLE_FINISHED“;

                   eventType = Op;

                   severity = Info;

                   parameters = („CardHandle=$, CardType=$,

                           ICCSN=$, CtID=$, SlotID=$,
PinRef=$,

                           PinInputCtID=$PinInputKT”);

                   doLog =

false }

B: =false:

          Atomare Operation: PIN bearbeiten inkl. Eventing und

         Ergebnisvermerk

         a.             Rufe TUC_KON_256 {

                   topic = „CARD/PIN/DISABLE_STARTED“;

                   eventType = Op;

                   severity = Info;

                   parameters = („CardHandle=$, CardType=$,

                           ICCSN=$, CtID=$, SlotID=$, PinRef=$,

                           PinInputCtID=$PinInputKT“);

                   doLog =

false }

         b.             Aufruf des Kartenterminalkommandos
„SICCT PERFORM

            VERIFICATION“ mit der Kartenoperation „DISABLE

            VERIFICATION REQUIREMENT” als Command-To-Perform. Es

            ist der Parameter P1=’00’ (mit Benutzerverifikation)
zu

            verwenden. Die Anzeige am KT erfolgt entsprechend

            TAB_KON_090 Terminalanzeigen beim Eingeben der PIN am

            Kartenterminal. Ersetze in displayMessage „ANW“
entsprechend

            ANW(pinRef) gemäß Tabelle TAB_KON_838.

         c.             Setze pinResult in Abhängigkeit
von Ergebnis Perform

              Verification:

                     -             pinResult = OK
für erfolgreiche Änderung

                     -             pinResult =
ERROR für Nutzer-Abbruch oder

                       Bearbeitungsfehler (siehe Fehlerfälle)

                -                  pinResult =
REJECTED für falsche PIN;

                       leftTries = x (bei Kartenantwort ´63
Cx´, x \> 0)

                -                  pinResult =
BLOCKED für gesperrte PIN

         d.            Rufe TUC_KON_256 {

               topic = „CARD/PIN/DISABLE_FINISHED“;

               eventType = Op;

               severity = Info;

               parameters = („CardHandle=$, CardType=$,

                      ICCSN=$;CtID=$, SlotID=$, PinRef=$,

                      PinInputCtID=$PinInputKT”);  

                      doLog=false}

6. Liefere pinResult und leftTries zurück

</td></tr><tr><td>
Varianten/

Alternativen

</td><td>
(-\>3) zur Optimierung kann vor Schritt 5 der PIN-Schutz geprüft werden:

 a.         pinStatus=TUC_KON_022 „Liefere PIN-Status“ {
cardSession;

       pinRef }

 b.         Wenn pinStatus\<\>DISABLED und enable=true, dann

        pinResult=OK und -\> weiter in Schritt 6

 c.         Wenn pinStatus=DISABLED und enable=false, dann

       pinResult=OK und -\> weiter in Schritt 6

</td></tr><tr><td>
Fehlerfälle

</td><td>
(



2) Karte ist fremd reserviert: Fehlercode 4093

(



3) Karte ist keine eGK der Generation 2 oder höher: Fehlercode 4209

(



4) PIN nicht gefunden; Karte ist eGK G2.0: Die Operation „PIN-Schutz
ein-/ausschalten“ wird für MRPIN.AMTS nicht unterstützt: Fehlercode 4072

(



5) Karte antwortet nicht innerhalb von CARD_TIMEOUT_CARD Sekunden: Fehlercode
4094

(



5) PIN nicht gefunden: Fehlercode 4072

(



5) PIN gesperrt: Fehlercode 4063

(



5) Zugriffsbedingung nicht erfüllt (PIN nicht abschaltbar): Fehlercode 4085

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
keine

</td></tr></table>

Tabelle73: TAB_KON_838 Mapping von pinRef auf ANW

<table><tr><th>
pinRef

</th><th>
ANW (max. 16 Zeichen)

</th></tr><tr><td>
MRPIN.NFD

</td><td>
Notfalldaten

</td></tr><tr><td>
MRPIN.DPE

</td><td>
Pers.Erklärungen

</td></tr><tr><td>
MRPIN.AMTS

</td><td>
Medikationsdaten

</td></tr><tr><td>
MRPIN.GDD

</td><td>
PIN•GDD

</td></tr></table>

Hinweis zu TAB_KON_838: Leerzeichen werden als "•" dargestellt.

Tabelle74: TAB_KON_241 Fehlercodes TUC_KON_027 „PIN-Schutz ein/ausschalten“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4063

</td><td>
Security

</td><td>
Error

</td><td>
PIN bereits blockiert

(BLOCKED)

</td></tr><tr><td>
4072

</td><td>
Technical

</td><td>
Error

</td><td>
ungültige PIN-Referenz

PinRef

</td></tr><tr><td>
4085

</td><td>
Security

</td><td>
Error

</td><td>
Zugriffsbedingung nicht erfüllt

</td></tr><tr><td>
4093

</td><td>
Technical

</td><td>
Error

</td><td>
Karte wird in einer anderen Kartensitzung exklusiv verwendet

</td></tr><tr><td>
4094

</td><td>
Technical

</td><td>
Error

</td><td>
Timeout beim Kartenzugriff aufgetreten

</td></tr><tr><td>
4209

</td><td>
Technical

</td><td>
Error

</td><td>
Kartentyp %CardType% wird durch diese Operation nicht unterstützt.

</td></tr></table>

**[\<=]**

### 4.1.5.4.7 TUC_KON_023 „Karte reservieren“

##### TIP1-A_4571

Der Konnektor MUSS den technischen Use Case „Karte reservieren“ gemäß
TUC_KON_023 umsetzen.

Tabelle75: TAB_KON_533 - TUC_KON_023 „Karte reservieren”

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_023 „Karte reservieren”

Dem Aufrufer des TUC_KON_023 wird beim Reservieren (DoLock=Ja) der Karte

zur ausschließlichen Nutzung

ein Lock zugeordnet. Wird der TUC-KON_023 mit diesem Lock zum Freigeben der
Reservierung (DoLock=Nein) aufgerufen, dann erlischt das Lock und

die ausschließliche Nutzung wird beendet

. Der Scope der Kartenreservierung wird vom Aufrufer des TUC_KON_023 gesteuert.

Das Lock ist Konnektor-intern. Es darf nicht außerhalb des Konnektors
referenzierbar sein. Zwei verschiedene Operationsaufrufe am Konnektor dürfen
nie ein identisches Lock haben.

Der Konnektor MUSS sicherstellen, dass auch im Fehlerfall die Reservierung zu
einem Lock aufgehoben wird.

Ein Lock

darf nicht

dauerhaft besteh

en

.

</td></tr><tr><td>
Beschreibung

</td><td>
Reservierung der Karte

</td></tr><tr><td>
Auslöser

</td><td>
 ---> UL

</td></tr><tr><td>
Vorbedingungen

</td><td>
Keine

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
Keine

</td></tr><tr><td>
Standardablauf

</td><td>
 1. Ermittle Card = CM_CARD_LIST(cardSession)

 2. Wenn doLock

A: = true:

       i.            Prüfe, dass der zur cardSession
gehörenden Karte kein  
           Lock zugeordnet ist

       ii.           Dem Aufrufer wird ein Lock auf die zur
cardSession  
           gehörende Karte zugeordnet. Es wird nicht
explizit als  
           Ausgangsdatum modelliert, sondern der
Aufrufer hat das Lock  
           durch die Zuordnung, muss es aber
nicht verwalten.

B: = false:

       i.            Prüfe, dass der Aufrufer für die zur
cardSession gehörende  
           Karte ein Lock hat.

       ii.           Das der Karte zugeordnete Lock wird
gelöscht.

</td></tr><tr><td>
Varianten/  
Alternativen

</td><td>
Keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
(



2Ai) Karte bereits reserviert, Fehlercode 4093

(



2Bi) Karte nicht durch Aufrufer reserviert, Fehlercode 4001

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
Keine

</td></tr></table>

Tabelle76: TAB_KON_534 Fehlercodes TUC_KON_023 „Karte reservieren“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4001

</td><td>
Technical

</td><td>
Error

</td><td>
interner Fehler

</td></tr><tr><td>
4093

</td><td>
Technical

</td><td>
Error

</td><td>
Karte bereits reserviert

</td></tr></table>

**[\<=]**

### 4.1.5.4.8 TUC_KON_005 „Card-to-Card authentisieren“

Die C2C-Authentisierung erfolgt konform zu den in [gemSpec_COS#15] festgelegten
Authentisierungsprotokollen.

Definition Quellkarte/Zielkarte:

Bei einseitiger Card-to-Card-Authentisierung ohne Aushandlung eines Session Key
ist die Quellkarte diejenige, die die Rolle des Karteninhabers bzw. der
Organisation gemäß [gemSpec_PKI_TI#Tab_PKI_254] gegenüber der anderen Karte
nachweist, z. B. der HBA bei der Freischaltung einer eGK.

Bei gegenseitiger Card-to-Card-Authentisierung ohne Aushandlung eines Session
Key erfolgen nach einander zwei einseitige Card-to-Card-Authentisierungen mit
vertauschten Rollen. Quell- und Zielkarte habe daher für den Gesamtablauf
keine nähere Bedeutung.

Bei Card-to-Card-Authentisierung mit Aushandlung eines Session Key ist die
Quellkarte diejenige, die die SM-APDUs produzieren kann, also die SMC (-KT oder
-K).

Die Zielkarte ist jeweils die Karte, die nicht die Quellkarte ist.

##### TIP1-A_4572

Der Konnektor MUSS den technischen Use Case „Card-to-Card authentisieren“
gemäß TUC_KON_005 umsetzen.

Die Card-to-Card-Authentisierung zwischen zwei Karten, bei der eine Karte der
Generation 1+ angehört MUSS das RSA-Verfahren verwenden.

Die Card-to-Card-Authentisierung zwischen zwei Karten der Generation 2 MUSS das
Verfahren der elliptischen Kurven verwenden.

Tabelle77: TAB_KON_096 – TUC_KON_005 „Card-to-Card authentisieren”

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_005 „Card-to-Card authentisieren“

</td></tr><tr><td>
Beschreibung

</td><td>
Durchführung einer Card-to-Card-Authentisierung

</td></tr><tr><td>
Auslöser

</td><td>
 ---> UL

</td></tr><tr><td>
Vorbedingungen

</td><td>
Wert von Source_CARDSESSION.AUTHSTATE: wenn Quellkarte

a) ein HBA ist: CHV; PIN.CH, verifiziert

b) eine SMC-B ist: CHV; PIN.SMC verifiziert

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Karten, Konnektor, Kartenterminal

</td></tr><tr><td>
Ausgangsdaten

</td><td>
Keine

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

</td></tr><tr><td>
Varianten/  
Alternativen

</td><td>
(



9) Wenn der für die CA-Zertifikatsprüfung zu selektierende CVC-Root-Key auf
der Zielkarte nicht vorhanden ist (Returncode des Kartenkommandos „MANAGE
SECURITY ENVIRONMENT“ ist ’6A 88’), dann muss der Konnektor:

 a)      das oder die passenden Cross-CV-Zertifikate aus dem Truststore 

    auswählen

 b)      mit dem Kartenkommando „PSO Verify Certificate“ jedes 

    ausgewählte Cross-CV-Zertifikat durch die Zielkarte prüfen lassen. 

     Dadurch wird der im Cross-CV-Zertifikat enthaltene öffentliche 

     Schlüssel an die Zielkarte übertragen. Die Zielkarte speichert den 

    darin enthaltenen neuen CVC-Root-Key.

 c)      den neuen CVC-Root-Key auf der Zielkarte selektieren

 d)      den Standardablauf der C2C-Authentisierung fortsetzen

(



9) Wenn tCard.TYPE=EGK und AuthMode=gegenseitig,  
      dann
Echtheitsprüfung der eGK durch den Konnektor:

 a)      Freischaltung der EGK durch den HBA/die SMC-B: 

     Durchführen der Authentisierung gemäß Tabelle TAB_KON_673 mit
Key-Referenzen gemäß Tabelle TAB_KON_674 aber mit AuthMode=einseitig

 b)      Konnektor liest das CA-Zertifikat EF.C.CA_eGK.CS (G1+) bzw. 

     C.CA_eGK.CS.E256 (G2)

 c)      Konnektor liest das End-Entity-Zertifikat der EGK  
   
EF.C.eGK.AUT_CVC (G1+) bzw. EF.C.eGK.AUT_CVC.E256 (G2)

 d)      Konnektor prüft das CVC-EE-Zertifikat mit TUC_KON_042 „CV- 

    Zertifikat prüfen“ {  
         certificate =
C.eGK.AUT_CVC/C.eGK.AUT_CVC.E256;  
         caCertificate  =
C.CA_eGK.CS/C.CA_eGK.CS.E256 }

 e)      Konnektor erzeugt Zufallszahl

 f)       Konnektor selektiert den PrK.eGK.AUT_CVC (G1+) bzw.  
 
PrK.eGK.AUT_CVC.E256 (G2) und stellt abhängig von der Version  
   der eGK
den Algorithmus auf der eGK ein (MSE Set)

 g)      Konnektor sendet Konkatenation aus Zufallszahl und  
  
CARD.ICCSN mit dem Befehl „INTERNAL AUTHENTICATE“ an die  
   eGK

 h)      Konnektor wertet das von der Karte erhaltene Chiffrat aus

</td></tr><tr><td>
Fehlerfälle

</td><td>
* Karte antwortet nicht innerhalb von CARD_TIMEOUT_CARD Sekunden, Fehlercode 4094

(



3) Eine Karte ist fremd reserviert, Fehlercode 4093

(



5) Zertifikat der Quellkarte fehlerhaft. Ausstellungsdatum liegt in der Zukunft;
Fehlercode 4233

(



6) eGK G1+ ausgealtert, Fehlercode 4192

(



8) Nötige PIN, bzw. KeyRef ist nicht verifiziert, Fehlercode 4085

(



9) Je nachdem, welche Karte den Fehler verursachte, wird zum ursprünglichen
Fehler (Fehlercode gemäß [gemSpec_COS]) im Error-Trace (welcher an erster
Stelle im Falle des HBA z. B. bereits ein Fehler bezüglich PIN-Verifikation
enthalten kann) noch ein weiterer mit Code 4056 oder 4057 hinzugefügt. Kann
der Fehler nicht eindeutig einer der beiden Karten zugeordnet so wird
Error-Code 4048 verwendet.

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
Keine

</td></tr></table>

Tabelle78: TAB_KON_673 AuthMode für C2C

<table><tr><th>
AuthMode

</th><th>
Definition des Ablaufs

</th></tr><tr><td>
einseitig

</td><td>
Externe oder Interne Authentisierung  
([gemSpec_COS#15.1] oder
[gemSpec_COS#15.2], passend zu den Zugriffsregeln der beteiligten CVC)

</td></tr><tr><td>
gegenseitig

</td><td>
Card-2-Card-Authentisierung ohne Sessionkey-Aushandlung ([gemSpec_COS#15.3])

</td></tr><tr><td>
gegenseitig+TC

</td><td>
Card-2-Card-Authentisierung mit Sessionkey-Aushandlung zur Etablierung eines
Trusted Channels ([gemSpec_COS#15.4])

</td></tr></table>

Tabelle79: TAB_KON_674 Erlaubte Parameterkombinationen und resultierende
CV-Zertifikate für C2C

<table><tr><th>
Quellkarte

</th><th>
Zielkarte

</th><th>
AuthMode

</th><th>
sKeyRef

</th><th>
tKeyRef

</th><th>
Fachlicher  
UseCase

</th></tr><tr><td>
HBA  
oder  
SM-B

</td><td>
eGK G1+

</td><td>
einseitig

</td><td>
{HPC.AUTR_  
CVC.R2048 |  
SMC.AUTR_  
CVC.R2048}

</td><td>
</td><td>
Freischaltung  
eGK

</td></tr><tr><td>
HBA  
oder  
SM-B

</td><td>
eGK G1+

</td><td>
gegen  
seitig

</td><td>
{HPC.AUTR_  
CVC.R2048 |  
SMC.AUTR_  
CVC.R2048}

</td><td>
eGK.AUT_  
CVC.R2048

</td><td>
Freischaltung  
eGK mit  
Echtheits  
prüfung eGK

</td></tr><tr><td>
HBA  
oder  
SM-B

</td><td>
eGK G2

</td><td>
einseitig

</td><td>
{HPC.AUTR_  
CVC.E256 |  
SMC.AUTR_  
CVC.E256}

</td><td>
</td><td>
Freischaltung  
eGK

</td></tr><tr><td>
HBA  
oder  
SM-B

</td><td>
eGK G2

</td><td>
gegen  
seitig

</td><td>
{HPC.AUTR_  
CVC.E256 |  
SMC.AUTR_  
CVC.E256}

</td><td>
eGK.AUT_  
CVC.E256

</td><td>
Freischaltung  
eGK mit  
Echtheits  
prüfung eGK

</td></tr><tr><td>
SMC-K

</td><td>
HBA

</td><td>
gegen  
seitig+TC

</td><td>
SAK.AUTD_  
CVC.E256

</td><td>
HPC.AUTD_  
SUK_CVC.E256

</td><td>
DTBS-  
Übertragung  
bei QES

</td></tr><tr><td>
SMC-KT

</td><td>
HBA

</td><td>
gegen  
seitig+TC

</td><td>
SMC.AUTD_  
RPS_CVC.E256

</td><td>
HPC.AUTD_  
SUK_CVC.E256

</td><td>
Remote-PIN

</td></tr><tr><td>
SMC-KT

</td><td>
SM-B

</td><td>
gegen  
seitig+TC

</td><td>
SMC.AUTD_  
RPS_CVC.E256

</td><td>
SMC.AUTD_  
RPE_CVC.E256

</td><td>
Remote-PIN

</td></tr></table>

Tabelle80: TAB_KON_535 Fehlercodes TUC_KON_005 „Card-to-Card authentisieren“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4048

</td><td>
Technical

</td><td>
Error

</td><td>
Fehler bei der C2C-Authentisierung

</td></tr><tr><td>
4056

</td><td>
Technical

</td><td>
Error

</td><td>
Fehler bei der C2C-Authentisierung, Quellkarte

</td></tr><tr><td>
4057

</td><td>
Technical

</td><td>
Error

</td><td>
Fehler bei der C2C-Authentisierung, Zielkarte

</td></tr><tr><td>
4085

</td><td>
Security

</td><td>
Error

</td><td>
Zugriffsbedingungen nicht erfüllt

</td></tr><tr><td>
4093

</td><td>
Technical

</td><td>
Error

</td><td>
Karte wird in einer anderen Kartensitzung exklusiv verwendet

</td></tr><tr><td>
4094

</td><td>
Technical

</td><td>
Error

</td><td>
Timeout beim Kartenzugriff aufgetreten

</td></tr><tr><td>
4192

</td><td>
Security

</td><td>
Error

</td><td>
C2C mit eGK G1+ ab 01.01.2019  nicht mehr gestattet

</td></tr><tr><td>
4233

</td><td>
Security

</td><td>
Error

</td><td>
Ausstellungsdatum des Zertifikats liegt in der Zukunft;

</td></tr></table>

**[\<=]**

### 4.1.5.4.9 TUC_KON_202 „LeseDatei“

##### TIP1-A_4573

Der Konnektor MUSS den technischen Use Case „LeseDatei“ gemäß TUC_KON_202
umsetzen.

Tabelle81: TAB_KON_218 – TUC_KON_202 „LeseDatei“

<table><tr><th>
Element

</th><th>
Beschreibung

</th></tr><tr><td>
Name

</td><td>
TUC_KON_202 „LeseDatei“

</td></tr><tr><td>
Beschreibung

</td><td>
Transparente Datei oder Teile davon lesen

</td></tr><tr><td>
Auslöser

</td><td>
 ---> UL

</td></tr><tr><td>
Vorbedingungen

</td><td>
Die Karte MUSS den nötigen Sicherheitszustand für den Zugriff besitzen

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Karte, Kartenterminal, Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

</td></tr><tr><td>
Varianten/

Alternativen

</td><td>
Wenn Card.TYPE = KVK, sendet der Konnektor in diesem Fall ein "Read Binary" im
Sinne von SICCT 1.2.1, 5.5.8.1 "Kommandos für synchrone Chipkarten".

</td></tr><tr><td>
Fehlerfälle

</td><td>
* Karte antwortet nicht innerhalb von CARD_TIMEOUT_CARD Sekunden, Fehlercode 4094

(



2) Karte ist fremd reserviert, Fehlercode 4093

(



3) Nötige PIN ist nicht verifiziert, Fehlercode 4085

(



5) Verzeichnis deaktiviert, Fehlercode 4086

(



4-5) Karte antwortet mit einer spezifischen Fehlermeldung, Fehlercode
\<Kartenfehlercode gemäß [gemSpec_COS]\>

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
Keine

</td></tr></table>

Tabelle82: TAB_KON_536 Fehlercodes TUC_KON_202 „LeseDatei“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4085

</td><td>
Security

</td><td>
Error

</td><td>
Zugriffsbedingungen nicht erfüllt

</td></tr><tr><td>
4086

</td><td>
Technical

</td><td>
Error

</td><td>
Verzeichnis deaktiviert

</td></tr><tr><td>
4093

</td><td>
Technical

</td><td>
Error

</td><td>
Karte wird in einer anderen Kartensitzung exklusiv verwendet

</td></tr><tr><td>
4094

</td><td>
Technical

</td><td>
Error

</td><td>
Timeout beim Kartenzugriff aufgetreten

</td></tr></table>

**[\<=]**

### 4.1.5.4.10 TUC_KON_203 „SchreibeDatei“

##### TIP1-A_4574

Der Konnektor MUSS den technischen Use Case „SchreibeDatei“ gemäß
TUC_KON_203 umsetzen.

Tabelle83: TAB_KON_219 – TUC_KON_203 „SchreibeDatei“

<table><tr><th>
Element

</th><th>
Beschreibung

</th></tr><tr><td>
Name

</td><td>
TUC_KON_203 „SchreibeDatei“

</td></tr><tr><td>
Beschreibung

</td><td>
Daten in transparente Datei schreiben

</td></tr><tr><td>
Auslöser

</td><td>
 ---> UL

</td></tr><tr><td>
Vorbedingungen

</td><td>
Die Karte MUSS den nötigen Sicherheitszustand für den Zugriff

besitzen.

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Karte, Kartenterminal, Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
Keine

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

</td></tr><tr><td>
Varianten/

Alternativen

</td><td>
keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
* Karte antwortet nicht innerhalb von CARD_TIMEOUT_CARD Sekunden, Fehlercode 4094

(



2) Schreibzugriff auf KVK nicht gestattet, Fehlercode 4085

(



3) Karte ist fremd reserviert, Fehlercode 4093

(



4) Nötige PIN ist nicht verifiziert, Fehlercode 4085

(



5) Verzeichnis oder Datei existiert nicht, Fehlercode 4087

(



4-5) Karte antwortet mit einer spezifischen Fehlermeldung, Fehlercode
\<Kartenfehlercode gemäß [gemSpec_COS]\>

(



6) Ausgewählte Datei ist nicht transparent, Fehlercode 4089

(



6) Verzeichnis deaktiviert, Fehlercode 4086

(



8) dataToBeWritten sind größer als der zur Verfügung stehende Speicherplatz,
Fehlercode 4247

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
keine

</td></tr></table>

Tabelle84: TAB_KON_537 Fehlercodes TUC_KON_203 „Schreibe Datei“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4085

</td><td>
Security

</td><td>
Error

</td><td>
Zugriffsbedingungen nicht erfüllt

</td></tr><tr><td>
4086

</td><td>
Technical

</td><td>
Error

</td><td>
Verzeichnis deaktiviert

</td></tr><tr><td>
4087

</td><td>
Technical

</td><td>
Error

</td><td>
Datei nicht vorhanden

</td></tr><tr><td>
4089

</td><td>
Technical

</td><td>
Error

</td><td>
Datei ist vom falschen Typ

</td></tr><tr><td>
4093

</td><td>
Technical

</td><td>
Error

</td><td>
Karte wird in einer anderen Kartensitzung exklusiv verwendet

</td></tr><tr><td>
4094

</td><td>
Technical

</td><td>
Error

</td><td>
Timeout beim Kartenzugriff aufgetreten

</td></tr><tr><td>
4247

</td><td>
Technical

</td><td>
Error

</td><td>
Speicherplatz auf der Karte nicht ausreichend

</td></tr></table>

**[\<=]**

### 4.1.5.4.11 TUC_KON_204 „LöscheDateiInhalt“

##### TIP1-A_5476

Der Konnektor MUSS den technischen Use Case „LöscheDateiInhalt“ gemäß
TUC_KON_204 umsetzen.

Tabelle85: TAB_KON_204 – TUC_KON_204 „LöscheDateiInhalt“

<table><tr><th>
Element

</th><th>
Beschreibung

</th></tr><tr><td>
Name

</td><td>
TUC_KON_204 „LöscheDateiInhalt“

</td></tr><tr><td>
Beschreibung

</td><td>
Inhalt einer transparenten Datei löschen

</td></tr><tr><td>
Auslöser

</td><td>
 ---> UL

</td></tr><tr><td>
Vorbedingungen

</td><td>
Die Karte MUSS den nötigen Sicherheitszustand für den Zugriff besitzen

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Karte, Kartenterminal, Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
keine

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

</td></tr><tr><td>
Varianten/

Alternativen

</td><td>
keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
* Karte antwortet nicht innerhalb von CARD_TIMEOUT_CARD Sekunden, Fehlercode 4094

(



2) Karte ist keine eGK der Generation 2 oder höher: Fehlercode 4209 (



3) Karte ist fremd reserviert, Fehlercode 4093

(



4) Nötige PIN ist nicht verifiziert, Fehlercode 4085

(



5) Verzeichnis oder Datei existiert nicht, Fehlercode 4087

(



6) Ausgewählte Datei ist nicht transparent, Fehlercode 4089

(



6) Verzeichnis deaktiviert, Fehlercode 4086

(



5-6) Karte antwortet mit einer spezifischen Fehlermeldung, Fehlercode
\<Kartenfehlercode gemäß [gemSpec_COS]\>

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
Keine

</td></tr></table>

Tabelle86: TAB_KON_785 Fehlercodes TUC_KON_204 „LöscheDateiInhalt“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4085

</td><td>
Security

</td><td>
Error

</td><td>
Zugriffsbedingungen nicht erfüllt

</td></tr><tr><td>
4086

</td><td>
Technical

</td><td>
Error

</td><td>
Verzeichnis deaktiviert

</td></tr><tr><td>
4087

</td><td>
Technical

</td><td>
Error

</td><td>
Datei nicht vorhanden

</td></tr><tr><td>
4089

</td><td>
Technical

</td><td>
Error

</td><td>
Datei ist vom falschen Typ

</td></tr><tr><td>
4093

</td><td>
Technical

</td><td>
Error

</td><td>
Karte wird in einer anderen Kartensitzung exklusiv verwendet

</td></tr><tr><td>
4094

</td><td>
Technical

</td><td>
Error

</td><td>
Timeout beim Kartenzugriff aufgetreten

</td></tr><tr><td>
4209

</td><td>
Technical

</td><td>
Error

</td><td>
Kartentyp %CardType% wird durch diese Operation nicht unterstützt.

</td></tr></table>

**[\<=]**

### 4.1.5.4.12 TUC_KON_209 „LeseRecord“

##### TIP1-A_4575

Der Konnektor MUSS den technischen Use Case „LeseRecord“ gemäß TUC_KON_209
umsetzen.

Tabelle87: TAB_KON_538 – TUC_KON_209 „LeseRecord“

<table><tr><th>
Element

</th><th>
Beschreibung

</th></tr><tr><td>
Name

</td><td>
TUC_KON_209 „LeseRecord"

</td></tr><tr><td>
Beschreibung

</td><td>
Daten aus strukturierter Datei lesen

</td></tr><tr><td>
Auslöser

</td><td>
 ---> UL

</td></tr><tr><td>
Vorbedingungen

</td><td>
Die Karte MUSS den nötigen Sicherheitszustand für den Zugriff besitzen

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Karte, Kartenterminal, Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

</td></tr><tr><td>
Varianten/

Alternativen

</td><td>
keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
* Karte antwortet nicht innerhalb von CARD_TIMEOUT_CARD Sekunden, Fehlercode 4094

(



2) Karte ist fremd reserviert, Fehlercode 4093

(



3) Nötige PIN ist nicht verifiziert, Fehlercode 4085

(



4) Verzeichnis oder Datei oder Record existiert nicht, Fehlercode 4087

(



5) Wenn Karte WrongFileType liefert, Fehlercode 4089

(



5) Verzeichnis deaktiviert, Fehlercode 4086

(



4-5) Karte antwortet mit einer spezifischen Fehlermeldung, Fehlercode
\<Kartenfehlercode gemäß [gemSpec_COS]\>.

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
keine

</td></tr></table>

Tabelle88: TAB_KON_539 Fehlercodes TUC_KON_209 „LeseRecord“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4085

</td><td>
Security

</td><td>
Error

</td><td>
Zugriffsbedingungen nicht erfüllt

</td></tr><tr><td>
4086

</td><td>
Technical

</td><td>
Error

</td><td>
Verzeichnis deaktiviert

</td></tr><tr><td>
4087

</td><td>
Technical

</td><td>
Error

</td><td>
Datei nicht vorhanden

</td></tr><tr><td>
4089

</td><td>
Technical

</td><td>
Error

</td><td>
Datei ist vom falschen Typ

</td></tr><tr><td>
4093

</td><td>
Technical

</td><td>
Error

</td><td>
Karte wird in einer anderen Kartensitzung exklusiv verwendet

</td></tr><tr><td>
4094

</td><td>
Technical

</td><td>
Error

</td><td>
Timeout beim Kartenzugriff aufgetreten

</td></tr></table>

**[\<=]**

### 4.1.5.4.13 TUC_KON_210 „SchreibeRecord“

##### TIP1-A_4576

Der Konnektor MUSS den technischen Use Case „SchreibeRecord“ gemäß
TUC_KON_210 umsetzen.

Tabelle89: TAB_KON_224 – TUC_KON_210 „SchreibeRecord“

<table><tr><th>
Element

</th><th>
Beschreibung

</th></tr><tr><td>
Name

</td><td>
TUC_KON_210 „SchreibeRecord"

</td></tr><tr><td>
Beschreibung

</td><td>
Daten in lineare Datei schreiben

</td></tr><tr><td>
Auslöser

</td><td>
 ---> UL

</td></tr><tr><td>
Vorbedingungen

</td><td>
Die Karte MUSS den nötigen Sicherheitszustand für den Zugriff besitzen

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Karte, Kartenterminal, Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
keine

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

</td></tr><tr><td>
Varianten/

Alternativen

</td><td>
keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
* Karte antwortet nicht innerhalb von CARD_TIMEOUT_CARD Sekunden, Fehlercode 4094

(



2) Schreibzugriff auf KVK nicht gestattet, Fehlercode 4085

(



3) Karte ist fremd reserviert, Fehlercode 4093

(



4) Nötige PIN ist nicht verifiziert, Fehlercode 4085

(



5) Verzeichnis, Datei existiert nicht, Fehlercode 4087

(



5-6) Verzeichnis deaktiviert, Fehlercode 4086

(



4-6) Karte antwortet mit einer spezifischen Fehlermeldung, Fehlercode
\<Kartenfehlercode gemäß [gemSpec_COS]\>

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
keine

</td></tr></table>

Tabelle90: TAB_KON_540 Fehlercodes TUC_KON_210 „SchreibeRecord“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4085

</td><td>
Security

</td><td>
Error

</td><td>
Zugriffsbedingungen nicht erfüllt

</td></tr><tr><td>
4086

</td><td>
Technical

</td><td>
Error

</td><td>
Verzeichnis deaktiviert

</td></tr><tr><td>
4087

</td><td>
Technical

</td><td>
Error

</td><td>
Datei nicht vorhanden

</td></tr><tr><td>
4088

</td><td>
Technical

</td><td>
Error

</td><td>
Datensatz zu groß

</td></tr><tr><td>
4093

</td><td>
Technical

</td><td>
Error

</td><td>
Karte wird in einer anderen Kartensitzung exklusiv verwendet

</td></tr><tr><td>
4094

</td><td>
Technical

</td><td>
Error

</td><td>
Timeout beim Kartenzugriff aufgetreten

</td></tr></table>

**[\<=]**

### 4.1.5.4.14 TUC_KON_211 „LöscheRecordInhalt“

##### TIP1-A_5477

Der Konnektor MUSS den technischen Use Case „LöscheRecordInhalt“ gemäß
TUC_KON_211 umsetzen.

Tabelle91: TAB_KON_211 – TUC_KON_211 „LöscheRecordInhalt“

<table><tr><th>
Element

</th><th>
Beschreibung

</th></tr><tr><td>
Name

</td><td>
TUC_KON_211 „LöscheRecordInhalt“

</td></tr><tr><td>
Beschreibung

</td><td>
Inhalt eines Records einer strukturierten Datei löschen

</td></tr><tr><td>
Auslöser

</td><td>
 ---> UL

</td></tr><tr><td>
Vorbedingungen

</td><td>
Die Karte MUSS den nötigen Sicherheitszustand für den Zugriff besitzen

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

 ---> UL

 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Karte, Kartenterminal, Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
keine

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

</td></tr><tr><td>
Varianten/

Alternativen

</td><td>
keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
* Karte antwortet nicht innerhalb von CARD_TIMEOUT_CARD Sekunden, Fehlercode 4094

(



2) Karte ist keine eGK der Generation 2 oder höher: Fehlercode 4209

(



3) Karte ist fremd reserviert, Fehlercode 4093

(



4) Nötige PIN ist nicht verifiziert, Fehlercode 4085

(



5) Verzeichnis, Datei oder Record existiert nicht, Fehlercode 4087

(



6) Verzeichnis deaktiviert, Fehlercode 4086

(



6) Record nicht vorhanden, Fehlercode 4091

(



5-6) Karte antwortet mit einer spezifischen Fehlermeldung, Fehlercode
\<Kartenfehlercode gemäß [gemSpec_COS]\>

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
Keine

</td></tr></table>

Tabelle92: TAB_KON_786 Fehlercodes TUC_KON_211 „LöscheRecordInhalt“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4085

</td><td>
Security

</td><td>
Error

</td><td>
Zugriffsbedingungen nicht erfüllt

</td></tr><tr><td>
4086

</td><td>
Technical

</td><td>
Error

</td><td>
Verzeichnis deaktiviert

</td></tr><tr><td>
4087

</td><td>
Technical

</td><td>
Error

</td><td>
Datei nicht vorhanden

</td></tr><tr><td>
4091

</td><td>
Technical

</td><td>
Error

</td><td>
Record nicht vorhanden

</td></tr><tr><td>
4093

</td><td>
Technical

</td><td>
Error

</td><td>
Karte wird in einer anderen Kartensitzung exklusiv verwendet

</td></tr><tr><td>
4094

</td><td>
Technical

</td><td>
Error

</td><td>
Timeout beim Kartenzugriff aufgetreten

</td></tr><tr><td>
4209

</td><td>
Technical

</td><td>
Error

</td><td>
Kartentyp %CardType% wird durch diese Operation nicht unterstützt.

</td></tr></table>

**[\<=]**

### 4.1.5.4.15 TUC_KON_214 „FügeHinzuRecord“

##### TIP1-A_4577

Der Konnektor MUSS den technischen Use Case „FügeHinzuRecord“ gemäß
TUC_KON_214 umsetzen.

Tabelle93: TAB_KON_228 – TUC_KON_214 „FügeHinzuRecord“

<table><tr><th>
Element

</th><th>
Beschreibung

</th></tr><tr><td>
Name

</td><td>
TUC_KON_214 „FuegeHinzuRecord"

</td></tr><tr><td>
Beschreibung

</td><td>
Daten in lineare Datei anfügen

</td></tr><tr><td>
Auslöser

</td><td>
 ---> UL

</td></tr><tr><td>
Vorbedingungen

</td><td>
Die Karte MUSS den nötigen Sicherheitszustand für den Zugriff besitzen

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Karte, Kartenterminal, Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
keine

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

</td></tr><tr><td>
Varianten/

Alternativen

</td><td>
keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
* Karte antwortet nicht innerhalb von CARD_TIMEOUT_CARD Sekunden, Fehlercode 4094

(



2) Schreibzugriff auf KVK nicht gestattet, Fehlercode 4085

(



3) Karte ist fremd reserviert, Fehlercode 4093

(



4) Nötige PIN ist nicht verifiziert, Fehlercode 4085

(



5-6) Verzeichnis, Datei existiert nicht, Fehlercode 4087

(



6) Verzeichnis deaktiviert, Fehlercode 4086

(



5-6) Karte antwortet mit einer spezifischen Fehlermeldung, Fehlercode
\<Kartenfehlercode gemäß [gemSpec_COS]\>

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
keine

</td></tr></table>

Tabelle94: TAB_KON_541 Fehlercodes TUC_KON_214 „FügeHinzuRecord“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4085

</td><td>
Security

</td><td>
Error

</td><td>
Zugriffsbedingungen nicht erfüllt

</td></tr><tr><td>
4086

</td><td>
Technical

</td><td>
Error

</td><td>
Verzeichnis deaktiviert

</td></tr><tr><td>
4087

</td><td>
Technical

</td><td>
Error

</td><td>
Datei nicht vorhanden

</td></tr><tr><td>
4093

</td><td>
Technical

</td><td>
Error

</td><td>
Karte wird in einer anderen Kartensitzung exklusiv verwendet

</td></tr><tr><td>
4094

</td><td>
Technical

</td><td>
Error

</td><td>
Timeout beim Kartenzugriff aufgetreten

</td></tr></table>

**[\<=]**

### 4.1.5.4.16 TUC_KON_215 „SucheRecord“

##### TIP1-A_4578

Der Konnektor MUSS den technischen Use Case „SucheRecord“ gemäß
TUC_KON_215 umsetzen.

Tabelle95: TAB_KON_229 – TUC_KON_215 „SucheRecord“

<table><tr><th>
Element

</th><th>
Beschreibung

</th></tr><tr><td>
Name

</td><td>
TUC_KON_215 „SucheRecord"

</td></tr><tr><td>
Beschreibung

</td><td>
Daten in linearer Datei suchen

</td></tr><tr><td>
Auslöser

</td><td>
 ---> UL

</td></tr><tr><td>
Vorbedingungen

</td><td>
Die Karte MUSS den nötigen Sicherheitszustand für den Zugriff besitzen

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Karte, Kartenterminal, Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

</td></tr><tr><td>
Varianten/

Alternativen

</td><td>
Keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
* Karte antwortet nicht innerhalb von CARD_TIMEOUT_CARD-Sekunden, Fehlercode 4094

(



2) Karte ist fremd reserviert, Fehlercode 4093

(



3) Nötige PIN ist nicht verifiziert, Fehlercode 4085

(



4-5) Verzeichnis, Datei existiert nicht, Fehlercode 4087

(



5) Verzeichnis deaktiviert, Fehlercode 4086

(



4-5) Karte antwortet mit einer spezifischen Fehlermeldung, Fehlercode
\<Kartenfehlercode gemäß [gemSpec_COS]\>

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
keine

</td></tr></table>

Tabelle96: TAB_KON_542 Fehlercodes TUC_KON_215 „SucheRecord“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4085

</td><td>
Security

</td><td>
Error

</td><td>
Zugriffsbedingungen nicht erfüllt

</td></tr><tr><td>
4086

</td><td>
Technical

</td><td>
Error

</td><td>
Verzeichnis deaktiviert

</td></tr><tr><td>
4087

</td><td>
Technical

</td><td>
Error

</td><td>
Datei nicht vorhanden

</td></tr><tr><td>
4093

</td><td>
Technical

</td><td>
Error

</td><td>
Karte wird in einer anderen Kartensitzung exklusiv verwendet

</td></tr><tr><td>
4094

</td><td>
Technical

</td><td>
Error

</td><td>
Timeout beim Kartenzugriff aufgetreten

</td></tr></table>

**[\<=]**

### 4.1.5.4.17 TUC_KON_018 „eGK-Sperrung prüfen“

##### TIP1-A_4579

Der Konnektor MUSS den technischen Use Case „eGK-Sperrung prüfen“ gemäß
TUC_KON_018 umsetzen.

Tabelle97: TAB_KON_110 - TUC_KON_018 „eGK-Sperrung prüfen“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_018 „eGK-Sperrung prüfen“

</td></tr><tr><td>
Beschreibung

</td><td>
Es wird geprüft, dass DF.HCA (Health Care Application) der eGK nicht gesperrt
ist und optional, dass das AUT-Zertifikat im DF.ESIGN gültig ist.  
Für eine
Karte ab der Generation G2.1 wird das AUT-Zertifikat (ECC) geprüft.  
Für
eine Karte der Generation G2.0 wird das AUT-Zertifikat (RSA) geprüft.

</td></tr><tr><td>
Auslöser

</td><td>
Aufruf durch Fachmodul im Konnektor

</td></tr><tr><td>
Vorbedingungen

</td><td>
keine

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor, Kartenterminal, eGK

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

    In allen anderen Fällen ist die Karte gesperrt = false.

</td></tr><tr><td>
Varianten/  
Alternativen

</td><td>
keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
(



2) Karte ist fremd reserviert, Fehlercode 4093

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
keine

</td></tr></table>

Tabelle98: TAB_KON_239 Fehlercodes TUC_KON_018 „eGK-Sperrung prüfen“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4093

</td><td>
Technical

</td><td>
Error

</td><td>
Karte wird in einer anderen Kartensitzung exklusiv verwendet

</td></tr></table>

**[\<=]**

### 4.1.5.4.18 TUC_KON_006 „Datenzugriffsaudit eGK schreiben“

##### TIP1-A_4580

Der Konnektor MUSS den technischen Use Case „Datenzugriffsaudit eGK
schreiben“ gemäß TUC_KON_006 umsetzen.

Tabelle99: TAB_KON_108 - TUC_KON_006 „Datenzugriffsaudit eGK schreiben“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_006 „Datenzugriffsaudit eGK schreiben“

</td></tr><tr><td>
Beschreibung

</td><td>
Zugriff auf eGK in EF.Logging protokollieren.

</td></tr><tr><td>
Auslöser

</td><td>
Aufruf durch ein Fachmodul

</td></tr><tr><td>
Vorbedingungen

</td><td>
Keine

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
eGK, HBA/SMC, Konnektor, Kartenterminal

</td></tr><tr><td>
Ausgangsdaten

</td><td>
Keine

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

</td></tr><tr><td>
Varianten/  
Alternativen

</td><td>
Keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
(



2) Protokoll nur für eGK gestattet, Fehlercode 4251

(



3) Karte ist fremd reserviert, Fehlercode 4093

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
keine

</td></tr></table>

Tabelle100: TAB_KON_238 Fehlercodes TUC_KON_006 „Datenzugriffsaudit eGK
schreiben“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4093

</td><td>
Technical

</td><td>
Error

</td><td>
Karte wird in einer anderen Kartensitzung exklusiv verwendet

</td></tr><tr><td>
4251

</td><td>
Technical

</td><td>
Error

</td><td>
Protokoll nur für eGK gestattet

</td></tr></table>

**[\<=]**

### 4.1.5.4.19 TUC_KON_218 „Signiere“

##### TIP1-A_4581

Der Konnektor MUSS den technischen Use Case „Signiere“ gemäß TUC_KON_218
umsetzen.

Tabelle101: TAB_KON_231 – TUC_KON_218 „Signiere“

<table><tr><th>
Element

</th><th>
Beschreibung

</th></tr><tr><td>
Name

</td><td>
TUC_KON_218 „Signiere“

</td></tr><tr><td>
Beschreibung

</td><td>
Dieser Use Case beschreibt das Anwenden eines privaten Schlüssels einer Karte
zur Signatur oder Authentisierung.

</td></tr><tr><td>
Auslöser

</td><td>
 ---> UL

</td></tr><tr><td>
Vorbedingungen

</td><td>
Zugriffsbedingung für referenzierten Schlüssel MUSS erfüllt sein

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Karte, Kartenterminal, Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

</td></tr><tr><td>
Varianten/

Alternativen

</td><td>
Keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
* Karte antwortet nicht innerhalb von CARD_TIMEOUT_CARD Sekunden, Fehlercode 4094

(



2) Karte ist fremd reserviert, Fehlercode 4093

(



3) Nötige PIN ist nicht verifiziert, Fehlercode 4085

(



5) Karte antwortet mit einer spezifischen Fehlermeldung, Fehlercode
\<Kartenfehlercode gemäß [gemSpec_COS]\>

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
Keine

</td></tr></table>

Tabelle102: TAB_KON_543 Fehlercodes TUC_KON_218 „Signiere“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4085

</td><td>
Security

</td><td>
Error

</td><td>
Zugriffsbedingungen nicht erfüllt

</td></tr><tr><td>
4093

</td><td>
Technical

</td><td>
Error

</td><td>
Karte wird in einer anderen Kartensitzung exklusiv verwendet

</td></tr><tr><td>
4094

</td><td>
Technical

</td><td>
Error

</td><td>
Timeout beim Kartenzugriff aufgetreten

</td></tr></table>

**[\<=]**

### 4.1.5.4.20 TUC_KON_219 „Entschlüssele“

##### TIP1-A_4582

Der Konnektor MUSS den technischen Use Case „Entschlüssele“ gemäß
TUC_KON_219 umsetzen.

Tabelle103: TAB_KON_232 – TUC_KON_219 „Entschlüssele“

<table><tr><th>
Element

</th><th>
Beschreibung

</th></tr><tr><td>
Name

</td><td>
TUC_KON_219 „Entschlüssele“

</td></tr><tr><td>
Beschreibung

</td><td>
Dieser Use Case beschreibt das Anwenden eines privaten Schlüssels einer Karte
zur Entschlüsselung.

</td></tr><tr><td>
Auslöser

</td><td>
 ---> UL

</td></tr><tr><td>
Vorbedingungen

</td><td>
Zugriffsbedingung für referenzierten Schlüssel muss erfüllt sein

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Karte(n), Kartenterminal, Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

</td></tr><tr><td>
Varianten/

Alternativen

</td><td>
Keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
* Karte antwortet nicht innerhalb von CARD_TIMEOUT_CARD Sekunden, Fehlercode 4094

(



2) Karte ist fremd reserviert, Fehlercode 4093

(



3) Nötige PIN ist nicht verifiziert, Fehlercode 4085

(



5) Schlüssel nicht vorhanden, Fehlercode 4079

(



6) Fehler im Chiffrat: Fehlercode 4069

(



4, 6) Karte antwortet mit einer spezifischen Fehlermeldung, Fehlercode
\<Kartenfehlercode gemäß [gemSpec_COS]\>

</td></tr><tr><td>
Varianten/

Alternativen

</td><td>
Keine

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
Keine

</td></tr></table>

Tabelle104: TAB_KON_210 Fehlercodes TUC_KON_219 „Entschlüssele“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4069

</td><td>
Technical

</td><td>
Error

</td><td>
korruptes Chiffrat bei asymmetrischer Entschlüsselung

</td></tr><tr><td>
4079

</td><td>
Technical

</td><td>
Error

</td><td>
Schlüsseldaten fehlen

</td></tr><tr><td>
4085

</td><td>
Security

</td><td>
Error

</td><td>
Zugriffsbedingungen nicht erfüllt

</td></tr><tr><td>
4093

</td><td>
Technical

</td><td>
Error

</td><td>
Karte wird in einer anderen Kartensitzung exklusiv verwendet

</td></tr><tr><td>
4094

</td><td>
Technical

</td><td>
Error

</td><td>
Timeout beim Kartenzugriff aufgetreten

</td></tr></table>

**[\<=]**

### 4.1.5.4.21 TUC_KON_200 „SendeAPDU“

##### TIP1-A_4583

Der Konnektor MUSS den technischen Use Case „SendeAPDU“ gemäß TUC_KON_200
umsetzen.

Tabelle105: TAB_KON_215 TUC_KON_200 „SendeAPDU“

<table><tr><th>
Element

</th><th>
Beschreibung

</th></tr><tr><td>
Name

</td><td>
TUC_KON_200 „SendeAPDU“

</td></tr><tr><td>
Beschreibung

</td><td>
Dieser Use Case beschreibt das Senden einer APDU an eine Chipkarte bzw. an ein
Kartenterminal und das Empfangen der Antwort.

</td></tr><tr><td>
Auslöser

</td><td>
 ---> UL

</td></tr><tr><td>
Vorbedingungen

</td><td>
Zugriffsbedingungen für das Kommando müssen in der Karte erfüllt sein und
Karte muss für exklusiven Zugriff reserviert worden sein

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Karte(n), Kartenterminal, Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
A. cardSession ist gegeben

 ---> OL

B. ctId ist gegeben

 ---> OL

</td></tr><tr><td>
Varianten/Alternativen

</td><td>
 ---> UL

</td></tr><tr><td>
Fehlerfälle

</td><td>
* Karte antwortet nicht innerhalb von CARD_TIMEOUT_CARD Sekunden, Fehlercode 4094

(



2) Der Aufrufer ist nicht im Besitz des Karten-Locks, Fehlercode 4232

(



3) Kommunikationsfehler mit dem Kartenterminal: Fehlercode 4044.

(



3) Karte antwortet mit einer spezifischen Fehlermeldung, Fehlercode
\<Kartenfehlercode gemäß [gemSpec_COS]\>

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
keine

</td></tr></table>

Tabelle106: TAB_KON_216 Fehlercodes TUC_KON_200 „SendeAPDU“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4044

</td><td>
Technical

</td><td>
Error

</td><td>
Fehler beim Zugriff auf das Kartenterminal

</td></tr><tr><td>
4094

</td><td>
Technical

</td><td>
Error

</td><td>
Timeout beim Kartenzugriff aufgetreten

</td></tr><tr><td>
4232

</td><td>
Technical

</td><td>
Error

</td><td>
der Aufrufer besitzt nicht das Karten-Lock

</td></tr></table>

**[\<=]**

### 4.1.5.4.22 TUC_KON_024 „Karte zurücksetzen“

##### TIP1-A_4584

Der Konnektor MUSS den technischen Use Case „Karte zurücksetzen“ gemäß
TUC_KON_024 umsetzen.

Tabelle107: TAB_KON_737 – TUC_KON_024 „Karte zurücksetzen“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_024 „Karte zurücksetzen“

</td></tr><tr><td>
Beschreibung

</td><td>
Der technische Use Case setzt die gewählte Karte zurück (alle erreichten
Sicherheitszustände werden auf der Karte und in der Verwaltung des Konnektors
zurückgesetzt; auf der Karte wird MF selektiert). Ein eventuell laufendes C2C
wird dabei abgebrochen.

</td></tr><tr><td>
Auslöser

</td><td>
Fachmodul

</td></tr><tr><td>
Vorbedingungen

</td><td>
keine

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Karte, Kartenterminal, Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
Keine

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

</td></tr><tr><td>
Varianten/  
Alternativen

</td><td>
Keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
* Karte antwortet nicht innerhalb von CARD_TIMEOUT_CARD Sekunden, Fehlercode 4094

(



2) Der Aufrufer ist nicht im Besitz des Karten-Locks, Fehlercode 4232

(



4) Karte antwortet mit einer spezifischen Fehlermeldung, Fehlercode
\<Kartenfehlercode gemäß [gemSpec_COS]\>

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
Keine

</td></tr></table>

Tabelle108: TAB_KON_544 Fehlercodes TUC_KON_024 „Karte zurücksetzen“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4094

</td><td>
Technical

</td><td>
Error

</td><td>
Timeout beim Kartenzugriff aufgetreten

</td></tr><tr><td>
4232

</td><td>
Technical

</td><td>
Error

</td><td>
der Aufrufer ist nicht im Besitz des Karten-Locks

</td></tr></table>

**[\<=]**

### 4.1.5.4.23 TUC_KON_216 „LeseZertifikat“

##### TIP1-A_4585

Der Konnektor MUSS den technischen Use Case „LeseZertifikat“ gemäß
TUC_KON_216 umsetzen.

Tabelle109: TAB_KON_230 – TUC_KON_216 „LeseZertifikat“

<table><tr><th>
Element

</th><th>
Beschreibung

</th></tr><tr><td>
Name

</td><td>
TUC_KON_216 „LeseZertifikat“

</td></tr><tr><td>
Beschreibung

</td><td>
Dieser Use Case beschreibt das Lesen eines Zertifikates von einer Karte

</td></tr><tr><td>
Auslöser

</td><td>
 ---> UL

</td></tr><tr><td>
Vorbedingungen

</td><td>
Keine

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Karte, Kartenterminal, Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

</td></tr><tr><td>
Varianten/  
Alternativen

</td><td>
Keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
(2) Karte ist fremd reserviert, Fehlercode 4093  
(-\>4) Es wurde versucht,
ein Zertifikat von der Karte zu lesen, welches auf der Karte nicht vorhanden
ist (Fehlercode 4256). Hierbei kann es sich um ein fehlendes Zertifikatsobjekt
(z.B. adressiertes ECC-Zertifikat auf HBA G2.0) oder ein leeres
Zertifikatsobjekt (z.B. adressiertes ECC-Zertifikat auf gSMC-K G2.0, welches
aber nicht personalisiert wurde) handeln.

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
Keine

</td></tr></table>

Tabelle110: TAB_KON_209 Fehlercodes TUC_KON_216 „LeseZertifikat“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4093

</td><td>
Technical

</td><td>
Error

</td><td>
Karte wird in einer anderen Kartensitzung exklusiv verwendet

</td></tr><tr><td>
4256

</td><td>
Technical

</td><td>
Warning

</td><td>
Zertifikat auf Karte nicht vorhanden

</td></tr></table>

**[\<=]**

### 4.1.5.4.24 TUC_KON_036 „LiefereFachlicheRolle“

##### TIP1-A_5478

Der Konnektor MUSS den technischen Use Case TUC_KON_036
„LiefereFachlicheRolle” umsetzen.

Tabelle111: TAB_KON_827 TUC_KON_036 „LiefereFachlicheRolle“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_036 „LiefereFachlicheRolle“

</td></tr><tr><td>
Beschreibung

</td><td>
Dieser TUC liefert die fachliche Rolle, die der OID aus dem X.509Zertifikat der
gesteckten Karte zugeordnet ist.

Es werden nur folgende Karten unterstützt:  
HBAx, SM-B, EGK, KVK

Es werden nur die AUT-Zertifikate ausgelesen.  
Für eine Karte ab der
Generation G2.1 wird das AUT-Zertifikat (ECC) geprüft.  
Für eine Karte der
Generation G2.0 wird das AUT-Zertifikat (RSA) geprüft.

</td></tr><tr><td>
Auslöser

</td><td>
 ---> UL

</td></tr><tr><td>
Vorbedingungen

</td><td>
Keine

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor, Karte

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Nachbedingungen

</td><td>
Keine

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

</td></tr><tr><td>
Varianten/  
Alternativen

</td><td>
Keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
* Karte antwortet nicht innerhalb von CARD_TIMEOUT_CARD Sekunden, Fehlercode 4094

(



2) Karte ist fremd reserviert, Fehlercode 4093

(



7) ProfessionOIDs mappen nicht auf die gleiche Rolle, Fehlercode 4210

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
keine

</td></tr></table>

Tabelle112: TAB_KON_829 Fehlercodes TUC_KON_036 „LiefereFachlicheRolle“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4093

</td><td>
Technical

</td><td>
Error

</td><td>
Karte wird in einer anderen Kartensitzung exklusiv verwendet

</td></tr><tr><td>
4094

</td><td>
Technical

</td><td>
Error

</td><td>
Timeout beim Kartenzugriff aufgetreten

</td></tr><tr><td>
4210

</td><td>
Technical

</td><td>
Error

</td><td>
ProfessionOIDs nicht eindeutig auf eine Rolle abbildbar

</td></tr></table>

**[\<=]**

### 4.1.5.5 Operationen an der Außenschnittstelle

##### TIP1-A_4586-03

Der Konnektor MUSS für Clients eine Basisanwendung Kartendienst mit den
Operationen VerifyPin, ChangePin, UnblockPin, GetPinStatus an der
Außenschnittstelle anbieten.

Tabelle113: TAB_KON_038 Basisanwendung Karten- und Kartenterminaldienst

<table><tr><th>
Name

</th><th colspan="2">
CardService

</th></tr><tr><td>
Version (KDV)

</td><td colspan="2">
8.1.0 (WSDL- und XSD-Version)

8.1.1 (WSDL- und XSD-Version)  
8.1.2 (WSDL-Version) 8.1.3 (XSD-Version)

</td></tr><tr><td>
Namensraum

</td><td colspan="2">
Siehe GitHub

</td></tr><tr><td>
Namensraum-Kürzel

</td><td colspan="2">
CARD für Schema und CARDW für WSDL

</td></tr><tr><td rowspan="7">
Operationen

</td><td>
Name

</td><td>
Kurzbeschreibung

</td></tr><tr><td>
VerifyPin

</td><td>
PIN prüfen

</td></tr><tr><td>
ChangePin

</td><td>
PIN ändern

</td></tr><tr><td>
UnblockPin

</td><td>
PIN entsperren

</td></tr><tr><td>
GetPinStatus

</td><td>
PIN-Status ermitteln

</td></tr><tr><td>
EnablePin

</td><td>
Erfordernis der PIN-Verifikation einschalten

</td></tr><tr><td>
DisablePin

</td><td>
Erfordernis der PIN-Verifikation abschalten

</td></tr><tr><td>
WSDL

</td><td colspan="2">
CardService.wsdl (WSDL-Version 8.1.0)  
CardService_v8_1_1.wsdl 

CardService_v8_1_2.wsdl

</td></tr><tr><td>
Schema

</td><td colspan="2">
CardService.xsd (XSD-Version 8.1.0)  
CardService_v8_1_1.xsd 

CardService_v8_1_3.xsd

</td></tr></table>

**[\<=]**

### 4.1.5.5.1 VerifyPin

##### TIP1-A_4587

Der Konnektor MUSS an der Außenschnittstelle eine Operation VerifyPin, wie in
Tabelle TAB_KON_047 Operation VerifyPin beschrieben, anbieten.

Tabelle114: TAB_KON_047 Operation VerifyPin

<table><tr><th>
Name

</th><th colspan="3">
VerifyPin

</th></tr><tr><td>
Beschreibung

</td><td colspan="3">
Stößt die sichere Eingabe einer PIN am PIN-Pad des Kartenterminals für eine
Karte an.

Das Ergebnis der PIN-Prüfung gibt Auskunft darüber, ob die PIN richtig oder
falsch war oder aufgrund zu vieler Fehlversuche blockiert ist.

Eine Karte kann potentiell mehrere PINs haben. Insbesondere für die
qualifizierte elektronische Signatur existiert eine separate PIN. Diese PIN
darf nur über das PIN-Pad eingegeben werden.

Die PIN-Verifikation und die damit verbundene Änderung des Sicherheitsstatus
der Karte erfolgt nur für die durch den Aufrufkontext adressierte
Kartensitzung. Falls die Karte in einem zentralen Kartenterminal steckt, auf
das der Arbeitsplatz Zugriff hat, erfolgt eine Remote-PIN-Eingabe. Das
Kartenterminal für die PIN-Eingabe ergibt sich dabei aus der im Aufrufkontext
angegebenen Mandanten-ID und Arbeitsplatz-ID

Diese Operation entspricht dem Aufruf von

TUC_KON_012 „PIN verifizieren“. Dort sind auch die Display Messages
definiert, die bei PIN-Eingabe am Kartenterminal anzuzeigen sind (TAB_KON_090
Terminalanzeigen beim Eingeben der PIN am Kartenterminal). Die beim Aufruf von
TUC_KON_012 anzugebende PIN-Art lautet „mandatorisch“. Die PIN-Verifikation
wird also unabhängig vom erreichten Sicherheitsstatus in der Karte immer
durchgeführt.

</td></tr><tr><td rowspan="5">
Aufrufparameter

</td><td colspan="3">
![Img-017][Img-017]

</td></tr><tr><td>
Name

</td><td colspan="2">
Beschreibung

</td></tr><tr><td>
Context

</td><td colspan="2">
MandantId, CsId, WorkplaceId verpflichtend; UserId verpflichtend für HBAx

</td></tr><tr><td>
CardHandle

</td><td colspan="2">
Adressiert die Karte, für die die PIN verifiziert werden soll.

Die Operation DARF die PIN-Verifikation mit der eGK NICHT unterstützen.
Unterstützt werden die Kartentypen HBAx und SM-B. Wird die Operation mit einem
nicht unterstützten Kartentypen aufgerufen, so MUSS der Konnektor die
Bearbeitung mit dem Fehler 4209 abbrechen.

</td></tr><tr><td>
PinTyp

</td><td colspan="2">
Gibt an, welche PIN der Karte verifiziert werden soll.

Erlaubte Belegung von PinTyp

in Abhängigkeit der durch Cardhandle referenzierten Karte:

 ---> UL

</td></tr><tr><td rowspan="11">
Rückgabe

</td><td colspan="3">
![Img-018][Img-018]

</td></tr><tr><td>
Name

</td><td colspan="2">
Beschreibung

</td></tr><tr><td>
Status

</td><td colspan="2">
Enthält den Ausführungsstatus der Operation (siehe

3.5.2)

</td></tr><tr><td rowspan="7">
PinResult

</td><td>
Wert

</td><td>
Bedeutung

</td></tr><tr><td>
OK

</td><td>
Prüfung war erfolgreich

</td></tr><tr><td>
REJECTED

</td><td>
PIN war falsch. Die Anzahl der verbleibenden Versuche ist im Element

LeftTries

</td></tr><tr><td>
ERROR

</td><td>
Ein Bearbeitungsfehler ist aufgetreten. Fehlerursache im Feld

Error

</td></tr><tr><td>
WASBLOCKED

</td><td>
PIN war zum Aufrufzeitpunkt bereits gesperrt

</td></tr><tr><td>
NOWBLOCKED

</td><td>
PIN ist durch aktuellen Fehlversuch

gesperrt

</td></tr><tr><td>
TRANSPORT

_PIN

</td><td>
PIN ist mit Transportschutz versehen

</td></tr><tr><td>
LeftTries

</td><td colspan="2">
Im Falle von

Result

=

REJECTED

wird hier die Anzahl der verbleibenden möglichen Versuche zurückgegeben.

</td></tr><tr><td>
Vorbedingung

</td><td colspan="3">
Keine

</td></tr><tr><td>
Nachbedingung

</td><td colspan="3">
keine

</td></tr></table>

Der Ablauf der Operation VerifyPin ist in Tabelle TAB_KON_738 Ablauf VerifyPin
beschrieben.

Tabelle115: TAB_KON_738 Ablauf VerifyPin

<table><tr><th>
Nr.

</th><th>
Aufruf Technischer

Use Case oder

Interne Operation

</th><th>
Beschreibung

</th></tr><tr><td>
1.

</td><td>
checkArguments

</td><td>
Die übergebenen Werte werden auf Konsistenz und Gültigkeit überprüft. Treten
hierbei Fehler auf, so bricht die Operation mit Fehler 4000 ab.

</td></tr><tr><td>
2.

</td><td>
TUC_KON_000 „Prüfe Zugriffs-berechtigung“

</td><td>
Prüfung der Zugriffsberechtigung durch den Aufruf

TUC_KON_000 {

    mandantId = $context.mandantId;

    clientSystemId = $context.clientsystemId;

    workplaceId = $context.workplaceId;

    userId = $context.userId;

    cardHandle }

Tritt bei der Prüfung ein Fehler auf, bricht die Operation mit Fehlercode aus
TUC_KON_000 ab.

</td></tr><tr><td>
3.

</td><td>
TUC_KON_026 „Liefere CardSession“

</td><td>
Ermittle cardSession über TUC_KON_026 {

    mandatId =$context.mandantId;

    clientsystemId  = $context.clientsystemId;

    userId = $context.userId;

    cardHandle }

</td></tr><tr><td>
4.

</td><td>
TUC_KON_012 „PIN verifizieren“

</td><td>
Verifiziere PIN über TUC_KON_012 {

    cardSession;

    workplaceId = $context.workplaceId;

    pinRef = PinRef(PinTyp);

    appName = „” (Leerstring);

    verificationType = Mandatorisch }

</td></tr><tr><td>
5.

</td><td>
Verifikationsergebnis auswerten

</td><td>
Wenn TUC_KON_012 mit Fehler 4065 abbricht, wird dies als erfolgreicher
Operationsdurchlauf mit PinResult= TRANSPORT_PIN abgefangen.

Wenn TUC_KON_012 den Returncode BLOCKED liefert, wird dies als erfolgreicher
Operationsdurchlauf mit PinResult= NOWBLOCKED zurückgegeben.

Wenn TUC_KON_012 mit Fehler 4063 abbricht, wird dies als erfolgreicher
Operationsdurchlauf mit PinResult= WASBLOCKED zurückgegeben

</td></tr></table>

Tabelle116: TAB_KON_545 Fehlercodes „VerifyPin“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4000

</td><td>
Technical

</td><td>
Error

</td><td>
Syntaxfehler

</td></tr><tr><td>
4078

</td><td>
Security

</td><td>
Error

</td><td>
PIN-Eingabe über das Clientsystem ist nicht zugelassen

</td></tr><tr><td>
4209

</td><td>
Technical

</td><td>
Error

</td><td>
Kartentyp %CardType% wird durch diese Operation nicht unterstützt.

</td></tr></table>

**[\<=]**

### 4.1.5.5.2 ChangePin

##### TIP1-A_4588

Der Konnektor MUSS an der Außenschnittstelle eine Operation ChangePin, wie in
Tabelle TAB_KON_049 Operation ChangePin beschrieben, anbieten.

Tabelle117: TAB_KON_049 Operation ChangePin

<table><tr><th>
Name

</th><th colspan="3">
ChangePin

</th></tr><tr><td>
Beschreibung

</td><td colspan="3">
Ändert eine PIN einer Karte. Alte und neue PIN

werden

dabei am PIN-Pad des Kartenterminals eingegeben.

Falls die Karte in einem zentralen Kartenterminal steckt, auf das der im
Aufrufkontext angegebene Arbeitsplatz Zugriff hat, erfolgt eine
Remote-PIN-Eingabe.

Diese Operation entspricht dem Aufruf TUC_KON_019 „PIN ändern

“

.

</td></tr><tr><td rowspan="5">
Aufrufparameter

</td><td colspan="3">
![Img-019][Img-019]

</td></tr><tr><td>
Name

</td><td colspan="2">
Beschreibung

</td></tr><tr><td>
Context

</td><td colspan="2">
MandantId, CsId, WorkplaceId verpflichtend; UserId optional (verpflichtend beim
HBA)

</td></tr><tr><td>
CardHandle

</td><td colspan="2">
Adressiert die Karte, für die die PIN geändert werden soll. Unterstützt
werden die Kartentypen EGK, HBAx und SM-B. Wird die Operation mit einem nicht
unterstützten Kartentypen aufgerufen, so MUSS der Konnektor die Bearbeitung
mit dem Fehler 4209 abbrechen.

</td></tr><tr><td>
PinTyp

</td><td colspan="2">
Gibt an, welche PIN der Karte geändert werden soll.

Erlaubte Belegung von PinTyp in Abhängigkeit der durch

CardHandle referenzierten Karte:

 ---> UL

</td></tr><tr><td rowspan="11">
Rückgabe

</td><td colspan="3">
![Img-020][Img-020]

</td></tr><tr><td>
Name

</td><td colspan="2">
Beschreibung

</td></tr><tr><td>
LeftTries

</td><td colspan="2">
Im Falle von

REJECTED

wird hier die Anzahl der verbleibenden möglichen Versuche zurückgegeben.

</td></tr><tr><td>
Status

</td><td colspan="2">
Enthält den Ausführungsstatus der Operation

,

siehe 3.5.2

</td></tr><tr><td colspan="3">
</td></tr><tr><td rowspan="6">
PinResult

</td><td>
Wert

</td><td>
Bedeutung

</td></tr><tr><td>
OK

</td><td>
PIN-Änderung war erfolgreich

</td></tr><tr><td>
ERROR

</td><td>
Ein Bearbeitungsfehler ist aufgetreten. Fehlerursache im Feld

Error

</td></tr><tr><td>
REJECTED

</td><td>
OldPIN war falsch Die Anzahl der verbleibenden Versuche ist im Element

LeftTries

</td></tr><tr><td>
WASBLOCKED

</td><td>
PIN war zum Aufrufzeitpunkt bereits gesperrt

</td></tr><tr><td>
NOWBLOCKED

</td><td>
PIN ist durch aktuellen Fehlversuch gesperrt

</td></tr><tr><td>
Vorbedingung

</td><td colspan="3">
Keine

</td></tr><tr><td>
Nachbedingung

</td><td colspan="3">
keine

</td></tr></table>

Tabelle118: TAB_KON_546 Ablauf ChangePin

<table><tr><th>
Nr.

</th><th>
Aufruf Technischer Use Case oder Interne Operation

</th><th>
Beschreibung

</th></tr><tr><td>
1.

</td><td>
checkArguments

</td><td>
Die übergebenen Werte werden auf Konsistenz und Gültigkeit überprüft. Treten
hierbei Fehler auf, so bricht die Operation mit Fehler 4000 ab.

</td></tr><tr><td>
2.

</td><td>
TUC_KON_000 „Prüfe Zugriffs-berechtigung“

</td><td>
Prüfung der Zugriffsberechtigung durch den Aufruf

TUC_KON_000 {

    mandantId = $context.mandantId;

    clientSystemId = $context.clientsystemId;

    workplaceId = $context.workplaceId;

    userId = $context.userId;

    cardHandle }

Tritt bei der Prüfung ein Fehler auf, bricht die Operation mit Fehlercode aus
TUC_KON_000 ab.

</td></tr><tr><td>
3.

</td><td>
TUC_KON_026 „Liefere CardSession“

</td><td>
Ermittle cardSession über TUC_KON_026 {

    mandantId =$context.mandantId;

    clientsystemId  = $context.clientsystemId;

    cardHandle;

    userId = $context.userId }

</td></tr><tr><td>
4.

</td><td>
TUC_KON_019 „PIN ändern“

</td><td>
Ändere PIN über TUC_KON_019 {

    cardSession;

    workplaceId = $context.workplaceId;

    pinRef = PinRef(PinTyp) }

</td></tr><tr><td>
5.

</td><td>
Verifikationsergebnis auswerten

</td><td>
Wenn TUC_KON_019 den Returncode BLOCKED liefert, wird dies als erfolgreicher
Operationsdurchlauf mit PinResult= NOWBLOCKED zurückgegeben.

Wenn TUC_KON_019 mit Fehler 4063 abbricht, wird dies als erfolgreicher
Operationsdurchlauf mit PinResult= WASBLOCKED zurückgegeben.

</td></tr></table>

Tabelle119: TAB_KON_547 Fehlercodes „ChangePin“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4000

</td><td>
Technical

</td><td>
Error

</td><td>
Syntaxfehler

</td></tr><tr><td>
4072

</td><td>
Technical

</td><td>
Error

</td><td>
Ungültige PIN-Referenz

PinRef

</td></tr><tr><td>
4209

</td><td>
Technical

</td><td>
Error

</td><td>
Kartentyp %CardType% wird durch diese Operation nicht unterstützt.

</td></tr></table>

**[\<=]**

### 4.1.5.5.3 GetPinStatus

##### TIP1-A_4589

Der Konnektor MUSS an der Außenschnittstelle eine Operation GetPinStatus, wie
in Tabelle TAB_KON_051 Operation GetPinStatus beschrieben, anbieten.

Tabelle120: TAB_KON_051 Operation GetPinStatus

<table><tr><th>
Name

</th><th colspan="4">
GetPinStatus

</th></tr><tr><td>
Beschreibung

</td><td colspan="4">
Diese Operation gibt Auskunft über den PIN-Zustand einer

Karte.

Für

transportgeschützte PIN gibt die Operation

die

Art des Transportschutzes an.

Für Echt-PINs kann mit dieser Operation die Anzahl der noch verbleibenden
Versuche für PIN-Verifikationen ermittelt werden oder ob die PIN bereits
verifiziert wurde.

</td></tr><tr><td rowspan="5">
Aufruf-parameter

</td><td colspan="4">
![Img-021][Img-021]

</td></tr><tr><td colspan="2">
Name

</td><td colspan="2">
Beschreibung

</td></tr><tr><td colspan="2">
Context

</td><td colspan="2">
MandantId, CsId, WorkplaceId; UserId

</td></tr><tr><td colspan="2">
CardHandle

</td><td colspan="2">
Adressiert die Karte, für die der PIN-Status ermittelt werden soll.
Unterstützt werden die Kartentypen

EGK, HBAx und SM-B.

Eine KVK ist nicht zulässig.

Wird die Operation mit einem nicht unterstützten Kartentypen aufgerufen, so
MUSS der Konnektor die Bearbeitung mit dem Fehler 4209 abbrechen.

</td></tr><tr><td colspan="2">
PinTyp

</td><td colspan="2">
Gibt an, für welche PIN der Karte der PIN-Status ermittelt werden soll.

Erlaubte Belegung von PinTyp in Abhängigkeit der durch Cardhandle
referenzierten Karte:

 ---> UL

 ---> UL

 ---> UL

</td></tr><tr><td rowspan="12">
Rückgabe

</td><td colspan="4">
![Img-022][Img-022]

</td></tr><tr><td>
Name

</td><td colspan="3">
Beschreibung

</td></tr><tr><td>
Status

</td><td colspan="3">
Enthält den Ausführungsstatus der Operation siehe

3.5.2

</td></tr><tr><td rowspan="8">
PinStatus

</td><td colspan="3">
Status der PIN. Die folgenden Werte sind verpflichtend:

</td></tr><tr><td colspan="2">
Wert

</td><td>
Bedeutung

</td></tr><tr><td colspan="2">
VERIFIED

</td><td>
Bereits verifiziert

(in

CARDSESSION.AUTHSTATE

vorhanden)

</td></tr><tr><td colspan="2">
TRANSPORT_PIN

</td><td>
Transport-PIN

</td></tr><tr><td colspan="2">
EMPTY_PIN

</td><td>
Leer-PIN

</td></tr><tr><td colspan="2">
BLOCKED

</td><td>
gesperrt

</td></tr><tr><td colspan="2">
VERIFIABLE

</td><td>
Echt-PIN,

noch nicht verifiziert

</td></tr><tr><td colspan="2">
DISABLED

</td><td>
PIN-Schutz ausgeschaltet (Verifikation nicht erforderlich)

</td></tr><tr><td>
LeftTries

</td><td colspan="3">
Bei einer Echt-PIN wird hier

bei

PinStatus =

VERIFIABLE

die Anzahl der verbleibenden möglichen Versuche für die Verifikation der PIN
zurückgegeben, bei einer gesperrten PIN 0.

</td></tr><tr><td>
Vorbedingung

</td><td colspan="4">
keine

</td></tr><tr><td>
Nachbe-dingung

</td><td colspan="4">
keine

</td></tr></table>

Tabelle121: TAB_KON_548 Ablauf GetPinStatus

<table><tr><th>
Nr .

</th><th>
Aufruf Technischer Use Case oder Interne Operation

</th><th>
Beschreibung

</th></tr><tr><td>
1.

</td><td>
checkArguments

</td><td>
Die übergebenen Werte werden auf Konsistenz und Gültigkeit überprüft. Treten
hierbei Fehler auf, so bricht die Operation mit Fehler 4000 ab.

</td></tr><tr><td>
2.

</td><td>
TUC_KON_000 „Prüfe Zugriffs- berechtigung“

</td><td>
Prüfung der Zugriffsberechtigung durch den Aufruf

TUC_KON_000 {

    mandantId = $context.mandantId;

    clientSystemId = $context.clientsystemId;

    workplaceId = $context.workplaceId;

    userId = $context.userId;  // falls angegeben

    cardHandle }

Tritt bei der Prüfung ein Fehler auf, so bricht die Operation mit dem
Fehlercode aus TUC_KON_000 ab.

</td></tr><tr><td>
3.

</td><td>
TUC_KON_026 „Liefere CardSession“

</td><td>
Ermittle cardSession über TUC_KON_026 {

    mandantId = $context.mandantId;

    clientSystemId = $context.clientsystemId;

    userId = $context.userId;  // falls angegeben ;

    cardHandle }

</td></tr><tr><td>
4.

</td><td>
TUC_KON_022 „Liefere PIN-Status“

</td><td>
Ermittle PinStatus über TUC_KON_022 {

    cardSession;

    pinRef = PinRef(PinTyp) }

</td></tr></table>

Tabelle122: TAB_KON_549 Fehlercodes „GetPinStatus“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4000

</td><td>
Technical

</td><td>
Error

</td><td>
Syntaxfehler

</td></tr><tr><td>
4001

</td><td>
Technical

</td><td>
Error

</td><td>
interner Fehler

</td></tr><tr><td>
4072

</td><td>
Technical

</td><td>
Error

</td><td>
ungültige PIN-Referenz

PinRef

</td></tr><tr><td>
4209

</td><td>
Technical

</td><td>
Error

</td><td>
Kartentyp %CardType% wird durch diese Operation nicht unterstützt.

</td></tr></table>

**[\<=]**

### 4.1.5.5.4 UnblockPin

##### TIP1-A_4590

Der Konnektor MUSS an der Außenschnittstelle eine Operation UnblockPin, wie in
Tabelle TAB_KON_053 Operation UnblockPin beschrieben, anbieten.

Tabelle123: TAB_KON_053 Operation UnblockPin

<table><tr><th>
Name

</th><th colspan="3">
UnblockPin

</th></tr><tr><td>
Beschreibung

</td><td colspan="3">
Mit diesem Kommando kann eine blockierte PIN wieder freigeschaltet werden. Dabei
wird der Wiederholungszähler für diese PIN in der Karte auf seinen
Anfangswert zurückgesetzt und es KANN eine neue PIN gesetzt werden. Um diese
Aktion durchführen zu können, muss eine PUK (auch als Resetting Code
bezeichnet) präsentiert werden.

PIN und PUK werden am PIN-Pad des Kartenterminals eingegeben.

Falls die Karte in einem zentralen Kartenterminal steckt, auf das der im
Aufrufkontext angegebene Arbeitsplatz Zugriff hat, erfolgt eine
Remote-PIN-Eingabe. Das Kartenterminal für die PIN-Eingabe ergibt sich dabei
aus der im Aufrufkontext angegebenen Mandanten-ID und Arbeitsplatz-ID.

Diese Operation entspricht dem Aufruf von TUC_KON_021 „PIN entsperren“.

</td></tr><tr><td rowspan="6">
Aufruf-parameter

</td><td colspan="3">
![Img-023][Img-023]

</td></tr><tr><td>
Name

</td><td colspan="2">
Beschreibung

</td></tr><tr><td>
Context

</td><td colspan="2">
MandantId, CsId, WorkplaceId verpflichtend; UserId (optional, für HBA
verpflichtend)

</td></tr><tr><td>
CardHandle

</td><td colspan="2">
Adressiert die Karte, für die die Blockierung der PIN aufgehoben werden soll.
Unterstützt werden die Kartentypen EGK, HBAx und SM-B. Wird die Operation mit
einem nicht unterstützten Kartentypen aufgerufen, so MUSS der

Konnektor die Bearbeitung mit dem Fehler 4209 abbrechen.

</td></tr><tr><td>
PinTyp

</td><td colspan="2">
Gibt an, für welche PIN der Karte die Blockierung aufgehoben werden soll.

Erlaubte Belegung von PinTyp in Abhängigkeit der durch Cardhandle
referenzierten Karte:

  -   eGK G1+: PIN.CH

 -   eGK G2: PIN.CH,  MRPIN.NFD, MRPIN.NFD_READ,

    MRPIN.DPE, MRPIN.GDD, MRPIN.OSE, MRPIN.AMTS,

   PIN.AMTS_REP

   - zusätzlich eGK G2.0: MRPIN.DPE_READ

 -    HBAx: PIN.CH, PIN.QES

 -    SM-B: PIN.SMC

</td></tr><tr><td>
SetNewPin

</td><td colspan="2">
Dieses Flag zeigt an, ob eine neue PIN gesetzt werden soll. Wird dieses Flag
nicht angegeben, so wird FALSE angenommen.

Das Flag ist notwendig, um bei Eingabe am PIN-Pad eindeutig festzulegen, ob eine
neue PIN gesetzt werden soll.

</td></tr><tr><td rowspan="10">
Rückgabe

</td><td colspan="3">
![Img-024][Img-024]

</td></tr><tr><td>
Name

</td><td colspan="2">
Beschreibung

</td></tr><tr><td>
LeftTries

</td><td colspan="2">
Im Falle von

REJECTED

wird hier die Anzahl der verbleibenden möglichen Versuche für die Eingabe der
PUK zurückgegeben.

</td></tr><tr><td>
Status

</td><td colspan="2">
Enthält den Ausführungsstatus der Operation siehe 3.5.2

</td></tr><tr><td rowspan="6">
PinResult

</td><td>
Wert

</td><td>
Bedeutung

</td></tr><tr><td>
OK

</td><td>
Prüfung war erfolgreich.

</td></tr><tr><td>
ERROR

</td><td>
Ein Bearbeitungsfehler ist aufgetreten. Fehlerursache im Feld

Error.

</td></tr><tr><td>
REJECTED

</td><td>
PUK war falsch. Die Anzahl der verbleibenden Versuche ist im Element

LeftTries.

</td></tr><tr><td>
WASBLOCKED

</td><td>
PUK war zum Aufrufzeitpunkt bereits gesperrt

</td></tr><tr><td>
NOWBLOCKED

</td><td>
PUK ist durch aktuellen Fehlversuch gesperrt

</td></tr><tr><td>
Vorbe-dingungen

</td><td colspan="3">
keine

</td></tr><tr><td>
Nachbe-dingungen

</td><td colspan="3">
keine

</td></tr></table>

Tabelle124: TAB_KON_550 Ablauf UnblockPIN

<table><tr><th>
Nr.

</th><th>
Aufruf Technischer Use Case oder Interne Operation

</th><th>
Beschreibung

</th></tr><tr><td>
1.

</td><td>
checkArguments

</td><td>
Die übergebenen Werte werden auf Konsistenz und Gültigkeit überprüft. Treten
hierbei Fehler auf, so bricht die Operation mit Fehler 4000 ab.

</td></tr><tr><td>
2.

</td><td>
TUC_KON_000 „Prüfe Zugriffs-berechtigung“

</td><td>
Prüfung der Zugriffsberechtigung durch den Aufruf

TUC_KON_000 {

    mandantId = $context.mandantId;

    clientSystemId = $context.clientsystemId;

    workplaceId = $context.workplaceId;

    userId = $context.userId; // falls angegeben

    cardHandle }

</td></tr><tr><td>
3.

</td><td>
TUC_KON_026 „Liefere CardSession“

</td><td>
Ermittle cardSession über TUC_KON_026

{

    mandantId = $context.mandantId;

    clientSystemId = $context.clientsystemId;

    userId = $context.userId;  // falls angegeben

    cardHandle }

</td></tr><tr><td>
4.

</td><td>
TUC_KON_021 „PIN entsperren“

</td><td>
Rücksetzen des Fehlbedienungszählers über TUC_KON_021 {

    cardSession;

    workplaceId = $context.workplaceId;

    pinRef = pinRef(PinTyp);

    setNewPIN = SetNewPIN }

</td></tr><tr><td>
5.

</td><td>
Verifikationsergebnis auswerten

</td><td>
Wenn TUC_KON_021 den Returncode BLOCKED liefert, wird dies als erfolgreicher
Operationsdurchlauf mit PinResult= NOWBLOCKED zurückgegeben.

Wenn TUC_KON_021 mit dem Fehlercode 4064 abbricht, wird dies als erfolgreicher
Operationsdurchlauf mit PinResult= WASBLOCKED zurückgegeben.

</td></tr></table>

Tabelle125: TAB_KON_551 Fehlercodes „UnblockPin“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4000

</td><td>
Technical

</td><td>
Error

</td><td>
Syntaxfehler

</td></tr><tr><td>
4209

</td><td>
Technical

</td><td>
Error

</td><td>
Kartentyp %CardType% wird durch diese Operation nicht unterstützt.

</td></tr></table>

**[\<=]**

### 4.1.5.5.5 EnablePin

##### TIP1-A_5487

Der Konnektor MUSS an der Außenschnittstelle eine Operation EnablePin, wie in
Tabelle TAB_KON_242 Operation EnablePin beschrieben, anbieten.

Tabelle126: TAB_KON_242 Operation EnablePin

<table><tr><th>
Name

</th><th colspan="3">
EnablePin

</th></tr><tr><td>
Beschreibung

</td><td colspan="3">
Schaltet für

eine

Multireferenz-PIN das Erfordernis, das Nutzergeheimnis zu verifizieren,

ein

, so dass der Sicherheitszustand nur durch eine erfolgreiche
Benutzerverifikation gesetzt werden kann.

</td></tr><tr><td rowspan="5">
Aufrufparameter

</td><td colspan="3">
![Img-025][Img-025]

</td></tr><tr><td>
Name

</td><td colspan="2">
Beschreibung

</td></tr><tr><td>
Context

</td><td colspan="2">
MandantId, ClientSystemId, WorkplaceId verpflichtend;

</td></tr><tr><td>
CardHandle

</td><td colspan="2">
Adressiert die Karte, deren MRPIN bearbeitet werden soll. Es

werden

nur eGKs ab Generation 2 unterstützt.

</td></tr><tr><td>
PinTyp

</td><td colspan="2">
Gibt an, auf welche MRPIN der Karte die Operation angewendet werden soll.

Erlaubte Werte:

 ---> UL

</td></tr><tr><td rowspan="11">
Rückgabe

</td><td colspan="3">
![Img-026][Img-026]

</td></tr><tr><td>
Name

</td><td colspan="2">
Beschreibung

</td></tr><tr><td>
Status

</td><td colspan="2">
Enthält den Ausführungsstatus der Operation, siehe 3.5.2

</td></tr><tr><td rowspan="7">
PinResult

</td><td>
Wert

</td><td>
Bedeutung

</td></tr><tr><td>
OK

</td><td>
Aktivierung war erfolgreich

</td></tr><tr><td>
REJECTED

</td><td>
PIN war falsch. Die Anzahl der verbleibenden Versuche ist im Element

LeftTries

</td></tr><tr><td>
ERROR

</td><td>
Ein Bearbeitungsfehler ist aufgetreten. Fehlerursache im Feld

Error

</td></tr><tr><td>
WASBLOCKED

</td><td>
PIN war zum Aufrufzeitpunkt bereits gesperrt

</td></tr><tr><td>
NOWBLOCKED

</td><td>
PIN ist durch aktuellen Fehlversuch gesperrt

</td></tr><tr><td>
TRANSPORT_PIN

</td><td>
Dieser Wert wird nicht verwendet

</td></tr><tr><td>
LeftTries

</td><td colspan="2">
Im Falle von

Result

=

REJECTED

wird hier die Anzahl der verbleibenden möglichen Versuche zurückgegeben.

</td></tr><tr><td>
Vorbedingung

</td><td colspan="3">
keine

</td></tr><tr><td>
Nachbedingung

</td><td colspan="3">
Für das Erreichen des Sicherheitszustands der MRPIN ist eine Nutzereingabe
erforderlich

</td></tr></table>

Tabelle127: TAB_KON_243 Ablauf EnablePin

<table><tr><th>
Nr.

</th><th>
Aufruf Technischer Use Case oder Interne Operation

</th><th>
Beschreibung

</th></tr><tr><td>
1.

</td><td>
checkArguments

</td><td>
Die übergebenen Werte werden auf Konsistenz und Gültigkeit überprüft. Treten
hierbei Fehler auf, so bricht die Operation mit Fehler 4000 ab.

</td></tr><tr><td>
2.

</td><td>
TUC_KON_000 „Prüfe Zugriffs- berechtigung“

</td><td>
Prüfung der Zugriffsberechtigung durch den Aufruf

TUC_KON_000 {

    mandantId = $context.mandantId;

    clientSystemId = $context.clientsystemId;

    workplaceId = $context.workplaceId;

    userId = $context.userId;

    cardHandle }

Tritt bei der Prüfung ein Fehler auf, so bricht die Operation mit dem
Fehlercode aus TUC_KON_000 ab.

</td></tr><tr><td>
3.

</td><td>
TUC_KON_026 „Liefere CardSession“

</td><td>
Ermittle cardSession über TUC_KON_026 {

    mandantId = $context.mandantId;

    clientSystemId = $context.clientsystemId;

    userId = $context.userId;

    cardHandle }

</td></tr><tr><td>
4.

</td><td>
TUC_KON_027 „PIN-Schutz ein-/ausschalten“

</td><td>
Aktiviere das Erfordernis der Benutzerverifikation der MRPIN durch Aufruf des
TUC_KON_027 „PIN-Schutz ein-/ausschalten“ {

    cardSession;

    pinRef  =   PinRef(PinType);

    enable = true}

</td></tr><tr><td>
5.

</td><td>
Verifikationsergebnis auswerten

</td><td>
Als erfolgreicher Operationsdurchlauf wird nur PinResult=OK gewertet.

Alle anderen Resultate sind Fehlerfälle, und neben dem Status ist auch
PinResult entsprechend zu setzen. Dabei gelten folgende Regeln:

Wenn TUC_KON_027 den PIN-Status BLOCKED liefert, wird auf PinResult=NOWBLOCKED
abgebildet.

Wenn TUC_KON_027 mit Fehler 4063 abbricht, wird dies auf PinResult=WASBLOCKED
abgebildet.

</td></tr></table>

Tabelle128: TAB_KON_244 Fehlercodes „EnablePin“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4000

</td><td>
Technical

</td><td>
Error

</td><td>
Syntaxfehler

</td></tr><tr><td>
4072

</td><td>
Technical

</td><td>
Error

</td><td>
Ungültige PIN-Referenz

PinRef

</td></tr><tr><td>
4209

</td><td>
Technical

</td><td>
Error

</td><td>
Kartentyp %CardType% wird durch diese Operation nicht unterstützt.

</td></tr></table>

**[\<=]**

### 4.1.5.5.6 DisablePin

##### TIP1-A_5488

Der Konnektor MUSS an der Außenschnittstelle eine Operation DisablePin, wie in
Tabelle TAB_KON_245 Operation DisablePin beschrieben, anbieten.

Tabelle129: TAB_KON_245 Operation DisablePin

<table><tr><th>
Name

</th><th colspan="3">
DisablePin

</th></tr><tr><td>
Beschreibung

</td><td colspan="3">
Schaltet für

eine

Multireferenz-PIN das Erfordernis, das Nutzergeheimnis zu verifizieren,

ab

. Die MRPIN verhält sich danach bei allen Zugriffen auf die durch sie
geschützten Objekte, als wäre sie freigeschaltet.

</td></tr><tr><td rowspan="5">
Aufrufparameter

</td><td colspan="3">
![Img-027][Img-027]

</td></tr><tr><td>
Name

</td><td colspan="2">
Beschreibung

</td></tr><tr><td>
Context

</td><td colspan="2">
MandantId, ClientSystemId, WorkplaceId verpflichtend;

</td></tr><tr><td>
CardHandle

</td><td colspan="2">
Adressiert die Karte, deren MRPIN bearbeitet werden soll. Es

werden

nur eGKs ab Generation 2 unterstützt.

</td></tr><tr><td>
PinTyp

</td><td colspan="2">
Gibt an, auf welche MRPIN der Karte die Operation angewendet werden soll.

Erlaubte Werte:

 ---> UL

</td></tr><tr><td rowspan="11">
Rückgabe

</td><td colspan="3">
![Img-028][Img-028]

</td></tr><tr><td>
Name

</td><td colspan="2">
Beschreibung

</td></tr><tr><td>
Status

</td><td colspan="2">
Enthält den Ausführungsstatus der Operation siehe 3.5.2

</td></tr><tr><td rowspan="7">
PinResult

</td><td>
Wert

</td><td>
Bedeutung

</td></tr><tr><td>
OK

</td><td>
Aktivierung war erfolgreich

</td></tr><tr><td>
REJECTED

</td><td>
PIN war falsch. Die Anzahl der verbleibenden Versuche ist im Element

LeftTries

</td></tr><tr><td>
ERROR

</td><td>
Ein Bearbeitungsfehler ist aufgetreten. Fehlerursache im Feld

Error

</td></tr><tr><td>
WASBLOCKED

</td><td>
PIN war zum Aufrufzeitpunkt bereits gesperrt

</td></tr><tr><td>
NOWBLOCKED

</td><td>
PIN ist durch aktuellen Fehlversuch gesperrt

</td></tr><tr><td>
TRANSPORT_PIN

</td><td>
Dieser Wert wird nicht verwendet

</td></tr><tr><td>
LeftTries

</td><td colspan="2">
Im Falle von

Result

=

REJECTED

wird hier die Anzahl der verbleibenden möglichen Versuche zurückgegeben.

</td></tr><tr><td>
Vorbedingung

</td><td colspan="3">
keine

</td></tr><tr><td>
Nachbedingung

</td><td colspan="3">
Der Sicherheitszustand der PIN ist dauerhaft (bis zur expliten Aktivierung mit
EnablePin) gesetzt, ohne dass eine Nutzereingabe erforderlich wäre

</td></tr></table>

Tabelle130: TAB_KON_246 Ablauf DisablePin

<table><tr><th>
Nr.

</th><th>
Aufruf Technischer Use Case oder Interne Operation

</th><th>
Beschreibung

</th></tr><tr><td>
1.

</td><td>
checkArguments

</td><td>
Die übergebenen Werte werden auf Konsistenz und Gültigkeit überprüft. Treten
hierbei Fehler auf, so bricht die Operation mit Fehler 4000 ab.

</td></tr><tr><td>
2.

</td><td>
TUC_KON_000 „Prüfe Zugriffs- berechtigung“

</td><td>
Prüfung der Zugriffsberechtigung durch den Aufruf

TUC_KON_000 {

    mandantId = $context.mandantId;

    clientSystemId = $context.clientsystemId;

    workplaceId = $context.workplaceId;

    userId = $context.userId;

    cardHandle }

Tritt bei der Prüfung ein Fehler auf, so bricht die Operation mit dem
Fehlercode aus TUC_KON_000 ab.

</td></tr><tr><td>
3.

</td><td>
TUC_KON_026 „Liefere CardSession“

</td><td>
Ermittle cardSession über TUC_KON_026 {

    mandantId = $context.mandantId;

    clientSystemId = $context.clientSystemId;

    userId = $context.userId;

    cardHandle }

</td></tr><tr><td>
4.

</td><td>
TUC_KON_027 „PIN-Schutz ein-/ausschalten“

</td><td>
Deaktiviere das Erfordernis der Benutzerverifikation der MRPIN durch Aufruf des
TUC_KON_027 „PIN-Schutz ein-/ausschalten“ {

    cardSession;

    pinRef  =   PinRef(PinType);

    enable = false}

</td></tr><tr><td>
5.

</td><td>
Verifikations-ergebnis auswerten

</td><td>
Als erfolgreicher Operationsdurchlauf wird nur PinResult=OK gewertet.

Alle anderen Resultate sind Fehlerfälle, und neben dem Status ist auch
PinResult entsprechend zu setzen. Dabei gelten folgende Regeln:

Wenn TUC_KON_027 den PIN-Status BLOCKED liefert, wird auf PinResult=NOWBLOCKED
abgebildet.

Wenn TUC_KON_027 mit Fehler 4063 abbricht, wird dies auf PinResult=WASBLOCKED
abgebildet.

</td></tr></table>

Tabelle131: TAB_KON_247 Fehlercodes „DisablePin“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4000

</td><td>
Technical

</td><td>
Error

</td><td>
Syntaxfehler

</td></tr><tr><td>
4072

</td><td>
Technical

</td><td>
Error

</td><td>
ungültige PIN-Referenz

PinRef

</td></tr><tr><td>
4209

</td><td>
Technical

</td><td>
Error

</td><td>
Kartentyp %CardType% wird durch diese Operation nicht unterstützt.

</td></tr></table>

**[\<=]**

### 4.1.5.6 Betriebsaspekte

##### TIP1-A_4592

Der Konnektor MUSS es einem Administrator ermöglichen,
Konfigurationsänderungen gemäß Tabelle TAB_KON_554 vorzunehmen.

Tabelle132: TAB_KON_554 Konfiguration des Kartendienstes

<table><tr><th>
ReferenzID

</th><th>
Belegung

</th><th>
Bedeutung

</th></tr><tr><td>
CARD_TIMEOUT_CARD

</td><td>
Sekunden

</td><td>
Maximale Zeit, die ein Aufruf einer Kartenoperation dauern darf, bevor der
Aufruf abgebrochen wird.

Der Konnektor MUSS sicherstellen, dass dieser Parameter einen Wert besitzt, mit
dem ein reibungsloser Betrieb gewährleistet ist, und MUSS dem Administrator
die Möglichkeit bieten, diesen Parameter zu konfigurieren.

</td></tr></table>

**[\<=]**

### 4.1.5.6.1 TUC_KON_025 "Initialisierung Kartendienst"

##### TIP1-A_4593

Der Konnektor MUSS den technischen Use Case „Initialisierung Kartendienst“
gemäß TUC_KON_025 umsetzen.

Tabelle133: TAB_KON_555 - TUC_KON_025 „Initialisierung Kartendienst“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_025 „Initialisierung Kartendienst“

</td></tr><tr><td>
Beschreibung

</td><td>
Nach dem Start des Kartendienstes MUSS der Konnektor für alle gesteckten Karten
den TUC_KON_001 {ctId, slotId } aufrufen und CM_CARD_LIST befüllen.

</td></tr><tr><td>
Auslöser

</td><td>
der Kartendienst wird gestartet

</td></tr><tr><td>
Vorbedingungen

</td><td>
Kartenterminaldienst wurde gestartet

</td></tr><tr><td>
Eingangsdaten

</td><td>
CTM_CT_LIST

</td></tr><tr><td>
Komponenten

</td><td>
Karte, Kartenterminal, Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
Aktuelle CM_CARD_LIST

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

</td></tr><tr><td>
Varianten/Alternativen

</td><td>
keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
keine

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
Keine

</td></tr></table>

**[\<=]**

### 4.1.5.6.2 Kartenübersicht und PIN-Management

##### TIP1-A_5110

Die Administrationsoberfläche MUSS dem Administrator eine Übersichtsseite
anbieten, die alle in CM_CARD_LIST enthaltenen Karten listet.In dieser
Übersichtsseite muss zu jeder Karte dargestellt werden:

 ---> UL

Ferner MÜSSEN auf Verlangen des Administrators zu jeder Karte neben den obigen
Informationen auch folgende Details angezeigt werden:

 ---> UL

**[\<=]**

##### TIP1-A_5111

Über die Administrationsoberfläche MUSS der Administrator für jede in der
Übersichtsseite angezeigte Karte vom Typ SM-B die folgenden TUCs für die
PIN.SMC auslösen können.Für diese MUSS er einen der gemäß Kapitel 4.1.1.6
[TIP1-A_4526] definierten Mandanten auswählen können:

 ---> UL

Die Eingabe der PIN SOLL von jedem vom Informationsmodell her zulässigen
Kartenterminal aus möglich sein. **[\<=]**

Der Konnektor kann den Administrator zur Laufzeit entscheiden lassen, an welchem
Kartenterminal die PIN eingegeben werden soll, indem er ihn wählen lässt, ob
er die PIN am Kartenterminal eingibt, in dem die betroffene SM-B steckt, oder
ihn den Arbeitsplatz wählen lässt, von dem aus er die Remote-PIN eingibt.

### 4.1.6 Systeminformationsdienst

Der Systeminformationsdienst stellt Basisdiensten, Fachmodulen und
Clientsystemen sowohl aktiv (Push-Mechanismus) wie passiv (Pull-Mechanismus)
Informationen zur Verfügung. Dabei erhebt er selbst keine Daten, sondern dient
nur als zentraler Mechanismus, der von anderen Basisdiensten und Fachmodulen
zur Verteilung und Bereitstellung derer Informationen verwendet werden kann.

Innerhalb des Systeminformationsdienstes werden folgende Präfixe für
Bezeichner verwendet:

 ---> UL

Push-Mechanismus

Der Push-Mechanismus des Systeminformationsdienstes hat die Aufgabe, Ereignisse
von internen Ereignisquellen im Konnektor (z. B. von anderen Basisdiensten wie
Kartendienst, Kartenterminaldienst oder Fachmodulen) an alle Basisdienste und
Fachmodule sowie an die bei ihm registrierten Ereignisempfänger
(Clientsysteme) weiterzuleiten.

Die Namen der Ereignisse, die Topics, sind als Baumstruktur organisiert und
werden mittels „/“-getrennter Liste angegeben (z. B.
„Auslöser/Ereigniskategorie1/…/Ereignis1“). Die konkreten Topics werden
innerhalb der einzelnen Funktionsmerkmale kontextbezogen definiert und im
Anhang in einer zentralen Liste übersichtlich dargestellt.

Clientsysteme können sich für den Empfang bestimmter Ereigniskategorien
(Topics) anmelden. Der Systeminformationsdienst übernimmt dementsprechend bei
der Verteilung der Ereignisse auch eine Filterfunktion für die
weiterzuleitenden Ereignisse.

Die Zustellung der Ereignisse erfolgt unidirektional über eine
Netzschnittstelle, deren Kommunikationsendpunkt („Ereignissenke“) vom
Clientsystem realisiert werden muss. Zur Übertragung der Daten wird ein
konnektoreigenes Protokoll cetp (Connector Event Transport Protocol) verwendet.

Pull-Mechanismus

Der Pull-Mechanismus des Systeminformationsdienstes hat die Aufgabe sowohl
Zustandswerte als auch statische Informationen des Konnektors selbst als auch
von den über ihn verwalteten Ressourcen durch Fachmodule und Clientsysteme
abrufbar zu machen. Dabei können entweder Listen von Ressourcen oder Details
zu einzelnen Ressourcen abgerufen werden.

Die folgenden Unterkapitel regeln:

 ---> UL

### 4.1.6.1 Funktionsmerkmalweite Aspekte

##### TIP1-A_4594

DerKonnektorsMUSS zur Übertragung von Ereignissen einecetp-Verbindung zuder
Ereignissenke des Clientsystemsaufbauen, die das Clientsystem beim
Operationsaufruf Subscribe perEventToangegeben hatte. **[\<=]**

##### TIP1-A_5536

Der Konnektor MUSS das Anwendungsprotokoll cetp (Connector Event Transport
Protocol) ausschließlich über das Transportprotokoll TCP (gebenenfalls TLS
gesichert) anbieten. **[\<=]**

##### TIP1-A_4595

Der Konnektor MUSS zur Übertragung der Ereignisse eine gesicherte Verbindung
(TLS) verwenden, die vom Konnektor als TLS-Client initiiert wurde, wenn
ANCL_TLS_MANDATORY=Enabled.Der Konnektor muss sich beim Aufbau der TLS-Sitzung
gegenüber dem Clientsystem authentisieren, wenn dieses eine Authentisierung im
Rahmen des TLS-Handshakes anfordert.Die Schalter ANCL_CAUT_MODE und
ANCL_CAUT_MANDATORY wirken für die Übertragung der Ereignisse nicht. **[\<=]**

Für die Übermittlung der Ereignisse wurde ein leichtgewichtiges Protokoll
gewählt, da vom Clientsystem keine Antwort auf Anwendungsebene erwartet wird.

##### TIP1-A_4596

Der Konnektors MUSS Ereignisse an Ereignissenken mittels Nachrichten verteilen,
die gemäß TAB_KON_030 „Ereignisnachricht“ aufgebaut sind. Der Konnektor
MUSS die Nachrichten mit der Zeichenkette „CETP“ beginnen, gefolgt von der
Länge der folgenden Ereignisnachricht in Anzahl Bytes. Das vier Byte lange
Längenfeld MUSS in der Byte-Reihenfolge Big-Endian codiert werden (das
hochwertigste Byte wird als erstes übertragen).

Abbildung11: PIC_KON_022 Grundsätzlicher Aufbau der Ereignisnachricht

Tabelle134: TAB_KON_030 Ereignisnachricht

<table><tr><th rowspan="8">
Beschreibung

</th><th colspan="2">
Die Ereignisnachricht, die zur Ereignissenke gesendet wird, ist ein
XML-Dokument. Die Ereignisnachricht wird in den „Umschlag“Event
gepackt.Wenn ein mandantenfähiges Clientsystem mehrere Anwendungskonnektoren
verwendet, dann kann es die erhaltenen Ereignisbenachrichtigungen anhand der
Subscription-ID einem Mandanten zuordnen.

</th></tr><tr><td colspan="2">


</td></tr><tr><td colspan="2">


</td></tr><tr><td>
Topic

</td><td>
Topic der Ereignisnachricht

</td></tr><tr><td>
Type

</td><td>
Typ der Ereignisnachricht (Security, Operation, Infrastructure)

</td></tr><tr><td>
Severity

</td><td>
Schwere der Ereignisnachricht (Info, Warning, Error, Fatal)

</td></tr><tr><td>
SubscriptionID

</td><td>
Identifikator der Anmeldung, der vom Konnektor bei der OperationSubscribefür
die Anmeldung des jeweiligen Clientsystems vergeben wurde.

</td></tr><tr><td>
Message

</td><td>
Dieses Element enthält die Ereignisnachricht. Der Inhalt ist abhängig vom
Topic und wird mittels „Key-Value“-Parameternübertragen.

</td></tr><tr><td>


</td><td>
Message/Parameter/Key

</td><td>
Name des Parameters (String), case sensitiv

</td></tr><tr><td>


</td><td>
Message/Parameter/Value

</td><td>
Wert des Parameters (String)

</td></tr><tr><td>
Hinweise

</td><td colspan="2">
Das XML-Dokument MUSS UTF-8-codiert sein.

</td></tr></table>

​​ **[\<=]**

### 4.1.6.2 Durch Ereignisse ausgelöste Reaktionen

Keine.

### 4.1.6.3 Interne TUCs, nicht durch Fachmodule nutzbar

Keine.

### 4.1.6.4 Interne TUCs, auch durch Fachmodule nutzbar

### 4.1.6.4.1 TUC_KON_256 „Systemereignis absetzen“

##### TIP1-A_4598-02

Der Konnektor MUSS für den PUSH-Mechanismus des Systeminformationsdienstes den
technischen Use Case TUC_KON_256 „Systemereignis absetzen” umsetzen.

Tabelle135: TAB_KON_556 - TUC_KON_256 „Systemereignis absetzen“

<table><tr><th>
Element

</th><th>
Beschreibung

</th></tr><tr><td>
Name

</td><td>
TUC_KON_256 „Systemereignis absetzen“

</td></tr><tr><td>
Beschreibung

</td><td>
Dieser TUC verteilt ein Ereignis im Konnektor intern (d.h. an Basisdienste und
Fachmodule) sowie an Clientsysteme, die sich für den Empfang angemeldet haben
(Operation

Subscribe

). Zusätzlich wird, bei gesetztem Flag, das Ereignis durch den
Protokollierungsdienst protokolliert.

</td></tr><tr><td>
Auslöser

</td><td>
Aufruf durch Basisdienst oder Fachmodul

</td></tr><tr><td>
Vorbedingungen

</td><td>
Fall Topic = „BOOTUP/BOOTUP_COMPLETE":

Zu allen URLs von clientseitigen Endpunkten, wie sie bei der

Subscribe

-Operation angegeben wurden, ist in der Subscription-Verwaltung des Konnektors
eine TerminationTime gespeichert. Sie wird jeweils auf den Wert der
TerminationTime der am längsten gültigen Subscription zu dem jeweiligen
Endpunkt gesetzt. Die URLs von clientseitigen Endpunkten müssen bis zum
Ablauf  ihrer TerminationTime auch über Bootups hinweg gespeichert werden.
Vor dem Versenden des BOOTUP_COMPLETE-Events werden sämtliche Subscriptions,
jedoch nicht die URLs gelöscht.  Bei Ablauf ihrer TerminationTime werden
nach dem Versenden des BOOTUP_COMPLETE-Events auch die URLs gelöscht.

</td></tr><tr><td>
Eingangsdaten

</td><td>
Attribute des zu versendenden Ereignisses:

 ---> UL

      (Wenn statt eines EventType ein ErrorType übergeben wird, so wird

      der EventType daraus abgeleitet.

      Typ des Events: Op = Operation, Sec = Security, Infra =
Infrastructure)

 ---> UL

      

Arbeitsanweisungen:

 ---> UL

Die Bezeichnungen Op, Sec, Infra, Info, Warning, Err, Fatal werden nur in diesem
Dokument verwendet und sind als Abkürzungen für die Werte Operation,
Security, Infrastructure, Information, Warning, Error, Fatal in den jeweiligen
Ereignisnachrichten gemäß Schema EventService.xsd zu verstehen.

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
Keine

</td></tr><tr><td>
Nachbedingungen

</td><td>
</td></tr><tr><td>
Standardablauf

</td><td>
Für das übergebene Ereignis werden folgende Schritte durchgeführt:

  1. Das Ereignis wird an alle Basisdienste und Fachmodule des

       Konnektors gesendet.

  2. Wenn doLog = true, erfolgt der Aufruf von TUC_KON_271 {

             eventType = $Event.eventType

                (mit eventType = „Op“, wenn $Event.eventType in
{„Op“, „Infra“}

                 mit eventType = „Sec“, wenn $Event.eventType
gleich "Sec")

            severity=$Event. severity;

            parameters= ($Event.topic, $Event.parameters) }

       Die Einschränkungen zur Protokollierung personenbezogener Daten

       gemäß TIP1-A_4710 müssen beim Aufruf von TUC_KON_271

       beachtet werden.

  3. Falls doDisp = false ist, wird an dieser Stelle abgebrochen.

  4. Das für den Versand an Clientsysteme benötigte XML-Dokument des

        Ereignisses wird aufgebaut (Element „Event“ gemäß

        EventService.XSD).

  5. Setze $subscriptionList = Liste der Clientsystem-Abonnements, die

        durch die Operationen Subscribe/Unsubscribe gepflegt werden und

        deren TerminationTime \> Systemzeit.

        Im Folgenden durchläuft diese Liste der Reihe nach drei Filter.
Nach

       dem letzten Filterschritt enthält $subscriptionList nur noch die

        Abonnements, an die das Ereignis versendet werden soll.

  a.             Filtern nach Topics:

        für jede $subscription in $subscriptionList {

             wenn $event.topic nicht mit $subscription.topic beginnt

                    oder übereinstimmt (case insensitiver
Vergleich),

             dann entferne $subscription aus $subscriptionList

        }

  b.            Filtern nach Zugriffsberechtigung:

        für jede $subscription in $subscriptionList {

              wenn TUC_KON_000 mit einem Fehler abgeschlossen

               wird,  dann entferne $subscription aus
$subscriptionList.

           Wenn

CardHandle bzw. CARD_HANDLE

in parameters übergeben wurde, dann

                TUC_KON_000 {

                     mandantId = $subscription.context.mandantId;

                     clientSystemId =
$subscription.context.clientsystemId;

                     workplaceId =
$subscription.context.workplaceId;

                     ctId = $parameters.value

                             für $parameters.key =
„ctId“

                     cardHandle = $parameters.value

                                        für
$parameters.key =

[„cardHandle“ | "CARD_HANDLE"]

;

                     needCardSession = false;

                     allWorkplaces = false

                }

            

oder im Fall nicht gegebenes

CardHandle bzw. CARD_HANLDE

                TUC_KON_000 {

                    mandantId = $subscription.context.mandantId;

                    clientSystemId =
$subscription.context.clientsystemId;

                    workplaceId = $subscription.context.workplaceId;

                    ctId = $parameters.value

                            für $parameters.key =
„ctId“

                    needCardSession = false;

                    allWorkplaces = false

                }    }

  c.           Filtern nach XPath-Filter in Subscription ([XPATH]):

       für jede $subscription in $subscriptionList {

            wenn der XPath-Ausdruck $subscription.filter

                 angewandt auf das als XML-Dokument dargestellte

                 Ereignis

                 ein leeres Ergebnis liefert,

            dann entferne $subscription aus $subscriptionList

       }

6. Versenden:

   für jede $subscription in $subscriptionList {

      versende das Ereignis an $subscription.eventTo

    }

Für das versendete Ereignis wird keine Antwort durch das Clientsystem erwartet.

</td></tr><tr><td>
Varianten/

Alternativen

</td><td>
Fall Topic = „BOOTUP/BOOTUP_COMPLETE":

4.        Das für den Versand an Clientsysteme benötigte XML-Dokument

    des Ereignisses wird aufgebaut (Element „Event“ gemäß

    EventService.XSD, SubscriptionID als leeres Element).

5.        Setze $urlList = Liste der URLs von clientseitigen Endpunkten,
wie

    sie bei der

Subscribe

-Operation angegeben wurden. Clientsysteme,

    deren Subscription-URL beim Einschalten des Konnektors noch nicht

    gelöscht waren, müssen benachrichtigt werden, auch wenn dann

    bereits deren TerminationTime \< Systemzeit ist.

Versenden:

für jede $url in $urlList {

   versende das Ereignis an $url

}

Für das versendete Ereignis wird keine Antwort durch das Clientsystem erwartet.
Dadurch wird bei einer Nichtzustellung auch kein erneuter

Versand des Ereignisses angestoßen, da der Konnektor keine Kenntnis

über den Erfolg einer Ereignisübermittlung hat.

</td></tr><tr><td>
Fehlerfälle

</td><td>
Fehler in den folgenden Schritten des Standardablaufs führen zum Abbruch mit
den ausgewiesenen Fehlercodes:

  (



5c)    Fehler bei der Auswertung des XPath-Ausdrucks:

                Fehlercode: 4095, nur für die jeweilige
Abonnement-Prüfung.

</td></tr><tr><td>
Fachliche Fehlermeldung

</td><td>
Keine

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige

Diagramme

</td><td>
Abbildung PIC_KON_112 Aktivitätsdiagramm zu „Systemereignis absetzen“

</td></tr></table>

![Img-029][Img-029]

Abbildung12: PIC_KON_112 Aktivitätsdiagramm zu „Systemereignis absetzen“

Tabelle136: TAB_KON_557 Fehlercodes TUC_KON_256 „Systemereignis absetzen“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4095

</td><td>
Technical

</td><td>
Error

</td><td>
Fehler bei der Auswertung eines XPath-Ausdruck

</td></tr></table>

**[\<=]**

### 4.1.6.4.2 TUC_KON_252 „Liefere KT_Liste“

##### TIP1-A_4599

Der Konnektor MUSS den technischen Use Case TUC_KON_252 „Liefere KT_Liste”
umsetzen.

Tabelle137: TAB_KON_558 – TUC_KON_252 „Liefere KT_Liste“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_252 „Liefere KT_Liste“

</td></tr><tr><td>
Beschreibung

</td><td>
Dieser TUC liefert eine Liste der Kartenterminals, die unter Beachtung der
Eingangsdaten verfügbar/erreichbar sind.

</td></tr><tr><td>
Auslöser

</td><td>
Aufruf durch ein Clientsystem (Operation

GetCardTerminals

) oder ein Fachmodul

</td></tr><tr><td>
Vorbedingungen

</td><td>
Keine

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor, Kartenterminal

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Nachbedingungen

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

</td></tr><tr><td>
Varianten/Alternativen

</td><td>
Keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
Keine

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
Keine

</td></tr></table>

**[\<=]**

### 4.1.6.4.3 TUC_KON_253 „Liefere Karten_Liste“

##### TIP1-A_4600

Der Konnektor MUSS den technischen Use Case TUC_KON_253 „Liefere
Karten_Liste” umsetzen.

Tabelle138: TAB_KON_559 – TUC_KON_253 „Liefere Karten_Liste“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_253 „Liefere Karten_Liste“

</td></tr><tr><td>
Beschreibung

</td><td>
Dieser TUC liefert eine Liste der gesteckten Karten, die unter Beachtung der
Eingangsdaten verfügbar/erreichbar sind.

</td></tr><tr><td>
Auslöser

</td><td>
Aufruf durch ein Clientsystem (Operation

GetCards

) oder ein Fachmodul

</td></tr><tr><td>
Vorbedingungen

</td><td>
Keine

</td></tr><tr><td>
Eingangsanforderung

</td><td>
Keine

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor, Kartenterminal, Karte

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Nachbedingungen

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

</td></tr><tr><td>
Varianten/  
Alternativen

</td><td>
Keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
Fehler in den folgenden Schritten des Standardablaufs führen zum Abbruch mit
den ausgewiesenen Fehlercodes:

(



1 a)    Ungültige Kartenterminal-ID: Fehlercode: 40

07

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
Keine

</td></tr></table>

Tabelle139: TAB_KON_560 Fehlercodes TUC_KON_253 „Liefere Karten_Liste“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
40

07

</td><td>
Technical

</td><td>
Error

</td><td>
ungültige Kartenterminal-ID

</td></tr></table>

**[\<=]**

### 4.1.6.4.4 TUC_KON_254 „Liefere Ressourcendetails“

##### TIP1-A_4602

Der Konnektor MUSS den technischen Use Case TUC_KON_254 „Liefere
Ressourcendetails” umsetzen.

Tabelle140: TAB_KON_561 - TUC_KON_254 „Liefere Ressourcendetails“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_254 „Liefere Ressourcendetails“

</td></tr><tr><td>
Beschreibung

</td><td>
Dieser TUC liefert Detailinformationen zu einer Ressource (KT, Karte) oder dem
Konnektor

</td></tr><tr><td>
Auslöser

</td><td>
Aufruf durch ein Clientsystem (Operation

GetResourceInformation

) oder ein Fachmodul

</td></tr><tr><td>
Vorbedingungen

</td><td>
Keine

</td></tr><tr><td>
Eingangsanforderung

</td><td>
Keine

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor, Kartenterminal, Karte, HSM

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Nachbedingungen

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

</td></tr><tr><td>
Varianten/  
Alternativen

</td><td>
Keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
Fehler in den folgenden Schritten des Standardablaufs führen zum Abbruch mit
den ausgewiesenen Fehlercodes:

(



1)    Ungültige Kartenterminal-ID: Fehlercode: 40

07

(



1)    Ungültige Kartenslot-ID: Fehlercode: 4097

(



1)    Keine Karte im angegebenen Slot: Fehlercode: 4098

(



1)    Keine Karte mit angegebener Iccsn gefunden: Fehlercode: 4099

(



1)    Karten-Handle ungültig: Fehlercode: 4101

(



2)    Ungültige Kartenterminal-ID: Fehlercode: 40

07

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
Keine

</td></tr></table>

Tabelle141: TAB_KON_562 Fehlercodes TUC_KON_254 „Liefere Ressourcendetails“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
40

07

</td><td>
Technical

</td><td>
Error

</td><td>
ungültige Kartenterminal-ID

</td></tr><tr><td>
4097

</td><td>
Technical

</td><td>
Error

</td><td>
ungültige Kartenslot-ID

</td></tr><tr><td>
4098

</td><td>
Technical

</td><td>
Error

</td><td>
keine Karte im angegebenen Slot gefunden

</td></tr><tr><td>
4099

</td><td>
Technical

</td><td>
Error

</td><td>
keine Karte zur angegebenen Iccsn gefunden

</td></tr><tr><td>
4101

</td><td>
Technical

</td><td>
Error

</td><td>
Karten-Handle ungültig

</td></tr></table>

**[\<=]**

### 4.1.6.5 Operationen an der Außenschnittstelle

##### TIP1-A_4603-02

Der Konnektor MUSS für Clients eine Basisanwendung Systeminformationsdienst
anbieten.

Tabelle142TAB_KON_029 Basisanwendung Systeminformationsdienst

<table><tr><th>
Name

</th><th colspan="2">
EventService

</th></tr><tr><td>
Version

</td><td colspan="2">
7.2.0 (WSDL-Version) 7.2.1 (XSD-Version)

</td></tr><tr><td>
Namensraum

</td><td colspan="2">
Siehe GitHub

</td></tr><tr><td>
Namensraum-Kürzel

</td><td colspan="2">
EVT für Schema und EVTW für WSDL

</td></tr><tr><td rowspan="8">
Operationen

</td><td>
Name

</td><td>
Kurzbeschreibung

</td></tr><tr><td>
GetCardTerminals

</td><td>
Auflistung der verfügbaren Kartenterminals

</td></tr><tr><td>
GetCards

</td><td>
Auflistung der gesteckten Karten

</td></tr><tr><td>
GetResourceInformation

</td><td>
Liefert Details zu einer Ressource (Kartenterminal, Karte, HSM)

</td></tr><tr><td>
Subscribe

</td><td>
Anmeldung der Zustellung von Ereignissen

</td></tr><tr><td>
Unsubsribe

</td><td>
Abmelden von der Zustellung von Ereignissen

</td></tr><tr><td>
RenewSubscriptions

</td><td>
Gültigkeit bestehender Subscriptions verlängern

</td></tr><tr><td>
GetSubscriptions

</td><td>
Abfrage der angemeldeten Zustellungen von Ereignissen

</td></tr><tr><td>
WSDL

</td><td colspan="2">
EventService.wsdl

</td></tr><tr><td>
Schema

</td><td colspan="2">
EventService.xsd

</td></tr></table>

**[\<=]**

### 4.1.6.5.1 GetCardTerminals

##### TIP1-A_4604

Der Konnektors MUSS an der Außenschnittstelle eine Operation GetCardTerminals,
wie in Tabelle TAB_KON_563 „Operation GetCardTerminals“ beschrieben,
anbieten.

Tabelle143: TAB_KON_563 Operation GetCardTerminals

<table><tr><th>
Name

</th><th colspan="3">
GetCardTerminals

</th></tr><tr><td>
Beschrei-bung

</td><td colspan="3">
Liefert die Liste der Kartenterminals, auf die der aufrufende Mandant und das
aufrufende Clientsystem zugreifen dürfen (siehe Zugriffsberechtigungsdienst)
sowie deren aktuelle Verfügbarkeit. Verfügbarkeit bedeutet im Falle eines
eHealth-Kartenterminals, dass der Konnektor eine Verbindung zumKartenterminal
aktuell hält.

</td></tr><tr><td rowspan="4">
Aufruf-parameter

</td><td colspan="3">


</td></tr><tr><td colspan="2">
Name

</td><td>
Beschreibung

</td></tr><tr><td colspan="2">
@mandant-wide

</td><td>
Wenn „true“, werden alle Kartenterminals zurückgegeben, auf die der Mandant
und das aufrufende Clientsystem zugreifen dürfen.Wenn „false“
(Standardbelegung), werden nur Kartenterminals zurückgegeben, auf die von dem
im Aufrufkontext spezifizierten Arbeitsplatz zugegriffen werden darf.

</td></tr><tr><td colspan="2">
Context

</td><td>
Aufrufkontext

</td></tr><tr><td rowspan="14">
Rückgabe

</td><td colspan="3">


</td></tr><tr><td colspan="2">
Name

</td><td>
Beschreibung

</td></tr><tr><td colspan="2">
Status

</td><td>
Ergebnis der Operation

</td></tr><tr><td colspan="3">
Die Liste der Kartenterminals

</td></tr><tr><td>
Name

</td><td colspan="2">
Beschreibung

</td></tr><tr><td>
ProductInformation

</td><td colspan="2">
Produktinformationen gemäß [gemSpec_OM] und dem Schema
„ProductInformation.xsd“ zu formatieren.

</td></tr><tr><td>
CtId

</td><td colspan="2">
Eineindeutige Identifikation des Kartenterminals

</td></tr><tr><td>
WorkplaceIds

</td><td colspan="2">
Die Liste der Arbeitsplätze, denen das Kartenterminal als lokales
Kartenterminal zugeordnet ist. Insbesondere für Entfernte Kartenterminals kann
diese Liste leer sein (siehe TUC_KON_252).

</td></tr><tr><td>
Name

</td><td colspan="2">
Sprechender Name des Kartenterminals

</td></tr><tr><td>
MacAddress

</td><td colspan="2">
MAC-Adresse des Kartenterminals

</td></tr><tr><td>
IPAddress

</td><td colspan="2">
IP-Adresse des Kartenterminals

</td></tr><tr><td>
Slots

</td><td colspan="2">
Anzahl der Slots des Kartenterminals

</td></tr><tr><td>
IS_PHYSICAL

</td><td colspan="2">
Attribut des Kartenterminals das anzeigt ob es sich um ein physisches oder
logisches Kartenterminal handelt(siehe auch TAB_KON_522 Parameterübersicht des
Kartenterminaldienstes)

</td></tr><tr><td>
Connected

</td><td colspan="2">
Zeigt an, ob dieses Kartenterminal aktuell verfügbar ist.TRUE– ist
verfügbarFALSE– ist nicht verfügbar

</td></tr><tr><td>
Vorbedingungen

</td><td colspan="3">
Keine

</td></tr><tr><td>
Nachbedingungen

</td><td colspan="3">
Der Zustand der Kartenterminals bleibt unverändert.

</td></tr><tr><td>
Hinweise

</td><td colspan="3">
Der Aufruf DARF nur den im Konnektor verwalteten, aktuellen Zustand des
Kartenterminals liefern und DARF NICHT Abfragen an die Kartenterminals absetzen.

</td></tr></table>

Der Ablauf der Operation GetCardTerminals ist in Tabelle TAB_KON_564 Ablauf
GetCardTerminals beschrieben:

Tabelle144: TAB_KON_564 Ablauf GetCardTerminals

<table><tr><th>
Nr.

</th><th>
Aufruf Technischer Use Case oder Interne Operation

</th><th>
Beschreibung

</th></tr><tr><td>
1.

</td><td>
checkArguments

</td><td>
Die übergebenen Werte werden auf Konsistenz und Gültigkeit überprüft. Treten
hierbei Fehler auf, so bricht die Operation mit Fehler 4000 ab.

</td></tr><tr><td>
2.

</td><td>
TUC_KON_000 „Prüfe Zugriffs- berechtigung“

</td><td>
Prüfung der Zugriffsberechtigung durch den AufrufTUC_KON_000
{      mandantId = $context.mandantId;      clientSystemId =
$context.clientsystemId;      workplaceId =
$context.workplaceId;      needCardSession =
false;      allWorkplaces = @mandant-wide }Tritt bei der Prüfung ein
Fehler auf, bricht die Operation mit Fehlercode aus TUC_KON_000 ab.

</td></tr><tr><td>
3.

</td><td>
TUC_KON_252„Liefere KT_Liste“

</td><td>
Die Liste der Kartenterminals wird erstellt und zurückgegeben.Tritt hierbei ein
Fehler auf, so bricht die Operation mit dem Fehler des TUCs
ab.Wenn@mandant-wide=truedann ermittle die Liste der Kartenterminals für alle
Arbeitsplätze des Mandanten für das angegebene Clientsystem durch den Aufruf
von TUC_KON_252{    clientSystemId =
$context.ClientSystemId;    mandantId = $context.mandantId
}Wenn@mandant-wide=falsedann ermittle die Liste der Kartenterminals für den
Arbeitsplatz des Mandanten für das angegebene Clientsystem entsprechend
$context durch den Aufruf von TUC_KON_252{    workplaceId =
$context.workplaceId;    clientSystemId =
$context.ClientSystemId;    mandantId = $context.mandantId }

</td></tr></table>

Tabelle145: TAB_KON_823 Fehlercodes „GetCardTerminals“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4000

</td><td>
Technical

</td><td>
Error

</td><td>
Syntaxfehler

</td></tr></table>

​​ **[\<=]**

### 4.1.6.5.2 GetCards

##### TIP1-A_4605

Der Konnektors MUSS an der Außenschnittstelle eine Operation GetCards, wie in
Tabelle TAB_KON_565 „Operation GetCards“ beschrieben, anbieten und MUSS
dabei Kartentypen aus Tabelle TAB_KON_500 Wertetabelle Kartentypen
unterscheiden.

Tabelle146: TAB_KON_565 Operation GetCards

<table><tr><th>
Name

</th><th colspan="3">
GetCards    

</th></tr><tr><td>
Beschreibung

</td><td colspan="3">
Liefert Informationen zu den in den Kartenterminals verfügbaren Karten zurück,
die in Kartenterminals stecken, auf die Mandant und Clientsystem zugreifen
dürfen. Insbesondere umfasst die Information die sog. Karten-Handles. Die
Karten-Handles können bei anderen Konnektoraufrufen zur Adressierung von
Karten genutzt werden.

</td></tr><tr><td rowspan="7">
Aufrufparameter

</td><td colspan="3">
</td></tr><tr><td>
Name

</td><td colspan="2">
Beschreibung

</td></tr><tr><td>
@mandant-  
wide

</td><td colspan="2">
Wenn „true“, werden alle Karten zurückgegeben, auf die der Mandant und das
aufrufende Clientsystem zugreifen dürfen. Wenn „false“ (Standardbelegung),
werden nur Karten zurückgegeben, auf die von dem im Aufrufkontext
spezifizierten Arbeitsplatz zugegriffen werden darf.

</td></tr><tr><td>
Context

</td><td colspan="2">
Aufrufkontext

</td></tr><tr><td>
CtId

</td><td colspan="2">
Identifikation des Kartenterminals. Wenn angegeben, werden nur die Karten
zurückgeliefert, die in diesem Kartenterminal verfügbar sind.

</td></tr><tr><td>
SlotId

</td><td colspan="2">
Nummer des Slots, beginnend bei 1.  
Wird zusätzlich zur CtId auch SlotId
übergeben, so wird die Karte zurückgegeben, die in dem angegebenen Slot des
mit CtId adressierten Kartenterminals steckt.

</td></tr><tr><td>
CardType

</td><td colspan="2">
Ein Kartentyp gemäß Tabelle TAB_KON_500 „Wertetabelle Kartentypen“ als
optionaler Filter. Wenn angegeben, werden nur Karten vom spezifizierten Typ
zurückgegeben. Unterstützt werden die Kartentypen EGK, KVK, HBAx, SM-B,
SMC-KT und UNKNOWN.

</td></tr><tr><td rowspan="15">
Antwort

</td><td colspan="3">
</td></tr><tr><td>
Name

</td><td colspan="2">
Beschreibung

</td></tr><tr><td>
Status

</td><td colspan="2">
Ergebnis der Operation

</td></tr><tr><td colspan="3">
Im Element Cards wird die Liste der gesteckten Karten zurückgegeben. Für jede
Karte wird dabei ein Card-Element angegeben. Leere Slots der Kartenterminals
sind in dieser Liste nicht enthalten.

</td></tr><tr><td colspan="2">
Name

</td><td>
Beschreibung

</td></tr><tr><td colspan="2">
Card  
Handle

</td><td>
Handle, mit dem die Karte in Folgeaufrufen adressiert werden kann. Der Konnektor
garantiert, dass dieses Handle die gesteckte Karte eindeutig identifiziert und
bei Entfernen der Karte aus dem Kartenterminal ungültig wird.  
Auch für
nicht erkannte Karten (z. B. bei falscher Steckrichtung der Karte) SOLL der
Konnektor gültige Handles liefern (sofern das Kartenterminal in diesem Fall in
der Lage ist, das entsprechende Ereignis „Karte wurde gesteckt“ zu
liefern), damit diese Karten z. B. zum Auswurf adressiert werden können.

</td></tr><tr><td colspan="2">
CardType

</td><td>
Erkannter Typ der Karte.  
Siehe Tabelle TAB_KON_500 Wertetabelle Kartentypen,

</td></tr><tr><td colspan="2">
Card  
Version

</td><td>
Der Konnektor MUSS in CardVersion bei eGK, HBA und SM-B/SMC-KT der Generation 2
die Versionsinformationen gemäß [gemSpec_Karten_Fach_TIP] übergeben, für
G1+ aus /MF/EF.Version.  
Bei KVK, HBA-VK und unbekannten Karten MUSS das
Element weggelassen werden.

</td></tr><tr><td colspan="2">
Iccsn

</td><td>
Falls auslesbar, die ICC-Serial-Number der Karte.  
Im Fall der KVK wird das
optionale Element Iccsn nicht zurückgegeben.

</td></tr><tr><td colspan="2">
CtId

</td><td>
Identifikation des Kartenterminals, in dem die Karte steckt.

</td></tr><tr><td colspan="2">
SlotId

</td><td>
Nummer des Slots (beginnend bei 1), in dem die Karte steckt.

</td></tr><tr><td colspan="2">
InsertTime

</td><td>
Gibt den Zeitpunkt an, zu dem der Konnektor die Karte erkannt hat.  
Die Zeit
wird mit dem Datentyp DateTime in folgendem Format angegeben: 

yyyy-mm-ddThh:mm:ss+hh:mm  
Es ist also – gemäß ISO 8601 [ISO8601] – die
lokale Zeit und die Differenz zur UTC anzugeben.

</td></tr><tr><td colspan="2">
CardHolder  
Name

</td><td>
Name des Karteninhabers bzw. der Institution/Organisation (subject.commonName). 

Bei KVK und unbekannten Karten MUSS das Element weggelassen werden.

</td></tr><tr><td colspan="2">
Kvnr

</td><td>
KVNR (Unveränderbarer Teil) MUSS bei eGK belegt werden. Bei allen anderen
Karten MUSS das Element weggelassen werden.

</td></tr><tr><td colspan="2">
Certificate  
Expiration  
Date

</td><td>
Ablaufdatum des Zertifikates (AUT bzw. OSIG).  
Bei KVK und unbekannten Karten
MUSS das Element weggelassen werden.

</td></tr><tr><td>
Vorbedingungen

</td><td colspan="3">
Keine.

</td></tr><tr><td>
Nachbedingungen

</td><td colspan="3">
Der Zustand der Karten und der Kartenterminals bleibt unverändert.

</td></tr><tr><td>
Hinweise

</td><td colspan="3">
Der Aufruf darf nur den im Konnektor verwalteten aktuellen Zustand der Karte
liefern und keine Abfragen an die Kartenterminals absetzen.

</td></tr></table>

Der Ablauf der Operation GetCards ist in Tabelle TAB_KON_566 Ablauf GetCards
beschrieben:

Tabelle147: TAB_KON_566 Ablauf GetCards

<table><tr><th>
Nr.

</th><th>
Aufruf Technischer Use Case oder Interne Operation

</th><th>
Beschreibung

</th></tr><tr><td>
1.

</td><td>
checkArguments

</td><td>
Die übergebenen Werte werden auf Konsistenz und Gültigkeit überprüft. Treten
hierbei Fehler auf, so bricht die Operation mit Fehler 4000 ab.

</td></tr><tr><td>
2.

</td><td>
TUC_KON_000 „Prüfe Zugriffsberechtigung“

</td><td>
Die Prüfung erfolgt durch den Aufruf

TUC_KON_000 {

      mandantId = $context.mandantId;

      clientSystemId = $context.clientsystemId;

      workplaceId = $context.workplaceId;

      needCardSession = false;

      allWorkplaces = @mandant-wide}

Tritt bei der Prüfung ein Fehler auf, bricht die Operation mit Fehlercode aus
TUC_KON_000 ab.

</td></tr><tr><td>
3.

</td><td>
TUC_KON_253 „Liefere Karten_Liste“

</td><td>
Die Liste der Karten wird erstellt und zurückgegeben. Tritt hierbei ein Fehler
auf, so bricht die Operation mit dem Fehler des TUCs ab.

Wenn

@mandant-wide=true

dann ermittle die Liste der Karten für alle Arbeitsplätze des Mandanten für
das angegebene Clientsystem durch den Aufruf

TUC_KON_253 „Liefere Karten_Liste“ {

    clientSystemId = $context.clientsystemId;

    cardTerminalId = CtId;

    slotId = SlotId;

    mandantId = $context.mandantId;

    cardType = CardType }

Wenn

@mandant-wide=false

dann ermittle die Liste der Karten für den Arbeitsplatz des Mandanten für das
angegebene Clientsystem entsprechend $context durch den Aufruf

TUC_KON_253 „Liefere Karten_Liste“ {

    workplaceId= $context.workplaceId;

    clientSystemId = $context.clientsystemId;

    cardTerminalId = CtId;

    slotId = SlotId;

    mandantId = $context.mandantId;

    cardType = CardType }

</td></tr></table>

Die Fehlerfälle der Operation GetCards sind in Tabelle TAB_KON_567 Fehlercodes
„GetCards dargestellt:

Tabelle148: TAB_KON_567 Fehlercodes „GetCards“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weiteren Fehlercodes auftreten:

</td></tr><tr><td>
4000

</td><td>
Technical

</td><td>
Error

</td><td>
Syntaxfehler

</td></tr></table>

**[\<=]**

### 4.1.6.5.3 GetResourceInformation

##### TIP1-A_4607

Der Konnektors MUSS an der Außenschnittstelle eine Operation
GetResourceInformation, wie in Tabelle TAB_KON_568 „Operation
GetResourceInformation“ beschrieben, anbieten.

Tabelle149: TAB_KON_568 Operation GetResourceInformation

<table><tr><th>
Name

</th><th colspan="2">
GetResourceInformation

</th></tr><tr><td>
Beschreibung

</td><td colspan="2">
Gibt Informationen zu einer Ressource (Karte, KT) oder dem Konnektor selbst
zurück

</td></tr><tr><td rowspan="8">
Aufrufparameter

</td><td colspan="2">
![Img-030][Img-030]

</td></tr><tr><td>
Name

</td><td>
Beschreibung

</td></tr><tr><td>
Context

</td><td>
Aufrufkontext

</td></tr><tr><td>
CtId

</td><td>
Identifikator eines Kartenterminals

</td></tr><tr><td>
SlotId

</td><td>
Kartenslot-Nummer (in Kombination mit

CtId

)

</td></tr><tr><td>
Iccsn

</td><td>
Iccsn einer Karte

</td></tr><tr><td>
CardHandle

</td><td>
CardHandle

einer

Karte.

Unterstützt werden die Kartentypen EGK, KVK, HBAx, SM-B, SMC-KT und UNKNOWN.

</td></tr><tr><td colspan="2">
Wurde keines der Elemente

CtId

,

SlotId

,

Iccsn

übergeben, so wird davon ausgegangen, dass der Aufrufer Informationen zum
Konnektor selbst abfragen möchte.

</td></tr><tr><td rowspan="20">
Rückgabe

</td><td colspan="2">
![Img-031][Img-031]

</td></tr><tr><td>
Name

</td><td>
Beschreibung

</td></tr><tr><td>
Status

</td><td>
Ergebnis der Operation

</td></tr><tr><td>
Card

</td><td>
Informationen einer Karte (siehe

GetCards

)

</td></tr><tr><td>
CardTerminal

</td><td>
Informationen eines Kartenterminals (siehe

GetCardTerminals

)

</td></tr><tr><td>
Connector

</td><td>
Informationen zum Konnektor

</td></tr><tr><td colspan="2">
![Img-032][Img-032]

</td></tr><tr><td>
VPNTIStatus

</td><td>
</td></tr><tr><td>
VPNTIStatus/

ConnectionStatus

</td><td>
Status der VPN-Verbindung zur TI (Online oder Offline)

</td></tr><tr><td>
VPNTIStatus/

Timestamp

</td><td>
Zeitstempel der letzten Statusänderung

</td></tr><tr><td>
VPNSISSTatus

</td><td>
</td></tr><tr><td>
VPNSISStatus/

ConnectionStatus

</td><td>
Status der VPN-Verbindung des SIS (Online oder Offline)

</td></tr><tr><td>
VPNSISStatus/

Timestamp

</td><td>
Zeitstempel der letzten Statusänderung

</td></tr><tr><td>
OperatingState

</td><td>
Betriebszustand (siehe Kapitel

3.3)

</td></tr><tr><td>
OperatingState/

ErrorState

</td><td>
Eine Zeile der Fehlerzustandsliste gemäß

Tabelle TAB_KON_503 Betriebszustand_Fehlerzustandsliste

</td></tr><tr><td>
OperatingState/

ErrorState/

ErrorCondition

</td><td>
ErrorCondition

gemäß

Tabelle TAB_KON_503 Betriebszustand_Fehlerzustandsliste

</td></tr><tr><td>
OperatingState/

ErrorState/Severity

</td><td>
Schwere des Fehlerzustandes gemäß

Tabelle TAB_KON_503 Betriebszustand_Fehlerzustandsliste

</td></tr><tr><td>
OperatingState/

ErrorState/Type

</td><td>
Fehlertyp gemäß

Tabelle TAB_KON_503 Betriebszustand_Fehlerzustandsliste

</td></tr><tr><td>
OperatingState/

ErrorState/Value

</td><td>
Fehlerzustandswert

</td></tr><tr><td>
OperatingState/

ErrorState/ValidFrom

</td><td>
Zeitstempel der letzten Änderung des Fehlerzustands

</td></tr><tr><td>
Vorbedingung

</td><td colspan="2">
</td></tr><tr><td>
Nachbedingung

</td><td colspan="2">
Der Zustand der Ressource bleibt unverändert.

</td></tr><tr><td>
Hinweise

</td><td colspan="2">
</td></tr></table>

Der Ablauf der Operation GetResourceInformation ist in Tabelle TAB_KON_569
Ablauf GetResourceInformation beschrieben:

Tabelle150: TAB_KON_569 Ablauf GetResourceInformation

<table><tr><th>
Nr.

</th><th>
Aufruf Technischer Use Case oder Interne Operation

</th><th>
Beschreibung

</th></tr><tr><td>
1.

</td><td>
checkArguments

</td><td>
Die übergebenen Werte werden auf Konsistenz und Gültigkeit überprüft.
Insbesondere wird geprüft, dass eine

SlotId

nur in Verbindung mit einer

CtId

übergeben werden kann (Abfrage einer Karte). Treten hierbei Fehler auf, so
bricht die Operation mit Fehler 4000 ab.

</td></tr><tr><td>
2.

</td><td>
TUC_KON_000 „Prüfe Zugriffs- berechtigung“

</td><td>
Die Prüfung erfolgt,

falls die Ressource der Konnektor ist, durch den Aufruf

TUC_KON_000 {

    mandantId = $context.mandantId;

    clientSystemId = $context.clientsystemId;

    workplaceId = $context.workplaceId;

    ctId = null;

    cardHandle = null;

    needCardSession = false;

    allWorkplaces = true

}

falls die Ressource ein Kartenterminal ist, durch den Aufruf

TUC_KON_000 {

    mandantId = $context.mandantId;

    clientSystemId = $context.clientsystemId;

    workplaceId = $context.workplaceId;

    ctId = $ctId;

    cardHandle = null;

    needCardSession = false;

    allWorkplaces = true

}

falls die Ressource eine Karte ist, durch den Aufruf

TUC_KON_000 {

    mandantId = $context.mandantId;

    clientSystemId = $context.clientsystemId;

    workplaceId = $context.workplaceId;

    ctId = null;

    cardHandle = $cardHandle;

    needCardSession = false;

    allWorkplaces = false

}

Tritt bei der Prüfung ein Fehler auf, bricht die Operation mit Fehlercode aus
TUC_KON_000 ab.

</td></tr><tr><td>
3.

</td><td>
TUC_KON_254 „Liefere Ressourcendetails“

</td><td>
Die Informationen zu der Ressource werden zusammengetragen und zurückgegeben.
Tritt hierbei ein Fehler auf, so bricht die Operation mit dem Fehler des TUCs
ab.

</td></tr></table>

Die Fehlerfälle der Operation GetResourceInformation sind in Tabelle
TAB_KON_570 Fehlercodes „GetResourceInformation dargestellt:

Tabelle151: TAB_KON_570 Fehlercodes „GetResourceInformation“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weiteren Fehlercodes auftreten:

</td></tr><tr><td>
4000

</td><td>
Technical

</td><td>
Error

</td><td>
Syntaxfehler

</td></tr></table>

**[\<=]**

### 4.1.6.5.4 Subscribe

##### TIP1-A_4608

Der Konnektors MUSS an der Außenschnittstelle eine Operation Subscribe, wie in
Tabelle TAB_KON_571 Operation Subscribe beschrieben, anbieten.

Tabelle152: TAB_KON_571 Operation Subscribe

<table><tr><th>
Name

</th><th colspan="3">
Subscribe

</th></tr><tr><td>
Beschreibung

</td><td colspan="3">
Clientsysteme melden mit dieser Operation ihr Interesse an bestimmten Topics
(Ereignissen) an.

</td></tr><tr><td rowspan="8">
Aufrufparameter

</td><td colspan="3">


</td></tr><tr><td colspan="2">
Name

</td><td>
Beschreibung

</td></tr><tr><td colspan="2">
Context

</td><td>
Aufrufkontext

</td></tr><tr><td colspan="2">
SubscriptionID

</td><td>
Darf nicht verwendet werden

</td></tr><tr><td colspan="2">
TerminationTime

</td><td>
Darf nicht verwendet werden

</td></tr><tr><td colspan="2">
EventTo

</td><td>
URL des Endpunkts, wo die Ereignisse zugestellt werden sollen.
Syntax:cetp://host:porthost: IP-Adresse oder FQDN des Clientsystems.port:
Portnummer des Kommunikationsendpunkts, an dem das Clientsystem auf die
Zustellung der Ereignisse wartet.

</td></tr><tr><td colspan="2">
Topic

</td><td>
Ein Topic, für das das Clientsystem sein Interesse anmeldet.

</td></tr><tr><td colspan="2">
Filter

</td><td>
Filter für die Ereignisnachricht (X-Path Ausdruckim Kontext mit Default
Namespace gleich "http://ws.gematik.de/conn/EventService/v7.2" ohne Verwendung
eines Namespace-Präfixes sowie Namensraum mit Präfix EVT gleich
"http://ws.gematik.de/conn/EventService/v7.2", der beim Versand von Ereignissen
in TUC_KON_256 ausgewertet wird. Ermöglicht die Filterung auf Basis der
Elemente einer XML-Ereignisnachricht)

</td></tr><tr><td rowspan="5">
Rückgabe

</td><td colspan="3">


</td></tr><tr><td>
Name

</td><td colspan="2">
Beschreibung

</td></tr><tr><td>
Status

</td><td colspan="2">
Ergebnis der Operation

</td></tr><tr><td>
SubscriptionID

</td><td colspan="2">
Ein Identifikator, der die Anmeldung für die Topics eindeutig identifiziert.
Bei den OperationenUnsubscribe,GetSubscriptionundRenewSubsriptionsMUSS
dieserSubscriptionIDangegeben werden.

</td></tr><tr><td>
TerminationTime

</td><td colspan="2">
Maximaler Gültigkeitszeitpunkt der Subscription. Sie MUSS auf Systemzeit + 25 h
gesetzt werden.

</td></tr><tr><td>
Vorbedingung

</td><td colspan="3">
Das Clientsystem muss die Ereignissenke realisieren.

</td></tr><tr><td>
Nachbedingung

</td><td colspan="3">
Nach erfolgreicher Anmeldung vermerkt der Konnektor dasangemeldete Topic unter
demSubscriptionID.Der Konnektor muss die Anmeldungen so lange als gültig
behandeln, bis entweder das Clientsystem diese explizit abmeldet oder der
Konnektor das Clientsystem als nicht mehr erreichbarerkennt (siehe nächsten
Punkt) oder der Konnektor neu gestartet oder ausgeschaltet wird oder die
TerminationTime kleiner als die Systemzeit ist.Der Konnektor muss die Anmeldung
aus seiner Verwaltung entfernen („Auto-Unsubscribe“), wenn EVT_MAX_TRY
Verbindungsaufbauversuche oder zählbare Zustellungsversuche (z.B. durch
Zählung beim Absenden der Zustellversuche) in Folge fehlgeschlagen sind. Wenn
die Ereignissenke Zustellungen grundsätzlich nicht beantwortet, so sind nur
die Verbindungsaufbauversuche zu zählen.

</td></tr><tr><td>
Hinweise

</td><td colspan="3">


</td></tr></table>

Der Ablauf der Operation Subscribe ist in Tabelle TAB_KON_572 Ablauf Subscribe
beschrieben:

Tabelle153: TAB_KON_572 Ablauf Subscribe

<table><tr><th>
Nr.

</th><th>
Aufruf Technischer Use Case oder Interne Operation

</th><th>
Beschreibung

</th></tr><tr><td>
1.

</td><td>
checkArguments

</td><td>
Die übergebenen Werte werden auf Konsistenz und Gültigkeit überprüft. Treten
hierbei Fehler auf, so bricht die Operation mit Fehler 4000 ab.

</td></tr><tr><td>
2.

</td><td>
TUC_KON_000 „Prüfe Zugriffs- berechtigung“

</td><td>
Die Prüfung erfolgt durch den AufrufTUC_KON_000 _000 {    mandantId =
$context.mandantId;    clientsystemId  =
$context.clientsystemId;    workplaceId =
$context.workplaceId;    needCardSession = false;    allWorkplaces
=true }Tritt bei der Prüfung ein Fehler auf, so bricht die Operation mit dem
Fehlercode aus TUC_KON_000 ab.

</td></tr><tr><td>
3.

</td><td>
saveSubscription

</td><td>
Die Anmeldung wird im Konnektor hinterlegt. Vorgehalten werden folgende Daten:

 ---> UL

Bei der Übernahme wird eine eindeutigeSubscriptionIdgeneriert, die dem
aufrufenden System zurückgegeben wird, falls die Subscription noch nicht
existiert. Existiert sie bereits, wird die
bestehendeSubscriptionIDzurückgegeben.

</td></tr></table>

Die Fehlerfälle der Operation Subscribe sind in Tabelle TAB_KON_573 Fehlercodes
„Subscribe dargestellt:

Tabelle154TAB_KON_573 Fehlercodes „Subscribe“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weiteren Fehlercodes auftreten:

</td></tr><tr><td>
4000

</td><td>
Technical

</td><td>
Error

</td><td>
Syntaxfehler

</td></tr></table>

​​ **[\<=]**

### 4.1.6.5.5 Unsubscribe

##### TIP1-A_4609

Der Konnektors MUSS an der Außenschnittstelle eine Operation Unsubscribe, wie
in Tabelle TAB_KON_574 Operation Unsubscribe beschrieben, anbieten.

Tabelle155: TAB_KON_574 Operation Unsubscribe

<table><tr><th>
Name

</th><th colspan="3">
Unsubscribe

</th></tr><tr><td>
Beschreibung

</td><td colspan="3">
Löscht eine Anmeldung mit dem angegebenenSubscriptionIDoder alle Anmeldungen zu
einem EndpunktEventTo.

</td></tr><tr><td rowspan="5">
Aufrufparameter

</td><td colspan="3">


</td></tr><tr><td colspan="2">
Name

</td><td>
Beschreibung

</td></tr><tr><td colspan="2">
Context

</td><td>
Aufrufkontext

</td></tr><tr><td colspan="2">
SubscriptionID

</td><td>
Der Identifikator, der bei derSubscribe-Operation geliefert wurde.

</td></tr><tr><td colspan="2">
EventTo

</td><td>
URL des clientseitigen Endpunkts, wie er bei derSubscribe-Operation angegeben
wurde.

</td></tr><tr><td rowspan="3">
Rückgabe

</td><td colspan="3">


</td></tr><tr><td>
Name

</td><td colspan="2">
Beschreibung

</td></tr><tr><td>
Status

</td><td colspan="2">
Ergebnis der Operation

</td></tr><tr><td>
Vorbedingung

</td><td colspan="3">
Die AnmeldungSubscribemuss vor dieser Operation aufgerufen worden sein.

</td></tr><tr><td>
Nachbedingung

</td><td colspan="3">
Der Konnektor entfernt aus seiner Verwaltung die Subscription
zurSubscription-IDbzw. alle Subscriptions zur clientseitigen URL
desEndpunktsEventTo.

</td></tr><tr><td>
Hinweise

</td><td colspan="3">
Keine

</td></tr></table>

Der Ablauf der Operation Unsubscribe ist in Tabelle TAB_KON_575 Ablauf
Unsubscribe beschrieben:

Tabelle156: TAB_KON_575 Ablauf Unsubscribe

<table><tr><th>
Nr.

</th><th>
Aufruf Technischer Use Case oder Interne Operation

</th><th>
Beschreibung

</th></tr><tr><td>
1.

</td><td>
checkArguments

</td><td>
Die übergebenen Werte werden auf Konsistenz und Gültigkeit überprüft. Treten
hierbei Fehler auf, so bricht die Operation mit Fehler 4000 ab.

</td></tr><tr><td>
2.

</td><td>
TUC_KON_000 „Prüfe Zugriffs- berechtigung“

</td><td>
Die Prüfung erfolgt durch den AufrufTUC_KON_000 {      mandantId =
$context.mandantId;      clientsystemId  =
$context.clientsystemId;      workplaceId =
$context.workplaceId;      needCardSession =
false;      allWorkplaces =true }Tritt bei der Prüfung ein Fehler auf,
bricht die Operation mit Fehlercode aus TUC_KON_000 ab.

</td></tr><tr><td>
3.

</td><td>
removeSubscription

</td><td>
Entfernen der Subscriptions aus der Liste aller Subscriptions.

</td></tr></table>

Die Fehlerfälle der Operation Unsubscribe sind in Tabelle TAB_KON_576
Fehlercodes „Unsubscribe dargestellt:

Tabelle157: TAB_KON_576 Fehlercodes „Unsubscribe“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weiteren Fehlercodes auftreten:

</td></tr><tr><td>
4000

</td><td>
Technical

</td><td>
Error

</td><td>
Syntaxfehler

</td></tr><tr><td>
4102

</td><td>
Technical

</td><td>
Error

</td><td>
ungültige SubscriptionId

</td></tr></table>

​​ **[\<=]**

### 4.1.6.5.6 RenewSubscriptions

##### TIP1-A_5112

Der Konnektors MUSS an der Außenschnittstelle eine Operation
RenewSubscriptions, wie in Tabelle TAB_KON_792 Operation RenewSubscriptions
beschrieben, anbieten.

Tabelle158: TAB_KON_792 Operation RenewSubscriptions

<table><tr><th>
Name

</th><th colspan="3">
RenewSubscriptions

</th></tr><tr><td>
Beschreibung

</td><td colspan="3">
Verlängert die Gültigkeit einer Liste von Anmeldungen, die jeweils
perSubscriptionIDidentifiziert werden.

</td></tr><tr><td rowspan="4">
Aufrufparameter

</td><td colspan="3">


</td></tr><tr><td colspan="2">
Name

</td><td>
Beschreibung

</td></tr><tr><td colspan="2">
Context

</td><td>
Aufrufkontext

</td></tr><tr><td colspan="2">
SubscriptionID

</td><td>
Der Identifikator, der bei derSubscribe-Operation geliefert wurde.

</td></tr><tr><td rowspan="5">
Rückgabe

</td><td colspan="3">


</td></tr><tr><td>
Name

</td><td colspan="2">
Beschreibung

</td></tr><tr><td>
Status

</td><td colspan="2">
Ergebnis der Operation

</td></tr><tr><td>
SubscriptionID

</td><td colspan="2">
Ein Identifikator, der die Anmeldung für die Topics eindeutig identifiziert.
Bei den OperationenUnsubscribe, GetSubscriptionundRenewSubsriptionsMUSS
dieseSubscriptionIDangegeben werden.

</td></tr><tr><td>
TerminationTime

</td><td colspan="2">
Maximaler Gültigkeitszeitpunkt der Subscription. Sie MUSS auf Systemzeit + 25 h
gesetzt werden.

</td></tr><tr><td>
Vorbedingung

</td><td colspan="3">


</td></tr><tr><td>
Nachbedingung

</td><td colspan="3">
Der Konnektor speichert jede neu vergebeneTerminationTimein seiner Verwaltung
der Subscriptions.

</td></tr><tr><td>
Hinweise

</td><td colspan="3">
Keine

</td></tr></table>

Der Ablauf der Operation RenewSubscriptions ist in Tabelle TAB_KON_793 Ablauf
RenewSubscriptions beschrieben:

Tabelle159: TAB_KON_793 Ablauf RenewSubscriptions

<table><tr><th>
Nr.

</th><th>
Aufruf Technischer Use Case oder Interne Operation

</th><th>
Beschreibung

</th></tr><tr><td>
1.

</td><td>
checkArguments

</td><td>
Die übergebenen Werte werden auf Konsistenz und Gültigkeit überprüft. Treten
hierbei Fehler auf, so bricht die Operation mit Fehler 4000 ab.

</td></tr><tr><td>
2.

</td><td>
TUC_KON_000 „Prüfe Zugriffs- berechtigung“

</td><td>
Die Prüfung erfolgt durch den AufrufTUC_KON_000 {      mandantId =
$context.mandantId;      clientsystemId  =
$context.clientsystemId;      workplaceId =
$context.workplaceId;      needCardSession =
false;      allWorkplaces =true }Tritt bei der Prüfung ein Fehler auf,
bricht die Operation mit Fehlercode aus TUC_KON_000 ab.

</td></tr><tr><td>
3.

</td><td>
renewSubscriptions

</td><td>
Es wird eine neueSubscribeRenewals-Liste angelegt.Alle Subscriptions,
derenTerminationTimekleiner als die Systemzeit sind, muss der Konnektor aus der
Verwaltung entfernen.Für jedeSubscriptionID, die in der Verwaltung der
Subscriptions existiert und derenTerminationTimegrößer als die Systemzeit
ist, wird eine neueTerminationTime = Systemzeit + 25hbestimmt. Diese wird
zusammen mit derSubscriptionIDalsSubscribeRenewalderSubscribeRenewals-Liste
hinzugefügt.Kommt es zu keiner Subscription-Verlängerung, weil nur ungültige
SubscriptionIDs im Aufruf angegeben waren, wird der Fehler 4102
zurückgeliefert. Kommt es zu mindestens einer Subscription-Verlängerung, sind
aber auch ungültige SubscriptionIDs im Aufruf, wird eine
RenewSubscriptionsResponse zurückgeliefert, mit CONN:Status/CONN:Result =
"Warning", GERROR:Trace mit {Fehlercode: 4102, ErrorType: Technical, Severity:
Error, Fehlertext: "Ungültige SubscriptionId"}, und der Information, welche
SubscriptionsIDs ungültig waren.

</td></tr></table>

Die Fehlerfälle der Operation RenewSubscriptions sind in Tabelle TAB_KON_794
Fehlercodes „RenewSubscriptions dargestellt:

Tabelle160: TAB_KON_794 Fehlercodes „RenewSubscriptions“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weiteren Fehlercodes auftreten:

</td></tr><tr><td>
4000

</td><td>
Technical

</td><td>
Error

</td><td>
Syntaxfehler

</td></tr><tr><td>
4102

</td><td>
Technical

</td><td>
Error

</td><td>
Ungültige SubscriptionId

</td></tr></table>

​​ **[\<=]**

### 4.1.6.5.7 GetSubscription

##### TIP1-A_4610

Der Konnektor MUSS an der Außenschnittstelle eine Operation GetSubscription,
wie in Tabelle TAB_KON_577 Operation GetSubscription beschrieben, anbieten.

Tabelle161: TAB_KON_577 Operation GetSubscription

<table><tr><th>
Name

</th><th colspan="2">
GetSubscription

</th></tr><tr><td>
Beschreibung

</td><td colspan="2">
Gibt die Liste der angemeldeten Topics zurück

</td></tr><tr><td rowspan="5">
Aufrufparameter

</td><td colspan="2">


</td></tr><tr><td>
Name

</td><td>
Beschreibung

</td></tr><tr><td>
@mandant-wide

</td><td>
Wenn „true“, werden alle Subscriptions zurückgegeben, die Mandant und
Clientsystem zugeordnet sind.Wenn „false“(Standardbelegung) werden alle
Subscriptions zurückgegeben, die dem im Aufrufkontext spezifizierten Tripel
aus Clientsystem, Mandanten und  Arbeitsplatz zugeordnet sind.

</td></tr><tr><td>
Context

</td><td>
Aufrufkontext

</td></tr><tr><td>
SubscriptionID

</td><td>
Der Identifikator, der bei derSubscribe-Operation geliefert wurde.

</td></tr><tr><td rowspan="11">
Rückgabe

</td><td colspan="2">


</td></tr><tr><td>
Name

</td><td>
Beschreibung

</td></tr><tr><td>
Status

</td><td>
Ergebnis der Operation

</td></tr><tr><td>
Subscriptions

</td><td>
Die Liste Subscriptions (vgl. OperationSubscribe)

</td></tr><tr><td colspan="2">


</td></tr><tr><td>
Subscription

</td><td>
Angefordertes Subscription-Element

</td></tr><tr><td>
Subscription/SubscriptionID

</td><td>
Identifikator der Subscription

</td></tr><tr><td>
Subscription/TerminationTime

</td><td>
Maximaler Gültigkeitszeitpunkt der Subscription.

</td></tr><tr><td>
Subscription/EventTo

</td><td>
URL des Endpunkts, wo die Ereignisse zugestellt werden sollen (Ereignissenke)

</td></tr><tr><td>
Subscription/Topic

</td><td>
Angemeldeter Topic

</td></tr><tr><td>
Subscription/Filter

</td><td>
Filterausdruck (falls vorhanden)

</td></tr><tr><td>
Vorbedingung

</td><td colspan="2">
Keine

</td></tr><tr><td>
Nachbedingung

</td><td colspan="2">
Die Liste der Subscriptions bliebt unverändert

</td></tr><tr><td>
Hinweise

</td><td colspan="2">
Keine

</td></tr></table>

Der Ablauf der Operation GetSubscription ist in Tabelle TAB_KON_578 Ablauf
GetSubscription beschrieben:

Tabelle162: TAB_KON_578 Ablauf GetSubscription

<table><tr><th>
Nr.

</th><th>
Aufruf Technischer Use Case oder Interne Operation

</th><th>
Beschreibung

</th></tr><tr><td>
1.

</td><td>
checkArguments

</td><td>
Die übergebenen Werte werden auf Konsistenz und Gültigkeit überprüft. Treten
hierbei Fehler auf, so bricht die Operation mit Fehler 4000 ab.

</td></tr><tr><td>
2.

</td><td>
TUC_KON_000 „Prüfe Zugriffs- berechtigung“

</td><td>
Die Prüfung erfolgt durch den AufrufTUC_KON_000 {    mandantId =
$context.mandantId;    clientsystemId  =
$context.clientsystemId;    workplaceId =
$context.workplaceId;    needCardSession = false;    allWorkplaces =
@mandant-wide }Tritt bei der Prüfung ein Fehler auf, bricht die Operation mit
Fehlercode aus TUC_KON_000 ab.

</td></tr><tr><td>
3.

</td><td>
getSubscriptions

</td><td>
Rückgabe der Subscription, die durchSubscriptionIdidentifiziert wird.Wurde
keineSubscriptionIdangegeben und @mandant-wide="true", werden alle
Subscriptions zurückgegeben, die dem angegebenen Clientsystem und Mandanten
zugeordnet werden können.Wurde keine SubscriptionId angegeben und
@mandant-wide="false", werden alle Subscriptions zurückgegeben, die dem
angegebenen Clientsystem, Mandanten und Arbeitsplatz zugeordnet werden können.

</td></tr></table>

Die Fehlerfälle der Operation GetSubscription sind in Tabelle TAB_KON_579
Fehlercodes „GetSubscription dargestellt:

Tabelle163: TAB_KON_579 Fehlercodes „GetSubscription“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weiteren Fehlercodes auftreten:

</td></tr><tr><td>
4000

</td><td>
Technical

</td><td>
Error

</td><td>
Syntaxfehler

</td></tr><tr><td>
4102

</td><td>
Technical

</td><td>
Error

</td><td>
ungültige SubscriptionId

</td></tr></table>

​​ **[\<=]**

### 4.1.6.6 Betriebsaspekte

##### TIP1-A_4611

Die Managementschnittstelle MUSS es einem Administrator ermöglichen
Konfigurationsänderungen gemäß Tabelle TAB_KON_580vorzunehmen:

Tabelle164: TAB_KON_580 Konfigurationswerte des Systeminformationsdienstes
(Administrator)

<table><tr><th>
ReferenzID

</th><th>
Belegung

</th><th>
Bedeutung und Administrator-Interaktion

</th></tr><tr><td>
EVT_MAX_TRY

</td><td>
Nummer

</td><td>
DerAdministrator MUSS über diesen Konfigurationsparameter die Anzahl der
Fehlversuche bzgl. Verbindungsversuche bzw. Ereigniszustellungen festlegen
können.  

Ist diese maximal zulässige Anzahl der Fehlversuche überschritten, muss der
Konnektor automatisch ein „Auto-Unsubscribe“(analog Operation
„Unsubscribe“mit „EventTo gleich der URL des clientseitigen Endpunkts“)
durchführen.

</td></tr></table>

**[\<=]**

##### TIP1-A_4612

Der Konnektor MUSS eine Mindestmenge von 999 Subscriptions insgesamt
unterstützen. Der Konnektorhersteller kann jedoch die Anzahl der maximal
möglichen Subscriptions (insgesamt und/oder pro Ziel) festlegen. **[\<=]**

##### TIP1-A_4613

Der Konnektor MUSS beim Bootupmit einer leeren Liste an Subscriptions starten. **[\<=]**

### 4.1.7 Verschlüsselungsdienst

Der Verschlüsselungsdienst bietet Schnittstellen zum hybriden und symmetrischen
Ver- und Entschlüsseln von Dokumenten an.

Der Verschlüsselungsdienst bietet für alleAlle_DocFormatedie hybride und
symmetrische Ver- und Entschlüsselung nach dem Cryptographic Message Syntax
(CMS) Standard an [RFC5652].

Darüber hinaus werden folgende formaterhaltende
Ver-/Entschlüsselungsmechanismen unterstützt:

 ---> UL

Der Konnektor kann optional folgende formaterhaltende
Ver-/Entschlüsselungsmechanismen unterstützen:

 ---> UL

Dabei soll der Konnektor, wenn er die S/MIME-Verschlüsselung unterstützt, auch
die S/MIME-Entschlüsselung unterstützen.

Der Konnektor muss bezüglich der zur Ver- und Entschlüsselung von Dokumenten
verwendeten Verfahren und Algorithmen die Vorgaben in [gemSpec_Krypt#3.1.4]
sowie in [gemSpec_Krypt#3.1.5] und hinsichtlich ECC-Migration die Vorgaben aus
[gemSpec_Krypt#5] erfüllen.

### 4.1.7.1 Funktionsmerkmalweite Aspekte

##### TIP1-A_4614

DerKonnektorsMUSS zur Unterstützung von Missbrauchserkennungen die in Tabelle
TAB_KON_581 gelisteten Operationen als Einträge in EVT_MONITOR_OPERATIONS
berücksichtigen.

Tabelle165:TAB_KON_581Verschlüsselungsdienst-Operationen
fürEVT_MONITOR_OPERATIONS

<table><tr><th>
Operationsname

</th><th>
OK_Val

</th><th>
NOK_Val

</th><th>
Alarmwert (Default-Grenzwert 10 Minuten-Σ)

</th></tr><tr><td>
EncryptDocument

</td><td>
1

</td><td>
5

</td><td>
101

</td></tr><tr><td>
DecryptDocument

</td><td>
1

</td><td>
5

</td><td>
101

</td></tr></table>

**[\<=]**

##### TIP1-A_5434

Der Konnektor MUSS das Operationspaar Verschlüsselung/Entschlüsselung so
implementieren, dass Dokumente vom Typ XML unverändert bleiben, wobei zwei
XML-Dokumente als identisch zu betrachten sind, wenn sie gemäß Canonical XML
1.1 gleich sind [CanonXML1.1]. **[\<=]**

##### A_17746

Der Konnektor MUSS für die kartenbasierte Ver- und Entschlüsselung die
Zertifikate und Schlüssel in Abhängigkeit vom kryptographischen Verfahren
unter Berücksichtigung des Einsatzbereiches aus TAB_KON_747 ermitteln.
**[\<=]**

<table><tr><th rowspan="2">
Karte

</th><th rowspan="2">
KeyReference 

</th><th rowspan="2">
Crypt

</th><th rowspan="2">
Zertifikat (Encrypt)

...in DF.ESIGN

</th><th rowspan="2">
Schlüssel (Decrypt)

...in DF.ESIGN

</th><th colspan="2">
Einsatzbereich

</th></tr><tr><td>
Außen-schnittstelle

</td><td>
Fachmodul-schnittstelle

</td></tr><tr><td rowspan="3">
HBA

</td><td rowspan="3">
C.ENC

</td><td>
RSA_ECC

</td><td>
EF.C.HP.ENC.R2048

EF.C.HP.ENC.E256

</td><td>
PrK.HP.ENC.R2048

PrK.HP.ENC.E256

</td><td>
Ja

</td><td>
Ja

</td></tr><tr><td>
ECC

</td><td>
EF.C.HP.ENC.E256

</td><td>
PrK.HP.ENC.E256

</td><td>
Ja

</td><td>
Ja

</td></tr><tr><td>
RSA

</td><td>
EF.C.HP.ENC.R2048

</td><td>
PrK.HP.ENC.R2048

</td><td>
Ja

</td><td>
Ja

</td></tr><tr><td rowspan="3">
SM-B

</td><td rowspan="3">
C.ENC

</td><td>
RSA_ECC

</td><td>
EF.C.HCI.ENC.R2048

EF.C.HCI.ENC.E256

</td><td>
PrK.HCI.ENC.R2048

PrK.HP.ENC.E256

</td><td>
Ja

</td><td>
Ja

</td></tr><tr><td>
ECC

</td><td>
EF.C.HCI.ENC.E256

</td><td>
PrK.HP.ENC.E256

</td><td>
Ja

</td><td>
Ja

</td></tr><tr><td>
RSA

</td><td>
EF.C.HCI.ENC.R2048

</td><td>
PrK.HCI.ENC.R2048

</td><td>
Ja

</td><td>
Ja

</td></tr><tr><td>
HBA-VK

</td><td>
C.ENC

</td><td>
RSA_ECC

RSA

</td><td>
EF.C.HP.ENC

</td><td>
PrK.HP.ENC

</td><td>
Ja

</td><td>
Ja

</td></tr><tr><td rowspan="2">
eGK

</td><td>
C.ENC

</td><td>
ECC

</td><td>
C.CH.ENC.E256

</td><td>
PrK.CH.ENC.E256

</td><td>
Nein

</td><td>
Ja

</td></tr><tr><td>
C.ENC

</td><td>
RSA

</td><td>
C.CH.ENC.R2048

</td><td>
PrK.CH.ENC.R2048

</td><td>
Nein

</td><td>
Ja

</td></tr></table>

<table><tr><th>
Typname

</th><th>
Werteliste

</th><th>
Defaultwert

</th><th>
Bedeutung

</th></tr><tr><td>
ENC_CRYPT

</td><td>
RSA

ECC

RSA_ECC

</td><td>
RSA

</td><td>
Werteliste des Parameters crypt bei der hybriden Verschlüsselung

RSA: Es wird RSA-2048 basiert verschlüsselt.

ECC: Es wird ECC-256 basiert verschlüsselt.

RSA_ECC: Es wird dual RSA-2048 basiert und ECC-256 basiert verschlüsselt. Es
wird als Fehlerfall gewertet, wenn weder RSA- noch ECC-Zertifikat von der Karte
geladen werden konnten, und als Warnung, wenn nur ein Zertifikat geladen werden
konnte.

</td></tr></table>

### 4.1.7.2 Durch Ereignisse ausgelöste Reaktionen

Keine.

### 4.1.7.3 Interne TUCs, nicht durch Fachmodule nutzbar

Keine.

### 4.1.7.4 Interne TUCs, auch durch Fachmodule nutzbar

Die in diesem Kapitel beschriebenen TUCs zur hybriden Ver- und Entschlüsselung
werden den Fachmodulen und Außenoperationen angeboten. Die TUCs zur
symmetrischen Ver-/Entschlüsselung werden den Fachmodulen angeboten. Es gibt
keine Aufrufhierarchie innerhalb der hier beschriebenen TUCs zur hybriden und
symmetrischen Ver-/Entschlüsselung.

### 4.1.7.4.1 TUC_KON_070 „Daten hybrid verschlüsseln”

##### TIP1-A_4616-03

Der Konnektor MUSS den technischen Use Case TUC_KON_070 „Daten hybrid
verschlüsseln” umsetzen.

Tabelle168: TAB_KON_739 - TUC_KON_070 „Daten hybrid verschlüsseln“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_070 „Daten hybrid verschlüsseln“

</td></tr><tr><td>
Beschreibung

</td><td>
Dieser TUC verschlüsselt ein Dokument oder Teile eines Dokumentes. Die
Verschlüsselung erfolgt zweistufig, d. h. die Daten werden symmetrisch mit
einem generierten Schlüssel verschlüsselt und anschließend wird dieser
Schlüssel mit einem asymmetrischen Verfahren verschlüsselt.  
Die
asymmetrische Verschlüsselung des symmetrischen Schlüssels kann für mehrere
Identitäten, repräsentiert durch X.509-Zertifikate oder öffentliche
Schlüssel, erfolgen. Das Ergebnis sind entsprechend viele Verschlüsselungen
desselben symmetrischen Schlüssels.  
Es werden die folgenden
formaterhaltenden Verschlüsselungsverfahren für die genannten Dokumententypen
unterstützt:

 ---> UL

Des Weiteren ist für alle unterstützten Dokumentformate (Alle_DocFormate) die
Verschlüsselung mit CMS [RFC5652] möglich.

</td></tr><tr><td>
Auslöser

</td><td>
Aufruf durch einen Fachmodul-TUC oder durch die Operation EncryptDocument des
Verschlüsselungsbasisdienstes

</td></tr><tr><td>
Vorbedingungen

</td><td>
Falls mit einem öffentlichen Schlüssel auf einer Karte verschlüsselt werden
soll, muss die Karte gesteckt sein.

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor, Kartenterminal, Karte

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

 ---> OL

</td></tr><tr><td>
Varianten/  
Alternativen

</td><td>
Zur Rückgabe der Hybridschlüssel MUSS auch die Variante vorgesehen werden,
dass die Hybridschlüssel („KeyInfo“) nicht eingebettet im Zieldokument
zurückgegeben werden, sondern separat.  
Im Fall des
Verschlüsselungsverfahrens S/MIME wird der Standardablauf des CMS
Verschlüsselungsverfahrens durch einen vorgelagerten
S/MIME-Vorbereitungsschritt und einen nachgelagerten
S/MIME-Nachbereitungsschritt ergänzt. Das S/MIME-Verfahren MUSS konform
[S/MIME] und SOLL konform [COMMON_PKI#Part 3] erfolgen.  
Der
S/MIME-Vorbereitungsschritt bereitet das übergebene MIME-Dokument gemäß
[S/MIME#3.1] auf die nachfolgende CMS-Verschlüsselung durch eine Kanonisierung
für Text [S/MIME#3.1.1] vor. Eine weitere Kanonisierung oder eine Anpassung
des Transfer Encodings [S/MIME#3.1.2] erfolgt nicht.  
Im
S/MIME-Nachbereitungsschritt wird das im Standardablauf erzeugt CMS-Objekt in
eine MIME-Nachricht vom Typ „application/pkcs7-mime“ eingebettet. 

Sämtliche Header-Felder der Nachricht MÜSSEN in die Header-Felder der
S/MIME-Nachricht übernommen werden. Die im Folgenden explizit zu setzenden
Header-Felder überschreiben die betroffenen Header-Felder.  
Es MUSS ein neues
message-id Element für den S/MIME-Header generiert werden.  
"MIME-Version:
1.0" MUSS definiert sein.  
Das Feld "Subject" MUSS mit "Subject:
Verschlüsselte Nachricht" überschrieben werden.  
Die Codierung des
verschlüsselten Inhalts der Nachricht MUSS in "base64" erfolgen. Entsprechend
ist das zugehörige Header-Feld zu füllen: "Content-Transfer-Encoding:
base64".  
Das Feld "Content-Type:" ist als "application/pkcs7-mime" zu
definieren. Die weiteren Attribute dieses Feldes sind:

 ---> UL

Das Feld "Content-Disposition" definiert den Inhalt der Nachricht als
Dateianhang: "Content-Disposition: attachment; filename=$dateiname"  
Zu Schr

itten 6 und 9 für TI-frem

de X.509-Zertifikate  
Der Konnektor MUSS beim asymmetrischen Anteil der
hybriden Verschlüsselung auch TI-fremde X.509-Zertifikate unterstützen, wenn
diese von einem CA-Zertifikat aus CERT_IMPORTED_CA_LIST ausgestellt wurden und
die kryptographischen Vorgaben aus Tabelle  [gemSpec_Krypt#Tab_KRYPT_002]
erfüllen.  
Der Konnektor MUSS Anfragen zur Hybridverschlüsselung mit einer
Fehlermeldung (Fehler 4200) abweisen, wenn hierfür TI-fremde X509-Zertifikate
vorgegeben werden, die nicht die kryptographischen Vorgaben aus Tabelle 
[gemSpec_Krypt#Tab_KRYPT_002] oder [gemSpec_Krypt#Tab_KRYPT_002a] erfüllen.

</td></tr><tr><td>
Fehlerfälle

</td><td>
Siehe Tabelle TAB_KON_740 Fehlercodes TUC_KON_070 „Daten hybrid
verschlüsseln“. Wenn im Ablauf des TUCs ein anderer Fehler als die in
Tabelle TAB_KON_740 beschriebenen Fehler auftritt, wird Fehler 4105 gemeldet. 

(-\>1) maximale Anzahl von Empfängern überschritten: Fehlercode 4282 

(-\>5) Schritt 5 – Zertifikatsprüfung „für alle anderen Zertifikate“ 

Für MGM_LU_ONLINE=Enabled gilt:  
Liefert die Zertifikatsprüfung
(OCSP-Abfrage) mdt. eine der folgenden Warnungen gemäß
[gemSpec_PKI#Tab_PKI_274]

 ---> UL

dann wird der TUC mit Fehler 4105 abgebrochen,  
Ausnahme: Falls im Falle
crypt=RSA_ECC der Hybridschlüssel nur für eines der beiden Zertifikate
erzeugt werden konnte, dann wird die Warnung 4259 mit \<Zertifikat\>
gemäß TAB_KON_747 in der Response zurückgegeben.

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
Abbildung PIC_KON_058 Aktivitätsdiagramm „Daten hybrid verschlüsseln“ 

Das Diagramm dient nur der Veranschaulichung und ist nicht vollständig.
Beispielsweise enthält es nicht die Steuerung durch den Parameter crypt.

</td></tr></table>

![Abbildung-13][Abbildung-13]

Abbildung13: PIC_KON_058 Aktivitätsdiagramm „Daten hybrid verschlüsseln“

Tabelle169: TAB_KON_073 Vorgaben zum Format verschlüsselter XML-Dokumente

<table><tr><th>
#

</th><th>
Beschreibung

</th></tr><tr><td>
</td><td>
xenc:EncryptedData MUSS ein ds:KeyInfo Element enthalten, welches wiederum ein
xenc:EncryptedKey Element enthält.

</td></tr><tr><td>
</td><td>
Der xenc:EncryptedKey MUSS [XMLEnc] konform sein.

</td></tr><tr><td>
</td><td>
Die xenc:EncryptionMethod für den Schlüssel MUSS gemäß [gemSpec_Krypt#3.1.5]
gewählt werden

</td></tr><tr><td>
</td><td>
Der xenc:EncryptedKey MUSS ein ds:KeyInfo Element mit ds:X509Data und
ds:X509Certificate Subelement enthalten, in dem das X.509-Zertifikat hinterlegt
wird.

</td></tr></table>

Tabelle170: TAB_KON_740 Fehlercodes TUC_KON_070 „Daten hybrid verschlüsseln“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4103

</td><td>
Technical

</td><td>
Error

</td><td>
XML-Element nicht gefunden

</td></tr><tr><td>
4104

</td><td>
Technical

</td><td>
Error

</td><td>
XML-Element nicht eindeutig identifiziert. (Überschneidung)

</td></tr><tr><td>
4105

</td><td>
Technical

</td><td>
Error

</td><td>
hybride Verschlüsselung konnte nicht durchgeführt werden

</td></tr><tr><td>
4200

</td><td>
Security

</td><td>
Error

</td><td>
Schlüssel erlaubt keinen zugelassenen Verschlüsselungsalgorithmus

</td></tr><tr><td>
4259

</td><td>
Technical

</td><td>
Warning

</td><td>
Verschlüsselung für Zertifikat \<Zertifikat\> nicht möglich

</td></tr><tr><td>
4282

</td><td>
Technical

</td><td>
Error

</td><td>
Maximalanzahl von Empfängerzertifikaten überschritten

</td></tr></table>

**[\<=]**

### 4.1.7.4.2 TUC_KON_071 „Daten hybrid entschlüsseln”

##### TIP1-A_4617-02

Der Konnektor MUSS den technischen Use Case TUC_KON_071 „Daten hybrid
entschlüsseln” umsetzen.

Tabelle171: TAB_KON_140 – TUC_KON_071 „Daten hybrid entschlüsseln“

<table><tr><th>
Element

</th><th>
Beschreibung

</th></tr><tr><td>
Name

</td><td>
TUC_KON_071 „Daten hybrid entschlüsseln“

</td></tr><tr><td>
Beschreibung

</td><td>
Ein hybrid verschlüsseltes Dokument, das konform zu TUC_KON_070 erstellt wurde,
wird entschlüsselt.  
Es muss eine asymmetrische Verschlüsselung vorliegen,
zu der der Schlüssel auf einer Karte vorliegt.

</td></tr><tr><td>
Auslöser

</td><td>
Aufruf in einem fachlichen Use Case oder des Verschlüsselungsbasisdienstes.

</td></tr><tr><td>
Vorbedingungen

</td><td>
Die Karte mit dem privaten Schlüssel muss gesteckt sein und der
Sicherheitszustand zur Nutzung des privaten Schlüssels muss gesetzt sein. 

Ein konform zu TUC_KON_070 hybrid verschlüsseltes Dokument liegt vor.  
Bei
XML-Dokumenten: Das Dokument enthält EncryptedData Elemente. Falls mehrere
Elemente des Dokumentes zu entschlüsseln sind, müssen diese alle mit
demselben symmetrischen Schlüssel verschlüsselt sein.

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor, Kartenterminal, Karte

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

</td></tr><tr><td>
Varianten/Alterna-  
tiven

</td><td>
Zu 6.: Zur Unterstützung von Bestandssystemen werden, neben den für den
symmetrischen Teil der hybriden Verschlüsselung vorgeschriebenen
kryptographischen Algorithmen, für den symmetrischen Teil der hybriden
Entschlüsselung auch folgende Algorithmen unterstützt (siehe
[gemSpec_Krypt#3.5.1]):

 ---> UL

RSA- und ECC-basierter Hybridschlüssel:  
Wenn sowohl ein RSA- als auch ein
ECC-basierter Hybridschlüssel vorliegen, muss zuerst die Entschlüsselung des
ECC-basierten Hybridschlüssels erfolgen. Falls dabei ein Fehler auftritt, muss
der Fehler protokolliert werden, und dann - ohne Abbruch - mit der
Entschlüsselung des RSA-basierten Hybridschlüssels fortgefahren werden. 

</td></tr><tr><td>
Fehlerfälle

</td><td>
Siehe Tabelle TAB_KON_142 Fehlercodes TUC_KON_071 „Daten hybrid
entschlüsseln“.  
Wenn im Ablauf des TUCs ein anderer Fehler als die in
Tabelle TAB_KON_142 Fehlercodes TUC_KON_071 „Daten hybrid entschlüsseln“
beschriebenen Fehler auftritt, wird Fehler 4107 gemeldet.

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
Abbildung PIC_KON_059 Aktivitätsdiagramm „Daten hybrid entschlüsseln“

</td></tr></table>

![Img-034][Img-034]

Abbildung14: PIC_KON_059 Aktivitätsdiagramm „Daten hybrid entschlüsseln“

Tabelle172: TAB_KON_142 Fehlercodes TUC_KON_071 „Daten hybrid entschlüsseln“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4106

</td><td>
Technical

</td><td>
Error

</td><td>
falscher Schlüssel

</td></tr><tr><td>
4107

</td><td>
Technical

</td><td>
Error

</td><td>
hybride Entschlüsselung konnte nicht durchgeführt werden

</td></tr><tr><td>
4103

</td><td>
Technical

</td><td>
Error

</td><td>
XML-Element nicht gefunden

</td></tr><tr><td>
4104

</td><td>
Technical

</td><td>
Error

</td><td>
XML-Element nicht eindeutig identifiziert

</td></tr><tr><td>
4201

</td><td>
Technical

</td><td>
Error

</td><td>
kryptographischer Algorithmus vom Konnektor nicht unterstützt

</td></tr></table>

**[\<=]**

### 4.1.7.4.3 TUC_KON_072 „Daten symmetrisch verschlüsseln”

##### TIP1-A_4618

Der Konnektor MUSS den technischen Use Case TUC_KON_072 „Daten symmetrisch
verschlüsseln“ umsetzen.

Tabelle173: TAB_KON_741 – TUC_KON_072 „Daten symmetrisch verschlüsseln“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_072 „Daten symmetrisch verschlüsseln“

</td></tr><tr><td>
Beschreibung

</td><td>
Es wird ein Dokument symmetrisch verschlüsselt. Dabei kann der zu verwendende
symmetrische Schlüssel optional übergeben werden.

</td></tr><tr><td>
Auslöser

</td><td>
Aufruf durch ein Fachmodul in einem fachlichen Use Case

</td></tr><tr><td>
Vorbedingungen

</td><td>
keine

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

</td></tr><tr><td>
Varianten/Alternativen

</td><td>
keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
Siehe Standardablauf.

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
keine

</td></tr></table>

Tabelle174: TAB_KON_742 Fehlercodes TUC_KON_072 „Daten symmetrisch
verschlüsseln“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4108

</td><td>
Technical

</td><td>
Error

</td><td>
Symmetrische Verschlüsselung konnte nicht durchgeführt werden

</td></tr></table>

**[\<=]**

### 4.1.7.4.4 TUC_KON_073 „Daten symmetrisch entschlüsseln”

##### TIP1-A_4619

Der Konnektor MUSS den technischen Use Case TUC_KON_073 „Daten symmetrisch
entschlüsseln“ umsetzen.

Tabelle175: TAB_KON_743 - TUC_KON_073 „Daten symmetrisch entschlüsseln“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_073 „Daten symmetrisch entschlüsseln”

</td></tr><tr><td>
Beschreibung

</td><td>
Es wird ein Dokument symmetrisch entschlüsselt. Der zu verwendende symmetrische
Schlüssel wird übergeben.

</td></tr><tr><td>
Auslöser

</td><td>
Aufruf durch ein Fachmodul in einem fachlichen Use Case

</td></tr><tr><td>
Vorbedingungen

</td><td>
keine

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
Das verschlüsselte Dokument wird mit dem symmetrischen Schlüssel
entschlüsselt. Als Verfahren zum Entschlüsseln wird CMS gewählt ([RFC5652]).

Das entschlüsselte Dokument wird zurückgeliefert.

</td></tr><tr><td>
Varianten/Alterna-tiven

</td><td>
keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
Bei Auftreten eines Fehlers im Standardablauf wird Fehlercode 4109 gemeldet.

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
keine

</td></tr></table>

Tabelle176: TAB_KON_744 Fehlercodes TUC_KON_073 „Daten symmetrisch
entschlüsseln“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4109

</td><td>
Technical

</td><td>
Error

</td><td>
symmetrische Entschlüsselung konnte nicht durchgeführt werden

</td></tr></table>

**[\<=]**

### 4.1.7.4.5 TUC_KON_075 „Symmetrisch verschlüsseln“

##### A_18001

Der Konnektor MUSS den technischen Use Case TUC_KON_075 „Symmetrisch
verschlüsseln“ umsetzen.

Tabelle177: TAB_KON_860 – TUC_KON_075 „Symmetrisch verschlüsseln“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_075 „Symmetrisch verschlüsseln“

</td></tr><tr><td>
Beschreibung

</td><td>
Es werden binäre Daten symmetrisch verschlüsselt. Optional können der zu
verwendende symmetrische Schlüssel und AssociatedData für Authenticated
Encryption with Associated Data (AEAD) übergeben werden.

</td></tr><tr><td>
Auslöser

</td><td>
Aufruf durch ein Fachmodul in einem fachlichen Use Case

</td></tr><tr><td>
Vorbedingungen

</td><td>
keine

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

</td></tr><tr><td>
Varianten/Alternativen

</td><td>
keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
-\> 2: Falls die Verschlüsselung fehlschlägt, wird Fehler 4108 gemäß
TAB_KON_742 gemeldet.

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
keine

</td></tr></table>

**[\<=]**

### 4.1.7.4.6 TUC_KON_076 „Symmetrisch entschlüsseln“

##### A_18002

Der Konnektor MUSS den technischen Use Case TUC_KON_076 „Symmetrisch
entschlüsseln“ umsetzen.

Tabelle178: TAB_KON_861 - TUC_KON_076 „Symmetrisch entschlüsseln“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_076 „Symmetrisch entschlüsseln”

</td></tr><tr><td>
Beschreibung

</td><td>
Es werden verschlüsselte Daten symmetrisch entschlüsselt. Für Authenticated
Encryption with Associated Data (AEAD) kann AssociatedData optional übergeben
werden. Der zu verwendende symmetrische Schlüssel wird übergeben.

</td></tr><tr><td>
Auslöser

</td><td>
Aufruf durch ein Fachmodul in einem fachlichen Use Case

</td></tr><tr><td>
Vorbedingungen

</td><td>
keine

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
Das verschlüsselte Dokument wird mit dem symmetrischen Schlüssel und
associatedData unter Verwendung der kryptographischen Verfahren aus  
entschlüsselt.  
Die entschlüsselten Daten werden zurückgeliefert.

</td></tr><tr><td>
Varianten/Alterna-tiven

</td><td>
keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
Bei Auftreten eines Fehlers im Standardablauf wird Fehlercode 4109 gemäß
TAB_KON_744 gemeldet.

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
keine

</td></tr></table>

**[\<=]**

### 4.1.7.5 Operationen an der Außenschnittstelle

##### TIP1-A_4620-03

Der Konnektor MUSS für Clients einen Basisdienst Verschlüsselungsdienst
anbieten.

Tabelle179: TAB_KON_745 Basisdienst Verschlüsselungsdienst

<table><tr><th>
Name

</th><th colspan="2">
EncryptionService

</th></tr><tr><td>
Version (KDV)

</td><td colspan="2">
6.1.0 (WSDL-Version), 6.1.1 (XSD-Version)  
6.1.1 (WSDL-Version), 6.1.2
(XSD-Version)

</td></tr><tr><td>
Namensraum

</td><td colspan="2">
Siehe GitHub

</td></tr><tr><td>
Namensraum-Kürzel

</td><td colspan="2">
CRYPT für Schema und CRYPTW für WSDL

</td></tr><tr><td rowspan="3">
Operationen

</td><td>
Name

</td><td>
Kurzbeschreibung

</td></tr><tr><td>
EncryptDocument

</td><td>
Dokument hybrid verschlüsseln

</td></tr><tr><td>
DecryptDocument

</td><td>
Dokument hybrid entschlüsseln

</td></tr><tr><td>
WSDL

</td><td colspan="2">
EncryptionService.wsdl (WSDL-Version 6.1.0)  
EncryptionService_v6_1_1.wsdl

</td></tr><tr><td>
Schema

</td><td colspan="2">
EncryptionService.xsd (XSD-Version 6.1.1)  
EncryptionService_v6_1_2.xsd

</td></tr></table>

**[\<=]**

### 4.1.7.5.1 EncryptDocument

##### TIP1-A_4621-05

Der Basisdienst Verschlüsselungsdienst des Konnektors MUSS an der
Clientschnittstelle eine Operation EncryptDocument anbieten.

Tabelle180: TAB_KON_071 Operation EncryptDocument

<table><tr><th>
Name

</th><th colspan="3">
EncryptDocument

</th></tr><tr><td>
Beschreibung

</td><td colspan="3">
Diese Operation verschlüsselt ein übergebenes Dokument hybrid.

Es werden die Dokumententypen

Alle_DocFormate

unterstützt.

Für die hybride Verschlüsselung wird ein asymmetrischer Schlüssel aus einem
X.509v3-Zertifikat genutzt. Dieses Zertifikat kann von einer Karte kommen oder
als Parameter übergeben werden. Pro Operationsaufruf können mehrere
Hybridschlüssel erzeugt werden. 

Übergibt der Aufrufer die Zertifikate beim Aufruf, steuert er durch die Wahl
der Zertifikate, ob RSA-basierte oder ECC-basierte Hybridschlüssel erzeugt
werden. Wenn das Verschlüsselungszertifikat von einer Karte kommt, kann der
Aufrufer durch Angabe des Kryptoverfahrens

crypt

 steuern, ob Hybridschlüssel für RSA oder für ECC oder beide erzeugt werden.
Das Defaultverhalten ist die Hybridschlüsselerzeugung für RSA und entspricht
dem Verhalten aus der Version 6.1.0 der Schnittstelle.

Es werden die folgenden Karten unterstützt: HBAx und SM-B. Die Operation
EncryptDocument DARF das Verschlüsseln mit der eGK NICHT unterstützen.

Für alle Dokumenttypen wird immer das gesamte Dokument verschlüsselt.

Vom Konnektor zu verschlüsselnde Dokumente müssen konform zu den Anforderungen
in Kapitel 3.1.1 "Dokumentformate" sein.

</td></tr><tr><td rowspan="16">
</td><td colspan="3">
![Img-035][Img-035]

</td></tr><tr><td>
Name

</td><td colspan="2">
Beschreibung

</td></tr><tr><td>
Context

</td><td colspan="2">
Aufrufkontext:

 ---> UL

</td></tr><tr><td colspan="3">
![Img-036][Img-036]

![Img-037][Img-037]

Das RecipientKeys-Element identifiziert die Empfänger der zu verschlüsselnden
Nachricht über X.509-Zertifikate (öffentliche Schlüssel). Quelle für die
Zertifikate kann eine gesteckte Karte sein, die per CertificateOnCard-Element
referenziert wird, oder der Aufrufer, der X.509-Zertifikate im
Certificate-Element übergibt.

</td></tr><tr><td>
Card

Handle

</td><td colspan="2">
Identifiziert die zu verwendende Karte mit dem (öffentlichen) Schlüssel.

Ist das Element nicht vorhanden, so werden nur Zertifikate per Element

Certificate

übergeben.

</td></tr><tr><td>
KeyRef

erence

</td><td colspan="2">
Der Wert dieses Parameters ist in Tabelle TAB_KON_747 KeyReference für
Encrypt-/DecryptDocument spezifiziert. Ist der Parameter nicht angegeben, gilt
der Default-Wert C.ENC.

</td></tr><tr><td>
Crypt

</td><td colspan="2">
Optional; 

Default: siehe TAB_KON_859

Wertebereich: [ENC_CRYPT]

Gibt den Typ von Zertifikaten vor, die von der per CardHandle referenzierten
Karte für die Erzeugung der Hybridschlüssel gemäß Tabelle TAB_KON_747
verwendet werden.

</td></tr><tr><td>
Certifi

cate

</td><td colspan="2">
Certificate

ist ein Base64-kodiertes XML-Element, in dem das Zertifikat, das den
asymmetrischen Schlüssel enthält (öffentlicher Schlüssel), DER-kodiert
übergeben wird.

Es kann eine Liste von Zertifikaten übergeben werden. Der Konnektor MUSS eine
Liste von mindestens 1000 Zertifikaten unterstützen.

Kommt das Zertifikat ausschließlich von einer Karte, dann kann dieser Parameter
weggelassen werden.

</td></tr><tr><td colspan="3">
![Img-038][Img-038]

</td></tr><tr><td>
CONN:

Document

</td><td colspan="2">
Dieses entsprechend [OASIS-DSS] Section 2.4.2 spezifizierte Element enthält das
zu verschlüsselnde Dokument, wobei die Kindelemente CONN:

Base64XML

und

dss:Base64Data

verwendet werden. Im Fall

dss:Base64Data

wird ein etwaig übergebenes MIME-Type-Attribut nicht ausgewertet.

</td></tr><tr><td colspan="3">
![Img-039][Img-039]

</td></tr><tr><td>
CRYPT:

Optional

Inputs

</td><td colspan="2">
Enthält eine Auswahl der folgenden unten näher erläuterten (optionalen)
Eingabeparameter:

</td></tr><tr><td colspan="3">
![Img-040][Img-040]

</td></tr><tr><td>
Encryption

Type

</td><td colspan="2">
Zu wählendes Verschlüsselungsverfahren, wobei folgende URI vorgesehen sind:

 ---> UL

Im Fall XMLEnc wird ein Base64-codiertes XML-Dokument im Element

CONN:Document/CONN:Base64XML

übergeben.

In den Fällen CMS und S/MIME wird ein Base64-codiertes Binär-Dokument im
Element

CONN:Document/dss:Base64Data

übergeben .

Ist der Parameter EncryptionType nicht gesetzt, dann gilt folgendes
Default-Verhalten: Für ein im Element

CONN:Document/CONN:Base64XML

übergebenes XML-Dokument wird als Verschlüsselungsverfahren [XMLEnc]
angewandt, und für ein im Element

CONN:Document/dss:Base64Data

übergebenes Dokument wird das Verschlüsselungsverfahren CMS angewandt.

XML-Documente werden nach Type=http://www.w3.org/2001/04/xmlenc#Element
verschlüsselt.

Im Fall S/MIME ist das in

CONN:Document/dss:Base64Data

übergebene Dokument eine MIME-Nachricht.  
Der Konnektor KANN die Operation im
Fall S/MIME mit Fehlercode 4279 beenden.

</td></tr><tr><td colspan="3">
![Img-041][Img-041]

</td></tr><tr><td>
Element

</td><td colspan="2">
Der Parameter wird nicht ausgewertet.

</td></tr><tr><td>
</td><td colspan="3">
![Img-042][Img-042]

</td></tr><tr><td>
</td><td colspan="2">
CRYPT:

Unprotected

Properties

</td><td>
Dieses optionale Element wird im CMS-Fall (EncryptionType = urn:ietf:rfc:5652)
ausgewertet.    

Die Elemente

./UnprotectedProperties/Property/Value/CMSAttribute

müssen base64/DER-kodiert ein vollständiges ASN.1-

Attribute

enthalten, definiert in [CMS# 9.1.AuthenticatedData Type]. Es muss bei der
Erstellung des CMS-Containers unter

"unauthAttrs"

aufgenommen werden. Das zugehörige Element

./UnprotectedProperties/Property/Identifier

wird nicht ausgewertet.

</td></tr><tr><td rowspan="4">
Rückgabe

</td><td colspan="3">
![Img-043][Img-043]

</td></tr><tr><td>
Status

</td><td colspan="2">
Enthält den Ausführungsstatus der Operation.

</td></tr><tr><td>
CRYPT:

Optional

Outputs

</td><td colspan="2">
Kann – in zukünftigen Versionen der Spezifikation – optionale
Ausgabeparameter enthalten.

</td></tr><tr><td>
CONN:

Document

</td><td colspan="2">
Enthält das verschlüsselte Dokument in base64-codierter Form, wenn die
Verschlüsselung erfolgreich durchgeführt wurde.

Im Fall XMLEnc wird das Base64-codierte verschlüsselte XML-Dokument im Element

CONN:Document/CONN:Base64XML

zurückgegeben.

Im Fall CMS wird das Base64-codierte Binär-Dokument im Element

CONN:Document/dss:Base64Data

zurückgegeben.

Im Fall S/MIME wird die Base64-codierte S/MIME-Nachricht im Element

CONN:Document/dss:Base64Data

zurückgegeben. Das Attribut

CONN:Document/dss:Base64Data/@MimeType

wird auf „application/pkcs7-mime“ gesetzt. Die S/MIME-Nachricht hat
Content-Transfer-Encoding: base64.

</td></tr><tr><td>
Fehler

</td><td colspan="3">
Bei Auftreten eines Fehlers im Standardablauf werden Fehlercodes entsprechend
TAB_KON_141 gemeldet.

</td></tr><tr><td>
Vorbe-dingungen

</td><td colspan="3">
Keine

</td></tr><tr><td>
Nachbe-dingungen

</td><td colspan="3">
Keine

</td></tr></table>

Der Ablauf der Operation EncryptDocument ist in Tabelle TAB_KON_746 Ablauf
EncryptDocument beschrieben:

Tabelle181: TAB_KON_746 Ablauf EncryptDocument

<table><tr><th>
Nr.

</th><th>
Aufruf Technischer Use Case oder Interne Operation

</th><th>
Beschreibung

</th></tr><tr><td>
1.

</td><td>
checkArguments

</td><td>
Die übergebenen Werte werden auf Konsistenz und Gültigkeit überprüft. Treten
hierbei Fehler auf, so bricht die Operation mit Fehler 4000 ab. Wird die
Operation für einen nicht unterstützten Kartentypen aufgerufen, so bricht die
Operation mit Fehler 4058 ab.

</td></tr><tr><td>
2.

</td><td>
checkDocumentFormat

</td><td>
Der Konnektor prüft für das zu verschlüsselnde Dokument, ob die Vorgaben aus
Kapitel 3.1.1 eingehalten sind. Bei Verletzung einer Vorgabe bricht der
Konnektor die Verarbeitung mit einem entsprechenden Fehlercode ab.

</td></tr><tr><td>
3.

</td><td>
TUC_KON_000 „Prüfe Zugriffs- berechtigung“

</td><td>
Die Prüfung erfolgt durch den Aufruf

TUC_KON_000 {

    mandantId = $context.mandantId;

    clientsystemId  = $context.clientsystemId;

    workplaceId = $context.workplaceId;

    userId = $context.userId;

    cardHandle = $cardHandle }

Tritt bei der Prüfung ein Fehler auf, bricht die Operation mit Fehlercode aus
TUC_KON_000 ab.

</td></tr><tr><td>
4.

</td><td>
TUC_KON_026 „Liefere CardSession“

</td><td>
Ermittle CardSession über TUC_KON_026 {

    mandatId =$context..mandantId;

    clientSystemId = $context.clientSystemId;

    cardHandle = $context..cardHandle;

    userId = $context.userId }

</td></tr><tr><td>
5.

</td><td>
TUC_KON_070 „Daten hybrid verschlüsseln“

</td><td>
Die hybride Verschlüsselung wird durchgeführt. Tritt hierbei ein Fehler auf,
bricht die Operation ab.

Die KeyInfo, d.h. die Liste der Hybridschlüssel inklusive des bei ihrer
Erzeugung verwendeten Zertifikates, sind dabei in das Dokument einzubetten.

</td></tr></table>

Tabelle182: TAB_KON_141 Fehlercodes „EncryptDocument“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Case

s und Fehlercodes aus Kapitel 3.1.1 kö

nnen folgende weitere Fehlercodes auftreten:

</td></tr><tr><td>
4000

</td><td>
Technical

</td><td>
Error

</td><td>
Syntaxfehler

</td></tr><tr><td>
4001

</td><td>
Security

</td><td>
Error

</td><td>
Interner Fehler

</td></tr><tr><td>
4058

</td><td>
Security

</td><td>
Error

</td><td>
Aufruf nicht zulässig

</td></tr><tr><td>
4279

</td><td>
Technical

</td><td>
Error

</td><td>
S/MIME-Funktionalität nicht unterstützt"

</td></tr><tr><td>
4283

</td><td>
Technical

</td><td>
Error

</td><td>
Dokument zu groß

</td></tr></table>

**[\<=]**

### 4.1.7.5.2 DecryptDocument

##### TIP1-A_4622-05

Der Basisdienst Verschlüsselungsdienst des Konnektors MUSS an der
Clientschnittstelle eine Operation DecryptDocument anbieten.

Tabelle183: TAB_KON_075 Operation DecryptDocument

<table><tr><th>
Name

</th><th colspan="2">
DecryptDocument

</th></tr><tr><td>
Beschreibung

</td><td colspan="2">
Die Operation entschlüsselt alle hybrid verschlüsselten Dokumente, die mit der
Operation EncryptDocument erzeugt wurden.

Es werden die Dokumententypen

Alle_DocFormate

unterstützt.

Für die Entschlüsselung wird ein asymmetrischer Schlüssel zu einem
X.509v3-Zertifikat genutzt. Dieses Zertifikat und der Schlüssel müssen von
einer Karte kommen.

Das bei der Entschlüsselung verwendete Kryptoverfahren (RSA oder ECC) wird
durch den Hybridschlüssel bestimmt, der durch die Karte entschlüsselt werden
soll. Sind sowohl RSA- als auch ECC-Hybridschlüssel für die referenzierte
Karte vorhanden, versucht der Konnektor die Entschlüsselung des
ECC-Hybridschlüssels, und wenn das nicht erfolgreich war, die Entschlüsselung
des RSA-Hybridschlüssels.

Vom Konnektor zu entschlüsselnde Dokumente müssen konform zu den Anforderungen
in Kapitel 3.1.1 "Dokumentformate" sein.

</td></tr><tr><td rowspan="10">
Aufrufparameter

</td><td colspan="2">
![Img-044][Img-044]

</td></tr><tr><td>
Name

</td><td>
Beschreibung

</td></tr><tr><td>
Context

</td><td>
Aufrufkontext:

 ---> UL

</td></tr><tr><td colspan="2">
![Img-045][Img-045]

</td></tr><tr><td>
PrivateKey

OnCard

</td><td>
Identifiziert die zu verwendende Karte mit dem (privaten) Schlüssel.

Es werden die folgenden Karten unterstützt: HBAx und SM-B. Die Operation
DecryptDocument DARF das Entschlüsseln mit der eGK NICHT unterstützen.

</td></tr><tr><td>
CardHandle

</td><td>
Identifiziert die gesteckte Karte.

</td></tr><tr><td>
KeyReference

</td><td>
Der Wert dieses Parameters ist in der Tabelle TAB_KON_747 KeyReference für
Encrypt-/DecryptDocument spezifiziert. Ist der Parameter nicht angegeben, gilt
der Default-Wert C.ENC.

</td></tr><tr><td>
Crypt

</td><td>
Ist nicht enthalten.

</td></tr><tr><td>
CONN:

Document

</td><td>
Enthält das base64-codierte Dokument, das entschlüsselt werden soll.

</td></tr><tr><td>
CRYPT:

OptionalInputs

</td><td>
Kann – in zukünftigen Versionen der Spezifikation – optionale
Aufrufparameter enthalten.

</td></tr><tr><td rowspan="4">
Rückgabe

</td><td colspan="2">
![Img-046][Img-046]

</td></tr><tr><td>
Status

</td><td>
Enthält den Ausführungsstatus der Operation.

</td></tr><tr><td>
CRYPT:

OptionalOutputs

</td><td>
Kann – in zukünftigen Versionen der Spezifikation – optionale
Ausgabeparameter enthalten.

</td></tr><tr><td>
CONN:Document

</td><td>
Enthält das entschlüsselte Dokument in base64-codierter Form

</td></tr><tr><td>
Fehler

</td><td colspan="2">
Bei Auftreten eines Fehlers im Standardablauf werden Fehlercodes entsprechend
TAB_KON_145 gemeldet.

</td></tr><tr><td>
Vorbe-dingungen

</td><td colspan="2">
Keine

</td></tr><tr><td>
Nachbe-dingungen

</td><td colspan="2">
Keine

</td></tr></table>

Der Ablauf der Operation DecryptDocument ist in Tabelle TAB_KON_076 Ablauf
DecryptDocument beschrieben:

Tabelle184: TAB_KON_076 Ablauf DecryptDocument

<table><tr><th>
Nr.

</th><th>
Aufruf Technischer Use Case oder Interne Operation

</th><th>
Beschreibung

</th></tr><tr><td>
1.

</td><td>
checkArguments

</td><td>
Die übergebenen Werte werden auf Konsistenz und Gültigkeit überprüft. Treten
hierbei Fehler auf, so bricht die Operation mit Fehler 4000 ab. Wird die
Operation für einen nicht unterstützten Kartentypen aufgerufen, so bricht die
Operation mit Fehler 4058 ab.

</td></tr><tr><td>
2.

</td><td>
TUC_KON_000 „Prüfe Zugriffs- berechtigung“

</td><td>
Die Prüfung erfolgt durch den Aufruf

TUC_KON_000 {

    mandantId = $context.mandantId;

    clientsystemId  = $context.clientsystemId;

    workplaceId = $context.workplaceId;

    userId = $context.userId;

    cardHandle = $cardHandle }

Tritt bei der Prüfung ein Fehler auf, bricht die Operation mit Fehlercode aus
TUC_KON_000 ab.

</td></tr><tr><td>
3.

</td><td>
TUC_KON_026 „Liefere CardSession“

</td><td>
Ermittle CardSession über 026 {

    mandatId =$context.mandantId;

    clientsystemId  = $context.clientsystemId;

    cardHandle = $context.cardHandle;

    userId = $context.userId }

</td></tr><tr><td>
4.

</td><td>
TUC_KON_071 Daten hybrid entschlüsseln

</td><td>
Die Entschlüsselung wird durchgeführt.

Im Fall eines XML-Dokuments mit mehreren verschlüsselten Elementen sind alle
mit dem angegebenen Schlüssel entschlüsselbaren Elemente zu entschlüsseln.

Wenn für das entschlüsselte Dokument Vorgaben aus Kapitel 3.1.1 nicht
eingehalten sind, bricht der Konnektor die Verarbeitung mit einem
entsprechenden Fehlercode ab.

Im Fall eines MIME-Dokuments KANN der Konnektor die Operation mit Fehlercode
4279 beenden.

</td></tr></table>

Tabelle185: TAB_KON_145 Fehlercodes „DecryptDocument“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen tech

nischen Use Cases und Fehlercodes aus Kapitel 3.1.1 können folgende weitere
Fehlercodes auf

treten:

</td></tr><tr><td>
4000

</td><td>
Technical

</td><td>
Error

</td><td>
Syntaxfehler

</td></tr><tr><td>
4001

</td><td>
Security

</td><td>
Error

</td><td>
interner Fehler

</td></tr><tr><td>
4058

</td><td>
Security

</td><td>
Error

</td><td>
Aufruf nicht zulässig

</td></tr><tr><td>
4279

</td><td>
Technical

</td><td>
Error

</td><td>
S/MIME-Funktionalität nicht unterstützt

</td></tr><tr><td>
4283

</td><td>
Technical

</td><td>
Error

</td><td>
Dokument zu groß

</td></tr></table>

**[\<=]**

### 4.1.7.6 Betriebsaspekte

keine

### 4.1.8 Signaturdienst

Der Signaturdienst bietet Clientsystemen und Fachmodulen eine Schnittstelle zum
Signieren von Dokumenten und Prüfen von Dokumentensignaturen

Innerhalb des Signaturdienstes werden folgende Präfixe für Bezeichner
verwendet:

 ---> UL

### 4.1.8.1 Funktionsmerkmalweite Aspekte

### 4.1.8.1.1 Dokumentensignatur

Der Signaturdienst umfasst die Funktionalität der nicht-qualifizierten
elektronischen Signatur (nonQES) mit der SM-B, sowie die qualifizierte
elektronische Signatur (QES) mit dem HBA und den HBA-Vorläuferkarten HBA-qSig
und ZOD_2.0 (=HBAx).

In der Abbildung fachlicher Abläufe kann es nötig sein, ein Dokument mehrfach
parallel zu signieren, oder existierende Signaturen gegenzusignieren. Der
Konnektor unterstütztparallele Signaturen(QES und nonQES). Ebenso unterstützt
er Gegensignaturen (QES und nonQES), die jeweils alle bestehenden Signaturen
gegensignieren. Die angebotene Möglichkeit des Gegensignierens bezieht sich
dabei auf das Signieren aller vorhandenen parallelen Signaturen, während ein
Gegensignieren von Gegensignaturen nicht angeboten wird. Der Konnektor
unterstützt ausschließlich eine dokumentexkludierende Gegensignatur, bei der
alle Signaturen gegensigniert werden, aber nicht der fachliche Inhalt des
Dokumentes selbst.

##### TIP1-A_4623-02

Der Signaturdienst MUSS für die Erstellung und Prüfung von
nicht-qualifizierten elektronischen Signaturen (nonQES) für
dienonQES_DocFormatedie Signaturverfahren entsprechend Tabelle TAB_KON_582 –
Signaturverfahren unterstützen. **[\<=]**

##### TIP1-A_4627

Der Signaturdienst MUSS für die Erstellung und Prüfung von qualifizierten
elektronischen Signaturen (QES) für dieQES_DocFormatedie Signaturverfahren
entsprechend Tabelle TAB_KON_582 – Signaturverfahren unterstützen. **[\<=]**

<table><tr><th>
Signaturformat

</th><th>
Standard

</th><th>
Dokumentformate

</th><th>
QES/

nonQES

</th><th>
Bemerkung

</th></tr><tr><td>
XMLDSig

(XAdES)

</td><td>
[RFC3275]

[XMLDSig]

[XAdES]

[RFC6931]

</td><td>
XML

</td><td>
QES,

nonQES

</td><td>
Hierdurch können abgesetzte (detached), umschließende (enveloping) und
eingebettete (enveloped) Signaturen erzeugt werden.

</td></tr><tr><td>
CMS

(CAdES)

</td><td>
[RFC5652]

[CAdES]

</td><td>
QES_DocFormate

nonQES_DocFormate

</td><td>
QES,

nonQES

</td><td>
Hierdurch können abgesetzte (detached) und umschließende (enveloping)
Signaturen erzeugt werden.

</td></tr><tr><td>
PDF/A

(PAdES)

</td><td>
[PAdES-3]

</td><td>
PDF/A

</td><td>
QES,

nonQES

</td><td>
Hierdurch können CMS-basierte Signaturen in PDF/A-Dokumente eingefügt und
dadurch eingebettete Signaturen erzeugt werden.

</td></tr><tr><td>
S/MIME

(optional)

</td><td>
[RFC5751]

</td><td>
nonQES_DocFormate

</td><td>
nonQES

</td><td>
Optional wird die Signatur und Signaturprüfung von MIME-Nachrichten
unterstützt.  
Der Konnektor soll, wenn er die S/MIME-Signatur unterstützt,
auch die S/MIME-Signaturprüfung unterstützen.

</td></tr></table>

Zu den Begriffen detached, enveloping und enveloped Signaturen siehe
beispielsweise auch [HüKo06#Abs. 4.3.3. und 4.3.1.5].

##### TIP1-A_5447

Der Signaturdienst MUSS für die Erstellung und Prüfung von
nicht-qualifizierten elektronischen Signaturen (nonQES) und qualifizierten
elektronischen Signaturen (QES) die Vorgaben zum Einsatzbereich gemäß Tabelle
TAB_KON_778 umsetzen.

Tabelle187: TAB_KON_778 – Einsatzbereich der Signaturvarianten für XAdES,
CAdES und PAdES

<table><tr><th colspan="4">
Signaturvarianten

</th><th colspan="3">
Einsatzbereich

</th></tr><tr><td>
Signatur

verfahren

</td><td>
Signatur-

variante

</td><td>
WAS wird signiert?

</td><td>
WO wird die Signatur abgelegt?

</td><td>
nonQES

</td><td>
QES

Außen-

schnittstelle

</td><td>
QES

Fachmodul-

schnittstelle

</td></tr><tr><td>
XAdES

</td><td>
detached

</td><td>
beliebiges (Binär)-Dokument

</td><td>
außerhalb des Dokuments in der SignResponse

</td><td>
Nein

</td><td>
Nein

</td><td>
Nein

</td></tr><tr><td>
XAdES

</td><td>
detached

</td><td>
gesamtes Input XML-Dokument

(= Root-Element mit Subelementen)

</td><td>
außerhalb des Dokuments in der SignResponse

</td><td>
Nein

</td><td>
Nein

</td><td>
Nein

</td></tr><tr><td>
XAdES

</td><td>
detached

</td><td>
ausgewähltes nicht Root-Element mit Subelementen im Input XML-Dokument

</td><td>
außerhalb des Dokuments in der SignResponse

</td><td>
Nein

</td><td>
Nein

</td><td>
Nein

</td></tr><tr><td>
XAdES

</td><td>
detached

</td><td>
ausgewähltes nicht Root-Element mit Subelementen im Input XML-Dokument

</td><td>
Innerhalb des Dokuments, aber außerhalb des signierten Subbaums

</td><td>
Nein

</td><td>
Bedingt

</td><td>
Bedingt

</td></tr><tr><td>
XAdES

</td><td>
enveloped

</td><td>
gesamtes Input XML-Dokument

(= Root-Element mit Subelementen)

</td><td>
Als direktes Child des Root-Elements

</td><td>
Ja

</td><td>
Bedingt

</td><td>
Bedingt

</td></tr><tr><td>
XAdES

</td><td>
enveloped

</td><td>
ausgewähltes nicht Root-Element mit Subelementen im Input XML-Dokument

</td><td>
Als direktes Child des ausgewählten Elements

</td><td>
Nein

</td><td>
Nein

</td><td>
Bedingt

</td></tr><tr><td>
XAdES

</td><td>
enveloping

</td><td>
gesamtes Input XML-Dokument

(= Root-Element mit Subelementen)

</td><td>
Im Dokument, das Root-Element umschließend

</td><td>
Ja

</td><td>
Bedingt

</td><td>
Bedingt

</td></tr><tr><td>
XAdES

</td><td>
enveloping

</td><td>
ausgewähltes nicht Root-Element mit Subelementen im Input XML-Dokument

</td><td>
Im Dokument, das ausgewählte Element umschließend

</td><td>
Nein

</td><td>
Nein

</td><td>
Nein

</td></tr><tr><td>
CAdES

</td><td>
detached

</td><td>
gesamtes Binärdokument

</td><td>
außerhalb des Dokuments in der SignResponse

</td><td>
Ja

</td><td>
Ja

</td><td>
Ja

</td></tr><tr><td>
CAdES

</td><td>
enveloping

</td><td>
gesamtes Binär-Dokument

</td><td>
innerhalb des CMS-Dokuments

</td><td>
Ja

</td><td>
Ja

</td><td>
Ja

</td></tr><tr><td>
PAdES

</td><td>
-

</td><td>
gesamtes PDF-Dokument

</td><td>
Im PDF-Dokument

</td><td>
Ja

</td><td>
Ja

</td><td>
Ja

</td></tr></table>

Legende:

Ja: Die Signaturvariante ist für den Einsatzbereich erlaubt.

Nein: Die Signaturvariante ist für den Einsatzbereich nicht erlaubt.

Bedingt: Die Signaturvariante ist für den Einsatzbereich nicht erlaubt, es sei
denn es wird durch eine im Konnektor integrierte Signaturrichtlinie explizit
gefordert.

Die Spalten mit gelber Kopfzeile definieren die Signaturvarianten, die mit
grauer, den Einsatzbereich. Beim Einsatzbereich wird zwischen nonQES und QES
unterschieden und im Fall QES nach der Bereitstellung an der
Außenschnittstelle oder intern für Fachmodule.

Die benötigten Signaturvarianten werden für XAdES über die Aufrufparameter
IncludeObject und SignaturePlacement gemäß [OASIS-DSS] gesteuert.

Für CAdES erfolgt die Steuerung welche Signaturvariante gewählt wird, über
den Aufrufparameter IncludeEContent. **[\<=]**

##### A_18756

Der Konnektor KANN alle Aufrufe zu Signaturerstellung einer nonQES-XAdES
Signatur mit Fehler 4111 und alle Aufrufe zur Signaturprüfung einer
nonQES-XAdES Signatur mit Fehler 4112 beantworten. Die Signaturvarianten aus
TAB_KON_778 werden damit weiter eingeschränkt. Wird die nonQES-XAdES Signatur
umgesetzt, so ist diese in der Sicherheitszertifizierung zu betrachten.
**[\<=]**

##### TIP1-A_5402

Der Konnektor MUSS von den AdES-Profilen die AdES-EPES-Profile umsetzen,
ergänzt um

 ---> UL

Dabei MUSS der Konnektor die Baseline-Profilierung gemäß Kapitel 6 in [XAdES
Baseline Profile] für XAdES, Kapitel 6 in [CAdES Baseline Profile] für CAdES
und Kapitel 6 in [PAdES Baseline Profile] für PAdES umsetzen. **[\<=]**

Durch die Baseline-Profilierung der AdES-BES-Profile wird festgelegt, wie der
Signaturzeitpunkt, gemessen als Systemzeit des Konnektors, in die Signatur
eingebracht wird.

##### TIP1-A_5403

Der Konnektor SOLL die signierten Dokumente konform zu [COMMON_PKI#Part 3] und
[COMMON_PKI#Part 8] erstellen. **[\<=]**

##### TIP1-A_4624

Bei fehlender expliziter Angabe durch den Aufrufer MUSS der Signaturdienst bei
der Erstellung von nicht-qualifizierten elektronischen Signaturen (nonQES) die
Default-Signaturverfahren entsprechend TAB_KON_583 Default-Signaturverfahren
wählen. **[\<=]**

##### TIP1-A_4628

Bei fehlender expliziter Angabe durch den Aufrufer MUSSder Signaturdienst bei
derErstellung vonqualifizierten elektronischen Signaturen (QES)die
Default-Signaturverfahren entsprechendTAB_KON_583 –
Default-Signaturverfahrenwählen. **[\<=]**

<table><tr><th rowspan="2">
Dokument-Format

</th><th colspan="4">
Signaturverfahren (und -variante)

</th></tr><tr><td>
Signaturverfahren

</td><td>
Signaturvariante

</td><td>
WAS wird signiert?

</td><td>
WO wird die Signatur abgelegt?

</td></tr><tr><td>
XML

</td><td>
XAdES

</td><td>
enveloped

</td><td>
gesamtes Input XML-Dokument

(= Root-Element mit Subelementen)

</td><td>
als direktes Child des Root-Elements

</td></tr><tr><td>
PDF/A

</td><td>
PAdES

</td><td>
-

</td><td>
gesamtes PDF-Dokument

</td><td>
im PDF-Dokument

</td></tr><tr><td>
alle anderen

</td><td>
CAdES

</td><td>
detached

</td><td>
gesamtes Binärdokument

</td><td>
außerhalb des Dokuments in der SignResponse

</td></tr></table>

##### TIP1-A_5387

Der Konnektor MUSS auf eine vollständige Nutzung der AdES-Profile erweiterbar
sein. **[\<=]**

##### TIP1-A_5033

Der Konnektor MUSS zur Unterstützung von Missbrauchserkennungen die in Tabelle
TAB_KON_584 gelisteten Operationen als Einträge in EVT_MONITOR_OPERATIONS
berücksichtigen.

Tabelle189: TAB_KON_584 nonQES-Operationen für EVT_MONITOR_OPERATIONS

<table><tr><th>
Operationsname

</th><th>
OK_Val

</th><th>
NOK_Val

</th><th>
Alarmwert (Default-Grenzwert 10 Minuten-Σ)

</th></tr><tr><td>
SignDocument (nonQES)

</td><td>
1

</td><td>
5

</td><td>
41

</td></tr><tr><td>
VerifyDocument (nonQES)

</td><td>
1

</td><td>
5

</td><td>
61

</td></tr></table>

**[\<=]**

##### TIP1-A_4629

Der Signaturdienst MUSS für die QES-Erstellung die Kartentypen HBA, HBA-qSig
und ZOD_2.0 unterstützen. **[\<=]**

##### TIP1-A_5436

Der Konnektor MUSS die Operation SignDocument für XML-Dokumente so
implementieren, dass das Dokument nach Entfernen der Signatur, insbesondere
auch einer Teilsignatur, als Ganzes unverändert ist, wobei zwei XML-Dokumente
als identisch zu betrachten sind, wenn sie gemäß Canonical XML 1.1 gleich
sind [CanonXML1.1]. **[\<=]**

##### TIP1-A_5682

Der Konnektor MUSS im VerificationReport einer QES-Signaturprüfung ausweisen,
wenn die für die Signatur verwendeten Algorithmen nach dem Algorithmenkatalog
[ALGCAT] als nicht geeignet eingestuft werden. **[\<=]**

##### A_17768

Der Konnektor MUSS bei der Signaturerstellung und Signaturprüfung (QES und
nonQES) die Zertifikate und Schlüssel gemäß den Vorgaben in TAB_KON_900
ermitteln.

Tabelle190: TAB_KON_900 Zertifikate und private Schlüssel für
Signaturerstellung und Signaturprüfung (QES und nonQES)

<table><tr><th colspan="1" rowspan="2">
 Karte  
 

</th><th colspan="1" rowspan="2">
Crypt  
 

</th><th colspan="1" rowspan="2">
Zertifikat (Verify)

</th><th colspan="1" rowspan="2">
Schlüssel (Sign)

</th><th colspan="2" rowspan="1">
Einsatzbereich

</th></tr><tr><th>
Außen-schnittstelle

</th><th>
Fachmodul-schnittstelle

</th></tr><tr><td colspan="2" rowspan="1">
QES

</td><td colspan="2" rowspan="1">
...in DF.QES

</td></tr><tr><td colspan="1" rowspan="2">
HBA

</td><td>
RSA

</td><td>
EF.C.HP.QES.R2048

</td><td>
PrK.HP.QES.R2048

</td><td>
ja

</td><td>
ja

</td></tr><tr><td>
ECC

</td><td>
EF.C.HP.QES.E256

</td><td>
PrK.HP.QES.E256

</td><td>
ja

</td><td>
ja

</td></tr><tr><td>
RSA_ECC

</td><td>
[ab G2.1]: EF.C.HP.QES.E256  
[G2.0]: EF.C.HP.QES.R2048

</td><td>
[ab G2.1]: PrK.HP.QES.E256  
[G2.0]: PrK.HP.QES.R2048

</td><td>
ja

</td><td>
ja

</td></tr><tr><td>
HBA-VK

</td><td>
RSA

</td><td>
EF.C.HP.QES

</td><td>
PrK.HP.QES

</td><td>
ja

</td><td>
ja

</td></tr><tr><td colspan="2" rowspan="1">
nonQES

</td><td colspan="2" rowspan="1">
...in DF.ESIGN

</td></tr><tr><td colspan="1" rowspan="2">
SM-B

</td><td>
RSA

</td><td>
EF.C.HCI.OSIG.R2048

</td><td>
PrK.HCI.OSIG.R2048

</td><td>
ja

</td><td>
ja

</td></tr><tr><td>
ECC

</td><td>
EF.C.HCI.OSIG.E256

</td><td>
PrK.HCI.OSIG.E256

</td><td>
ja

</td><td>
ja

</td></tr><tr><td>
RSA_ECC

</td><td>
[ab G2.1]: EF.C.HCI.OSIG.E256  
[G2.0]: EF.C.HCI.OSIG.R2048

</td><td>
[ab G2.1]: PrK.HCI.OSIG.E256  
[G2.0]: PrK.HCI.OSIG.R2048

</td><td>
ja

</td><td>
ja

</td></tr><tr><td colspan="1" rowspan="2">
eGK

</td><td>
RSA

</td><td>
EF.C.CH.AUT.R2048

</td><td>
PrK.CH.AUT.R2048

</td><td>
nein

</td><td>
ja

</td></tr><tr><td>
ECC

</td><td>
EF.C.CH.AUT.E256

</td><td>
PrK.CH.AUT.E256

</td><td>
nein

</td><td>
ja

</td></tr><tr><td>
RSA_ECC

</td><td>
[ab G2.1]: EF.C.CH.AUT.E256  
[G2.0]: EF.C.CH.AUT.R2048

</td><td>
[ab G2.1]: PrK.CH.AUT.E256  
[G2.0]: PrK.CH.AUT.R2048

</td><td>
nein

</td><td>
ja

</td></tr></table>

**[\<=]**

<table><tr><th>
Typname

</th><th>
Werteliste

</th><th>
Defaultwert

</th><th>
Bedeutung

</th></tr><tr><td>
SIG_CRYPT_QES

</td><td>
RSA

ECC

RSA_ECC

</td><td>
RSA

</td><td>
Werteliste des Parameters crypt bei der bei der Erzeugung einer QES-Signatur

RSA: Es wird eine RSA-2048 Signatur erzeugt.

ECC: Es wird eine ECC-256 Signatur erzeugt.

RSA_ECC: In Abhängigkeit von der Kartengeneration wird eine RSA-2048 bzw. eine
ECC-256 Signatur erzeugt (siehe TAB_KON_900).

</td></tr></table>

<table><tr><th>
Typname

</th><th>
Werteliste

</th><th>
Defaultwert

</th><th>
Bedeutung

</th></tr><tr><td>
SIG_CRYPT_nonQES

</td><td>
RSA

ECC

RSA_ECC

</td><td>
RSA

</td><td>
Werteliste des Parameters crypt bei der bei der Erzeugung einer nonQES-Signatur

RSA: Es wird eine RSA-2048 Signatur erzeugt.

ECC: Es wird eine ECC-256 Signatur erzeugt.

RSA_ECC: In Abhängigkeit von der Kartengeneration wird eine RSA-2048 bzw. eine
ECC-256 Signatur erzeugt (siehe TAB_KON_900).

</td></tr></table>

### 4.1.8.1.2 Signaturrichtlinien

Signaturrichtlinien dienen der Profilierung von Signaturerstellung und
-prüfung. Beim Aufruf der Operation SignDocument kann eine URI übergeben
werden, die eine im Konnektor hinterlegte Signaturrichtlinie referenziert. Die
Plattform des Konnektors stellt selbst keine Signaturrichtlinien bereit.
Fachanwendungen, die Signaturrichtlinien erfordern, definieren diese im
Fachmodul des Konnektors. Für XML-Dokumentenformate aus der Menge
vonQES_DocFormatekönnen die nachfolgenden Aspekte über eine
Signaturrichtlinie gekapselt festgelegt werden:

 ---> UL

##### TIP1-A_5538

Der Konnektor MUSS Signaturrichtlinien fürXML-Dokumentenformateausder Menge
vonQES_DocFormatebeidieSignaturerstellung und -prüfungumsetzen.

Der Konnektor MUSS den für jede Signaturrichtlinie definierten Bezeichner (URI)
bei der Signatur als SigPolicyId im Feld SignaturePolicyIdentifier einbetten.
Bei der Signaturprüfung MUSS der Konnektor über eine etwaig vorhandene
SigPolicyId die Signaturrrichtlinie identifizieren.

Die gemäß AdES erforderliche Hash-Referenz über die Policy (SigPolicyHash)
MUSS Schema-konform leer gelassen werden. Bei der Signaturprüfung DARF die
Hash-Referenz über die Policy NICHT geprüft werden. **[\<=]**

### 4.1.8.1.3 Signaturzeitpunkt

Bezogen auf den vom Konnektor für die Signaturprüfung anzunehmenden
Signaturerstellungszeitpunkt werden in dieser Spezifikation die Bezeichner
Ermittelter_Signaturzeitpunkt und Benutzerdefinierter_Zeitpunkt verwendet.

Ermittelter_Signaturzeitpunkt:Vom Konnektor ermittelter Zeitpunkt, zu dem eine
Signatur geprüft wird. Es werden folgende Signaturzeitpunkte ermittelt:

 ---> OL

Anmerkung: Bei vom Konnektor selbst erstellten Signaturen ist immer ein in der
Signatur eingebetteter Zeitpunkt vorhanden, jedoch kein qualifizierter
Zeitstempel, da in der TI keine qualifizierten Zeitstempel ausgestellt
werden. Sollte ein Dokument mit einem qualifizierten Zeitstempel versehen
sein, so wird dieser nicht für die Ermittlung des Signaturzeitpunktes
herangezogen.

Benutzerdefinierter_Zeitpunkt:Vom Benutzer beim Aufruf der
Signaturprüfoperation als Parameter an den Konnektor übergebener Zeitpunkt,
zu dem eine Signatur geprüft werden soll.

### 4.1.8.1.4 Jobnummer

Da die eHealth-Kartenterminals dezentral über eine Netzwerkschnittstelle am
Konnektor betrieben werden, fehlt die Möglichkeit zur direkten physischen und
vom Anwender kontrollierbaren Zuordnung eines solchen Terminals zu einem
Arbeitsplatz, auf dem sich das Clientsystem befindet.

Daher ist es bei einer fehlerhaften Zuordnung eines eHealth-Kartenterminals zu
einem Arbeitsplatz möglich, dass die PIN-Eingabeaufforderung –
beispielsweise zu einem Signaturauftrag – an ein entferntes Kartenterminal
weitergeleitet wird. Diese fehlerhafte Zuordnung kann durch einen Fehler des
Clientsystems oder den Versuch eines Angriffes hervorgerufen werden.

Die Jobnummern werden vom Konnektor erzeugt und können durch Clientsystem
abgerufen werden. Der Konnektor stellt jedoch keine Verbindung zwischen
erzeugten und verwendeten Jobnummern her. Es wird also nicht geprüft, ob nur
Jobnummern verwendet werden, die vorher vom Konnektor erzeugt wurden, oder ob
alle Jobnummern verwendet werden, die vom Konnektor erzeugt wurden.

##### TIP1-A_4639

Um Fehler- und Angriffsmöglichkeiten auszuschließen, MUSS der Konnektor bei
bestimmten PIN-Verifikationen vor der Aufforderung zur PIN-Eingabe an einem
eHealth-Kartenterminal eine hinreichend eindeutige Nummer – die Jobnummer –
generieren, welche den Auftrag kennzeichnet, für dessen Verarbeitung die
PIN-Eingabe erfolgen soll. Bei welchen PIN-Verifikationen dies der Fall ist,
kann den PIN-Prompts in TAB_KON_090 Terminalanzeigen beim Eingeben der PIN am
Kartenterminalentnommen werden. **[\<=]**

##### TIP1-A_4640

Diese Jobnummer MUSS vom Konnektor im Display des eHealth-Kartenterminals neben
der PIN-Eingabeaufforderung angezeigt werden. **[\<=]**

##### TIP1-A_4992-02

Das Handbuch des Konnektors MUSS den Benutzer über den korrekten Gebrauch der
Jobnummer informieren. Es MUSS ihm verdeutlichen, dass er seine PIN über die
Tastatur des eHealth-Kartenterminals nur eingeben darf, wenn am Primärsystem
und am Display des Kartenterminals die gleiche Jobnummer angezeigt wird.
Stimmen die beiden Nummern nicht überein, so soll der Benutzer seine PIN nicht
eingeben und stattdessen weitergehende Schritte zur Klärung des aufgetretenen
Fehlverhaltens einleiten. **[\<=]**

##### TIP1-A_4642

Zur hinreichend eindeutigen Kennzeichnung des Vorganges MUSS eine Jobnummer von
einem Zufallswert abgeleitet sein, wobei die Vorgaben an einen solchen
Zufallswert beachtet werden MÜSSEN[gemSpec_Krypt#2.2]. **[\<=]**

##### TIP1-A_4643

Zur Wahrung der Benutzerfreundlichkeit MUSS eine Reduzierung der Jobnummer auf
eine Länge von sechs Zeichen erfolgen. Diese sechs Zeichen MÜSSEN in zwei
Zeichengruppen mit je drei Zeichen, getrennt durch einen Bindestrich (0x2D),
dargestellt werden. Die erste Zeichengruppe MUSS ausschließlich die Zeichen
"A-Z" beinhalten, die zweite Zeichengruppe MUSS aus Ziffern "0-9" bestehen. Die
Länge der resultierenden, reduzierten Jobnummer ist sieben und wird durch den
Umfang der darstellbaren Zeichen auf dem Display des eHealth-Kartenterminals
beschränkt. **[\<=]**

##### TIP1-A_4644

Der Konnektor MUSS die Eindeutigkeit einer Jobnummer sicherstellen:

 ---> UL

**[\<=]**

##### TIP1-A_4645

Die einzelnen Zeichen der Jobnummer MÜSSEN für die Anzeige am Kartenterminal
gemäß dem Zeichensatz ISO 646DE/DIN66003, bzw. ISO 646 US codiert werden. Aus
diesem Zeichensatz dürfen nur die Zeichen „A-Z“ (0x41 bis 0x5A) und die
Ziffern „0-9“ (0x30 bis 0x39) für die Anzeige der Jobnummer verwendet
werden. **[\<=]**

Beispiele für eine Jobnummer sind ABC-475 und HZF-696.

Die Einbettung der Jobnummer in den Nachrichtentext für den Bildschirm des
Kartenlesers wird in TAB_KON_090 Terminalanzeigen beim Eingeben der PIN am
Kartenterminal beschrieben.

### 4.1.8.1.5 Komfortsignatur

Für die QES unterstützt der Konnektor die Komfortsignaturfunktion. In diesem
Modus können für ein- und denselben HBA mehrere vom Clientsystem initiierte
Signaturaufträge (Einzel- oder Stapelsignatur) abgearbeitet werden, ohne dass
der Inhaber des HBA für jeden einzelnen dieser Signaturaufträge die PIN.QES
am Kartenterminal eingegeben muss.

Im Auslieferungszustand ist die Komfortsignaturfunktion ausgeschaltet
(SAK_COMFORT_SIGNATURE = Disabled), d. h. mit dem Konnektor können zunächst
keine Komfortsignaturen durchgeführt werden. Die Komfortsignaturfunktion kann
vom Administrator eingeschaltet werden. Dies ist nur möglich, wenn an der
Clientsystemschnittstelle des Konnektors verpflichtend TLS mit
Clientauthentisierung (Konfigurationsvariante SOAP1 und SOAP2 in TAB_KON_852)
konfiguriert ist. Das Einschalten der Komfortsignaturfunktion im Konnektor hat
zur Folge, dass alle Operationen an der Clientsystemschnittstelle nur über TLS
mit Clientauthentisierung angesprochen werden können (außer ggf.
Dienstverzeichnisdienst).

Bei eingeschalteter Komfortsignaturfunktion können potentiell alle HBAs in der
Umgebung, in der der Konnektor eingesetzt ist, Komfortsignaturen durchführen.
Die eigentliche Aktivierung der Komfortsignatur muss separat für jede einzelne
HBA-CardSession erfolgen.

Durch Aufruf der Operation ActivateComfortSignature des Konnektors durch das
Primärsystem wird die Nutzung der Komfortsignatur für eine HBA-CardSession
(Komfortsignaturmodus) aktiviert. Dazu muss der HBA-Inhaber diePIN.QESeingeben.

Der Konnektor merkt sich für die Cardsession des HBA, dass die Komfortsignatur
aktiviert wurde. Bei den folgenden Aufrufen vonSignDocumentwerden dann
Komfortsignaturen ausgeführt, solange bis eines der folgenden Abbruchkriterien
eintritt:

·      Die vom HBA (entsprechend Personalisierung) oder die vom Konnektor
(entsprechend KonfigurationSAK_COMFORT_SIGNATURE_MAX) durchgesetzte maximale
Anzahl von Signaturen wurde erreicht.

·      Das konfigurierte Zeitintervall für die Komfortsignatur
(entsprechend KonfigurationSAK_COMFORT_SIGNATURE_TIMER) ist für die
Cardsession abgelaufen.

·      Der Komfortsignaturmodus wurde für die betroffene Cardsession
deaktiviert.

·      Der HBA wurde gezogen.

·      Der Sicherheitszustand des HBA wurde zurückgesetzt.

·      Die Komfortsignaturfunktion wurde für den Konnektor durch den
Administrator deaktiviert.

##### A_19945

Der Signaturdienst MUSS bei der Komfortsignatur die Signaturvarianten für die
QES gemäß TAB_KON_778 unterstützen. **[\<=]**

##### A_18597

Bei der Komfortsignatur DARF der Konnektor den Sicherheitszustand
derPIN.QES NICHT selbsttätig zurücksetzen, außer wenn dies explizit
spezifikatorisch gefordert wird. **[\<=]**

A_18597 kann z. B. umgesetzt werden, indem

·       ein dedizierter logischer Kanal des HBA für die Komfortsignatur
verwendet wird und

·      im dedizierten logischen Kanal des HBA die Selektion
vonDF.QESsolange beibehalten wird, bis ein Verlassen vonDF.QESdurch die
Spezifikation explizit gefordert wird.

##### A_18686-01

Der Konnektor MUSS für jede HBA-Kartensitzung mit eingeschalteter
Komfortsignatur einen Komfortsignatur-Timer gemäß konfiguriertem
ZeitintervallSAK_COMFORT_SIGNATURE_TIMER einrichten.  
Der Konnektor DARF nach
Erreichen des Maximalwerts des Timers NICHT weitere Signaturaufträge annehmen.
 
Der Konnektor MUSS den Sicherheitszustand des HBA nach Erreichen des
Maximalwertes des Timers zurücksetzen, nachdem Signaturaufträge, die bis zu
diesem Zeitpunkt bereits zur Bearbeitung angenommen wurden, vollständig
abgearbeitet wurden. **[\<=]**

##### A_19100-01

Der Konnektor MUSS für jede HBA-Kartensitzung mit eingeschalteter
Komfortsignatur die an die Karte gesendeten Signaturaufträge zählen und nach
Erreichen von SAK_COMFORT_SIGNATURE_MAX den Sicherheitszustand des HBA
zurücksetzen. **[\<=]**

##### A_19258

Bei der Komfortsignatur MUSS der Signaturdienst die zu signierenden Daten (DTBS)
über Secure Messaging vom Konnektor zum HBA übertragen. Dieser Secure
Messaging-Kanal MUSS über die gSMC-K zum HBA mittels C.SAK.AUTD_CVC aufgebaut
werden. **[\<=]**

##### A_20073-01

Der Konnektor MUSS die beim Aktivieren des Komfortsignaturmodus vom PS
übermittelte UserId für die Kartensitzung des HBA, für den der Modus
aktiviert wird, auf die ausreichende Länge von 128 Bit im Format einer UUID
nach RFC4122 prüfen und die Aktivierung mit Fehler 4272 ablehnen, wenn die
UserId nicht ausreichend lang ist. **[\<=]**

##### A_20074

Der Konnektor MUSS die Eindeutigkeit der UserId sicherstellen. Wird die
Operation ActivateComfortSignature mit einer UserId im Aufrufkontext
aufgerufen, die innerhalb der vorangegangenen 1.000 Vorgänge bereits verwendet
wurde, so MUSS der Konnektor die Bearbeitung mit dem Fehler 4270 abbrechen. Die
Zählung der Aufrufe erfolgt dabei unabhängig vom Aufrufkontext. **[\<=]**

##### A_19101

Das Handbuch des Konnektors MUSS einen Hinweis enthalten, dass die
Authentifizierung des HBA-Inhabers für die Komfortsignatur vom Clientsystem
vorgenommen wird und dass die Authentifizierung des Nutzers am Clientsystem
einen unverzichtbaren Beitrag zur Sicherheit der Lösung leistet. **[\<=]**

##### A_22344

Der Konnektor MUSS mindestens zwei parallele Komfortsignatursessions für ein-
und denselben HBA unterstützen. **[\<=]**

Es kann davon ausgegangen werden, dass in den Einsatzumgebungen des Konnektors
fachlicher Bedarf an mehr als zwei parallelen Komfortsignatursessions
besteht. Daher wird empfohlen, mehr als zwei Sessions zu unterstützen.

Um pro Session die maximal erlaubte Anzahl von Signaturen
(SAK_COMFORT_SIGNATURE_MAX) ausschöpfen zu können, sollen für parallele
Komfortsignatursessions nach Möglichkeit mehrere logische Kanäle des
HBA verwendet werden.

Der Konnektor soll sich robust verhalten, wenn zu einem HBA Signaturaufträge
von unterschiedlichen Clientsystemen aus eintreffen, während vorherige
Signaturaufträge noch nicht vollständig abgearbeitet sind. Nach Möglichkeit
sollen gleichzeitig eintreffende Signaturaufträge angenommen und abgearbeitet
werden.

##### A_22352

Der Konnektor SOLL die Komfortsignatur-Timer paralleler Komfortsignatursessions
für ein- und denselben HBA so umsetzen, dass diese unabhängig voneinander
wirken. **[\<=]**

##### A_22459

Der Konnektor SOLL die Komfortsignatur-Zähler paralleler
Komfortsignatursessions für ein- und denselben HBA so umsetzen, dass diese
unter Berücksichtigung der Limitierungen der Karte unabhängig voneinander
wirken. **[\<=]**

### 4.1.8.2 Durch Ereignisse ausgelöste Reaktionen

keine

### 4.1.8.3 Interne TUCs, nicht durch Fachmodule nutzbar

Abbildung PIC_KON_103 Use Case Diagramm Signaturdienst (nonQES) beschreibt die
Aufrufbeziehungen der nonQES-TUCs des Signaturdienstes. Die TUCs des
Signaturdienstes sind weiß dargestellt. Genutzte TUCs anderer Basisdienste
sind grau hinterlegt.

![Abbildung-15][Abbildung-15]

Abbildung PIC_KON_104 Use Case Diagramm Signaturdienst (QES) beschreibt die
Aufrufbeziehungen der QES-TUCs des Signaturdienstes.

![Abbildung-16][Abbildung-16]

Abbildung PIC_KON_102 Use Case Diagramm Signaturdienst (Komfortsignatur)
beschreibt die Aufrufbeziehungen der TUCs des Signaturdienstes für die
Komfortsignatur.

![Abbildung-17][Abbildung-17]

### 4.1.8.3.1 TUC_KON_155 „Dokumente zur Signatur vorbereiten”

##### TIP1-A_4646-04

Der Konnektor MUSS den technischen Use Case TUC_KON_155 „Dokumente zur
Signatur vorbereiten” umsetzen.

Tabelle193: TAB_KON_748 - TUC_KON_155 „Dokumente zur Signatur vorbereiten“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_155 ”Dokumente zur Signatur vorbereiten”

</td></tr><tr><td>
Beschreibung

</td><td>
Die zu signierenden Dokumente werden entsprechend den Erfordernissen  
der
Signaturverfahren für die QES oder nonQES vorbereitet.

</td></tr><tr><td>
Anwendungsumfeld

</td><td>
Erstellung von qualifizierten elektronischen Signaturen (QES) und 

nicht-qualifizierten elektronischen Signaturen (nonQES)

</td></tr><tr><td>
Auslöser

</td><td>
Aufruf durch TUC_KON_150 „Dokumente QES signieren“ oder  
TUC_KON_160
„Dokumente nonQES signieren“

</td></tr><tr><td>
Vorbedingungen

</td><td>
keine

</td></tr><tr><td>
Eingangsdaten

</td><td>
 -  signatureMode  
    (Signaturart: QES | nonQES)

 -  documentsToBeSigned  
    (Zu signierendes Dokument bzw. zu signierende
Dokumente) und pro  
    Dokument:

 -  documentFormat  
    (Formatangabe für das zu signierende Dokument)

 -  optionalInputs  
    (weitere optionale Eingabeparameter zur Steuerung
der Details bei der  
   zu erstellenden Signatur (siehe Operation
SignDocument, Parameter  
   dss:OptionalInputs), darin u.a.

   -signatureType  
       (URI für den Signaturtyp XML-, CMS-,
S/MIME-o PDF-Signatur)

 -  certificate  
    (Signaturzertifikat)

 -  ocspResponses –

optional

    (OCSP-Response des EE-Zertifikats, das bei der Signaturerstellung in 

   die Signatur eingebettet wird.)

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
signatureType  = XMLDSig (XAdES)

Entsprechend den Regeln für die QES und die nonQES werden zunächst  
weitere
Signatureigenschaften zum jeweiligen Dokument in Form von

QualifyingProperties

(siehe [XAdES]) hinzugefügt.

Die Systemzeit des Anwendungskonnektors muss in das XML-Element

SigningTime

(siehe [XAdES]) eingetragen werden. Die Signatur wird  
anschließend
entsprechend [XMLDSig] vorbereitet. D. h., es wird je  
Dokument nach Erzeugung
der Reference Elemente das SignedInfo  
Element aufgebaut. Dessen Inhalt ergibt
dann nach erfolgter  
XML-Kanonisierung und Hashing die DTBS (Data To Be
Signed), die  
später zur Karte gesendet werden.

certificate wird im Element

ds:KeyInfo/ds:X509Data

gespeichert.

Im Fall signatureMode = QES können neben den reinen Nutzdaten auch  
alle
weiteren Elemente in die Signatur einbezogen werden, die für die 

Rekonstruktion der ursprünglich dargestellten Daten in der sicheren  
Anzeige
erforderlich sind. Für XML-Dokumente sind das, falls vorhanden,  
das/die
XML-Schema(ta). Für diese werden Referenzen (Hash + URI) in  
die Signatur
eingebettet.

Die URI ist im Fall übergebener XML-Schemata der übergebene

signatureType

- Parameter. Die URI ist im Fall der im Konnektor im  
Rahmen einer
Signaturrichtlinie hinterlegten XML-Schemata/XSL-  
Stylesheets die URI der
Signaturrichtlinie, ergänzt um den Dateinamen  
mit Pfad, wie in der
Signaturrichtlinie festgelegt.

(Beispiel: URI für Schemadatei NFD_Document.xsd der Signaturrichtlinie
SR_DF_NFDM_NOTFALLDATEN lautet: urn:gematik:fa:sak:nfdm:r1:v1:NFD_Document.xsd)

Das Einbetten der Referenzen erfolgt über das XML-Element 

ds:object/ds:manifest (XMLDSig) mit eingebetteten XML-Elementen 

ds:Reference, die eine URI (RefURI) als Identifier für die jeweilige Datei 

und einen Hash über die jeweilige Resource enthalten.  
Der
ShortTextClientsystem muss in die Signatur in das

DataObjectFormat/Description

-Element gemäß [XAdES]  
(Abschnitt 7.2.5) eingebettet werden.

Falls durch den Aufrufparameter

SIG:IncludeRevocationInfo

angefordert, wird die für die Offline-Prüfung notwendige OCSP-Antwort  
im
Sinne vom ES-X-L vom Konnektor in die Signatur eingebettet:

Die base-64 kodierte OCSP-Response wird im Feld

QualifyingProperties/UnsignedProperties 

/UnsignedSignatureProperties/RevocationValues 

/OCSPValues/EncapsulatedOCSPValue

(selbst DER-kodiert)  
gespeichert.

signatureType  = CMS (CAdES)

Etwaig einzubettende XML-Schemata werden zunächst wie für XAdES  
definiert in
ein ds:manifest-Element eingebettet. Die so erzeugte  
Zeichenkette wird als
genau ein ASN.1 Character String vom Typ  
UTF8String verpackt. Dieser wird als
contentDescription in einen  
Content-Hints Attributwert vom Typ ContentHints
verpackt, wobei der  
contentType=id-data gemäß [CAdES].

Der ShortTextClientsystem muss in die Signatur in das  

content-  
hints.ContentDescription

-Attribut gemäß [CAdES] (Abschnitt  
5.10.3) eingebettet werden.

Ist die Einbettung von OCSP-Responses gefordert, wird die für die 

Offline-Prüfung notwendige OCSP-Antwort des EE-Zertifikats im Attribut 

SingedData.crls.other abgelegt.

signatureType  = PDF/A (PAdES)

Der ShortTextClientsystem muss bei einer PDF-Signatur in das

Reason

-Feld eingebettet werden.

OCSP-Responses werden bei PAdES nicht eingebettet.

Es sind die Vorgaben zum Signaturprofil gemäß Tabelle

TAB_KON_779-01

„Profilierung der Signaturformate“ zu erfüllen.

Die aufbereiteten zu signierenden Dokumente werden an den Aufrufer 

zurückgegeben.

</td></tr><tr><td>
Varianten/  
Alternativen

</td><td>
keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
Das Verhalten des TUCs bei einem Fehlerfall ist in TAB_KON_586  
Fehlercodes
TUC_KON_155 „Dokumente zur Signatur vorbereiten“  
„PDF/A (PAdES)“

Es ist nicht genügend Speicherplatz im PDF-Dokument verfügbar: 4205

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
keine

</td></tr></table>

Tabelle194: TAB_KON_586 Fehlercodes TUC_KON_155 „Dokumente zur Signatur
vorbereiten“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td>
4205

</td><td>
Technical

</td><td>
Error

</td><td>
Es ist nicht genügend Speicherplatz im PDF-Dokument verfügbar.

</td></tr></table>

**[\<=]**

### 4.1.8.3.2 TUC_KON_165 „Signaturvoraussetzungen für nonQES prüfen“

##### TIP1-A_4647-02

Der Konnektor MUSS den technischen Use Case „Signaturvoraussetzungen für
nonQES prüfen” umsetzen.

Tabelle195: TAB_KON_749 – TUC_KON_165 „Signaturvoraussetzungen für nonQES
prüfen“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_

165

„Signaturvoraussetzungen für nonQES prüfen“

</td></tr><tr><td>
Beschreibung

</td><td>
Es werden die Voraussetzungen an die zu signierenden Dokumente und das
Signaturzertifikat geprüft. Es werden die

nonQES_DocFormate

unterstützt.

</td></tr><tr><td>
Auslöser

</td><td>
TUC_KON_160 „Dokumente nonQES signieren“

</td></tr><tr><td>
Vorbedingungen

</td><td>
keine

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor, Kartenterminal, Signaturkarte

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

</td></tr><tr><td>
Varianten/Alterna-tiven

</td><td>
Keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
Keine

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
keine

</td></tr></table>

Tabelle196: TAB_KON_587 Fehlercodes TUC_KON_165 „Signaturvoraussetzungen für
nonQES prüfen“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können keine
weiteren Fehlercodes auftreten.

</td></tr></table>

**[\<=]**

### 4.1.8.3.3 TUC_KON_166 „nonQES Signaturen erstellen“

##### TIP1-A_4648

Der Konnektor MUSS den technischen Use Case TUC_KON_166 „nonQES Signaturen
erstellen” umsetzen.

Tabelle197: TAB_KON_750 – TUC_KON_166 „nonQES Signaturen erstellen“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_166 „nonQES Signaturen erstellen“

</td></tr><tr><td>
Beschreibung

</td><td>
Die Data To Be Signed (DTBS) werden erzeugt, an die Signaturkarte gesendet und
dort signiert.

</td></tr><tr><td>
Auslöser

</td><td>
TUC_KON_160 „Dokumente nonQES signieren“

</td></tr><tr><td>
Vorbedingungen

</td><td>
keine

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor, Kartenterminal, Signaturkarte

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
Die folgenden Schritte werden für jedes Dokument der Liste durchgeführt.

 ---> OL

</td></tr><tr><td>
Varianten/Alternativen

</td><td>
keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
Fehler in den folgenden Schritten des Standardablaufs führen zum Abbruch mit
den ausgewiesenen Fehlercodes:

(



3) Fehlgeschlagene mathematische Prüfung der Signatur: 4120

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
keine

</td></tr></table>

Tabelle198: TAB_KON_120 Fehlercodes TUC_KON_166 „nonQES Signaturen erstellen“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4120

</td><td>
Security

</td><td>
Error

</td><td>
Kartenfehler

</td></tr></table>

**[\<=]**

### 4.1.8.3.4 TUC_KON_152 "Signaturvoraussetzungen für QES prüfen"

##### TIP1-A_4649

Der Konnektor MUSS den technischen Use Case TUC_KON_152
„Signaturvoraussetzungen für QES prüfen” umsetzen.

Tabelle199: TAB_KON_751 – TUC_KON_152 „Signaturvoraussetzungen für QES
prüfen“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_152 „Signaturvoraussetzungen für QES prüfen“

</td></tr><tr><td>
Beschreibung

</td><td>
Es werden die Voraussetzungen an die zu signierenden Dokumente und das
Signaturzertifikat geprüft. Es werden die

QES_DocFormate

unterstützt.

</td></tr><tr><td>
Auslöser

</td><td>
TUC_KON_150 „Dokumente QES signieren“

</td></tr><tr><td>
Vorbedingungen

</td><td>
keine

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor, Kartenterminal, Signaturkarte

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

</td></tr><tr><td>
Varianten/Alternativen

</td><td>
keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
(-\>3) Für MGM_LU_ONLINE=Enabled gilt:

Liefert die Zertifikatsprüfung (OCSP-Abfrage) die Warnung CERT_REVOKED oder
CERT_UNKNOWN gemäß [gemSpec_PKI#Tab_PKI_274], dann wird der TUC mit Fehler
4123 abgebrochen.

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
keine

</td></tr></table>

Tabelle200: TAB_KON_588 Fehlercodes TUC_KON_152 „Signaturvoraussetzungen für
QES prüfen“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können keine
weiteren Fehlercodes auftreten.

</td></tr></table>

**[\<=]**

### 4.1.8.3.5 TUC_KON_154 "QES Signaturen erstellen"

Der TUC_KON_154 stellt den Standardsignaturfall in der TI, die Stapelsignatur
dar (auch für Stapel der Größe 1). Da die Stapelsignatur auf der Zielkarte
passende CVC voraussetzt, die auf den HBA-Vorläuferkarten nicht vorhanden
sind, kann dieser TUC nur den HBA unterstützen. Für HBA-Vorläuferkarten kann
TUC_KON_168 verwendet werden.

##### TIP1-A_4651-02

Der Konnektor MUSS den technischen Use Case TUC_KON_154 „QES Signaturen
erstellen” umsetzen.

Tabelle201: TAB_KON_752 – TUC_KON_154 „QES Signaturen erstellen"

<table><tr><th>
Element

</th><th>
Beschreibung

</th></tr><tr><td>
Name

</td><td>
TUC_KON_154 „QES Signaturen erstellen“

</td></tr><tr><td>
Beschreibung

</td><td>
Die Data To Be Signed (DTBS) werden erzeugt, an die Signaturkarte gesendet und
dort signiert.

</td></tr><tr><td>
Auslöser

</td><td>
TUC_KON_150 „Dokumente QES signieren“

</td></tr><tr><td>
Vorbedingungen

</td><td>
Die Ressourcen Signaturkarte und Kartenterminal sind für den Vorgang reserviert.

DF.QES ist selektiert.

PIN.QES ist initial verifiziert

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor, Kartenterminal, Signaturkarte (HBA)

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
Basierend auf SAK.AUTD_CVC und HPC.AUTD_SUK_CVC und den zugehörigen privaten
Schlüsseln wird ein sicherer Kanal zwischen der gSMC-K des Konnektors und dem
HBA aufgebaut mittels Aufruf TUC_KON_005 „Card-to-Card authentisieren“ {  

     sourceCardSession = gSMC-K;

     targetCardSession = CardSession;

     authMode = „gegenseitig+TC“}

Die folgenden Schritte werden für jedes Dokument des Stapels durchgeführt.

 ---> OL

</td></tr><tr><td>
Varianten/

Alternativen

</td><td>
Alternativ zum Standardablauf kann zu Beginn die maximal erlaubte Stapelgröße
SSEC durch Auslesen von EF.SSEC ermittelt werden. Der zu signierende
Dokumentenstapel wird in Teilstapel von maximaler Größe SSEC zerlegt. Für
jeden Teilstapel wird die PIN.QES verifiziert. Die Dokumente des Teilstapels
werden wie im Standardablauf beschrieben signiert.

Der Nutzer kann den Vorgang der PIN-Eingabe abbrechen.

</td></tr><tr><td>
Fehlerfälle

</td><td>
(-\>2) Fehler im Signaturvorgang führen zum Abbruch des gesamten
Signaturvorgangs, Fehlercode 4123

(-\>3) Fehler bei der PIN-Eingabe führen zum Abbruch des Signaturvorgangs

(-\>4) Fehler in mathematischer Prüfung der Signatur führen zum Abbruch des
Signaturvorgangs, Fehlercode 4120

Das Verhalten des TUCs bei einem Fehlerfall, einem Timeout der PIN-Eingabe oder
beim Abbruch durch den Benutzer ist in Tabelle TAB_KON_192 Verhalten des
Konnektors beim Abbruch einer Stapelsignatur beschrieben.

</td></tr><tr><td>
Sicherheitsanforderungen

</td><td>
Zum Aufbau des sicheren Kanals bzw. zur Aushandlung des symmetrischen
Schlüssels DARF DF.QES NICHT verlassen werden. Benötigte CVCs des HBA MÜSSEN
also bereits vor dem Signaturvorgang eingelesen und gecacht werden. Dies KANN
bereits beim Stecken des HBA geschehen.

Die in [gemSpec_Krypt#3.1.2] angegebenen Festlegungen der zu unterstützenden
Algorithmen MÜSSEN berücksichtigt werden.

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
Abbildung PIC_KON_113 Aktivitätsdiagramm zu „QES Signaturen erstellen“

Das Diagramm dient nur der Veranschaulichung und ist nicht vollständig.
Beispielsweise enthält es nicht die Steuerung durch den Parameter crypt.

</td></tr></table>

![Img-050][Img-050]

Abbildung18: PIC_KON_113 Aktivitätsdiagramm zu „QES Signaturen erstellen“

Tabelle202: TAB_KON_126 Fehlercodes TUC_KON_154 „QES Signaturen erstellen“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4120

</td><td>
Security

</td><td>
Error

</td><td>
Kartenfehler

</td></tr><tr><td>
4123

</td><td>
Security

</td><td>
Error

</td><td>
Fehler bei Signaturerstellung

</td></tr></table>

**[\<=]**

### 4.1.8.3.6 TUC_KON_168 „Einzelsignatur QES erstellen“

##### TIP1-A_4652-02

Der Konnektor MUSS den technischen Use Case TUC_KON_168 „Einzelsignatur QES
erstellen“ umsetzen.

Tabelle203: TAB_KON_293 - TUC_KON_168 „Einzelsignatur QES erstellen“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_168 ”Einzelsignatur QES erstellen”

</td></tr><tr><td>
Beschreibung

</td><td>
Es wird ein Dokument technisch mit einer Signatur versehen.

Im Gegensatz zum TUC_KON_154 „QES Signaturen erstellen“ wird hier nur eine
einzelne Signatur ohne vorhergehendes C2C erstellt. Die Übertragung der DTBS
erfolgt ohne Secure Messaging.

</td></tr><tr><td>
Auslöser

</td><td>
TUC_KON_150 Dokumente QES signieren

</td></tr><tr><td>
Vorbedingungen

</td><td>
Die Ressourcen Signaturkarte und Kartenterminal sind für den Vorgang reserviert.

DF.QES ist selektiert.

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor, Kartenterminal, Signaturkarte (HBAx)

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

</td></tr><tr><td>
Varianten/  
Alternativen

</td><td>
keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
Das Verhalten des TUCs bei einem Fehlerfall, einem Timeout der PIN-Eingabe oder
beim Abbruch durch den Benutzer ist in Tabelle TAB_KON_192 Verhalten des
Konnektors beim Abbruch einer Stapelsignatur beschrieben.

(



3) Fehler in mathematischer Prüfung der Signatur: Abbruch mit 4120

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
keine

</td></tr></table>

Tabelle204: TAB_KON_590 Fehlercodes TUC_KON_168 „Einzelsignatur QES
erstellen“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th colspan="2">
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="5">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten.

</td></tr><tr><td>
4120

</td><td>
Security

</td><td>
Error

</td><td colspan="2">
Kartenfehler

</td></tr></table>

**[\<=]**

### 4.1.8.3.7 TUC_KON_158 "Komfortsignaturen erstellen"

Der TUC_KON_158 führt die Komfortsignatur für ein Dokument oder mehrere
Dokumente eines Stapels aus. Da die Komfortsignatur auf der Zielkarte passende
CVC voraussetzt, die auf den HBA-Vorläuferkarten nicht vorhanden sind,
unterstützt dieser TUC nur den HBA.

##### A_19102-04

Der Konnektor MUSS den technischen Use Case TUC_KON_158 „Komfortsignaturen
erstellen” umsetzen.

Tabelle205: TAB_KON_870 – TUC_KON_158 „Komfortsignaturen erstellen"

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_158 „Komfortsignaturen erstellen“

</td></tr><tr><td>
Beschreibung

</td><td>
Die Data To Be Signed (DTBS) werden erzeugt, an die Signaturkarte gesendet und
dort signiert.

Die Übertragung der DTBS erfolgt mit Secure Messaging.

Die Abarbeitung der Signatur erfolgt im SE#2.

</td></tr><tr><td>
Auslöser

</td><td>
TUC_KON_170 „Dokumente mit Komfort signieren“

</td></tr><tr><td>
Vorbedingungen

</td><td>
Die Ressource Signaturkarte ist für den Vorgang reserviert.

DF.QES ist selektiert.

PIN.QES ist initial verifiziert

</td></tr><tr><td>
Eingangsdaten

</td><td>
·        

Zu signierendes Dokument bzw. zu signierende Dokumente

·        

cardSession (nur HBA erlaubt)

·        

zu verwendende Identität (Zertifikatsreferenz)

·        

crypt [SIG_CRYPT_QES] -

optional

;

default und 

Wertebereich: siehe TAB_KON_862-01

(Dieser Parameter steuert, ob RSA-basierte oder ECC-basierte Signaturen erzeugt
werden.)

·        

WorkplaceId

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor, Kartenterminal, Signaturkarte (HBA)

</td></tr><tr><td>
Ausgangsdaten

</td><td>
·        

Signierte Dokumente

</td></tr><tr><td>
Standardablauf

</td><td>
1.

  

Wenn noch nicht erfolgt, wird basierend auf SAK.AUTD_CVC und HPC.AUTD_SUK_CVC
und den zugehörigen privaten Schlüsseln ein sicherer Kanal zwischen der
gSMC-K des Konnektors und dem HBA aufgebaut mittels Aufruf TUC_KON_005
„Card-to-Card authentisieren“ {  

     sourceCardSession = gSMC-K;

     targetCardSession = CardSession;

     authMode = „gegenseitig+TC“}

Die folgenden Schritte werden für jedes Dokument des Stapels durchgeführt.

2.    Das zu signierende Dokument wird, soweit noch nicht erfolgt, für die
Signatur gemäß des entsprechenden Formats vorbereitet. Ein Ergebnis dieser
Vorbereitung sind die Data To Be Signed (DTBS): der Hash-Wert (Digest des
SignedInfo-Elementes), der zur Signatur an die Karte gesendet werden soll.

3.    Es wird geprüft, ob der Komfortsignatur-Zähler der cardSession den
Wert SAK_COMFORT_SIGNATURE_MAX überschritten hat .

 

4.    Für das zu signierende Dokument werden die DTBS zur Signatur im
sicheren Kanal an den HBA übermittelt (Aufruf TUC_KON_218 „Signiere“).
Dabei werden der Schlüssel und der Algorithmusidentifier über die Tabelle
TAB_KON_900 bestimmt.

5.    Der Komfortsignatur-Zähler der cardSession wird um 1 erhöht.

6.    Die erstellte Signatur wird mathematisch geprüft.

7.    Der ermittelte Signaturwert wird in den zuvor vorbereiteten
Signaturprototypen eingefügt.

8.

  

Der Konnektor löst TUC_KON_256 {"SIG/SIGNDOC/NEXT_SUCCESSFUL"; Op; Info;
„$Jobnummer"; noLog; $doInformClients } aus.

</td></tr><tr><td>
Varianten/

Alternatien

</td><td>
Keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
In den Fehlerfällen, die zum Abbruch des Komfortsignaturmodus mit Fehlercode
4271 führen, wird vor dem Abbruch TUC_KON_172 für das cardHandle des HBA
ausgeführt.

(-\>3) Der Komfortsignatur-Zähler der cardSession hat den Maximalwert
überschritten: Fehlercode 4271

(-\>4) Der PIN.QES-Nutzungszähler der Karte ist abgelaufen (erkennbar z. B.
daran, dass die Karte einen Autorisierungsfehler zurückmeldet): Fehlercode 4271

(-\>4) Fehler im Signaturvorgang führen zum Abbruch des gesamten
Signaturvorgangs: Fehlercode 4123

(-\>6) Fehler in mathematischer Prüfung der Signatur führen zum Abbruch des
Signaturvorgangs: Fehlercode 4120

Das weitere Verhalten des TUCs bei einem Fehlerfall oder beim Abbruch durch den
Benutzer ist in TAB_KON_192, Verhalten des Konnektors beim Abbruch einer
Stapelsignatur, beschrieben.

</td></tr><tr><td>
Sicherheitsanforderungen

</td><td>
Zum Aufbau des sicheren Kanals bzw. zur Aushandlung des symmetrischen
Schlüssels DARF DF.QES NICHT verlassen werden. Benötigte CVCs des HBA MÜSSEN
also bereits vor dem Signaturvorgang eingelesen und gecached werden. Dies KANN
bereits beim Stecken des HBA geschehen.

Komfortsignaturen MÜSSEN im SE#2 abgearbeitet werden.

Die in [gemSpec_Krypt] angegebenen Festlegungen der zu unterstützenden
Algorithmen MÜSSEN berücksichtigt werden.

</td></tr></table>

Tabelle206: TAB_KON_873 Fehlercodes TUC_KON_158 „Komfortsignaturen erstellen“

<table><tr><td>
Fehlercode

</td><td>
ErrorType

</td><td>
Severity

</td><td>
Fehlertext

</td></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4120

</td><td>
Security

</td><td>
Error

</td><td>
Kartenfehler

</td></tr><tr><td>
4123

</td><td>
Security

</td><td>
Error

</td><td>
Fehler bei Signaturerstellung

</td></tr><tr><td>
</td><td>
</td></tr></table>

**[\<=]**

### 4.1.8.4 Interne TUCs, auch durch Fachmodule nutzbar

##### A_20478

Der Konnektor KANN für die nonQES-Signaturerstellung an der Schnittstelle zu
Fachmodulen zusätzliche Dokumentformate unterstützen. **[\<=]**

Die in der obigen Anforderung benannten Signaturen von Dokumentenformaten
umfassen beispielsweise die Signatur von Token nach SAML2 für das Fachmodul
ePA entsprechend [gemSpec_FM_ePA#A_14927].

### 4.1.8.4.1 TUC_KON_160 „Dokumente nonQES signieren”

##### TIP1-A_4653

Der Konnektor MUSS den technischen Use Case TUC_KON_160 „Dokumente nonQES
signieren” umsetzen.

Tabelle207: TAB_KON_753 – TUC_KON_160 „Dokumente nonQES signieren“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_160 „Dokumente nonQES signieren“

</td></tr><tr><td>
Beschreibung

</td><td>
Im Rahmen von Fachanwendungen werden ein oder mehrere Dokumente mit einer
nicht-qualifizierten elektronischen Signatur (nonQES) versehen. Es werden die
nonQES_DocFormate unterstützt.

</td></tr><tr><td>
Auslöser

</td><td>
Aufruf durch ein Clientsystem (Operation SignDocument) oder ein Fachmodul.

</td></tr><tr><td>
Vorbedingungen

</td><td>
Die Signaturkarte muss gesteckt sein.

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor, Kartenterminal, Signaturkarte bzw. HSM-B

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

(Liste der signierten Dokumente)

</td></tr><tr><td>
Standardablauf

</td><td>
Der Konnektor KANN die Schritte 1 bis 4 in einer beliebigen Reihenfolge
durchführen.

 ---> OL

</td></tr><tr><td>
Varianten/  
Alternativen

</td><td>
Im Fall signatureType=S/MIME-Signatur  
wird der Standardablauf des CMS
Signaturverfahrens durch einen vorgelagerten S/MIME-Vorbereitungsschritt und
einen nachgelagerten S/MIME-Nachbereitungsschritt ergänzt. Das
S/MIME-Verfahren MUSS konform [S/MIME] und SOLL konform [COMMON_PKI], Part 3,
erfolgen.  
Der S/MIME-Vorbereitungsschritt bereitet das übergebene
MIME-Dokument gemäß [S/MIME], Kapitel 3.1, auf die nachfolgende CMS-Signatur
durch eine Kanonisierung für Text [S/MIME], Kapitel 3.1.1, vor. Eine weitere
Kanonisierung oder eine Anpassung des Transfer Encodings [S/MIME], Kapitel
3.1.2, erfolgt nicht.  
Im S/MIME-Nachbereitungsschritt wird das im
Standardablauf erzeugte CMS-Objekt in eine MIME-Nachricht vom Typ
„application/pkcs7-mime“ eingebettet.  
Sämtliche Header-Felder der
Nachricht MÜSSEN in die Header-Felder der S/MIME-Nachricht übernommen werden.
 
"MIME-Version: 1.0" MUSS definiert sein.  
Das Feld "Content-Type:" ist als
"application/pkcs7-mime" zu definieren. Die weiteren Attribute dieses Feldes
sind:

 ---> UL

Die Codierung des signierten Inhalts der Nachricht MUSS in "base64" erfolgen.
Entsprechend ist das zugehörige Header-Feld zu füllen:
"Content-Transfer-Encoding: base64".  
Das Feld "Content-Disposition" definiert
den Inhalt der Nachricht als Dateianhang: "Content-Disposition: attachment;
filename=$dateiname"

</td></tr><tr><td>
Fehlerfälle

</td><td>
Fehler in den folgenden Schritten des Standardablaufs führen zum Abbruch mit
den ausgewiesenen Fehlercodes:  
(2) Ungültige Angabe des
Signaturverfahrens: Fehlercode 4111  
         Übergabe eines für die
nonQES nicht unterstützten  
        Dokumentformats: Fehlercode 4110 

  (3) Kartentyp nicht zulässig für Signatur: Fehlercode 4126

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
keine

</td></tr></table>

Tabelle208: TAB_KON_127 Fehlercodes TUC_KON_160 „Dokumente nonQES signieren“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4110

</td><td>
Technical

</td><td>
Error

</td><td>
ungültiges Dokumentformat (%Format%)

Der Parameter Format enthält das übergebene Dokumentformat.

</td></tr><tr><td>
4111

</td><td>
Technical

</td><td>
Error

</td><td>
ungültiger Signaturtyp oder Signaturvariante

</td></tr><tr><td>
4126

</td><td>
Security

</td><td>
Error

</td><td>
Kartentyp nicht zulässig für Signatur

</td></tr></table>

**[\<=]**

##### TIP1-A_4653-02

Der Konnektor MUSS den technischen Use Case TUC_KON_160 „Dokumente nonQES
signieren” umsetzen.

Tabelle209: TAB_KON_753 – TUC_KON_160 „Dokumente nonQES signieren“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_160 „Dokumente nonQES signieren“

</td></tr><tr><td>
Beschreibung

</td><td>
Im Rahmen von Fachanwendungen werden ein oder mehrere Dokumente mit einer
nicht-qualifizierten elektronischen Signatur (nonQES) versehen. Es werden die
nonQES_DocFormate unterstützt.

</td></tr><tr><td>
Auslöser

</td><td>
Aufruf durch ein Clientsystem (Operation SignDocument) oder ein Fachmodul.

</td></tr><tr><td>
Vorbedingungen

</td><td>
Die Signaturkarte muss gesteckt sein.

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor, Kartenterminal, Signaturkarte bzw. HSM-B

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

(Liste der signierten Dokumente)

</td></tr><tr><td>
Standardablauf

</td><td>
Der Konnektor KANN die Schritte 1 bis 4 in einer beliebigen Reihenfolge
durchführen.

 ---> OL

</td></tr><tr><td>
Varianten/  
Alternativen

</td><td>
Im Fall signatureType=S/MIME-Signatur  
wird der Standardablauf des CMS
Signaturverfahrens durch einen vorgelagerten S/MIME-Vorbereitungsschritt und
einen nachgelagerten S/MIME-Nachbereitungsschritt ergänzt. Das
S/MIME-Verfahren MUSS konform [S/MIME] und SOLL konform [COMMON_PKI], Part 3,
erfolgen.  
Der S/MIME-Vorbereitungsschritt bereitet das übergebene
MIME-Dokument gemäß [S/MIME], Kapitel 3.1, auf die nachfolgende CMS-Signatur
durch eine Kanonisierung für Text [S/MIME], Kapitel 3.1.1, vor. Eine weitere
Kanonisierung oder eine Anpassung des Transfer Encodings [S/MIME], Kapitel
3.1.2, erfolgt nicht.  
Im S/MIME-Nachbereitungsschritt wird das im
Standardablauf erzeugte CMS-Objekt in eine MIME-Nachricht vom Typ
„application/pkcs7-mime“ eingebettet.  
Sämtliche Header-Felder der
Nachricht MÜSSEN in die Header-Felder der S/MIME-Nachricht übernommen werden.
 
"MIME-Version: 1.0" MUSS definiert sein.  
Das Feld "Content-Type:" ist als
"application/pkcs7-mime" zu definieren. Die weiteren Attribute dieses Feldes
sind:

 ---> UL

Die Codierung des signierten Inhalts der Nachricht MUSS in "base64" erfolgen.
Entsprechend ist das zugehörige Header-Feld zu füllen:
"Content-Transfer-Encoding: base64".  
Das Feld "Content-Disposition" definiert
den Inhalt der Nachricht als Dateianhang: "Content-Disposition: attachment;
filename=$dateiname"

</td></tr><tr><td>
Fehlerfälle

</td><td>
Fehler in den folgenden Schritten des Standardablaufs führen zum Abbruch mit
den ausgewiesenen Fehlercodes:  
(2) Ungültige Angabe des
Signaturverfahrens: Fehlercode 4111  
         Übergabe eines für die
nonQES nicht unterstützten  
        Dokumentformats: Fehlercode 4110 

  (3) Kartentyp nicht zulässig für Signatur: Fehlercode 4126

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
keine

</td></tr></table>

Tabelle210: TAB_KON_127 Fehlercodes TUC_KON_160 „Dokumente nonQES signieren“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4110

</td><td>
Technical

</td><td>
Error

</td><td>
ungültiges Dokumentformat (%Format%)

Der Parameter Format enthält das übergebene Dokumentformat.

</td></tr><tr><td>
4111

</td><td>
Technical

</td><td>
Error

</td><td>
ungültiger Signaturtyp oder Signaturvariante

</td></tr><tr><td>
4126

</td><td>
Security

</td><td>
Error

</td><td>
Kartentyp nicht zulässig für Signatur

</td></tr></table>

Die zulässigen Zertifikate und Schlüssel sind in TAB_KON_900 aufgelistet. **[\<=]**

### 4.1.8.4.2 TUC_KON_161 „nonQES Dokumentsignatur prüfen”

##### TIP1-A_4654-04

Der Konnektor MUSS den technischen Use Case TUC_KON_161 „nonQES
Dokumentsignatur prüfen” umsetzen.

Tabelle211: TAB_KON_121 - TUC_KON_161 „nonQES Dokumentsignatur prüfen“

<table><tr><th>
Element

</th><th>
Beschreibung

</th></tr><tr><td>
Name

</td><td>
TUC_KON_161 „nonQES Dokumentsignatur prüfen”

</td></tr><tr><td>
Beschreibung

</td><td>
Es wird die nicht-qualifizierte elektronische Signatur (nonQES) eines Dokuments
geprüft. Dabei werden die Signaturverfahren laut Tabelle TAB_KON_582 –
Signaturverfahren unterstützt. Sind mehrere Signaturen vorhanden, so werden
alle geprüft. Auch Parallel- und Gegensignaturen MÜSSEN unterstützt werden. 

Die unterstützten Zertifikatstyp-OIDs sind in der Tabelle TAB_KON_786
aufgelistet.

</td></tr><tr><td>
Auslöser

</td><td>
Aufruf durch ein Clientsystem (Operation VerifyDocument) oder ein Fachmodul

</td></tr><tr><td>
Vorbedingungen

</td><td>
keine

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

ocspGracePeriod

         (OCSP-Grace Period: maximal zulässiger Zeitraum, den die letzte

        OCSP-Antwort aus dem Cache bezüglich des Referenzzeitpunkts

        zurückliegen darf)

 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

XML-Signatur:

      Die Core Validation erfolgt entsprechend [XMLDSig]

      Kapitel 3.2 Core Validation.

CMS-Signatur:

      Die Core Validation erfolgt entsprechend Cryptographic

     Message Syntax (CMS) Kapitel 5.6 Signature Verification

     Process [RFC5652].

PDF-Signatur:

      Die Core Validation erfolgt entsprechend [PAdES-3]

      Kapitel 4.6 Signature Validation aus PAdES-BES Part 3.

Auch wenn die Validierung fehlschlägt, werden die folgenden Prüfschritte
durchgeführt, so dass ein vollständiges Prüfprotokoll erstellt werden kann.

 ---> OL

Teil 1: Signaturzertifikat ermitteln

XML-Signatur:

      Das Signaturzertifikat ist im XMLDSig Element

    

ds:KeyInfo/ds:X509Data

gespeichert [XMLDSig]

     oder wird als Eingangsparameter übergeben.

CMS-Signatur:

      Das Signaturzertifikat für CAdES ist im Feld

    

certificates

im

SignedData

Container gespeichert

     [CAdES] oder wird als Eingangsparameter übergeben.

PDF-Signatur:

      Das PDF Signaturzertifikat für PAdES ist im Feld

     SignedData.certificates entsprechend Kapitel 6.1.1

      „Placements of the signing certificate“

      [PAdES Baseline Profile] gespeichert oder wird als

     Eingangsparameter übergeben.

Teil 2: Signaturzeitpunkt bestimmen

Der Signaturzeitpunkt Ermittelter_Signaturzeitpunkt_Eingebettet wird wie folgt
selektiert:

XML-Signatur:

Das XML element SigningTime spezifiziert den 

Signaturzeitpunkt entsprechend Kapitel 7.2.1 XAdES

[XAdES].

CMS-Signatur:

Das Attribut SigningTime spezifiziert den

Signaturzeitpunkt entsprechend Kapitel 11.3 CMS [CMS].

PDF-Signatur:

Der Signaturzeitpunkt kann dem M Eintrag des Signature

Dictionary entnommen werden [PAdES Baseline Profile]

Kapitel 6.2.1 Signing time.

Der Signaturzeitpunkt

Benutzerdefinierter_Zeitpunkt

liegt gegebenenfalls als Aufrufparameter vor. Der Signaturzeitpunkt

Ermittelter_Signaturzeitpunkt_System

wird ermittelt.

Teil 3: Signaturzertifikatsprüfung:

Bei der folgenden Signaturzertifikatsprüfung sind die Signaturzeitpunkte
gemäß [TIP1-A_5545] zu berücksichtigen.

Die Signaturzertifikatsprüfung erfolgt durch Aufruf von TUC_KON_037
„Zertifikat prüfen“.

Die Parameter im Aufruf von TUC_KON_037 „Zertifikat prüfen“ werden wie
folgt gesetzt

 ---> UL

In Abhängigkeit von der policyList gemäß Tabelle TAB_KON_786 gesetzte
Parameter:

 ---> UL

Sind OCSP-Responses in der Signatur eingebettet, ist die jüngste OCSP-Response,
die für die Zertifikatsprüfung notwendig ist, beim Aufruf von TUC_KON_037 zu
übergeben.

Sofern der Aufruf von TUC_KON_037 ocspResponsesRenewed zurückgibt, wird die
Liste der OCSP-Responses in die Signatur eingebettet.

Auch wenn die Zertifikatsprüfung fehlschlägt, werden die folgenden Prüfungen
durchgeführt.

 ---> OL

In diesem Schritt wird das signierte Dokument entsprechend der Profilierung der
Signaturformate (siehe Anhang B.2) geprüft.

Es sind die Vorgaben für die Prüfung von Signaturen aus den Standards für
AdES [XAdES], [XAdES Baseline], [CAdES], [CAdES Baseline], [PAdES-3] und [PAdES
Baseline] umzusetzen. Dabei sind die Vorgaben aus Tabelle TAB_KON_779-01
„Profilierung der Signaturformate“ und Tabelle  
TAB_KON_778
„Einsatzbereich der Signaturvarianten“ zu erfüllen.

Auch wenn nicht alle Anforderungen an das Format des signierten Dokuments
erfüllt werden, wird die Prüfung mit den folgenden Schritten fortgesetzt, um
ein vollständiges Prüfungsprotokoll zu erhalten.

 ---> OL

</td></tr><tr><td>
Varianten/

Alternativen

</td><td>
Im Fall, dass die Online-Prüfung des Sperrzustands des Signaturzertifikats
nicht möglich ist und eine möglicherweise gecachte OCSP-Response nicht
vorhanden ist oder nicht mehr verwendet werden darf, wird das Prüfergebnis mit
der entsprechenden Warnung zurückgegeben.

Im Fall einer PKCS#1-Signatur ist das verwendete
Signaturverfahren,  RSASSA-PSS bzw. RSASSA-PKCS1-v1_5, aus der Signatur zu
bestimmen.

</td></tr><tr><td>
Fehlerfälle

</td><td>
Das Verhalten des TUCs bei einem Fehlerfall ist in TAB_KON_124 Fehlercodes
TUC_KON_161 „nonQES Dokumentensignatur prüfen“ beschrieben.

(-\>1) keine Signatur in signedDocument und signature vorhanden: 4253

(



2

„CoreValidation“

)

Interner Fehler: 4001, Signatur des Dokument ungültig: 4115.

Signatur umfasst nicht das gesamte Dokument: 4262.

(



3 „

CheckSignatureCertificate“

)      

Interner Fehler: 4001, Signaturzertifikat ermitteln fehlgeschlagen: 4206.

(



4

„CheckPolicyConstraints“

)  

Interner Fehler: 4001, Dokument nicht konform zu Regeln für nonQES: 4112.

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
keine

</td></tr></table>

Tabelle212: TAB_KON_124 Fehlercodes TUC_KON_161 „nonQES Dokumentensignatur
prüfen“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weiteren Fehlercodes auftreten.

</td></tr><tr><td>
4001

</td><td>
Technical

</td><td>
Error

</td><td>
Interner Fehler

</td></tr><tr><td>
4206

</td><td>
Technical

</td><td>
Error

</td><td>
Signaturzertifikat ermitteln ist fehlgeschlagen

</td></tr><tr><td>
4112

</td><td>
Technical

</td><td>
Error

</td><td>
Dokument nicht konform zu Regeln für nonQES

</td></tr><tr><td>
4115

</td><td>
Security

</td><td>
Error

</td><td>
Signatur des Dokuments ungültig.

Der SignatureValue des Dokuments ist falsch oder für mindestens eine Reference
ist der DigestValue falsch.

</td></tr><tr><td>
4253

</td><td>
Technical

</td><td>
Error

</td><td>
Keine Signatur im Aufruf

</td></tr><tr><td>
4262

</td><td>
Technical

</td><td>
Error

</td><td>
Signatur umfasst nicht das gesamte Dokument

</td></tr><tr><td>
4264

</td><td>
Technical

</td><td>
Warning

</td><td>
Ein oder mehrere Zertifikate ignoriert

</td></tr></table>

Das Gesamtergebnis (VerificationResult) für die Prüfung einer
Dokumentensignatur fasst die Ergebnisse aller Prüfungsschritte in einem
einzelnen Statuswert zusammen.

Tabelle213: TAB_KON_754 Übersicht Status für Prüfung einer Dokumentensignatur

<table><tr><th colspan="2">
VerificationResult für gesamtes Dokument (VerificationResult/HighLevelResult)

</th></tr><tr><td>
Wert

</td><td>
Bedeutung

</td></tr><tr><td>
VALID

</td><td>
Wenn VerificationResult für alle Signaturen zum Dokument VALID

</td></tr><tr><td>
INVALID

</td><td>
Wenn VerificationResult für eine Signatur zum Dokument INVALID

</td></tr><tr><td>
INCONCLUSIVE

</td><td>
in allen anderen Fällen

</td></tr><tr><td colspan="2">
VerificationResult pro Signatur  (VerificationReport/IndividualReport/Result)

</td></tr><tr><td>
Wert

</td><td>
Bedeutung

mögliche Ausprägungen im VerificationReport

</td></tr><tr><td rowspan="3">
VALID

</td><td>
Die Signatur wurde gemäß den Regeln für die nonQES geprüft und für gültig
befunden.

</td></tr><tr><td>
ResultMajor = urn:oasis:names:tc:dss:1.0:resultmajor:Success

ResultMinor =
urn:oasis:names:tc:dss:1.0:resultminor:valid:signature:OnAllDocuments

</td></tr><tr><td>
ResultMajor = urn:oasis:names:tc:dss:1.0:resultmajor:Success

ResultMinor =
urn:oasis:names:tc:dss:1.0:resultminor:valid:signature:HasManifestResults

</td></tr><tr><td rowspan="7">
INVALID

</td><td>
Die Signatur ist ungültig oder aufgrund eines Fehlers konnte die
Signaturprüfung nicht durchgeführt werden.

</td></tr><tr><td>
ResultMajor = urn:oasis:names:tc:dss:1.0:resultmajor:Success

ResultMinor = urn:oasis:names:tc:dss:1.0:resultminor:invalid:IncorrectSignature

</td></tr><tr><td>
ResultMajor = urn:oasis:names:tc:dss:1.0:resultmajor:Success

ResultMinor =
urn:oasis:names:tc:dss:1.0:resultminor:valid:signature:InvalidSignatureTimestamp

</td></tr><tr><td>
ResultMajor = urn:oasis:names:tc:dss:1.0:resultmajor:RequesterError

</td></tr><tr><td>
ResultMajor = urn:oasis:names:tc:dss:1.0:resultmajor:ResponderError

</td></tr><tr><td>
ResultMajor = urn:oasis:names:tc:dss:1.0:resultmajor:InsufficientInformation

ResultMinor = urn:oasis:names:tc:dss:1.0:resultminor:invalid:IncorrectSignature

</td></tr><tr><td>
ResultMajor = urn:oasis:names:tc:dss:1.0:resultmajor:InsufficientInformation

ResultMinor = urn:oasis:names:tc:dss:1.0:resultminor:CertificateChainNotComplete

</td></tr><tr><td rowspan="2">
INCONCLUSIVE

</td><td>
Die Signatur wurde gemäß den Regeln für die nonQES geprüft. Allerdings
konnten eine oder mehrere Prüfungen nicht vollständig durchgeführt werden.
Einzelheiten finden sich in Result-Detail.

Die Prüfungen, die durchgeführt werden konnten, waren erfolgreich.

</td></tr><tr><td>
ResultMajor = urn:oasis:names:tc:dss:1.0:resultmajor:InsufficientInformation

ResultMinor = urn:oasis:names:tc:dss:1.0:resultminor:OcspNotAvailiable

Hinweis: Das Erreichen dieses Zustandes hängt davon ab, ob eine OCSP-Abfrage
nicht durchgeführt werden konnte, unabhängig davon, ob die Ursache dafür die
Offlineschaltung des Konnektors (MGM_LU_ONLINE = Disabled) oder die
Nichterreichbarkeit des OCSP-Responders im Online-Betrieb (MGM_LU_ONLINE =
Enabled)  ist.

</td></tr></table>

Tabelle214: TAB_KON_786 Übersicht unterstützte Zertifikatstyp-OIDs

<table><tr><th>
policyList

</th><th>
intendedKeyUsage

</th><th>
intendedExtendedKeyUsage

</th></tr><tr><td>
X.509-Zertifikat einer eGK

</td><td>
oid_egk_aut

</td><td>
intendedKeyUsage(C.CH.AUT)

</td><td>
id-kp-clientAuth

</td></tr><tr><td>
X.509-Zertifikat einer eGK

</td><td>
oid_egk_autn

</td><td>
intendedKeyUsage(C.CH.AUTN)

</td><td>
id-kp-clientAuth

</td></tr><tr><td>
X.509-Zertifikat der SM-B

</td><td>
oid_smc_b_osig

</td><td>
intendedKeyUsage(C.HCI.OSIG)

</td><td>
-

</td></tr><tr><td>
X.509-Zertifikat eines fachanwendungsspezifischen Dienstes

</td><td>
oid_fd_sig

</td><td>
intendedKeyUsage(C.FD.SIG)

</td><td>
-

</td></tr><tr><td>
X.509-Zertifikat eines fachanwendungsspezifischen Dienstes (nonRepudiation)

</td><td>
oid_fd_osig

</td><td>
intendedKeyUsage(C.FD.OSIG)

</td><td>
-

</td></tr><tr><td>
X.509-Zertifikat eines zentralen Dienstes (nonRepudiation)

</td><td>
oid_zd_sig

</td><td>
intendedKeyUsage(C.ZD.SIG)

</td><td>
-

</td></tr></table>

**[\<=]**

##### TIP1-A_5545

Der Konnektor MUSS zur nonQES-Signaturprüfung ein Prüfergebnis das sich auf
genau einen angenommenen Signaturzeitpunkt bezieht, an den Aufrufer
zurückgeben.Die Auswahl des angenommenen Signaturzeitpunkts, auf den sich das
Signaturergebnis bezieht, erfolgt hierarchisch:

 ---> UL

**[\<=]**

### 4.1.8.4.3 TUC_KON_162 „Kryptographische Prüfung der XML-Dokumentensignatur”

##### TIP1-A_5505

Der Konnektor MUSS den technischen Use Case TUC_KON_162 „Kryptographische
Prüfung der XML-Dokumentensignatur” umsetzen.

Tabelle215: TAB_KON_430 – TUC_KON_162 „Kryptographische Prüfung der
XML-Dokumentensignatur“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_162 „Kryptographische Prüfung der XML-Dokumentensignatur”

</td></tr><tr><td>
Beschreibung

</td><td>
Es wird die mathematische Korrektheit der elektronischen Signatur eines
XML-Dokuments geprüft. Sind mehrere Signaturen vorhanden, so werden alle
geprüft.

</td></tr><tr><td>
Auslöser

</td><td>
Aufruf durch ein Fachmodul

</td></tr><tr><td>
Vorbedingungen

</td><td>
 ---> UL

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
„CoreValidation“

:

Es erfolgt die mathematische Prüfung der Signatur, bestehend aus der Prüfung
der Hash-Kette bis zum signierten Hashwert und der Prüfung der
kryptographischen Signatur unter Verwendung des öffentlichen Schlüssels aus
dem Zertifikat, des Signaturwertes und des signierten Hashwertes.

XML-Signatur:

     

Die Core Validation erfolgt entsprechend [XMLDSig] Kapitel 3.2  
     Core
Validation.

  a) CoreValidation erfolgreich -\> result = true

  b) CoreValidation fehlerhaft  -\> result = false

</td></tr><tr><td>
Varianten/Alternativen

</td><td>
keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
Fehler in den folgenden Schritten des Standardablaufs führen zu den
ausgewiesenen Fehlercodes:

Interner Fehler: 4001

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
keine

</td></tr></table>

Tabelle216: TAB_KON_431 Fehlercodes TUC_KON_162 „Kryptographische Prüfung der
XML-Dokumentensignatur“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th colspan="2">
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="5">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weiteren Fehlercodes auftreten.

</td></tr><tr><td>
4001

</td><td>
Technical

</td><td>
Error

</td><td colspan="2">
Interner Fehler

</td></tr></table>

**[\<=]**

### 4.1.8.4.4 TUC_KON_150 „Dokumente QES signieren”

##### TIP1-A_4655-02

Der Konnektor MUSS den technischen Use Case TUC_KON_150 „Dokumente QES
signieren” umsetzen.

Tabelle217: TAB_KON_755 – TUC_KON_150 „Dokumente QES signieren“

<table><tr><th>
Element

</th><th>
Beschreibung

</th></tr><tr><td>
Name

</td><td>
TUC_KON_150 ”Dokumente QES signieren”

</td></tr><tr><td>
Beschreibung

</td><td>
Im Rahmen von Fachanwendungen werden ein oder mehrere Dokumente mit einer
qualifizierten elektronischen Signatur versehen. Es werden die QES_DocFormate
unterstützt.

</td></tr><tr><td>
Auslöser

</td><td>
Aufruf durch ein Clientsystem (Operation SignDocument) oder ein Fachmodul.

</td></tr><tr><td>
Vorbedingungen

</td><td>
Die Signaturkarte muss gesteckt sein.

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor, Kartenterminal, Signaturkarte (HBAx)

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
Der Konnektor KANN die Schritte 1 bis 4 in einer beliebigen Reihenfolge
durchführen.

 ---> OL

Wenn nur ein zu signierendes Dokument vorhanden ist und der Einfachsignaturmodus
aktiviert ist (siehe Konfigurationsparameter SAK_SIMPLE_SIGNATURE_ MODE), wird
in Schritt 7 Variante a) durchgeführt, ansonsten Variante b).

 ---> OL

</td></tr><tr><td>
Varianten/

Alternativen

</td><td>
Der Nutzer kann den Vorgang bei der Autorisierung (Schritt 6) abbrechen. Hierbei
sind die gleichen Regeln anzuwenden wie im Fehlerfall (s. Fehlerfälle).

</td></tr><tr><td>
Fehlerfälle

</td><td>
Fehler in den folgenden Schritten des Standardablaufs führen zum Abbruch mit
den ausgewiesenen Fehlercodes:

(-\>1) Ungültige Angabe des Signaturtyps oder Signaturvariante:

         Fehlercode 4111

         Übergabe eines für die QES nicht unterstützten
Dokumentformats:

         Fehlercode 4110

(-\>2) Kartentyp nicht zulässig für Signatur: Fehlercode 4126

(-\>5) Fehler bei der Reservierung von Ressourcen: Fehlercode 4060

(-\>7b) Karte ist kein HBA, sondern HBA-Vorläuferkarte: Fehlercode 4118

Im Fehlerfall, inklusive Timeout bei der PIN-Eingabe, oder bei Abbruch durch den
Benutzer (Fehler 4049):

 a)      … MUSS DF.QES verlassen werden

 b)      … MÜSSEN alle reservierten Ressourcen freigegeben werden

 c)      … MUSS der Fehler immer an das Clientsystem zurückgemeldet

    werden

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
Abbildung PIC_KON_114 Aktivitätsdiagramm zu „Dokument QES signieren“

</td></tr></table>

![Img-051][Img-051]

Abbildung19: PIC_KON_114 Aktivitätsdiagramm zu „Dokument QES signieren“

Tabelle218: TAB_KON_128 Fehlercodes TUC_KON_150 „Dokument QES signieren“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4060

</td><td>
Technical

</td><td>
Error

</td><td>
Ressource belegt

</td></tr><tr><td>
4110

</td><td>
Technical

</td><td>
Error

</td><td>
ungültiges Dokumentformat (%Format%)

Der Parameter Format enthält das übergebene Dokumentformat.

</td></tr><tr><td>
4111

</td><td>
Technical

</td><td>
Error

</td><td>
ungültiger Signaturtyp oder Signaturvariante

</td></tr><tr><td>
4118

</td><td>
Technical

</td><td>
Error

</td><td>
Stapelsignaturen werden nur für den HBA unterstützt. Mit HBA-Vorläuferkarten
sind nur Einzelsignaturen möglich.

</td></tr><tr><td>
4126

</td><td>
Security

</td><td>
Error

</td><td>
Kartentyp nicht zulässig für Signatur

</td></tr><tr><td>
4049

</td><td>
Technical

</td><td>
Error

</td><td>
Abbruch durch den Benutzer

</td></tr></table>

**[\<=]**

### 4.1.8.4.5 Anforderungen an die Stapelsignatur

Eine Stapelsignatur definiert sich als „Erstellung einer begrenzten Anzahl
Signaturen nach den zeitlich unmittelbar aufeinander folgenden Prozessen der
Anzeige der zu signierenden Daten und der einmaligen Authentisierung des
Signaturschlüssel-Inhabers gegenüber der qualifizierten elektronischen
Signaturerstellungseinheit“ (siehe [BSI-TR03114]).

##### TIP1-A_4669

Der Signaturdienst MUSS die Möglichkeit bieten, Dokumente eines Stapels einzeln
qualifiziert elektronisch zu signieren. Der Signaturdienst MUSS als
qualifizierte elektronische Signaturerstellungseinheit für die Stapelsignatur
den HBA unterstützen. **[\<=]**

##### TIP1-A_5664

Die zu signierenden Dokumente einer Stapelsignatur MÜSSEN vom Signaturdienst im
Konnektor in derselben Reihenfolge signiert, in der sie im Signaturauftrag vom
Clientsystem geschickt werden. **[\<=]**

##### TIP1-A_4670

Bei der Stapelsignatur MUSS der Signaturdienst die zu signierenden Daten
(DTBS)über Secure Messaging vom Konnektor zum HBA übertragen. Dieser Secure
Messaging-Kanal MUSS über die gSMC-K zum HBA mittels C.SAK.AUTD_CVC aufgebaut
werden. **[\<=]**

##### TIP1-A_4671

Der Signaturdienst MUSS dem Benutzer während und nach einer PIN-Eingabe die
Möglichkeit zum Abbruch einer Stapelsignatur anbieten.Das geforderte Verhalten
des Konnektors beim Abbruch einer Stapelsignatur wird in der folgenden Tabelle
beschrieben. Hierbei werden die beiden Punkte „Abbruch, während die erneute
PIN-Eingabe angefordert wird“ (Nummer 1 bis 4) und „Abbruch, während der
Vorgang der Signaturerstellung läuft“ (Nummer 5 bis 6) unterschieden. Zeile
Nummer 7 beschreibt alle sonstigen Fehlerfälle.Ein Teilstapel einer
Stapelsignatur ist durch die maximale Anzahl der Dokumente definiert, welche
nach der Eingabe der Signatur-PIN durch den Signaturschlüssel-Inhaber signiert
werden kann.

Tabelle219: TAB_KON_192 Verhalten des Konnektors beim Abbruch einer
Stapelsignatur

<table><tr><th colspan="2">
Nummer

</th><th>
Problem/Fehler/Ereignis

</th><th>
Verhalten des Konnektors

</th></tr><tr><td rowspan="4">
Während die erneute PIN-Eingabe angefordert wird

</td><td>
1

</td><td>
Timeout bei der PIN-Eingabe am KT

</td><td>
Der Signaturvorgang (Stapel) wird

beendet

:

Kein „Fehler“

Die Signaturen des/der vorherigen Teilstapel(s) bleiben erhalten und werden an
das Clientsystem zurückgegeben.

Keine weiteren Signaturen des neuen Teilstapels werden erstellt. (Die
Weiterverarbeitung bereits erstellter Signaturen des letzten Teilstapels
(sofern vorhanden) wird noch abgeschlossen).

</td></tr><tr><td>
2

</td><td>
PIN gesperrt (nach mehrfacher Fehleingabe)

</td><td>
Siehe Verhalten unter Nummer 1

</td></tr><tr><td>
3

</td><td>
Abbruchkommando „StopSignature“ zur Jobnummer wird empfangen

</td><td>
Der Signaturvorgang (Stapel) wird

beendet

.

Kein „Fehler“

Keine weiteren Signaturen des neuen Teilstapels werden erstellt. (Die
Weiterverarbeitung bereits erstellter Signaturen des letzten Teilstapels
(sofern vorhanden) wird noch abgeschlossen).

</td></tr><tr><td>
4

</td><td>
Abbruchtaste am Kartenterminal wird gedrückt

</td><td>
Siehe Verhalten unter Nummer 1

</td></tr><tr><td rowspan="2">
während der Vorgang der Signaturerstellung läuft

</td><td>
5

</td><td>
Abbruchkommando „StopSignature“ zur Jobnummer wird empfangen

</td><td>
Signaturvorgang (Stapel) wird

abgebrochen

.

Kein „Fehler“

Keine weiteren Signaturen des Stapels werden erstellt.

Keine weiteren Signaturen des Teilstapels werden erstellt.

Bisher erstellte Signaturen des aktuellen Teilstapels werden verworfen.

</td></tr><tr><td>
6

</td><td>
Abbruchtaste am Kartenterminal wird gedrückt.

</td><td>
Die „Abbruch“-Taste wird nicht vom Signaturdienst fortlaufend überwacht



Keine Aktion seitens des Signaturdienstes.

</td></tr><tr><td>
</td><td>
7

</td><td>
Bei allen anderen Fehlerfällen (z. B.: es kommen zu viele Signaturen zurück,
der Hash-Wert einer der Signaturen stimmt nicht, Karte gezogen, etc)

</td><td>
Signaturvorgang (Stapel) wird abgebrochen.

Schwerer Fehler.

Keine weiteren Signaturen des Stapels werden erstellt.

Keine weiteren Signaturen des aktuellen Teilstapels werden erstellt.

Bisher erstellte Signaturen aller Teilstapel werden verworfen.

Es handelt sich um Probleme/Fehlerfälle, die bei typischen Angriffen auftreten
können.

</td></tr></table>

**[\<=]**

### 4.1.8.4.6 TUC_KON_151 „QES Dokumentensignatur prüfen“

##### TIP1-A_4672-04

Der Konnektor MUSS den technischen Use Case TUC_KON_151
„QES-Dokumentensignatur prüfen” umsetzen.

Tabelle220: TAB_KON_591 - TUC_KON_151 „QES-Dokumentensignatur prüfen“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_151 „QES-Dokumentensignatur prüfen”

</td></tr><tr><td>
Beschreibung

</td><td>
Es wird die QES eines Dokuments geprüft. Dabei werden die Signaturverfahren
laut Tabelle TAB_KON_582 – Signaturverfahren unterstützt. Sind mehrere
Signaturen vorhanden, so werden alle geprüft. Auch Parallel- und
Gegensignaturen MÜSSEN unterstützt werden.

</td></tr><tr><td>
Eingangsanforderung

</td><td>
keine

</td></tr><tr><td>
Auslöser

</td><td>
Aufruf durch ein Clientsystem (Operation VerifyDocument) oder durch ein
Fachmodul im Konnektor

</td></tr><tr><td>
Vorbedingungen

</td><td>
keine

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
1. „DocumentValidation“: Das signierte Dokument wird validiert mit Aufruf
TUC_KON_080 „Dokument validieren“{ … }.

Treten Fehler bei der Validierung der Typkonformität auf, wenn die Signatur im
Dokument eingebettet ist, wird die Prüfung mit einem Fehler abgebrochen. 

Treten bei der Typkonformität, wenn die Signatur nicht im Dokument
eingebettet ist, Fehler auf, so bricht der TUC nicht ab, sondern führt die
folgenden Schritte soweit sinnvoll möglich durch. (Die Entscheidung über das
sinnvoll Durchführbare liegt beim Hersteller des Konnektors.)

2. „CoreValidation“:

Es erfolgt die mathematische Prüfung der Signatur, bestehend aus der Prüfung
der Hash-Kette bis zum signierten Hashwert und der Prüfung der Signatur unter
Verwendung des öffentlichen Schlüssels, des Signaturwertes und des signierten
Hashwertes.  
XML-Signatur:  
Die Core Validation erfolgt entsprechend
[XMLDSig] Kapitel 3.2 Core Validation.  
CMS-Signatur:   
Die Core Validation
erfolgt entsprechend Cryptographic Message Syntax (CMS) Kapitel 5.6 Signature
Verification Process [RFC5652].  
PDF-Signatur:  
Die Core Validation erfolgt
entsprechend [PAdES-3] Kapitel 4.6 Signature Validation aus PAdES-BES Part 3. 

Auch wenn die Validierung fehlschlägt, werden die folgenden Prüfschritte
durchgeführt, so dass ein vollständiges Prüfprotokoll erstellt werden kann.

3. „CheckSignatureCertificate“:

Teil 1: Signaturzertifikat ermitteln  
  XML-Signatur:  
        Das
Signaturzertifikat ist im XMLDSig Element  
       
ds:KeyInfo/ds:X509Data gespeichert [XMLDSig] oder wird als  
       
Eingangsparameter übergeben.  
  CMS-Signatur:  
        Das
Signaturzertifikat für CAdES ist im Feld certificates im  
      
SignedData Container gespeichert [CAdES] oder wird als  
      
Eingangsparameter übergeben.  
  PDF-Signatur:  
        Das PDF
Signaturzertifikat für PAdES ist im Feld  
      
SignedData.certificates entsprechend Kapitel 6.1.1 „Placements of 

       the signing certificate“ [PAdES Baseline Profile] gespeichert
oder  
       wird als Eingangsparameter übergeben.  
Teil 2:
Signaturzeitpunkt bestimmen

 

Der Signaturzeitpunkt

 

Ermittelter_Signaturzeitpunkt_Eingebettet

wird wie

  folgt selektiert:

  XML-Signatur:

       Das XML element

SigningTime

spezifiziert den Signaturzeitpunkt

       entsprechend Kapitel 7.2.1 XAdES [XAdES].

  CMS-Signatur:

       Das Attribut

SigningTime

spezifiziert den Signaturzeitpunkt

       entsprechend Kapitel 11.3 CMS [CMS].

  PDF-Signatur:

       Der Signaturzeitpunkt kann dem M Eintrag des Signature Dictionary

       entnommen werden [PAdES Baseline Profile] Kapitel 6.2.1 Signing

       time.

Der Signaturzeitpunkt

Benutzerdefinierter_Zeitpunkt

liegt gegebenenfalls als Aufrufparameter vor. Der Signaturzeitpunkt

Ermittelter_Signaturzeitpunkt_System

wird ermittelt.

Teil 3: Signaturzertifikatsprüfung:

Bei der folgenden Signaturzertifikatsprüfung sind die Signaturzeitpunkte
gemäß [TIP1-A_5540] zu berücksichtigen.

Die Signaturzertifikatsprüfung erfolgt durch Aufruf von TUC_KON_037
„Zertifikat prüfen“ {

    certificate = C.HP.QES;

    qualifiedCheck = required;

    baseTime = Signaturzeitpunkt;

    offlineAllowNoCheck = true;

   validationMode = OCSP;

    ocspResponses = OCSP-Response;

    getOCSPResponses = includeRevocationInfo

}.

Sind OCSP-Responses in der Signatur eingebettet, ist die jüngsten OCSP-Response
des EE-Zertifikats, die für die Zertifikatsprüfung notwendig ist, beim Aufruf
von TUC_KON_037 zu übergeben.

Sofern der Aufruf von TUC_KON_037 ocspResponses zurückgibt, wird die
OCSP-Response des EE-Zertifikats in die Signatur eingebettet.

Auch wenn die Zertifikatsprüfung fehlschlägt, werden die folgenden Prüfungen
durchgeführt.

4. „CheckPolicyConstraints“:

In diesem Schritt wird das signierte Dokument entsprechend der Profilierung der
Signaturformate (siehe Anhang B.2) geprüft. Es sind die Vorgaben für die
Prüfung von Signaturen aus den Standards für AdES [XAdES], [XAdES Baseline],
[CAdES], [CAdES Baseline], [PAdES-3] und [PAdES Baseline] umzusetzen. Dabei
sind die Vorgaben aus Tabelle TAB_KON_779-01

"Profilierung der Signaturformate“ und Tabelle TAB_KON_778 „Einsatzbereich
der Signaturvarianten“ zu erfüllen.

Auch wenn nicht alle Anforderungen an das Format des signierten Dokuments
erfüllt werden, wird die Prüfung mit den folgenden Schritten fortgesetzt, um
ein vollständiges Prüfungsprotokoll zu erhalten.

5. Das Prüfergebnis (VerificationResult, OptionalOutput) wird an den Aufrufer
zurückgegeben (siehe TAB_KON_593 Übersicht Status für Prüfung einer
Dokumentensignatur).

</td></tr><tr><td>
Varianten/Alternativen

</td><td>
Keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
Das Verhalten des TUCs bei einem Fehlerfall ist in TAB_KON_592 Fehlercodes
TUC_KON_151 „QES Dokumentensignatur prüfen“ beschrieben.

(-\>1) keine Signatur in signedDocument und signatureObject vorhanden: 4253.

(



2

„CoreValidation“

) Interner Fehler: 4001, Signatur des Dokuments ungültig:

4115, Signatur umfasst nicht das gesamte Dokument: 4262

(



3

„CheckSignatureCertificate“

) Interner Fehler: 4001, Signaturzertifikat ermitteln ist fehlgeschlagen: 4206.

(



4

„CheckPolicyConstraints“

) Interner Fehler: 4001, Dokument nicht konform zu Regeln für QES: 4124,
Dokument nicht konform zu Profilierung der Signaturformate: 4208.

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
keine

</td></tr></table>

Tabelle221: TAB_KON_592 Fehlercodes TUC_KON_151 „QES Dokumentensignatur
prüfen“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4001

</td><td>
Technical

</td><td>
Error

</td><td>
interner Fehler

</td></tr><tr><td>
4115

</td><td>
Security

</td><td>
Error

</td><td>
Signatur des Dokuments ungültig. Prüfung der Hashwertkette bzw. Prüfung der
kryptographischen Signatur fehlgeschlagen.

</td></tr><tr><td>
4124

</td><td>
Technical

</td><td>
Error

</td><td>
Dokument nicht konform zu Regeln für QES

</td></tr><tr><td>
4206

</td><td>
Technical

</td><td>
Error

</td><td>
Signaturzertifikat ermitteln ist fehlgeschlagen

</td></tr><tr><td>
4208

</td><td>
Technical

</td><td>
Error

</td><td>
Dokument nicht konform zu Profilierung der Signaturformate

</td></tr><tr><td>
4253

</td><td>
Technical

</td><td>
Error

</td><td>
Keine Signatur im Aufruf

</td></tr><tr><td>
4262

</td><td>
Technical

</td><td>
Error

</td><td>
Signatur umfasst nicht das gesamte Dokument

</td></tr><tr><td>
4264

</td><td>
Technical

</td><td>
Warning

</td><td>
Ein oder mehrere Zertifikate ignoriert

</td></tr></table>

Das Gesamtergebnis (VerificationResult) für die Prüfung einer
Dokumentensignatur fasst die Ergebnisse

aller Prüfungsschritte in einem einzelnen Statuswert zusammen. 

Tabelle222: TAB_KON_593 Übersicht Status für Prüfung einer Dokumentensignatur

<table><tr><th colspan="4">
VerificationResult für gesamtes Dokument (VerificationResult/HighLevelResult)

</th></tr><tr><td colspan="2">
Wert

</td><td colspan="2">
Bedeutung

</td></tr><tr><td colspan="2">
VALID

</td><td colspan="2">
Wenn VerificationResult für alle Signaturen zum Dokument VALID

</td></tr><tr><td colspan="2">
INVALID

</td><td colspan="2">
Wenn VerificationResult für eine Signatur zum Dokument INVALID

</td></tr><tr><td colspan="2">
INCONCLUSIVE

</td><td colspan="2">
in allen anderen Fällen

</td></tr><tr><td colspan="4">
VerificationResult pro Signatur  (VerificationReport/IndividualReport/Result)

</td></tr><tr><td colspan="2">
Wert

</td><td colspan="2">
Bedeutung  
mögliche Ausprägungen im VerificationReport

</td></tr><tr><td colspan="2" rowspan="3">
VALID

</td><td colspan="2">
Die Signatur wurde gemäß den Regeln für die QES geprüft und für gültig
befunden.

</td></tr><tr><td colspan="2">
ResultMajor = urn:oasis:names:tc:dss:1.0:resultmajor:Success  
ResultMinor =
urn:oasis:names:tc:dss:1.0:resultminor:valid:signature:OnAllDocuments

</td></tr><tr><td colspan="2">
ResultMajor = urn:oasis:names:tc:dss:1.0:resultmajor:Success  
ResultMinor =
urn:oasis:names:tc:dss:1.0:resultminor:valid:signature:HasManifestResults

</td></tr><tr><td colspan="2" rowspan="7">
INVALID

</td><td colspan="2">
Die Signatur ist ungültig oder aufgrund eines Fehlers konnte die
Signaturprüfung nicht durchgeführt werden.

</td></tr><tr><td colspan="2">
ResultMajor = urn:oasis:names:tc:dss:1.0:resultmajor:Success  
ResultMinor =
urn:oasis:names:tc:dss:1.0:resultminor:invalid:IncorrectSignature

</td></tr><tr></tr><tr><td colspan="2">
ResultMajor = urn:oasis:names:tc:dss:1.0:resultmajor:RequesterError

</td></tr><tr><td colspan="2">
ResultMajor = urn:oasis:names:tc:dss:1.0:resultmajor:ResponderError

</td></tr><tr><td colspan="2">
ResultMajor = urn:oasis:names:tc:dss:1.0:resultmajor:InsufficientInformation 

ResultMinor = urn:oasis:names:tc:dss:1.0:resultminor:invalid:IncorrectSignature

</td></tr><tr><td colspan="2">
ResultMajor = urn:oasis:names:tc:dss:1.0:resultmajor:InsufficientInformation 

ResultMinor =
urn:oasis:names:tc:dss:1.0:resultminor:CertificateChainNotComplete

</td></tr><tr><td colspan="2" rowspan="2">
INCONCLUSIVE

</td><td colspan="2">
Die Signatur wurde gemäß den Regeln für die QES geprüft. Allerdings konnten
eine oder mehrere Prüfungen nicht vollständig durchgeführt werden.
Einzelheiten finden sich in Result-Detail.  
Die Prüfungen, die durchgeführt
werden konnten, waren erfolgreich.

</td></tr><tr><td colspan="2">
ResultMajor = urn:oasis:names:tc:dss:1.0:resultmajor:InsufficientInformation 

ResultMinor = urn:oasis:names:tc:dss:1.0:resultminor:OcspNotAvailiable 

Hinweis: Das Erreichen dieses Zustandes hängt davon ab, ob eine OCSP-Abfrage
nicht durchgeführt werden konnte, unabhängig davon, ob die Ursache dafür die
Offlineschaltung des Konnektors (MGM_LU_ONLINE = Disabled) oder die
Nichterreichbarkeit des OCSP-Responders im Online-Betrieb (MGM_LU_ONLINE =
Enabled)  ist.

</td></tr></table>

**[\<=]**

##### TIP1-A_5540-01

Der Konnektor MUSS zur QES-Signaturprüfung ein Prüfergebnis, das sich auf
genau einen angenommenen Signaturzeitpunkt bezieht, an den Aufrufer
zurückgeben.  Die Auswahl des angenommenen Signaturzeitpunkts, auf den sich
das Signaturergebnis bezieht, erfolgt hierarchisch:

 ---> UL

**[\<=]**

### 4.1.8.4.7 TUC_KON_170 „Dokumente mit Komfort signieren”

##### A_19103-06

Der Konnektor MUSS den technischen Use Case TUC_KON_170 „Dokumente mit Komfort
signieren” umsetzen.

Tabelle223: TAB_KON_871 – TUC_KON_170 „Dokumente mit Komfort signieren“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_170 ”Dokumente mit Komfort signieren”

</td></tr><tr><td>
Beschreibung

</td><td>
Im Rahmen von Fachanwendungen werden ein oder mehrere Dokumente mit einer
Komfortsignatur versehen. Es werden die QES_DocFormate unterstützt.

</td></tr><tr><td>
Auslöser

</td><td>
Aufruf durch ein Clientsystem (Operation SignDocument) oder ein Fachmodul.

</td></tr><tr><td>
Vorbedingungen

</td><td>
Die Signaturkarte muss gesteckt sein.

</td></tr><tr><td>
Eingangsdaten

</td><td>
·        

signRequests

(Liste von Signaturaufträgen)

Jeder Signaturauftrag (SignRequest) kapselt:

•

     

documentsToBeSigned

(Zu signierendes Dokument bzw. zu signierende Dokumente);

darin u.a.

documentFormat

(Formatangabe für das zu signierende Dokument)

•

     

optionalInputs

(weitere optionale Eingabeparameter zur Steuerung der Details bei der zu
erstellenden Signatur, siehe Operation SignDocument, Parameter
dss:OptionalInputs); darin u.a. signatureType (URI für den
Signaturtyp  XML-, CMS-, PDF-Signatur)

•

     

includeRevocationInfo [Boolean]: – optional; Default: true

(Dieser optionale Parameter steuert die Einbettung von OCSP Antworten in die
Signatur; siehe Operation SignDocument, Parameter SIG:IncludeRevocationInfo)

·        

cardSession

(Kartensitzung. Unterstützte Kartentypen: HBA)

·        

crypt [SIG_CRYPT_QES] -

optional

;

default und Wertebereich: siehe TAB_KON_862-01

(Dieser Parameter steuert, ob RSA-basierte oder ECC-basierte Signaturen erzeugt
werden.)

·        

workplaceId

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor, Kartenterminal, Signaturkarte (HBA)

</td></tr><tr><td>
Ausgangsdaten

</td><td>
·        

signedDocuments

(Liste der signierten Dokumente)

</td></tr><tr><td>
Standardablauf

</td><td>
Der Konnektor KANN die Schritte 1 bis 5 in einer beliebigen Reihenfolge
durchführen.

1.    Prüfe

SAK_COMFORT_SIGNATURE = Enabled

2.  Prüfe, ob der Komfortsignatur-Timer der cardSession
(SAK_COMFORT_SIGNATURE_TIMER) abgelaufen ist.  

3.    Der Signaturtyp und die Signaturvariante werden für jedes Dokument der
Liste entsprechend signatureType und SignatureVariant festgelegt (ggf. in
optionalInputs enthalten). Wenn SignatureType oder SignatureVariant nicht
übergeben wurden, wird das dem Dokumentformat entsprechende Default-Verfahren
gewählt (siehe TAB_KON_583 – Default-Signaturverfahren).

4.    Für alle Dokumente des Stapels wird die Zulässigkeit des Kartentyps
geprüft. Das für die Signatur zu nutzende Zertifikat wird anhand des
Kartentyps und des Parameters crypt ausgewählt.

5.    Es werden die Voraussetzungen für die Signatur geprüft. Dies erfolgt
im TUC_KON_152 „Signaturvoraussetzungen für QES prüfen“.  
Wenn
includeRevocationInfo=true, dann setze ocspResponses auf Rückgabewert von
TUC_KON_152.

6.    Die am Signaturvorgang beteiligte RessourceSignaturkarte wird für die
exklusive Nutzung durch diesen Signaturvorgang reserviert. Die Reservierung der
Signaturkarte erfolgt durch Aufruf von  
TUC_KON_023 „Karte reservieren“ { 

    cardSession;  
    doLock = true }.

7.    Zum Vorbereiten der Dokumente für die Signatur wird TUC_KON_155
„Dokumente zur Signatur vorbereiten“ mit ocspResponses aufgerufen.

Die Zugriffe auf die Signaturkarte im Schritt 8 müssen im DF.QES erfolgen.
DF.QES darf am Ende des TUCs nicht verlassen werden.

8.    Die Signaturen werden erstellt. Dies erfolgt gemäß TUC_KON_158
„Komfortsignaturen erstellen“.

9.    Die reservierte Ressource Signaturkarte wird wieder freigegeben. Zur
Freigabe der Signaturkarte wird TUC_KON_023 „Karte reservieren“   
 
 cardSession;  
   doLock = false }  
aufgerufen.

10.    Die signierten Dokumente werden an den Aufrufer zurückgegeben.

</td></tr><tr><td>
Varianten/

Alternativen

</td><td>
keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
Fehler in den folgenden Schritten des Standardablaufs führen zum Abbruch mit
den ausgewiesenen Fehlercodes.  
In den Fehlerfällen, die zum Abbruch des
Komfortsignaturmodus mit Fehlercode 4271 führen, wird vor dem Abbruch
TUC_KON_172 für das cardHandle des HBA ausgeführt.

(-\>1) Komfortsignaturfunktion im Konnektor nicht aktiviert: Fehlercode 4263 

(-\>2) Der Komfortsignatur-Timer der cardSession ist abgelaufen: Fehlercode
4271  
(-\>3) Ungültige Angabe des Signaturtyps oder Signaturvariante:

         Fehlercode 4111

         Übergabe eines für die QES nicht unterstützten
Dokumentformats:

         Fehlercode 4110

(-\>4) Kartentyp nicht zulässig für Signatur: Fehlercode 4126

(-\>6) Fehler bei der Reservierung der Signaturkarte: Fehlercode 4060

(-\>8) Karte ist kein HBA, sondern HBA-Vorläuferkarte: Fehlercode 4274

Im Fehlerfall:

 a)      … DARF DF.QES NICHT verlassen werden

 b)      … MÜSSEN alle reservierten Ressourcen freigegeben werden

 c)      … MUSS der Fehler immer an das Clientsystem zurückgemeldet

    werden

</td></tr><tr><td>
Sicherheits-anforderungen

</td><td>
Der Konnektor MUSS sicherstellen, dass der erhöhte Sicherheitszustand der
PIN.QES nur für die Komfortsignatur mittels TUC_KON_170 innerhalb einer
Kartensitzung nachgenutzt werden darf.

</td></tr></table>

Tabelle224: TAB_KON_872 Fehlercodes TUC_KON_170 „Dokumente mit Komfort
signieren“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4060

</td><td>
Technical

</td><td>
Error

</td><td>
Ressource belegt

</td></tr><tr><td>
4110

</td><td>
Technical

</td><td>
Error

</td><td>
ungültiges Dokumentformat (%Format%)

Der Parameter Format enthält das übergebene Dokumentformat.

</td></tr><tr><td>
4111

</td><td>
Technical

</td><td>
Error

</td><td>
ungültiger Signaturtyp oder Signaturvariante

</td></tr><tr><td>
4126

</td><td>
Security

</td><td>
Error

</td><td>
Kartentyp nicht zulässig für Signatur

</td></tr><tr><td>
4049

</td><td>
Technical

</td><td>
Error

</td><td>
Abbruch durch den Benutzer

</td></tr><tr><td>
4263

</td><td>
Technical

</td><td>
Error

</td><td>
Komfortsignaturfunktion nicht aktiviert

</td></tr><tr><td>
4271

</td><td>
Technical

</td><td>
Error

</td><td>
Komfortsignaturmodus abgebrochen

</td></tr><tr><td>
4274

</td><td>
Technical

</td><td>
Error

</td><td>
Komfortsignaturen werden nur für den HBA unterstützt

</td></tr></table>

**[\<=]**

### 4.1.8.4.8 TUC_KON_171 „Komfortsignatur einschalten”

##### A_19104-04

Der Konnektor MUSS den technischen Use Case TUC_KON_171 „Komfortsignatur
einschalten“ umsetzen.

Tabelle225: TAB_KON_883 – TUC_KON_171 „Komfortsignatur einschalten“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_171 „Komfortsignatur einschalten“

</td></tr><tr><td>
Beschreibung

</td><td>
Zum Einschalten des Komfortsignaturmodus wird die PIN.QES verifiziert und der
Signaturmodus „Comfort“ für die cardSession gesetzt.

</td></tr><tr><td>
Auslöser

</td><td>
·        

Operation ActivateComfortSignature

·        

Aufruf durch ein Fachmodul

</td></tr><tr><td>
Vorbedingungen

</td><td>
Der Karte muss gesteckt sein.

</td></tr><tr><td>
Eingangsdaten

</td><td>
·        

cardSession (nur HBA erlaubt)

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor, Kartenterminal, Karte (HBA)

</td></tr><tr><td>
Ausgangsdaten

</td><td>
·        

signatureMode

</td></tr><tr><td>
Standardablauf

</td><td>
1.    Prüfe

SAK_COMFORT_SIGNATURE = Enabled

2.    Die am Vorgang beteiligten Ressourcen (Karte sowie PIN-Pad und Display
des PIN-Eingabe-Kartenterminals) werden für die exklusive Nutzung durch diesen
Vorgang reserviert. Die Reservierung der Karte erfolgt durch Aufruf von 

TUC_KON_023 „Karte reservieren“ {  
    cardSession;  
    doLock
= true }

Der Zugriff auf die Karte im Schritt 3 muss im DF.QES erfolgen. Das DF.QES darf
danach nicht verlassen werden, damit der PIN-Status der PIN.QES erhalten bleibt.

3.    Die Einschaltung der Komfortsignatur wird durch den Anwender
autorisiert. Dies erfolgt durch Aufruf von TUC_KON_012 „PIN verifizieren“ {
cardSession;  
workplaceId;  
pinRef = PIN.QES;  
verificationType =
Mandatorisch }  
Für die Anzeige am Kartenterminal ist die Displaymessage für
„Komfortsignatur aktivieren“ aus TAB_KON_090 zu verwenden.

4.    Setze

CARDSESSION.SIGNMODE

= Comfort

5.    Starte Komfortsignatur-Timer für die cardSession bei „0“

6.    Die reservierten Ressourcen (Karte sowie PIN-Pad und  
Display des
PIN-Eingabe-Kartenterminals) werden wieder freigegeben.  
Zur Freigabe der
Karte wird TUC_KON_023 „Karte reservieren“   
   cardSession;  
 
 doLock = false }  
aufgerufen.

</td></tr><tr><td>
Varianten/  
Alternativen

</td><td>
Keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
Fehler in den folgenden Schritten des Standardablaufs führen zum Abbruch mit
den ausgewiesenen Fehlercodes:  
(-\>1) Komfortsignaturfunktion im Konnektor
nicht aktiviert: Fehlercode 4263  
(-\>) Keine Komfortsignatursession für den
HBA aktivierbar, da Maximalzahl an parallelen Komfortsignatursessions
erschöpft:  
Fehlercode 4278  
(-\>2) Fehler bei der Reservierung von
Ressourcen: Fehlercode 4060  
(-\>3) Karte ist kein HBA, sondern
HBA-Vorläuferkarte: Fehlercode 4274

(-\>3) pinResult = BLOCKED: Fehlercode 4275  
(-\>3) pinResult = REJECTED:
Fehlercode 4276  
(-\>4) Fehler beim Setzen des Signaturmodus: Fehlercode 4267

(-\>5) Fehler beim Starten des Komfortsignatur-Timers: Fehlercode 4267

Im Fehlerfall, inklusive Timeout bei der PIN-Eingabe, oder bei Abbruch durch den
Benutzer (Fehler 4049):  
 a)     … MUSS (ab Schritt
5) CARDSESSION.SIGNMODE = PIN gesetzt werden  
 b)      … MUSS (ab
Schritt 3) DF.QES verlassen werden  
 c)      … MÜSSEN alle
reservierten Ressourcen freigegeben werden  
 d)      … MUSS der Fehler
immer an das Clientsystem zurückgemeldet werden

</td></tr></table>

Tabelle226: TAB_KON_886 Fehlercodes TUC_KON_171 „Komfortsignatur einschalten“

<table><tr><td>
Fehlercode

</td><td>
ErrorType

</td><td>
Severity

</td><td>
Fehlertext

</td></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4049

</td><td>
Technical

</td><td>
Error

</td><td>
Abbruch durch den Benutzer

</td></tr><tr><td>
4060

</td><td>
Technical

</td><td>
Error

</td><td>
Ressource belegt

</td></tr><tr><td>
4263

</td><td>
Technical

</td><td>
Error

</td><td>
Komfortsignaturfunktion nicht aktiviert

</td></tr><tr><td>
4267

</td><td>
Technical

</td><td>
Error

</td><td>
Fehler beim Aktivieren des Komfortsignaturmodus \<cardHandle\>

</td></tr><tr><td>
4274

</td><td>
Technical

</td><td>
Error

</td><td>
Komfortsignaturen werden nur für den HBA unterstützt

</td></tr><tr><td>
4275

</td><td>
Technical

</td><td>
Error

</td><td>
Security Error PIN jetzt gesperrt (BLOCKED)

</td></tr><tr><td>
4276

</td><td>
Technical

</td><td>
Error

</td><td>
Security Error PIN falsch (REJECTED)

</td></tr><tr><td>
4278

</td><td>
Technical

</td><td>
Error

</td><td>
Keine Komfortsignatursession mehr verfügbar

</td></tr></table>

**[\<=]**

### 4.1.8.4.9 TUC_KON_172 „Komfortsignatur ausschalten”

##### A_19105

Der Konnektor MUSS den technischen Use Case TUC_KON_172 „Komfortsignatur
ausschalten“ umsetzen.

Tabelle227: TAB_KON_884 – TUC_KON_172 „Komfortsignatur ausschalten“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_172 „Komfortsignatur ausschalten“

</td></tr><tr><td>
Beschreibung

</td><td>
Zum Ausschalten des Komfortsignaturmodus werden die Sicherheitszustände der
Karte(n), die im Konnektor verwalteten Sicherheitszustände und der
Signaturmodus der cardSession(s) zurückgesetzt.

</td></tr><tr><td>
Auslöser

</td><td>
·        

Operation DeactivateComfortSignature

·        

TUC_KON_158

·        

Der Administrator setzt SAK_COMFORT_SIGNATURE = Disabled

·        

Aufruf durch ein Fachmodul

</td></tr><tr><td>
Vorbedingungen

</td><td>
Die Karten müssen gesteckt sein.

</td></tr><tr><td>
Eingangsdaten

</td><td>
Bei Auslösen des TUCs durch den Administrator:

·        

Keine

Ansonsten:

·        

cardHandles : Liste von cardHandles (nur HBA erlaubt)

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor, Kartenterminal, Karte (HBA)

</td></tr><tr><td>
Ausgangsdaten

</td><td>
Keine

</td></tr><tr><td>
Standardablauf

</td><td>
1.    Wenn der TUC nicht durch den Administrator ausgelöst wurde:  
Prüfe

SAK_COMFORT_SIGNATURE = Enabled

2.    Wenn der TUC durch den Administrator ausgelöst wurde: Ermittle die
cardHandles aller gesteckten HBA.

3.    Für jedes übergebene bzw. ermittelte cardHandle:

4.    Ermittle cardSessions zu cardHandle

5.    Für jede ermittelte cardSession:

a.    Setze den PIN-Status der PIN.QES zurück (z. B. durch Verlassen von
DF.QES für alle logischen Kanäle der Karte)

b.    Lösche den im Konnektor verwalteten Sicherheitszustand aus

CARDSESSION.AUTHSTATE (PINRef=PIN.QES)

c.    Setze

CARDSESSION.SIGNMODE = PIN

d.    Stoppe Komfortsignatur-Timer für die cardSession

</td></tr><tr><td>
Varianten/  
Alternativen

</td><td>
Keine

</td></tr><tr><td>
Fehlerfälle

 

</td><td>
(-\>1) Komfortsignaturfunktion im Konnektor nicht aktiviert: Fehlercode 4263

Fehler und Warnungen in den folgenden Schritten werden über alle cardHandle
akkumuliert und die \<komma-separierte Liste von cardHandle\> für den
jeweiligen Fehlertext erzeugt.

(-\>3) Bei einem ungültigen cardHandle wird mit dem nächsten cardHandle aus
cardHandles fortgesetzt. Fehlercode 4265

(-\>4) Ist zu einem cardHandle keine cardSession vorhanden wird mit dem
nächsten cardHandle fortgesetzt. Fehlercode 4266

(-\>5) Tritt in Schritt 4 ein Fehler auf wird mit dem nächsten cardHandle
fortgesetzt. Fehlercode 4268

</td></tr></table>

 

Tabelle228: TAB_KON_887 Fehlercodes TUC_KON_172 „Komfortsignatur ausschalten“

<table><tr><td>
Fehlercode

</td><td>
ErrorType

</td><td>
Severity

</td><td>
Fehlertext

</td></tr><tr><td>
4263

</td><td>
Technical

</td><td>
Fehler

</td><td>
Komfortsignaturfunktion nicht aktiviert

</td></tr><tr><td>
4265

</td><td>
Technical

</td><td>
Warning

</td><td>
Karten-Handle ungültig \<komma-separierte Liste von cardHandle\>

</td></tr><tr><td>
4266

</td><td>
Technical

</td><td>
Warning

</td><td>
Keine Kartensitzung vorhanden \<komma-separierte Liste von cardHandle\>

</td></tr><tr><td>
4268

</td><td>
Technical

</td><td>
Fehler

</td><td>
Fehler beim Deaktivieren des Komfortsignaturmodus \<komma-separierte Liste von
cardHandle\>

</td></tr></table>

**[\<=]**

### 4.1.8.4.10 TUC_KON_173 „Liefere Signaturmodus”

##### A_19106-02

Der Konnektor MUSS den technischen Use Case TUC_KON_173 „Liefere
Signaturmodus“ umsetzen.

Tabelle229: TAB_KON_885 – TUC_KON_173 „Liefere Signaturmodus“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_173 „Liefere Signaturmodus“

</td></tr><tr><td>
Beschreibung

</td><td>
Der aktuell konfigurierte Status der Komfortsignaturfunktion im Konnektor und
Informationen zur Komfortsignatursession werden ermittelt und an den Aufrufer
zurückgegeben.

</td></tr><tr><td>
Auslöser

</td><td>
·        

Operation GetSignatureMode

·        

Aufruf durch ein Fachmodul

</td></tr><tr><td>
Vorbedingungen

</td><td>
Keine

</td></tr><tr><td>
Eingangsdaten

</td><td>
·   

 cardSession   
(Kartensitzung. Unterstützte Kartentypen: HBA)

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor, Kartenterminal, Signaturkarte (HBA)

</td></tr><tr><td>
Ausgangsdaten

</td><td>
·        

comfortSignatureStatus

·        

comfortSignatureMax

·        

comfortSignatureTimer

·        

sessionInfo (optional): Struktur aus

signatureMode, countRemaining, timeRemaining

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

</td></tr><tr><td>
Varianten/

Alternativen

</td><td>
(-\>4b) Der Rückgabewert für countRemaining muss für jede
Komfortsignatursession den aktuellen Stand zur Anzahl verbleibender
Komfortsignaturen wiedergeben unter Einbezug

a)   ggf. parallel existierender Sessions auf ein und demselben logischen
Kanal des HBA,

b)   der maximal durch die Karte in diesem logischen Kanal erlaubten
Komfortsignaturen (laut [gemSpec_HBA_ObjSys*] 250) und

c)   der konfigurierten maximal erlaubten Anzahl an Komfortsignaturen für
die betreffende Session (SAK_COMFORT_SIGNATURE_MAX).

</td></tr><tr><td>
Fehlerfälle

</td><td>
Wenn im Standardablauf ein Fehler auftritt, wird mit Fehler 4269 abgebrochen.

</td></tr></table>

 

Tabelle230: TAB_KON_888 Fehlercodes TUC_KON_173 „Liefere Signaturmodus“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td>
4269

</td><td>
Technical

</td><td>
Error

</td><td>
Fehler beim Ermitteln des Signaturmodus \<cardHandle\>

</td></tr></table>

**[\<=]**

### 4.1.8.5 Operationen an der Außenschnittstelle

##### TIP1-A_4676-08

Der Konnektor MUSS Clientsystemen den Basisdienst Signaturdienst (nonQES und
QES) anbieten.

Tabelle231: TAB_KON_197 Basisdienst Signaturdienst (nonQES und QES)

<table><tr><th>
Name

</th><th colspan="2">
SignatureService

</th></tr><tr><td>
Version (KDV)

</td><td colspan="2">
7.4.0 (WSDL-Version), 7.4.2 (XSD-Version)  
7.4.2 (WSDL-Version), 7.4.4
(XSD-Version)  
7.5.5 (WSDL- und XSD-Version)  
Siehe Anhang D

</td></tr><tr><td>
Namensraum

</td><td colspan="2">
Siehe Anhang D

</td></tr><tr><td>
Namensraum-Kürzel

</td><td colspan="2">
SIG für Schema und SIGW für WSDL

</td></tr><tr><td rowspan="5">
Operationen

</td><td>
Name

</td><td>
Kurzbeschreibung

</td></tr><tr><td>
SignDocument

</td><td>
Dokument signieren

</td></tr><tr><td>
VerifyDocument

</td><td>
Signatur verifizieren

</td></tr><tr><td>
StopSignature

</td><td>
Signieren eines Dokumentenstapels abbrechen

</td></tr><tr><td>
GetJobNumber

</td><td>
Liefert eine Jobnummer für den nächsten Signiervorgang

</td></tr><tr><td>
ActivateComfortSignature

</td><td>
Aktiviert die Komfortsignatur für einen HBA

</td></tr><tr><td>
DeactivateComfortSignature

</td><td>
Deaktiviert die Komfortsignatur für einen oder mehrere HBA

</td></tr><tr><td>
GetSignatureMode

</td><td>
Liefert den Status der Komfortsignaturfunktion und Informationen zur
Komfortsignatursession eines HBA

</td></tr><tr><td>
WSDL

</td><td colspan="2">
SignatureService_V7_5_5.wsdl  
SignatureService_V7_4_2.wsdl 

SignatureService.wsdl (WSDL-Version 7.4.0)

</td></tr><tr><td>
Schema

</td><td colspan="2">
SignatureService_V7_5_5.xsd  
SignatureService_V7_4_4.xsd  
SignatureService.xsd
(XSD-Version 7.4.2)

</td></tr></table>

**[\<=]**

### 4.1.8.5.1 SignDocument (nonQES und QES)

##### TIP1-A_5010-09

Der Signaturdienst des Konnektors MUSS an der Clientschnittstelle eine an
[OASIS-DSS] angelehnte Operation SignDocument anbieten.

Tabelle232: TAB_KON_065 Operation SignDocument (nonQES und QES)

<table><tr><th>
Name

</th><th colspan="2" rowspan="1">
SignDocument

</th></tr><tr><td>
Beschreibung

</td><td colspan="2" rowspan="1">
Diese Operation lehnt sich an [OASIS-DSS] an. Sie enthält voneinander
unabhängige SignRequests. Jeder SignRequest erzeugt eine Signatur für ein
Dokument.  
Für die qualifizierte elektronische Signatur (QES) werden die
QES_DocFormate unterstützt. Für nicht-qualifizierte elektronische Signaturen
(nonQES) werden die nonQES_DocFormate unterstützt.  
Zur Signaturerzeugung
werden Schlüssel und Zertifikate einer Chipkarte benutzt.  
Unterstützte
Karten sind für die QES der HBAx mit dem QES-Zertifikat. Für die nonQES wird
für die Signaturtypen „XML-Signatur, CMS-Signatur, PDF-Signatur,
S/MIME-Signatur“ die SM-B mit dem OSIG–Zertifikat unterstützt.  
Bei der
Erstellung von XML-Signaturen MUSS Canonical XML 1.1 verwendet werden
[CanonXML1.1].  
Es soll der Common-PKI-Standard eingesetzt werden, siehe
[Common-PKI].  
In Summe für die Größe der Dokumente in allen SignRequests
innerhalb einer SignDocument-Anfrage MUSS der Konnektor eine Gesamtgröße von
\<= 250 MB unterstützen.

</td></tr><tr><td rowspan="20">
Aufruf-parameter

</td><td colspan="2" rowspan="1">
</td></tr><tr><td>
Name

</td><td>
Beschreibung

</td></tr><tr><td>
CONN:  
Card  
Handle

</td><td>
Identifiziert die zu verwendende Signaturkarte.  
Die Operation DARF die
Signatur mit der eGK NICHT unterstützen. Wird die Operation mit einem nicht
unterstützten Kartentypen aufgerufen, so MUSS der Konnektor die Bearbeitung
mit dem Fehler 4126 abbrechen.

</td></tr><tr><td>
SIG:  
Crypt

</td><td>
Der Parameter crypt steuert die Auswahl der Zertifikate und Schlüssel für die
Signaturerstellung abhängig von der durch cardHandle adressierten Karte
gemäß TAB_KON_900.  
Defaultwert: 

 ---> UL

</td></tr><tr><td>
CCTX:  
Context

</td><td>
Aufrufkontext QES mit HBAx:  
MandantId, ClientSystemId, WorkplaceId, UserId
verpflichtend  
Aufrufkontext nonQES mit SM-B:  
MandantId, ClientSystemId,
WorkplaceId verpflichtend; UserId nicht ausgewertet

</td></tr><tr><td>
TvMode

</td><td>
Der Parameter wird im Konnektor nicht ausgewertet.

</td></tr><tr><td>
SIG:  
JobNumber

</td><td>
Die Nummer des Jobs, unter der der nächste Signaturvorgang gestartet wird. 

Parameter ist verpflichtend.

</td></tr><tr><td>
SIG:  
Sign  
Request

</td><td>
Ein SignRequest kapselt den Signaturauftrag für ein Dokument.  
Das
verpflichtende XML-Attribut RequestID identifiziert einen SignRequest innerhalb
eines Stapels von SignRequests eindeutig. Es dient der Zuordnung der
SignResponse zum jeweiligen SignRequest.  
Enthält der Aufruf mehr als die
unterstützte Anzahl von SignRequests, bricht die Operation mit Fehler 4000 ab.
 
Es sind mindestens 50 SignRequests zu unterstützen.

</td></tr><tr><td>
SIG:  
Optional  
Inputs

</td><td>
Enthält optionale Eingangsparameter (angelehnt an dss:OptionalInputs gemäß
[OASIS-DSS] Section 2.7):

![Img-052][Img-052]

</td></tr><tr><td>
SIG:  
Document

</td><td>
Dieses an das dss:Document Element aus [OASIS-DSS] Section 2.4.2 angelehnte
Element enthält das zu signierende Dokument, wobei die Kindelemente
CONN:Base64XML und dss:Base64Data auftreten können.  
Bei den als
dss:Base64Data übergebenen Dokumenten werden folgende (Klassen von) MIME-Types
unterschieden:

 ---> UL

Der MIME-Type „text/plain“ wird interpretiert als „text/plain;
charset=iso-8859-15”.  
Das Element enthält ein Attribut ShortText Es muss
für QES-Signaturen bei jedem Aufruf vom Clientsystem übergeben werden, für
nonQES-Signaturen ist es optional.  
Über das Attribut RefURI kann gemäß
[OASIS-DSS] (Abschnitt 2.4.1) ein zu signierender Teilbaum eines XML-Dokuments
ausgewählt werden. 

Wenn die Signatur eines Teilbaums für die 

Signaturvariante nicht unterstützt wird, muss der Signaturauftrag mit Fehler
4111 abgelehnt werden.

</td></tr><tr><td>
SIG:  
Include  
Revocation  
Info

</td><td>
Durch diesen verpflichtenden Schalter kann der Aufrufer die Einbettung von zum
Zeitpunkt der Signaturerstellung vorliegenden Sperrinformationen anfordern. Es
wird ausschließlich die zu erstellende Signatur betrachtet, d.h. es erfolgt
keine Einbettung von Sperrinformationen für bereits enthaltene Signaturen. 

Für nicht-qualifizierte elektronische Signaturen (nonQES) wird diese
Funktionalität nicht unterstützt.

 Für PDF-Signaturen werden keine Sperrinformationen eingebettet.

</td></tr><tr><td>
dss:  
Signature  
Type

</td><td>
Durch dieses in [OASIS-DSS] (Abschnitt 3.5.1) beschriebene Element kann der
generelle Typ der zu erzeugenden Signaturen spezifiziert werden. Hierbei
MÜSSEN folgende Signaturtypen unterstützt werden:

 ---> UL

 ---> UL

 ---> UL

Die nachfolgenden Werte KÖNNEN unterstützt werden:

 ---> UL

Der Konnektor KANN die Operation im Fall S/MIME mit Fehlercode 4279 beenden. 

Andere

SignatureType

-Angaben führen zu einer Fehlermeldung 4111 (Ungültiger Signaturtyp oder
Signaturvariante).

Die Signaturtypen „XML-Signatur, CMS-Signatur, PDF-Signatur,
S/MIME-Signatur“ DÜRFEN für QES der HBAx nur mit dem QES-Zertifikat
erfolgen, für nonQES nur mit dem OSIG-Zertifikat der SM-B. In jedem diese
Anforderung verletzenden Fall MUSS der Fehler 4058 (Aufruf nicht zulässig)
zurückgeliefert werden.

Fehlt dieses Element, so wird der Signaturtyp gemäß TAB_KON_583 –
Default-Signaturverfahren aus dem Dokumententyp abgeleitet.

</td></tr><tr><td>
dss:  
Properties

</td><td>
Durch dieses in [OASIS-DSS] (Abschnitt 3.5.5) definierte Element können
zusätzliche signierte und unsignierte Eigenschaften (Properties) bzw.
Attribute in die Signatur eingefügt werden.  
Unterstützt werden genau
folgende Attribute:  
Im CMS-Fall (SignatureType = urn:ietf:rfc:5652) kann es
XML-Elemente  
./SignedProperties/Property/Value/CMSAttribute  
und 

./UnsignedProperties/Property/Value  
/CMSAttribute  
enthalten. Ein solches
XML-Element CMSAttribute muss ein vollständiges, base64/DER-kodiertes
ASN.1-Attribute enthalten, definiert in [CMS#5.3.SignerInfo Type]. Es muss bei
der Erstellung des CMS-Containers unverändert unter SignedAttributes bzw.
UnsignedAttributes aufgenommen werden.  
Die Übergabe der Attribute

 ---> UL

wird ignoriert und es wird die Warnung 4273 zurück gegeben.

</td></tr><tr><td>
SIG:  
Include  
EContent

</td><td>
Durch dieses in [OASIS-DSS] (Abschnitt 3.5.7), definierte Element kann bei einer
CMS-basierten Signatur das Einfügen des signierten Dokumentes in die Signatur
angefordert werden.  
Die Verwendung dieses Parameters bei anderen
Signaturtypen führt zu einem Fehler 4111 (Ungültiger Signaturtyp oder
Signaturvariante).

</td></tr><tr><td>
SIG:  
Include  
Object

</td><td>
Dieses Element enthält zum Anfordern einer Enveloping XML Signatur ein
dss:IncludeObject-Element gemäß [OASIS-DSS] (Abschnitt 3.5.6).  
Ist das
Element vorhanden und ein anderer Signaturtyp als eine XML-Signatur
angefordert, so wird der Fehler 4111 (Ungültiger Signaturtyp oder
Signaturvariante) zurückgeliefert.

</td></tr><tr><td>
dss:  
Signature  
Placement

</td><td>
Durch dieses in [OASIS-DSS] (Abschnitt 3.5.8) definierte Element kann bei
XML-basierten Signaturen gemäß [RFC3275] die Platzierung der Signatur im
Dokument angegeben werden.  
Die in [OASIS-DSS] (Abschnitt 2.5, XPath c)
beschriebene Deklaration von Namespace-Prefixes im
dss:SignaturePlacement-Element muss nicht unterstützt werden.   
Bei anderen
Signaturtypen wird das Element ignoriert und eine Warnung (Fehlercode 4197,
Parameter SignaturePlacement wurde ignoriert) zurückgeliefert. 

dss:SignaturePlacement darf nur zusammen mit einer unterstützten
Signaturrichtlinie verwendet werden (sp:SignaturePolicyIdentifier muss
entsprechend gesetzt sein).

</td></tr><tr><td>
dss:  
Return  
Updated  
Signature

</td><td>
Durch dieses in [OASIS-DSS] (Abschnitt 4.5.8) definierte Element kann eine
übergegebene XML- oder CMS-Signatur mit zusätzlichen Informationen und
Signaturen (Parallel- und Gegensignaturen) versehen werden. Hierbei sind
folgende Ausprägungen für das Type-Attribut vorgesehen:

 ---> UL

Bei anderen Type-Attributen wird der Fehler 4111 (Ungültiger Signaturtyp oder
Signaturvariante) zurückgeliefert.

</td></tr><tr><td>
dss:  
Schemas

</td><td>
Durch das in [OASIS-DSS] (Abschnitt 2.8.5) definierte Element können eine Menge
von XML-Schemata übergeben werden, die zur Validierung der übergebenen
XML-Dokumente verwendet werden können.

</td></tr><tr><td colspan="2" rowspan="1">
</td></tr><tr><td>
dss:Schema

</td><td>
Dieses Element enthält ein XML-Schema zur Validierung des übergebenen
XML-Dokuments. Das Attribut RefURI ist verpflichtend. Es kennzeichnet dabei den
Namensraum des XML-Schemas entsprechend [OASIS-DSS] (Abschnitt 2.8.5)

</td></tr><tr><td>
sp:  
Generate  
Under  
Signature  
Policy

</td><td>
Über dieses in [OASIS-SP], Kapitel 2.2.1.1.1.1 Optional Input
\<GenerateUnderSignaturePolicy\>, definierte Element wird die  erforderliche
Singnaturrichlinie ausgewählt.  
Die im Element sp:SignaturePolicyIdentifier
übergebene URI identifiziert die Signaturrichtlinie.  
Die XML-Elemente 

SignaturePolicyLocation  
DigestAndAlgorithm  
werden nicht verwendet.

Wenn eine nach TAB_KON_778 notwendige Signaturrichtlinie fehlt oder
die übergebene Signaturrichtlinie unbekannt ist, wird Fehler
4111 zurückgeliefert.  

</td></tr><tr><td>
SIG:  
Viewer  
Info

</td><td>
Enthält optional die vom Konnektor in die Signatur einzubeziehende Referenzen
für die Stylesheets zur Anzeige.

</td></tr><tr><td>
Rückgabe

</td><td colspan="2" rowspan="1">
</td></tr><tr><td>
SIG:SignResponse

</td><td>
Eine SignResponse kapselt den ausgeführten Signaturauftrag pro Dokument. Die
Zuordnung zwischen SignRequest und SignResponse erfolgt über die RequestID.

</td></tr><tr><td>
CONN:Status

</td><td>
Enthält den Status der ausgeführten Operation pro SignRequest.

</td></tr><tr><td>
SIG:  
Optional  
Outputs

</td><td>
Enthält (angelehnt an

dss:OptionalOutputs

) optionale Ausgangsparameter:

![Img-053][Img-053]

</td></tr><tr><td>
SIG:  
Document  
With  
Signature

</td><td>
![Img-054][Img-054]

Pro

SignResponse

wird ein Element

SIG:DocumentWithSignature

gemäß [OASIS-DSS] (Abschnitt 3.5.8) zurückgeliefert, in dem das Dokument mit
Signatur enthalten ist. Dabei werden die XML-Attribute des Elements

SIG:Document

auf dem zugehörigen

SignRequest

übernommen.

Ist die Signatur nicht im Dokument enthalten, wird ein leeres Element

Base64XML

oder

Base64Data

zurückgegeben. Die Signatur wird dann im Element

dss:SignatureObject

abgelegt.

Wenn die Signatur im Dokument enthalten ist, wird das signierte Dokument im Feld

Base64XML

bzw.

Base64Data

zurückgeliefert. In diesem Fall MUSS die

dss:SignaturePtr

-Alternative in

dss:SignatureObject

(vgl. [OASIS-DSS] Abschnitt 2.5) dazu genutzt werden, auf die in den Dokumenten
enthaltenen Signaturen zu verweisen.

</td></tr><tr><td>
vr:  
VerificationReport

</td><td>
Vom Konnektor nicht befüllt.

</td></tr><tr><td>
dss:  
SignatureObject

</td><td>
Enthält im Erfolgsfall die erzeugte Signatur pro

SignRequest

in Form eines

dss:SignatureObject

-Elementes gemäß [OASIS-DSS] (Abschnitt 3.2).

</td></tr><tr><td>
Vorbe-dingungen

</td><td>
Keine

</td></tr><tr><td>
Nachbe-dingungen

</td><td>
Keine

</td></tr></table>

Der Ablauf der Operation SignDocument ist in Tabelle TAB_KON_756 Ablauf
Operation SignDocument (nonQES und QES) beschrieben:

Tabelle233: TAB_KON_756 Ablauf Operation SignDocument (nonQES und QES)

<table><tr><th>
Nr.

</th><th>
Aufruf Technischer Use Case oder Interne Operation

</th><th>
Beschreibung

</th></tr><tr><td>
1.

</td><td>
checkArguments

</td><td>
Anhand des Kartentyps wird ermittelt, ob eine QES oder eine nonQES erzeugt
werden soll. Alle übergebenen Parameterwerte werden auf Konsistenz und
Gültigkeit überprüft. Treten hierbei Fehler auf, so bricht die Operation mit
Fehler 4000 ab.

</td></tr><tr><td>
2.

</td><td>
TUC_KON_000 „Prüfe Zugriffs- berechtigung“

</td><td>
Die Prüfung erfolgt durch den Aufruf  
TUC_KON_000 {  
    mandantId =
$context.mandantId;  
    clientsystemId  = $context.clientsystemId; 

    workplaceId = $context.workplaceId;  
    userId =
$context.userId;  
    cardHandle = $cardHandle }  
Tritt bei der Prüfung
ein Fehler auf, bricht die Operation mit Fehlercode aus TUC_KON_000 ab.

</td></tr><tr><td>
3.

</td><td>
TUC_KON_026 „Liefere CardSession“

</td><td>
Ermittle CardSession über TUC_KON_026 {  
    mandatId =$context.mandantId;
 
    clientsystemId  = $context.clientsystemId;  
    cardHandle =
$context.cardHandle;  
    userId = $context.userId }

</td></tr><tr><td colspan="3">
Im Fall QES wird Schritt 4 ausgeführt. Im Fall nonQES wird Schritt 5
ausgeführt.

</td></tr><tr><td>
4a)

</td><td>
Prüfe Signaturdienst-Modul

</td><td>
Prüfe, ob MGM_LU_SAK=Enabled. Ist dies nicht der Fall, so bricht die Operation
mit Fehler 4125 ab.

</td></tr><tr><td colspan="3" rowspan="1">
Wenn für die CardSession die Komfortsignatur aktiviert ist
(CARDSESSION.SIGNMODE = Comfort) wird Schritt 4 c) ausgeführt. Andernfalls
wird Schritt 4 b) ausgeführt.

</td></tr><tr><td>
4b)

</td><td>
TUC_KON_150 „Dokumente QES signieren“

</td><td>
Die QES wird erzeugt. Tritt hierbei ein Fehler auf, bricht die Operation ab.

</td></tr><tr><td>
4c)

</td><td>
TUC_KON_170 „Dokumente mit Komfort signieren“

</td><td>
Eine Komfortsignatur wird erzeugt. Tritt hierbei ein Fehler auf, bricht die
Operation ab.

</td></tr><tr><td>
5)

</td><td>
TUC_KON_160 „Dokumente nonQES signieren“

</td><td>
Die nonQES wird erzeugt. Tritt hierbei ein Fehler auf, bricht die Operation ab.

</td></tr></table>

Tabelle234: TAB_KON_757 Fehlercodes „SignDocument (nonQES und QES)“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen TUCs können folgende weiteren
Fehlercodes auftreten:

</td></tr><tr><td>
4000

</td><td>
Technical

</td><td>
Error

</td><td>
Syntaxfehler

</td></tr><tr><td>
4111

</td><td>
Technical

</td><td>
Error

</td><td>
ungültiger Signaturtyp oder Signaturvariante

</td></tr><tr><td>
4126

</td><td>
Security

</td><td>
Error

</td><td>
Kartentyp nicht zulässig für Signatur

</td></tr><tr><td>
4125

</td><td>
Technical

</td><td>
Error

</td><td>
LU_SAK nicht aktiviert

</td></tr><tr><td>
4197

</td><td>
Technical

</td><td>
Warning

</td><td>
Parameter SignaturePlacement wurde ignoriert

</td></tr><tr><td>
4252

</td><td>
Technical

</td><td>
Error

</td><td>
Jobnummer wurde in den letzten 1.000 Aufrufen bereits verwendet und ist nicht
zulässig

</td></tr><tr><td>
4273

</td><td>
Technical 

</td><td>
Warning

</td><td>
Attribute im Parameter dss:Properties wurden ignoriert

</td></tr><tr><td>
4279

</td><td>
Technical 

</td><td>
Error

</td><td>
S/MIME-Funktionalität nicht unterstützt

</td></tr><tr><td>
4283

</td><td>
Technical

</td><td>
Error

</td><td>
Dokument zu groß

</td></tr></table>

Die zulässigen Zertifikate und Schlüssel sind in TAB_KON_900 aufgelistet. **[\<=]**

### 4.1.8.5.2 VerifyDocument (nonQES und QES)

##### TIP1-A_5034-06

Der Signaturdienst des Konnektors MUSS an der Clientschnittstelle eine an
[OASIS-DSS] angelehnte Operation VerifyDocument (nonQES und QES) anbieten.

Tabelle235: TAB_KON_066 Operation VerifyDocument (nonQES und QES)

<table><tr><th>
Name

</th><th colspan="3">
VerifyDocument

</th></tr><tr><td>
Beschreibung

</td><td colspan="3">
Diese Operation verifiziert die Signatur eines Dokumentes.

Der Konnektor MUSS jede konform zur Außenschnittstelle SignDocument erzeugte
Signatur durch VerifyDocument prüfen können.

Das Ergebnis der Prüfung wird, wenn gefordert, in Form eines standardisierten
Prüfberichts in einer

VerificationReport

-Struktur gemäß [OASIS-VR] zurückgeliefert.

</td></tr><tr><td rowspan="16">
Aufruf-parameter

</td><td colspan="3">
![Img-055][Img-055]

            

</td></tr><tr><td colspan="2">
Name

</td><td>
Beschreibung

</td></tr><tr><td colspan="2">
CCTX:

Context

</td><td>
MandantId, ClientSystemId, WorkplaceId verpflichtend; UserId nicht ausgewertet

</td></tr><tr><td colspan="2">
TvMode

</td><td>
Der Parameter wird im Konnektor nicht ausgewertet.

</td></tr><tr><td colspan="2">
SIG:

Optional

Inputs

</td><td>
Enthält optionale Eingabeparameter (angelehnt an dss:OptionalInputs gemäß
[OASIS-DSS] Section 2.7):

Die zulässigen optionalen Eingabeparameter sind unten erläutert.

</td></tr><tr><td colspan="2">
SIG:

Document

</td><td>
Enthält im Fall der Prüfung von detached oder enveloped Signaturen das zur
Signatur gehörende bzw. das diese umschließende Dokument (siehe [OASIS-DSS]
Section 2.4.2 und oben).

</td></tr><tr><td colspan="2">
dss:

Signa

ture

Object

</td><td>
Enthält die zu prüfende Signatur, wenn sie nicht im Dokument selbst
eingebettet ist ([OASIS-DSS] Kapitel 4.1). Hierbei werden

XML-Signaturen

als

ds:Signature

Element und alle anderen Signaturen als

dss:Base64Signature

mit entsprechend gesetztem

Type

-Attribut (siehe

SignatureType,

Operation SignDocument) übergeben, wobei die nachfolgenden Werte unterstützt
werden MÜSSEN:

 ---> UL

Die nachfolgenden Werte KÖNNEN unterstützt werden:

 ---> UL

</td></tr><tr><td colspan="2">
SIG:

Include

Revocat

ionInfo

</td><td>
Durch diesen verpflichtenden Schalter kann der Aufrufer die Einbettung von zum
Zeitpunkt der Signaturprüfung vorliegenden Sperrinformationen anfordern.

Ist bereits eine Sperrinformation eingebettet, so wird die neue Sperrinformation
zusätzlich eingebettet.

Für in einer Gegensignatur enthaltene Signaturen erfolgt keine Einbettung von
Sperrinformationen.

 Für PDF-Signaturen erfolgt keine Einbettung von Sperrinformationen. Der
Konnektor nimmt die Warnung 4261 in die Antwort auf. 

</td></tr><tr><td colspan="3">
![Img-056][Img-056]

</td></tr><tr><td colspan="2">
SIG:

Verify

Mani

fests

</td><td>
Durch das in [OASIS-DSS] (Abschnitt 4.5.1) definierte Element kann die Prüfung
eines ggf. vorhandenen Manifests angefordert werden.

</td></tr><tr><td colspan="3">
![Img-057][Img-057]

</td></tr><tr><td colspan="2">
SIG:

Use

Verifi

cation

Time

</td><td>
Durch das in [OASIS-DSS] (Abschnitt 4.5.2) spezifizierte Element kann die
Prüfung der Signatur bezüglich eines durch den Aufrufer bestimmten
Zeitpunktes (

Benutzerdefinierter_Zeitpunkt

) erfolgen.

</td></tr><tr><td colspan="2">
dss:

Addit

ional

KeyInfo

</td><td>
Durch das in [OASIS-DSS] (Abschnitt 4.5.4) spezifizierte Element kann
zusätzliches, für die Prüfung benötigtes, Schlüsselmaterial übergeben
werden.

</td></tr><tr><td colspan="2">
vr:

Return

Verifi

cation

Report

</td><td>
Durch dieses in [OASIS-VR] spezifizierte Element kann die Erstellung eines
ausführlichen Prüfberichtes angefordert werden. Der Konnektor MUSS die
Anforderungen der Konformitätsstufe 2 („Comprehensive“) erfüllen und die
Profilierung aus Anhang B3 beachten.

</td></tr><tr><td colspan="2">
dss:

Schemas

</td><td>
Durch das in [OASIS-DSS] (Abschnitt 2.8.5) definierte Element können eine Menge
von XML-Schematas übergeben werden, die zur Validierung des übergebenen
XML-Dokumentes verwendet werden können.

Zur Struktur dieses Elements siehe Beschreibung des Parameters

dss:Schemas

der Operation SignDocument.

</td></tr><tr><td colspan="2">
SIG:

Viewer

Info

</td><td>
Der Parameter wird im Konnektor nicht ausgewertet.

</td></tr><tr><td rowspan="11">
Rückgabe

</td><td colspan="3">
![Img-058][Img-058]

</td></tr><tr><td>
Status

</td><td colspan="2">
Enthält den Ausführungsstatus der Operation.

</td></tr><tr><td>
SIG:

Verifi

cation

Result

</td><td colspan="2">
![Img-059][Img-059]

Das Element

Sig:VerificationResult

enthält das Ergebnis der Prüfung als Ampel, den Typ des zugehörigen
angenommenen Signaturzeitpunkts und der angenommene Signaturzeitpunkt selbst.

</td></tr><tr><td>
SIG:

High

Level

Result

</td><td colspan="2">
Das Ergebnis der Prüfung (Ampelschaltung) mit folgenden Werten:

 ---> UL

</td></tr><tr><td>
SIG:

Time

stamp

Type

</td><td colspan="2">
Der Typ des angenommenen Signaturzeitpunkts mit folgenden Werten:

 ---> UL

Als Format darf jedes zum XML-Typ "dateTime" konforme Format verwendet werden
(\<element name="Timestamp" type="dateTime"/\>). Wenn mehrere Signaturen im
Dokument vorhanden sind, wird hier der angenommene Signaturzeitpunkt der
jüngsten Signatur angegeben.

</td></tr><tr><td>
SIG:

Time

stamp

</td><td colspan="2">
Im Element SIG:Timestamp wird der zu SIG:TimestampType gehörende Zeitstempel
zurückgegeben.

</td></tr><tr><td>
SIG:

Optio

nal

Outputs

</td><td colspan="2">
Enthält (angelehnt an dss:OptionalOutputs, wie in Abschnitt 2.7 von [OASIS-DSS]
beschrieben) optionale Ausgangselemente:

![Img-060][Img-060]

</td></tr><tr><td>
dss:

Verify

Manifest

Results

</td><td colspan="2">
Dieses in Abschnitt 4.5.1 von [OASIS-DSS] definierte Element enthält
Informationen zur Prüfung eines ggf. vorhandenen Signaturmanifests und wird
zurückgeliefert, sofern beim Aufruf das

dss:VerifyManifest

-Element, aber nicht das

RequestVerificationReport

als optionales Eingabeelement übergeben wurde.

</td></tr><tr><td>
SIG:

Document

With

Signa

ture

</td><td colspan="2">
Dieses in Abschnitt 4.5.8 von [OASIS-DSS] spezifizierte Element wird
zurückgeliefert, falls eine in dem Dokument enthaltene Signatur (Enveloped
Signature) in Verbindung mit dem

SIG:IncludeRevocationInfo

-Element geprüft wurde.

</td></tr><tr><td>
dss:

Updated

Signa

ture

</td><td colspan="2">
Dieses in Abschnitt 4.5.8 von [OASIS-DSS] spezifizierte Element wird
zurückgeliefert, falls eine abgesetzte (Detached Signature) oder
umschließende (Enveloping Signature) in Verbindung mit dem

SIG:IncludeRevocationInfo-

Element geprüft wurde.

</td></tr><tr><td>
vr:

Verifi

cation

Report

</td><td colspan="2">
Dieses in [OASIS-VR] spezifizierte Element wird zurückgeliefert, falls das

ReturnVerificationReport

-Element als Eingabeparameter verwendet wurde. Die Profilierung von Anhang B3
MUSS beachtet werden.

</td></tr><tr><td>
Vorbe-dingungen

</td><td colspan="3">
Keine

</td></tr><tr><td>
Nachbe-dingungen

</td><td colspan="3">
Keine

</td></tr></table>

Tabelle236: TAB_KON_760 Ablauf Operation VerifyDocument (nonQES und QES)

<table><tr><th>
Nr.

</th><th>
Aufruf Technischer Use Case oder Interne Operation

</th><th>
Beschreibung

</th></tr><tr><td>
1.

</td><td>
checkArguments

</td><td>
Die übergebenen Werte werden auf Konsistenz und Gültigkeit überprüft. Treten
hierbei Fehler auf, so bricht die Operation mit Fehler 4000 ab.

</td></tr><tr><td>
2.

</td><td>
TUC_KON_000 „Prüfe Zugriffs- berechtigung“

</td><td>
Die Prüfung erfolgt durch den Aufruf

TUC_KON_000 {

    mandantId = $context.mandantId;

    clientsystemId  = $context.clientsystemId;

    workplaceId = $context.workplaceId;

    needCardSession= false;

}

Tritt bei der Prüfung ein Fehler auf, bricht die Operation mit Fehlercode aus
TUC_KON_000 ab.

</td></tr><tr><td>
3.

</td><td>
prüfe, ob QES oder nonQES

</td><td>
Ist im jeweiligen Signaturzertifikat mindestens ein QCStatement mit dem OID
id-etsi-qcs-QcCompliance (0.4.0.1862.1.1) enthalten, handelt es sich um eine
QES-Signatur, andernfalls liegt eine nonQES-Signatur vor.

</td></tr><tr><td colspan="3">
Für QES-Signaturen wird Schritt 4 ausgeführt. Für nonQES-Signaturen wird
Schritt 5 ausgeführt.  
Im Fall eines S/MIME-Dokuments KANN der Konnektor die
Operation mit Fehlercode 4279 beenden.

</td></tr><tr><td>
4.a

</td><td>
Prüfe Signaturdienst-Modul

</td><td>
Prüfe, ob MGM_LU_SAK=Enabled. Ist dies nicht der Fall, so bricht die Operation
mit Fehler 4125 ab.

</td></tr><tr><td>
4.b

</td><td>
TUC_KON_151 „QES Dokumentensignatur prüfen“

</td><td>
Die QES wird geprüft. Tritt hierbei ein Fehler auf, bricht die Operation ab.

</td></tr><tr><td>
5.

</td><td>
TUC_KON_161 „nonQES Dokumentensignatur prüfen“

</td><td>
Die nonQES wird geprüft. Tritt hierbei ein Fehler auf, bricht die Operation ab.

</td></tr></table>

Tabelle237: TAB_KON_761 Fehlercodes „VerifyDocument (nonQES und QES)“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen TUCs (siehe Tabelle TAB_KON_760 Ablauf
Operation VerifyDocument) können folgende weiteren Fehlercodes auftreten:

</td></tr><tr><td>
4000

</td><td>
Technical

</td><td>
Error

</td><td>
Syntaxfehler

</td></tr><tr><td>
4261

</td><td>
Technical

</td><td>
Warning

</td><td>
Einbettung von Revocation-Informationen nicht unterstützt

</td></tr><tr><td>
4125

</td><td>
Technical

</td><td>
Error

</td><td>
LU_SAK nicht aktiviert

</td></tr><tr><td>
4279

</td><td>
Technical

</td><td>
Error

</td><td>
S/MIME-Funktionalität nicht unterstützt

</td></tr><tr><td>
4283

</td><td>
Technical

</td><td>
Error

</td><td>
Dokument zu groß

</td></tr></table>

**[\<=]**

### 4.1.8.5.3 StopSignature

##### TIP1-A_5666-02

Der Signaturdienst des Konnektors MUSS an der Clientschnittstelle eine Operation
StopSignature anbieten.

Tabelle238: TAB_KON_840 Operation StopSignature

<table><tr><th>
Name

</th><th colspan="3">
StopSignature

</th></tr><tr><td>
Beschreibung

</td><td colspan="3">
Diese Operation unterbricht die Signatur eines Dokumentenstapels.

Der Konnektor MUSS jede Signaturerstellung für ein Dokumentenstapel
unterbrechen können.

</td></tr><tr><td rowspan="4">
Aufrufparameter

</td><td colspan="3">
![Img-061][Img-061]

            

</td></tr><tr><td colspan="2">
Name

</td><td>
Beschreibung

</td></tr><tr><td colspan="2">
CCTX:Context

</td><td>
MandantId, ClientSystemId, WorkplaceId verpflichtend; UserId nicht ausgewertet

</td></tr><tr><td colspan="2">
SIG: JobNumber

</td><td>
Die Nummer des Jobs, der gestoppt werden soll.

</td></tr><tr><td rowspan="2">
Rückgabe

</td><td colspan="3">
![Img-062][Img-062]

</td></tr><tr><td>
CONN:Status

</td><td colspan="2">
Enthält den Ausführungsstatus der Operation.

</td></tr><tr><td>
Vorbedingungen

</td><td colspan="3">
Keine

</td></tr><tr><td>
Nachbedingungen

</td><td colspan="3">
Keine

</td></tr></table>

Tabelle239: TAB_KON_841 Ablauf Operation StopSignature

<table><tr><th>
Nr.

</th><th>
Aufruf Technischer Use Case oder Interne Operation

</th><th>
Beschreibung

</th></tr><tr><td>
1.

</td><td>
checkArguments

</td><td>
Die übergebenen Werte werden auf Konsistenz und Gültigkeit überprüft. Dabei
wird auch das CardHandle zu der übergebenen JobNumber ermittelt und dieses
CardHandle zusammen mit dem übergebenen Context einer Berechtigungsprüfung
unterworfen. Treten hierbei Fehler auf, so bricht die Operation mit Fehler 4000
ab

.

</td></tr><tr><td>
2.

</td><td>
Stoppe die Stapelsignaturverarbeitung

</td><td>
Die Verarbeitung der Stapelsignatur wird abgebrochen

</td></tr></table>

Tabelle240: TAB_KON_842 Fehlercodes „StopSignature“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Folgende Fehlercodes können auftreten:

</td></tr><tr><td>
4000

</td><td>
Technical

</td><td>
Error

</td><td>
Syntaxfehler

</td></tr><tr><td>
4243

</td><td>
Technical

</td><td>
Error

</td><td>
Jobnummer unbekannt

</td></tr></table>

**[\<=]**

### 4.1.8.5.4 GetJobNumber

##### TIP1-A_5667

Der Signaturdienst des Konnektors MUSS an der Clientschnittstelle eine Operation
GetJobNumber anbieten.

Tabelle241: TAB_KON_843 Operation GetJobNumber

<table><tr><th>
Name

</th><th colspan="3">
GetJobNumber

</th></tr><tr><td>
Beschreibung

</td><td colspan="3">
Diese Operation liefert eine Jobnummer zur Verwendung in der Operation
SignDocument.

Die Jobnummer MUSS nach den Vorgaben von Kapitel

4.1.8.1.4

erstellt werden.

</td></tr><tr><td rowspan="3">
Aufrufparameter

</td><td colspan="3">
![Img-063][Img-063]

</td></tr><tr><td colspan="2">
Name

</td><td>
Beschreibung

</td></tr><tr><td colspan="2">
CCTX:Context

</td><td>
MandantId, ClientSystemId, WorkplaceId verpflichtend; UserId nicht ausgewertet

</td></tr><tr><td rowspan="2">
Rückgabe

</td><td colspan="3">
![Img-064][Img-064]

</td></tr><tr><td>
SIG: JobNumber

</td><td colspan="2">
Jobnummer zur Verwendung in „SignDocument“

</td></tr><tr><td>
Vorbedingungen

</td><td colspan="3">
Keine

</td></tr><tr><td>
Nachbedingungen

</td><td colspan="3">
Keine

</td></tr></table>

Tabelle242: TAB_KON_844 Ablauf Operation GetJobNumber

<table><tr><th>
Nr.

</th><th>
Aufruf Technischer Use Case oder Interne Operation

</th><th>
Beschreibung

</th></tr><tr><td>
1.

</td><td>
checkArguments

</td><td>
Die übergebenen Werte werden auf Konsistenz und Gültigkeit überprüft. Treten
hierbei Fehler auf, so bricht die Operation mit Fehler 4000 ab.

</td></tr><tr><td>
2.

</td><td>
Generiere und liefere eine Jobnummer

</td><td>
Eine innerhalb von 1000 Aufrufen eindeutige Jobnummer wird generiert und
geliefert. Die Zählung der Aufrufe erfolgt dabei unabhängig vom Aufrufkontext.

</td></tr></table>

Tabelle243: TAB_KON_845 Fehlercodes „GetJobNumber“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Folgende Fehlercodes können auftreten:

</td></tr><tr><td>
4000

</td><td>
Technical

</td><td>
Error

</td><td>
Syntaxfehler

</td></tr></table>

**[\<=]**

### 4.1.8.5.5 ActivateComfortSignature

##### A_19107

Der Signaturdienst des Konnektors MUSS an der Clientschnittstelle eine Operation
ActivateComfortSignature anbieten.

Tabelle244: TAB_KON_874 ActivateComfortSignature

<table><tr><td>
Name

</td><td colspan="2">
ActivateComfortSignature

</td></tr><tr><td>
Beschreibung

</td><td colspan="2">
Diese Operation aktiviert die Komfortsignatur für einen HBA bezogen auf einen
Aufrufkontext.

</td></tr><tr><td rowspan="4">
Aufrufparameter

</td><td colspan="2">
             

</td></tr><tr><td>
Name

</td><td>
Beschreibung

</td></tr><tr><td>
CONN:

Card

Handle

</td><td>
Identifiziert die zu adressierende Karte.

Es wird nur der HBA unterstützt.

</td></tr><tr><td>
CCTX:Context

</td><td>
MandantId, ClientSystemId, WorkplaceId, UserId verpflichtend zu übergeben;

MandantId, WorkplaceId nicht ausgewertet

</td></tr><tr><td rowspan="3">
Rückgabe

</td><td colspan="2">
![Img-065][Img-065]

</td></tr><tr><td>
CONN:Status

</td><td>
Enthält den Ausführungsstatus der Operation.

</td></tr><tr><td>
SIG: SignatureMode

</td><td>
Signaturmodus des HBA

Enthält bei erfolgreicher Ausführung der Operation den Wert „

COMFORT“

</td></tr><tr><td>
Vorbedingungen

</td><td colspan="2">
Keine

</td></tr><tr><td>
Nachbedingungen

</td><td colspan="2">
Keine

</td></tr></table>

Tabelle245: TAB_KON_877 Ablauf ActivateComfortSignature

<table><tr><td>
Nr.

</td><td>
Aufruf Technischer Use Case oder Interne Operation

</td><td>
Beschreibung

</td></tr><tr><td>
1.

</td><td>
checkArguments

</td><td>
Die übergebenen Werte werden auf Konsistenz und Gültigkeit überprüft. Treten
hierbei Fehler auf, so bricht die Operation mit Fehler 4000 ab.

</td></tr><tr><td>
2.

</td><td>
TUC_KON_000 „Prüfe Zugriffsberechtigung“

</td><td>
Die Prüfung erfolgt durch den Aufruf

TUC_KON_000 {

    mandantId = $context.mandantId;

    clientsystemId  = $context.clientsystemId;

    workplaceId = $context.workplaceId;

    userId = $context.userId;

    cardHandle = $cardHandle }

Tritt bei der Prüfung ein Fehler auf, bricht die Operation mit Fehlercode aus
TUC_KON_000 ab.

</td></tr><tr><td>
3.

</td><td>
TUC_KON_026 „Liefere CardSession“

</td><td>
Ermittle CardSession über TUC_KON_026 {

    mandatId =$context.mandantId;

    clientsystemId  = $context.clientsystemId;

    cardHandle = $context.cardHandle;

    userId = $context.userId }

</td></tr><tr><td>
4.

</td><td>
TUC_KON_171 „Komfortsignatur einschalten“

</td><td>
Der Komfortsignaturmodus wird für das Tupel (CardHandle, CardSession)
eingeschaltet. Tritt hierbei ein Fehler auf, bricht die Operation ab.

</td></tr></table>

 

Tabelle246: TAB_KON_879 Fehlercodes ActivateComfortSignature

<table><tr><td>
Fehlercode

</td><td>
ErrorType

</td><td>
Severity

</td><td>
Fehlertext

</td></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen TUCs können folgende weiteren
Fehlercodes auftreten:

</td></tr><tr><td>
4000

</td><td>
Technical

</td><td>
Error

</td><td>
Syntaxfehler

</td></tr><tr><td>
4270

</td><td>
Technical

</td><td>
Error

</td><td>
UserId wurde in den letzten 1.000 Vorgängen bereits verwendet

</td></tr><tr><td>
4272

</td><td>
Technical

</td><td>
Error

</td><td>
UserId nicht zulässig

</td></tr></table>

**[\<=]**

### 4.1.8.5.6 DeactivateComfortSignature

##### A_19108

Der Signaturdienst des Konnektors MUSS an der Clientschnittstelle eine Operation
DeactivateComfortSignature anbieten.

Tabelle247: TAB_KON_875 DeactivateComfortSignature

<table><tr><td>
Name

</td><td colspan="3">
DeactivateComfortSignature

</td></tr><tr><td>
Beschreibung

</td><td colspan="3">
Diese Operation deaktiviert die Komfortsignatur für einen oder mehrere HBA.

</td></tr><tr><td rowspan="3">
Aufrufparameter

</td><td colspan="3">
            

</td></tr><tr><td colspan="2">
Name

</td><td>
Beschreibung

</td></tr><tr><td colspan="2">
CONN:

Card

Handle

</td><td>
Identifiziert die zu adressierende Karte.

Es wird nur der HBA unterstützt.

</td></tr><tr><td rowspan="2">
Rückgabe

</td><td colspan="3">
![Img-066][Img-066]

</td></tr><tr><td>
CONN:Status

</td><td colspan="2">
Enthält den Ausführungsstatus der Operation.

</td></tr><tr><td>
Vorbedingungen

</td><td colspan="3">
Keine

</td></tr><tr><td>
Nachbedingungen

</td><td colspan="3">
Keine

</td></tr><tr></tr></table>

Tabelle248: TAB_KON_878 Ablauf DeactivateComfortSignature

<table><tr><td>
Nr.

</td><td>
Aufruf Technischer Use Case oder Interne Operation

</td><td>
Beschreibung

</td></tr><tr><td>
1.

</td><td>
checkArguments

</td><td>
Die übergebenen Werte werden auf Konsistenz und Gültigkeit überprüft. Treten
hierbei Fehler auf, so bricht die Operation mit Fehler 4000 ab.

</td></tr><tr><td>
2.

</td><td>
TUC_KON_172 „Komfortsignatur ausschalten“

</td><td>
Der Komfortsignaturmodus wird für alle Karten aus der CardHandle-Liste
ausgeschaltet.

</td></tr></table>

 

Tabelle249: TAB_KON_880 Fehlercodes DeactivateComfortSignature

<table><tr><td>
Fehlercode

</td><td>
ErrorType

</td><td>
Severity

</td><td>
Fehlertext

</td></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen TUCs können folgende weiteren
Fehlercodes auftreten:

</td></tr><tr><td>
4000

</td><td>
Technical

</td><td>
Error

</td><td>
Syntaxfehler

</td></tr></table>

**[\<=]**

### 4.1.8.5.7 GetSignatureMode

##### A_19109-02

Der Signaturdienst des Konnektors MUSS an der Clientschnittstelle eine Operation
GetSignatureMode anbieten.

Tabelle250: TAB_KON_876 GetSignatureMode

<table><tr><th>
Name

</th><th colspan="3">
GetSignatureMode

</th></tr><tr><td>
Beschreibung

</td><td colspan="3">
Diese Operation liefert den aktuell ko

nfigurierten Status der Komfortsignaturfunktion im Konnektor und
Session-Informationen

zur Kartensitzung für das CardHandle und den Aufrufkontext, falls sich die
Kartensitzung im Komfortsignaturmodus befindet.

</td></tr><tr><td rowspan="3">
Aufrufparameter

</td><td colspan="3">
           

</td></tr><tr><td colspan="2">
Name

</td><td>
Beschreibung

</td></tr><tr><td colspan="2">
CONN:CardHandle

</td><td>
Identifiziert die zu adressierende Karte.

Es wird nur der HBA unterstützt.

</td></tr><tr><td>
CCTX:Context

</td><td>
MandantId, ClientSystemId, WorkplaceId, UserId verpflichtend zu übergeben

</td></tr><tr><td rowspan="2">
Rückgabe

</td><td colspan="3">
![Img-067][Img-067]

</td></tr><tr><td>
CONN:Status

</td><td colspan="2">
Enthält den Ausführungsstatus der Operation.

</td></tr><tr><td>
 

</td><td>
SIG:  
ComfortSignatureStatus

</td><td colspan="2">
Komfortsignatur-Konfigurationsstatus des Konnektors

</td></tr><tr><td>
 

</td><td>
SIG:ComfortSignatureMax

</td><td colspan="2">
Im Konnektor konfigurierte Anzahl von Komfortsignaturen, die ohne erneute
PIN-Eingabe ausgeführt werden dürfen

</td></tr><tr><td>
 

</td><td>
SIG: ComfortSignatureTimer

</td><td colspan="2">
Im Konnektor konfiguriertes Zeitintervall, in dem Komfortsignaturen ohne erneute
PIN-Eingabe ausgeführt werden dürfen,

Format: "PTnHnMnS" (gemäß Datenttyp xsd:duration)

</td></tr><tr><td>
 

</td><td>
SIG:SessionInfo

</td><td colspan="2">
Falls vorhanden, Session-Informationen zur Komfortsignatursession für das
CardHandle und den Aufrufkontext

</td></tr><tr><td>
 

</td><td>
SIG:SignatureMode

</td><td colspan="2">
Signaturmodus der Komfortsignatursession (="

COMFORT"

)

</td></tr><tr><td>
 

</td><td>
SIG:CountRemaining

</td><td colspan="2">
Verbleibende Anzahl von Komfortsignaturen, die ohne erneute PIN-Eingabe
ausgeführt werden dürfen

</td></tr><tr><td>
SIG:TimeRemaining

</td><td colspan="2">
Verbleibende Zeit, in der Komfortsignaturen ohne erneute PIN-Eingabe ausgeführt
werden dürfen

Format: "PTnHnMnS" (gemäß Datenttyp xsd:duration)

</td></tr><tr><td>
Vorbedingungen

</td><td colspan="3">
Keine

</td></tr><tr><td>
Nachbedingungen

</td><td colspan="3">
Keine

</td></tr></table>

Tabelle251: TAB_KON_882 Ablauf GetSignatureMode

<table><tr><td>
Nr.

</td><td>
Aufruf Technischer Use Case oder Interne Operation

</td><td>
Beschreibung

</td></tr><tr><td>
1.

</td><td>
checkArguments

</td><td>
Die übergebenen Werte werden auf Konsistenz und Gültigkeit überprüft. Treten
hierbei Fehler auf, so bricht die Operation mit Fehler 4000 ab.

</td></tr><tr><td>
2. 

</td><td>
TUC_KON_000 „Prüfe Zugriffsberechtigung“

</td><td>
Die Prüfung erfolgt durch den Aufruf

TUC_KON_000 {

    mandantId = $context.mandantId;

    clientsystemId  = $context.clientsystemId;

    workplaceId = $context.workplaceId;

    userId = $context.userId;

    cardHandle = $cardHandle }

Tritt bei der Prüfung ein Fehler auf, bricht die Operation mit Fehlercode aus
TUC_KON_000 ab.

</td></tr><tr><td>
3.

</td><td>
TUC_KON_026 „Liefere CardSession“

</td><td>
Ermittle CardSession über TUC_KON_026 {

    mandatId =$context.mandantId;

    clientsystemId  = $context.clientsystemId;

    cardHandle = $context.cardHandle;

    userId = $context.userId }

</td></tr><tr><td>
4.

</td><td>
TUC_KON_173 „Liefere Signaturmodus“

</td><td>
Der Komfortsignatur-Konfig

urationsstatus des Konnektors und, falls vorhanden, Session-Informationen zur
Komfortsignatursession für das CardHandle und den Aufrufkontext werden

zurückgeliefert.

</td></tr></table>

 

Tabelle252: TAB_KON_881 Fehlercodes GetSignatureMode

<table><tr><td>
Fehlercode

</td><td>
ErrorType

</td><td>
Severity

</td><td>
Fehlertext

</td></tr><tr><td colspan="4">
Folgende Fehlercodes können auftreten:

</td></tr><tr><td>
4000

</td><td>
Technical

</td><td>
Error

</td><td>
Syntaxfehler

</td></tr></table>

**[\<=]**

### 4.1.8.6 Betriebsaspekte

##### TIP1-A_4680-03

Die Managementschnittstelle MUSS es einem Administrator ermöglichen
Konfigurationsänderungen gemäß Tabelle TAB_KON_596 vorzunehmen:

Tabelle253: TAB_KON_596 Konfigurationswerte des Signaturdienstes (Administrator)

<table><tr><th>
ReferenzID

</th><th>
Belegung

</th><th>
Bedeutung und Administrator-Interaktion

</th></tr><tr><td>
SAK_SIMPLE_  
SIGNATURE_ MODE

</td><td>
SE#1  
SE#2

</td><td>
Aktivierung/Deaktivierung des „Einfachsignaturmodus“ für alle HBAx für die
 
Durchführung von Einfachsignaturen im SecurityEnvironment #1 (SE#1) für
Dokumentenstapel  
der Größe 1 anstelle der Verwendung des SE#2. 

Default-Wert = SE#1

</td></tr><tr><td>
SAK_COMFORT_  
SIGNATURE

</td><td>
Enabled/  
Disabled

</td><td>
Aktivierung/Deaktivierung der Komfortsignaturfunktion im Konnektor

Default-Wert = Disabled

Die Komfortsignaturfunktion darf nur aktiviert sein, wenn

ANCL_TLS_MANDATORY = Enabled und

ANCL_CAUT_MANDATORY = Enabled

</td></tr><tr><td>
SAK_COMFORT_  
SIGNATURE_MAX

</td><td>
[1 - 250]

</td><td>
Anzahl von Komfortsignaturen, die ohne erneute PIN-Eingabe ausgeführt werden
dürfen

Default-Wert = 100

Der Parameter ist nur relevant, wenn die Komfortsignaturfunktion aktiviert ist
(SAK_COMFORT_SIGNATURE = Enabled).

</td></tr><tr><td>
SAK_COMFORT_  
SIGNATURE_TIMER

</td><td>
[1 – 24 h]

</td><td>
Zeitintervall, in dem Komfortsignaturen ohne erneute PIN-Eingabe ausgeführt
werden dürfen

Der Timer startet mit Eingabe der PIN.QES für die Komfortsignatur.

Default-Wert = 6 h

Der Parameter ist nur relevant, wenn die Komfortsignaturfunktion aktiviert ist
(SAK_COMFORT_SIGNATURE = Enabled).

</td></tr></table>

**[\<=]**

### 4.1.9 Zertifikatsdienst

Der Zertifikatsdienst bietet eine Schnittstelle zur Überprüfung der
Gültigkeit von Zertifikaten an. Dies geschieht auf Grundlage des durch den
Vertrauensanker (TSL-CA-Signer-Zertifikat und eine aktuelle, gültige TSL
aufgespannten Vertrauensraums sowie unter Berücksichtigung von aktuellen
Statusinformationen (OCSP, CRL). Die Zertifikatsprüfung wird sowohl für
nonQES- als auch für QES-Zertifikate unterstützt.

Die für die QES-Zertifikatsprüfung notwendigen QES-Signer-Zertifikate werden
durch die Vertrauensliste der Bundesnetzagentur (BNetzA-VL) bereitgestellt. Das
Signer-Zertifikat der BNetzA-VL ist in der TSL enthalten.

Im Rahmen der ECC-Migration muss der Konnektor neben RSA auch ECC unterstützen.
Hierfür wird eine TSL bereitgestellt, die sowohl die neuen ECC-basierten
Zertifikate als auch aus Rückwärtskompatibilitätsgründen die weiterhin
benötigten RSA-basierten Zertifikate enthält. Diese neue TSL wird auch als
„TSL(ECC-RSA)“ bezeichnet. In dieser Spezifikation wird außerhalb der
Regelungen zur ECC-Migration  nicht zwischen „TSL(ECC-RSA)"
und „TSL(RSA)" unterschieden, da die Anforderungslage keine Unterscheidung
erfordert.

Innerhalb des Zertifikatsdienstes werden folgende Präfixe für Bezeichner
verwendet:

 ---> UL

### 4.1.9.1 Funktionsmerkmalweite Aspekte

Bei der Zertifikatsprüfung wird im Rahmen eines Anwendungsfalls u.a. auch der
Verwendungszweck des Zertifikats geprüft. Der Verwendungszweck
(intendedKeyUsage) wird als Parameter an TUC_KON_037 übergeben. Der konkrete
Wert von intendedKeyUsage ist abhängig vom kryptographischen Verfahren, auf
welchem das Zertifikat basiert. Die Parametrisierung von intendedKeyUsage wird
in TAB_KON_853 in Abhängigkeit vom zu prüfenden Zertifikat, dem
Anwendungsfall und dem kryptographischen Verfahren definiert.

##### A_17295-01

Der Konnektor MUSS bei der Zertifikatsprüfung die intendedKeyUsage in
Abhängigkeit vom zu prüfenden Zertifikat, dem Anwendungsfall und dem
kryptographischen Verfahren gemäßTAB_KON_853prüfen.

Tabelle254: TAB_KON_853- intendedKeyUsage bei Zertifikatsprüfung

<table><tr><th colspan="1" rowspan="2">
Zertifikat

</th><th colspan="1" rowspan="2">
Anwendungsfall

</th><th colspan="2" rowspan="1">
intendedKeyUsage bei

</th></tr><tr><td>
RSA

</td><td>
ECC

</td></tr><tr><td>
C.SMKT.AUT

</td><td>
TUC_KON_050 „Beginne Kartenterminalsitzung“  
TUC_KON_053 „Paire
Kartenterminal“

</td><td>
digitalSignature  
&keyEncipherment

</td><td>
digitalSignature

</td></tr><tr><td>
C.CH.AUT  
C.CH.AUTN

</td><td>
TUC_KON_161 „nonQES Dokumentsignatur prüfen”

</td><td>
digitalSignature  
&keyEncipherment

</td><td>
digitalSignature

</td></tr><tr><td>
C.CH.ENC  
C.CH.ENCV  
C.HCI.ENC  
C.HP.ENC  
Zertifikate  aus
CERT_IMPORTED_CA_LIST

</td><td>
TUC_KON_070 „Daten hybrid verschlüsseln“

</td><td>
keyEncipherment

</td><td>
keyAgreement 

</td></tr><tr><td>
 C.HCI.OSIG

</td><td>
 TUC_KON_161 „nonQES Dokumentsignatur prüfen”

</td><td>
 nonRepudiation

</td><td>
 nonRepudiation

</td></tr><tr><td>
C.FD.TLS-S

</td><td>
TUC_KON_110 „Kartenbasierte TLS-Verbindung aufbauen“

</td><td>
digitalSignature&keyEncipherment

</td><td>
digitalSignature

</td></tr><tr><td>
C.ZD.TLS-S

</td><td>
TUC_KON_290 „LDAP-Verbindung aufbauen“

</td><td>
digitalSignature

</td><td>
digitalSignature

</td></tr><tr><td>
C.ZD.TLS-S

</td><td>
TIP1-A_5662 - Gesicherte Übertragung von BNetzA-VL und Hashwert  
TUC_KON_282
„UpdateInformationen beziehen“  
TUC_KON_283 Infrastruktur Konfiguration
aktualisieren  
TUC_KON_285 „UpdateInformationen für Fachmodul beziehen“ 

TUC_KON_286 „Paket für Fachmodul laden“

</td><td>
digitalSignature&keyEncipherment

</td><td>
digitalSignature

</td></tr><tr><td>
C.FD.AUT

</td><td>
A_17225-*

</td><td>
digitalSignature&keyEncipherment

</td><td>
digitalSignature

</td></tr><tr><td>
C.FD.SIG

</td><td>
TUC_KON_161 „nonQES Dokumentsignatur prüfen”

</td><td>
digitalSignature

</td><td>
digitalSignature

</td></tr><tr><td>
C.FD.OSIG

</td><td>
TUC_KON_161 „nonQES Dokumentsignatur prüfen”

</td><td>
nonRepudiation

</td><td>
nonRepudiation

</td></tr><tr><td>
C.ZD.SIG

</td><td>
TUC_KON_161 „nonQES Dokumentsignatur prüfen”

</td><td>
nonRepudiation

</td><td>
nonRepudiation

</td></tr></table>

**[\<=]**

Bei der Zertifikatsprüfung wird ein übergebenes Zertifikat oder ein Zertifikat
einer referenzierten Karte geprüft. Das konkrete Zertifikatsobjekt einer Karte
ist abhängig vom Kartentyp und dem gewählten kryptographischen Verfahren. Die
folgende Tabelle führt auf, welche Zertifikatsobjekte einer Karte in
Abhängigkeit vom kryptographischen Verfahren für die jeweilige
Zertifikatsreferenz ausgewählt werden.

<table><tr><th rowspan="2">
CertRef

</th><th rowspan="2">
Kartentyp

</th><th colspan="2">
Objekt der Karte in Abhängigkeit vom kryptographischen Verfahren (Crypt)

</th></tr><tr><td>
RSA

</td><td>
ECC

</td></tr><tr><td rowspan="4">
C.AUT

</td><td>
HBA-VK 

</td><td>
EF.C.HP.AUT

</td><td>
-

</td></tr><tr><td>
HBA

</td><td>
EF.C.HP.AUT.R2048

</td><td>
EF.C.HP.AUT.E256

</td></tr><tr><td>
SM-B

</td><td>
EF.C.HCI.AUT

</td><td>
EF.C.HCI.AUT.E256

</td></tr><tr><td>
eGK G2

</td><td>
EF.C.CH.AUT.R2048

</td><td>
EF.C.CH.AUT.E256

</td></tr><tr><td>
C.ENC

</td><td>
HBA-VK

</td><td>
EF.C.HP.ENC

</td><td>
-

</td></tr><tr><td>
</td><td>
HBA

</td><td>
EF.C.HP.ENC.2048

</td><td>
EF.C.HP.ENC.E256

</td></tr><tr><td>
</td><td>
SM-B

</td><td>
EF.C.HCI.ENC.R2048

</td><td>
EF.C.HCI.ENC.E256

</td></tr><tr><td>
C.SIG

</td><td>
SM-B

</td><td>
EF.C.HCI.OSIG.R2048

</td><td>
EF.C.HCI.OSIG.E256

</td></tr><tr><td>
C.QES

</td><td>
HBA-VK

</td><td>
EF.C.HP.QES

</td><td>
-

</td></tr><tr><td>
</td><td>
HBA

</td><td>
EF.C.HP.QES.R2048

</td><td>
EF.C.HP.QES.E256

</td></tr></table>

##### TIP1-A_4682

DerVertrauensankerder TI MUSSzum Auslieferungszeitpunkt des
Konnektorsintegritätsgeschützt im Konnektor hinterlegt sein. Zur
Sicherstellung dieser IntegritätMUSSdie Dateiablage EF.C.TSL.CA_1 der
Anwendung DF.Sicherheitsanker der gSMC-K [gemSpec_gSMC-K_ObjSys#5.7.2]
verwendet werden. **[\<=]**

##### TIP1-A_4684

Falls Parameter MGM_LU_ONLINE=Enabled,MUSS der Zertifikatsdienst einmal täglich
die Aktualisierung der TSL durch Aufruf von TUC_KON_032 „TSL aktualisieren“
durchführen und anschließend TUC_KON_040 „CRL aktualisieren“ aufrufen.
**[\<=]**

##### TIP1-A_4685

Der KonnektorMUSS Spitzenlasten durch paralleles Herunterladen der TSL und der
CRL vermeiden. Dazu MÜSSEN die imEinsatz befindlichen Konnektoren eines
Herstellers ihre Download-Versuche gleichmäßig über den Tag verteilen. **[\<=]**

Dadurch wird gleichzeitig die Spitzenlast bei OCSP-Anfragen begrenzt.

##### A_17572

Falls die TSL(ECC-RSA) verwendet wird, MUSS der Konnektor vor deren
Aktualisierung mit TUC_KON_032 „TSL aktualisieren“ die Hash-Datei der
TSL(ECC-RSA) herunterladen, um zu prüfen, ob die am TSL-Downloadpunkt
verfügbare TSL(ECC-RSA) eine andere ist, als die schon zuvor heruntergeladene
und bereits ausgewertete TSL(ECC-RSA). Entspricht der Hash-Wert am
Download-Punkt der bereits heruntergeladenen und ausgewerteten TSL(ECC-RSA),
MUSS der Konnektor auf den Download verzichten. **[\<=]**

##### A_17661

Der Konnektor MUSS für den Download der Hash-Datei der TSL(ECC-RSA) die
Verbindung zum TSL-Dienst durch TLS absichern. Der Konnektor MUSS das vom
TSL-Dienst beim TLS-Verbindungsaufbau präsentierte Zertifikat C.ZD.TLS-S
prüfen. Die Prüfung erfolgt durch Aufruf von TUC_KON_037 „Zertifikat
prüfen“ {

certificate = C.ZD.TLS-S;

qualifiedCheck = not_required;

offlineAllowNoCheck = true;

policyList  = oid_zd_tls_s;

intendedKeyUsage  = intendedKeyUsage(C.ZD.TLS-S);

intendedExtendedKeyUsage = id-kp-serverAuth;

validationMode  = OCSP } .

Falls Fehler im TLS-Verbindungsaufbau bzw. bei der Zertifikatsprüfung auftreten
MUSS der Konnektor den TLS-Verbindungsaufbau mit Fehlercode 4235 gemäß
TAB_KON_825 abbrechen. **[\<=]**

##### A_17781

Falls im Rahmen der TSL-Aktualisierung beim Download der Hash-Datei der
TSL(ECC-RSA) ein Fehler auftritt MUSS der Konnektor die Aktualisierung der TSL
mit TUC_KON_032 „TSL aktualisieren“ ohne einen ermittelten Hashwert
aufrufen. **[\<=]**

##### TIP1-A_6730

Falls Parameter MGM_LU_ONLINE=Enabled,MUSS der Zertifikatsdienst die
Aktualisierung der BNetzA-VL im
Zeitintervall  CERT_BNETZA_VL_UPDATE_INTERVALdurch Aufruf von TUC_KON_031
„BNetzA-VL aktualisieren“durchführen. **[\<=]**

##### TIP1-A_6731

Der Zertifikatsdienst MUSS einmal täglich die zeitliche Gültigkeitder
BNetzA-VL prüfen. Wenn das Element NextUpdate in der Vergangenheit liegt MUSS
der Konnektor den Betriebszustand EC_ BNetzA_VL_not_valid auslösen. **[\<=]**

##### TIP1-A_6732

Der Konnektor MUSS Spitzenlasten durch Herunterladen der BNetzA-VL vermeiden.
Dazu MÜSSEN die imEinsatz befindlichen Konnektoren den Zeitpunkt für den
Download zufällig wählen unter Beachtung des konfigurierten
ZeitintervallsCERT_BNETZA_VL_UPDATE_INTERVAL. **[\<=]**

##### TIP1-A_5662

Der Konnektor MUSS für den Download der BNetzA-VL und deren Hashwert die
Verbindung zum TSL-Dienst durch TLS absichern. Der Konnektor MUSS  das vom
TSL-Dienst beim TLS-Verbindungsaufbau präsentierte Zertifikat ID.ZD.TLS_S
prüfen. Die Prüfung erfolgt durch Aufruf von TUC_KON_037 „Zertifikat
prüfen“ {

certificate = ID.ZD.TLS_S;

qualifiedCheck = not_required;

offlineAllowNoCheck = true;

policyList  = oid_zd_tls_s;

intendedKeyUsage  = intendedKeyUsage(C.ZD.TLS-S);

intendedExtendedKeyUsage = id-kp-serverAuth;

validationMode  = OCSP } .

Fehler im TLS-Verbindungsaufbau bzw. bei der Zertifikatsprüfung führen zum
Abbruch des TLS-Verbindungsaufbaus mit Fehlercode 4235 gemäß TAB_KON_825.

Tabelle256: TAB_KON_825 Fehlercodes „TLS-Verbindungsaufbau zum TSL-Dienst“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4235

</td><td>
Security

</td><td>
Error

</td><td>
TSL-Dienst konnte bei TLS-Verbindungsaufbau nicht authentisiert werden

</td></tr></table>

**[\<=]**

##### TIP1-A_5663

Der Konnektor MUSS beim TLS-Verbindungsaufbau zum TSL-Dienst prüfen, dass die
vom TSL-Dienst in ID.ZD.TLS_S übergebene technische Rolle gemäß
[gemSpec_OID#GS-A_4446] dem Wert „oid_tsl_ti“entspricht.

Ein Fehler bei der Prüfung der techischen Rolle führt zum Abbruch des
TLS-Verbindungsaufbaus mit Fehlercode 4236 gemäß TAB_KON_826.

Tabelle257: TAB_KON_826 Fehlercodes„TLS-Verbindungsaufbau zum TSL-Dienst bei
Prüfung der technischen Rolle“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td>
4236

</td><td>
Security

</td><td>
Error

</td><td>
Rollenprüfung bei TLS-Verbindungsaufbau zum TSL-Dienst fehlgeschlagen

</td></tr></table>

**[\<=]**

##### TIP1-A_4686

Steht der Ablauf der TSL innerhalb von 7 Tagen an, MUSS der Konnektor den
Betriebszustand EC_TSL_Expiring annehmen.

Mit Ablauf der Gültigkeit der TSL MUSS der Konnektor den Betriebszustand
EC_TSL_Out_Of_Date_Within_Grace_Period annehmen.

Mit Ablauf der Graceperiod der TSL MUSS der Konnektor den kritischen
Betriebszustand EC_TSL_Out_Of_Date_Beyond_Grace_Period annehmen. **[\<=]**

##### TIP1-A_4687

Steht der Ablauf der Gültigkeit des TI-Vertrauensankers innerhalb von 30 Tagen
an, MUSS der Konnektor den Betriebszustand EC_TSL_Trust_Anchor_Expiring
annehmen.

Mit Ablauf der Gültigkeit des Vertrauensankers MUSS der Konnektor den
kritischen Betriebszustand EC_TSL_Trust_Anchor_Out_Of_Date annehmen. **[\<=]**

##### TIP1-A_4994

Steht der Ablauf der Gültigkeit der CRL innerhalb von 3 Tagen an, MUSS der
Konnektor den Betriebszustand EC_CRL_Expiringannehmen.

Mit Ablauf der Gültigkeit der CRL MUSS der Konnektor den kritischen
BetriebszustandEC_CRL_Out_Of_Dateannehmen. **[\<=]**

##### TIP1-A_4688

DerKonnektorMUSS alle OCSP-Anfragen über den OCSP-Forwarder (HTTP-Proxy) des
Zugangsdienst-Providers schicken, der durch die Konfigurationswerte
(CERT_OCSP_FORWARDER_ADDRESS, CERT_OCSP_FORWARDER_PORT) festgelegt ist. **[\<=]**

##### TIP1-A_4689

Der Zertifikatsdienst MUSS erhaltene OCSP-Antworten für eine
durchCERT_OCSP_DEFAULT_GRACE_PERIOD_NONQESangegebene Anzahl an Minuten
(nonQES-Zertifikate) zwischenspeichern. **[\<=]**

##### TIP1-A_4690

Bei Ausführung von TUC_PKI_006 „OCSP-Abfrage“ [gemSpec_PKI#8.3.2.2] MÜSSEN
folgende Parameter verwendet werden:OCSP-Graceperiod =
    CERT_OCSP_DEFAULT_GRACE_PERIOD_NONQES

 ---> UL

**[\<=]**

##### TIP1-A_4691

Für die gSMC-K sowie für jede gesteckte Karte außer eGK MUSS der Konnektor im
IntervallCERT_EXPIRATION_CARD_CHECK_DAYSgenau einmal TUC_KON_033 aufrufen.Der
Konnektor MUSS die Gültigkeitsdauer der Zertifikate prüfen mittels Aufruf
von:für gSMC-KTUC_KON_033{checkSMCK; doInformClients=Ja; crypt =
ECC}TUC_KON_033{checkSMCK; doInformClients=Ja; crypt = RSA}für jede
gesteckte G2.0 Karte außer eGK und außer
gSMC-KTUC_KON_033{cardSession; doInformClients=Ja; crypt = RSA}für jede
gesteckte ab G2.1 Karte außer
eGKTUC_KON_033{cardSession; doInformClients=Ja; crypt =
ECC}TUC_KON_033{cardSession; doInformClients=Ja; crypt = RSA} **[\<=]**

##### TIP1-A_4692

Der Konnektor MUSS zur Unterstützung von Missbrauchserkennungen die in Tabelle
TAB_KON_597 gelisteten Operationen als Einträge in EVT_MONITOR_OPERATIONS
berücksichtigen.

Tabelle258: TAB_KON_597 Operationen in EVT_MONITOR_OPERATIONS

<table><tr><th>
Operationsname

</th><th>
OK_Val

</th><th>
NOK_Val

</th><th>
Alarmwert (Default-Grenzwert 10 Minuten-

Σ

)

</th></tr><tr><td>
VerifyCertificate

</td><td>
1

</td><td>
5

</td><td>
401

</td></tr></table>

**[\<=]**

##### A_23274

Der Konnektor SOLL dem Administrator an der Management-Oberfläche die
Aktualisierung der TSL und CRL per Download ermöglichen. Dabei wird
TUC_KON_032 „TSL aktualisieren“ und anschließend TUC_KON_040 „CRL
aktualisieren“ aufgerufen. **[\<=]**

### 4.1.9.2 Durch Ereignisse ausgelöste Reaktionen

Keine.

### 4.1.9.3 Interne TUCs, nicht durch Fachmodule nutzbar

### 4.1.9.3.1 TUC_KON_032 „TSL aktualisieren“

##### TIP1-A_4693-02

Der Konnektor MUSS den technischen Use Case TUC_KON_032 „TSL aktualisieren“
umsetzen.

Tabelle259: TAB_KON_766 TUC_KON_032 „TSL aktualisieren“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_032 „TSL aktualisieren“

</td></tr><tr><td>
Beschreibung

</td><td>
Dieser TUC prüft die Aktualität der TSL und initialisiert ggf. den
TSL-spezifischen Bereich des TrustStores neu. Zusätzlich wird bei einem
Wechsel des TI-Vertrauensankers das neue TSL-Signer-CA-Zertifikat in einem
sicheren Speicherort im Konnektor hinterlegt. Im Fall der Veröffentlichung
eines CVC-Root-CA-Zertifikats werden das CVC-Root-CA-Zertifikat und die
Cross-CV-Zertifikate aus der TSL in den Truststore eingestellt.

</td></tr><tr><td>
Auslöser

</td><td>
 ---> UL

</td></tr><tr><td>
Vorbedingungen

</td><td>
 ---> UL

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Nachbedingungen

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

</td></tr><tr><td>
Varianten/  
Alternativen

</td><td>
(-\> 1) Wenn der Download der TSL aus der TI fehlschlägt oder wenn der
Konnektor im Fall onlineMode = ENABLED keine Verbindung zur TI hat, muss der
Konnektor die TSL vom Download-Punkt im Internet

(CERT_TSL_DOWNLOAD_ADDRESS_INTERNET) gemäß [gemSpec_TSL#A_21182]
beziehen. Im Fall onlineMode = DISABLED wird abgebrochen.

Wenn kein aktiver VPN-Tunnel SIS vorhanden ist, muss der Konnektor den
Downloadversuch der TSL aus dem Internet direkt über das IAG initiieren, auch
wenn ANLW_INTERNET_MODUS=SIS konfiguriert ist. Im Fall
ANLW_INTERNET_MODUS=KEINER wird abgebrochen.

Wenn die Namensauflösung für CERT_TSL_DOWNLOAD_ADDRESS_INTERNET fehlschlägt,
muss der Konnektor die TSL über CERT_TSL_IP_ADDRESS_INTERNET beziehen.

Wenn keiner der vorigen Downloadversuche erfolgreich war, muss der
Konnektor die TSL von der konfigurierbaren
Adresse CERT_TSL_DOWNLOAD_ADDRESS_INTERNET_BU beziehen.

Wenn die Namensauflösung für CERT_TSL_DOWNLOAD_ADDRESS_INTERNET_BU
fehlschlägt, muss der Konnektor die TSL über CERT_TSL_IP_ADDRESS_INTERNET_BU
beziehen.

Für eine aus dem Internet bezogene TSL muss der Konnektor auch die vom
TSL-Dienst gemäß [gemSpec_TSL#A_21182] bereitgestellte detached-Signatur der
TSL herunterladen. Der Konnektor muss dann immer zunächst die
detached-Signatur der TSL prüfen, einschließlich vollständiger Prüfung der
Zertifikatskette bis zum TI-Vertrauensanker. Die kryptographische Prüfung der
Signatur muss entsprechend A_21185 durchgeführt werden.

Bezüglich der Prüfung des Sperrstatus des TSL-Signer-Zertifikats muss der
Konnektor eines der folgenden Verfahren umsetzen:

 ---> OL

(1) Wird die importedTSL manuell übergeben (in den Eingangsdaten), so wird
diese statt des Downloads verwendet und an TUC_PKI_001 übergeben. Innerhalb
der PKI TUCs findet dann kein Download der TSL statt.  
(1) Falls onlineMode
= DISABLED, kann der Sperrstatus des TSL-Signer-Zertifikats nicht überprüft
werden. In diesem Fall wird die Aktivierung der importedTSL auch ohne Prüfung
des Sperrstatus durchgeführt.  
(1) Wird durch den von TUC_PKI_001
aufgerufenen TUC_PKI_013 „Import neuer Vertrauensanker“ ein neuer
TI-Vertrauensanker (ein neues TSL-Signer-CA-Zertifikat) in der importedTSL
gefunden, so wird dieser, wie dort beschrieben, extrahiert und in einem
sicheren Speicherort gespeichert. Vor Erreichen des Aktivierungsdatums werden
die TSLs ausschließlich mit dem alten TSL-Signer-Zertifikat signiert. Ab dem
Aktivierungsdatum werden die TSLs mit einem TSL-Signer-Zertifikat signiert, das
von der neuen TSL-Signer-CA ausgestellt wurde.

</td></tr><tr><td>
Fehlerfälle

</td><td>
(1) Tritt beim manuellen Import der Datei ein Fehler auf, wird TUC_KON_256 { 

       topic = „CERT/TSL/IMPORT“;  
       eventType = Op; 

       severity = Error;  
       parameters =
„$Fehlerbeschreibung“;  
       doLog = true;  
       doDisp =
false }  
ausgelöst. Fehlercode 4128.  
(1) Tritt beim periodischen Update
der TSL beim Aufruf des TUC_PKI_001 oder eines durch ihn aufgerufenen TUCs ein
Fehler auf, geht der Konnektor in den Betriebszustand
EC_TSL_Update_Not_Successful. Der Konnektor geht erst in den Betriebszustand
EC_TSL_Update_Not_Successful, wenn weder der Downloadversuch aus der TI noch
der Downloadversuch aus dem Internet erfolgreich war. Die vorhandenen
TSL-Vertrauensanker werden weiter verwendet. Fehlercode 4127.

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
keine

</td></tr></table>

Tabelle260: TAB_KON_598 Fehlercodes TUC_KON_032 „TSL aktualisieren“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4127

</td><td>
Security

</td><td>
Error

</td><td>
Import der TSL-Datei fehlgeschlagen

</td></tr><tr><td>
4128

</td><td>
Technical

</td><td>
Error

</td><td>
der manuelle Import der TSL-Datei schlägt fehl

</td></tr></table>

**[\<=]**

Für den Download der TSL über einen HTTP-Server im Internet wird zusätzlich
zu der bereits mit einer XML-Signatur versehenen TSL eine detached-Signatur
als separate Datei auf dem Download-Punkt zur Verfügung gestellt. Diese
detached-Signatur umfasst die TSL in ihrerer Gänze, das heißt die
TSL-XML-Datei wird inkl. der dort bereits enthaltenen XML-Signatur nochmal
durch den TSL-Signer signiert. Ein Konnektor verwendet dann bei der
Signaturprüfung einer TSL, die über das Internet bezogen wurde, die
detached-Signatur für die Signaturprüfung. Hintergrund ist die aus
Sicherheitsperspektive einfachere, im Sinne von sicherer prüfbare
detached-Signatur. Das heißt, die TSL muss nicht als XML-File verarbeitet und
die relativ komplexe XML-Signatur - die potentiell von einem Angreifer
modifiziert sein könnte - nicht ausgewertet werden. Deshalb wird der Weg
gewählt, der auch für die Signatur von X.509-Zertifikaten und OCSP-Responses
verwendet wird.

##### A_21185

Der Konnektor MUSS beim Download der TSL aus dem Internet ebenfalls deren
detached-Signatur (vgl. [gemSpec_TSL#A_21182]) mit herunterladen und immer
zunächst folgende Prüfungen durchführen:

 ---> OL

Schlägt eine der Prüfungen fehl, MUSS der Import abgebrochen werden.

Ist die Prüfung erfolgreich, KANN die Prüfung der XML-Signatur der TSL im
weiteren fachlichen Ablauf der TSL-Aktualisierung entfallen. **[\<=]**

Eine erweiterte Übersicht zum Aufbau der detached-Signatur-Datei inkl. Beispiel
finden sie unter [gemGitHub_tslSig].

##### A_20750

Der Hersteller des Konnektors MUSS den Betreiber des Konnektors in geeigneter
Weise (mindestens per Handbuch-Eintrag und per Hinweis innerhalb der
UpdateInformation eines FirmwareUpdates am KSR) darüber informieren, dass im
Fall, dass eine TSL-Aktualisierung innerhalb der TI fehlschlägt, automatisch
versucht wird, eine TSL-Aktualisierung aus dem Internet vorzunehmen. **[\<=]**

### 4.1.9.3.2 TUC_KON_031 „BNetzA-VL aktualisieren“

##### TIP1-A_6729

Der Konnektor MUSS den technischen Use Case TUC_KON_031 „BNetzA-VL
aktualisieren“ umsetzen.

Tabelle261: TAB_KON_618 TUC_KON_031 „BNetzA-VL aktualisieren“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_031 „BNetzA-VL aktualisieren”

</td></tr><tr><td>
Beschreibung

</td><td>
Dieser TUC prüft die Aktualität der BNetzA-VL. Wenn eine neuere BNetzA-VL
vorliegt, wird diese heruntergeladen, geprüft und im Truststore gespeichert.

</td></tr><tr><td>
Auslöser

</td><td>
 ---> UL

</td></tr><tr><td>
Vorbedingungen

</td><td>
 ---> UL

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Nachbedingungen

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

</td></tr><tr><td>
Varianten/Alternativen

</td><td>
(



1) Wird eine zu importierende BNetzA-VL manuell übergeben (in den
Eingangsdaten), so wird diese statt des Downloads verwendet und an TUC_PKI_036
{BNetzA-VL Datei} übergeben. Innerhalb der PKI TUCs findet dann kein Download
der BNetzA-VL statt.

(



1) Ist MGM_LU_SAK=disabled, so wird der TUC ohne Fehler beendet.

</td></tr><tr><td>
Fehlerfälle

</td><td>
(



1) Tritt beim manuellen Import der Datei ein Fehler auf, wird TUC_KON_256
{„CERT/BNETZA_VL/IMPORT“; Op; Error; „$Fehlerbeschreibung“; doLog =
true; doDisp = false} ausgelöst. Fehlercode 4129.

(



1) Tritt beim periodischen Update der BNetzA-VL beim Aufruf des TUC_PKI_036 oder
eines durch ihn aufgerufenen TUCs ein Fehler auf, geht der Konnektor in den
Betriebszustand EC_BNetzA_VL_Update_Not_Successful. Fehlercode 4133.

In beiden Fällen wird eine vorhandene gültige BNetzA-VL weiter verwendet.

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
keine

</td></tr></table>

Tabelle262: TAB_KON_619 Fehlercodes TUC_KON_031 „BNetzA-VL aktualisieren“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4129

</td><td>
Technical

</td><td>
Error

</td><td>
der manuelle Import der BNetzA-Vertrauensliste schlägt fehl

</td></tr><tr><td>
4133

</td><td>
Security

</td><td>
Error

</td><td>
Import der BNetzA-Vertrauensliste fehlgeschlagen

</td></tr></table>

**[\<=]**

### 4.1.9.3.3 TUC_KON_040 „CRL aktualisieren“

##### TIP1-A_4694

Der Konnektor MUSS den technischen Use Case TUC_KON_040 „CRL aktualisieren“
umsetzen.

Tabelle263: TAB_KON_767 TUC_KON_040 „CRL aktualisieren“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_040 „CRL aktualisieren“

</td></tr><tr><td>
Beschreibung

</td><td>
Dieser TUC aktualisiert die CRL

</td></tr><tr><td>
Auslöser

</td><td>
 ---> UL

</td></tr><tr><td>
Vorbedingungen

</td><td>
 ---> UL

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
Keine

</td></tr><tr><td>
Nachbedingungen

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

 ---> OL

              topic = „CERT/CRL/UPDATED“;  
             
eventType = Op;  
              severity = Error;  
        
     parameters = „„;  
              doLog = true; 

              doDisp=false}  
aus.

 ---> OL

</td></tr><tr><td>
Varianten/  
Alternativen

</td><td>
(



1) Wird eine manuell importierte CRL übergeben, so wird diese verwendet.

</td></tr><tr><td>
Fehlerfälle

</td><td>
(



1) Tritt beim manuellen Import der Datei ein Fehler auf, wird TUC_KON_256 { 

        topic = „CERT/CRL/IMPORT“;  
        eventType =
Op;  
        severity = Error;  
        parameters =
„${Fehlerbeschreibung}“;  
        doLog = true; 

        doDisp=false}  
ausgelöst.

(



2) Signaturprüfung der CRL fehlgeschlagen: Fehlercode 4130

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
keine

</td></tr></table>

Tabelle264: TAB_KON_599 Fehlercodes TUC_KON_040 „CRL aktualisieren“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4130

</td><td>
Security

</td><td>
Error

</td><td>
Signatur- oder Gültigkeitsprüfung der CRL fehlgeschlagen

</td></tr></table>

**[\<=]**

### 4.1.9.3.4 TUC_KON_033 „Zertifikatsablauf prüfen“

##### TIP1-A_4695

Der Konnektor MUSS den technischen Use Case TUC_KON_033 „Zertifikatsablauf
prüfen” umsetzen.

Tabelle265: TAB_KON_768 TUC_KON_033 „Zertifikatsablauf prüfen“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_033 „Zertifikatsablauf prüfen“

</td></tr><tr><td>
Beschreibung

</td><td>
Dieser TUC prüft und meldet das zeitliche Ablaufen eines X.509-Zertifikats
einer Karte.

</td></tr><tr><td>
Auslöser

</td><td>
 ---> UL

</td></tr><tr><td>
Vorbedingungen

</td><td>
Keine

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
1. TUC_KON_216 „LeseZertifikat“ für:

 ---> OL

2. Das Ablaufdatum expirationDate wird aus dem Feld validity ausgelesen.  
3.
Falls das Zertifikat abgelaufen ist, Systemereignis absetzen:

 ---> UL

4. Alternativ bei Ablauf des Zertifikats innerhalb von CERT_EXPIRATION_WARN_DAYS
Systemereignis absetzen:

 ---> UL

5. expirationDate wird zurückgegeben.

</td></tr><tr><td>
Varianten/  
Alternativen

</td><td>
Keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
(1) Zur angegebenen CardSession keine Karte gefunden: Fehlercode 4131. 

(1) Für eGK, HBA, SM-B gilt: Wenn crypt=ECC und Kartengeneration\<G2.1,
bricht der TUC mit Warnung 4257 ab.  
(1) Für gSMC-K gilt: Wenn crypt=ECC
und beim Aufruf von TUC_KON_216 wird die Warnung 4256 zurückgegeben, dann wird
der TUC nach Schritt 1 beendet und die Warnung 4257 an den Aufrufer
zurückgegeben.  
(2) Extraktion des Ablaufsdatums fehlgeschlagen:
Fehlercode 4132.

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
Keine

</td></tr></table>

Tabelle266: TAB_KON_600 Fehlercodes TUC_KON_033 „Zertifikatsablauf prüfen“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4131

</td><td>
Technical

</td><td>
Error

</td><td>
Zum angegebenen CardHandle keine Karte gefunden.

</td></tr><tr><td>
4132

</td><td>
Security

</td><td>
Error

</td><td>
Extraktion des Ablaufsdatums fehlgeschlagen

</td></tr><tr><td>
4257

</td><td>
Technical

</td><td>
Warning

</td><td>
ECC-Zertifikate nicht vorhanden auf Karte: \<cardHandle\>

</td></tr></table>

**[\<=]**

### 4.1.9.4 Interne TUCs, auch durch Fachmodule nutzbar

### 4.1.9.4.1 TUC_KON_037 „Zertifikat prüfen"

##### TIP1-A_4696-02

Der Konnektor MUSS den technischen Use Case „Zertifikat prüfen“ gemäß
TUC_KON_037 „Zertifikat prüfen“ umsetzen.

Tabelle267: TAB_KON_769 TUC_KON_037 „Zertifikat prüfen“

<table><tr><th>
Element

</th><th>
Beschreibung

</th></tr><tr><td>
Name

</td><td>
TUC_KON_037 „Zertifikat prüfen“

</td></tr><tr><td>
Beschreibung

</td><td>
Der TUC beschreibt

 ---> UL

</td></tr><tr><td>
Auslöser

</td><td>
 ---> UL

</td></tr><tr><td>
Vorbedingungen

</td><td>
 ---> UL

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

Als Timeout wird beim Aufruf von TUC_PKI_018  der Wert von
CERT_OCSP_TIMEOUT_NONQES bzw. beim Aufruf von TUC_PKI_030 der Wert von
CERT_OCSP_TIMEOUT_QES übergeben (siehe auch Eingangsdaten von diesen TUCs in
[gemSpec_PKI]).

Für die QES-Zertifikatsprüfung wird das zu prüfende QES-Zertifikat an
TUC_PKI_030 „QES-Zertifikatsprüfung“ übergeben.

Wird im Aufruf der Eingangsparameter getOCSPResponses = false mit übergeben,
wird keine OCSP-Response an den Aufrufer zurückgegeben.

Als TOLERATE_OCSP_FAILURE wird beim Aufruf von TUC_PKI_018  offlineAllowNoCheck
verwendet.

Wenn der Eingangsparameter validationMode („Prüfmodus“) den Wert NONE hat,
werden die TUC_PKI_018-Eingangsparameter

 ---> UL

 ---> OL

</td></tr><tr><td>
Varianten/

Alternativen

</td><td>
</td></tr><tr><td>
Fehlerfälle

</td><td>
TUC_KON_037 im kritischen Betriebszustand EC_TSL_Out_Of_Date_Beyond_Grace_Period
aufgerufen: Fehlercode 4002.

-\> 2a) certificate ist nicht in der TSL enthalten

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Der Konnektor MUSS unter Einhaltung aller anderen Anforderungen an die
Zertifikatsprüfung die Anzahl der OCSP-Abfragen minimieren. Dies MUSS durch
Caching (unter Berücksichtigung der Grace Period) und DARF NICHT durch
Bündelung von OCSP-Anfragen geschehen.

</td></tr><tr><td>
Zugehörige

Diagramme

</td><td>
keine

</td></tr></table>

Tabelle268: TAB_KON_601 Fehlercodes TUC_KON_037 „Zertifikat prüfen“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases treten folgende
Fehlercodes auf.

</td></tr><tr><td>
4002

</td><td>
Security

</td><td>
Fatal

</td><td>
Der Konnektor befindet sich in einem kritischen Betriebszustand

</td></tr><tr><td>
4260

</td><td>
Security

</td><td>
Error

</td><td>
Zertifikat nicht vorhanden in TSL

</td></tr></table>

**[\<=]**

### 4.1.9.4.2 TUC_KON_042 „CV-Zertifikat prüfen“

##### TIP1-A_5482-01

Der Konnektor MUSS den technischen Use Case „CV-Zertifikat prüfen“ gemäß
TUC_KON_042 „CV-Zertifikat prüfen“ umsetzen.

Tabelle269: TAB_KON_818 TUC_KON_042 „CV-Zertifikat prüfen“ 

<table><tr><th>
Element

</th><th>
Beschreibung

</th></tr><tr><td>
Name

</td><td>
TUC_KON_042 „CV-Zertifikat prüfen“

</td></tr><tr><td>
Beschreibung

</td><td>
Die Gültigkeit eines (EndEntity-)CV-Zertifikats wird geprüft. Es werden
folgende Prüfungen durchgeführt:

Kryptographische Prüfung der Signaturen des End-Entity-CV-Zertifikats und des
CVC-CA-Zertifikats

 ---> UL

</td></tr><tr><td>
Auslöser

</td><td>
 ---> UL

</td></tr><tr><td>
Vorbedingungen

</td><td>
 ---> UL

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
1.  Prüfung von CV-Zertifikaten der Generation 2:

   

Die CVC-Prüfung setzt sich gemäß GS-A_5009, … GS-A_5012

   [gemSpec_PKI#8.8] aus folgenden Schritten zusammen:

        i. Prüfe die kryptographische Korrektheit der Signatur des

               CA-Zertifikats caCertificate mit dem öffentlichen
Root-

               Schlüssel der ausstellenden CVC-Root-CA. Der
benötigte

              Root-Key befindet sich im Truststore des Konnektors.

        ii. Prüfe die kryptographische Korrektheit der Signatur des

               (EndEntity-)CV-Zertifikats certificate mit dem
öffentlichen

              Schlüssel der ausstellenden CVC-CA (aus dem CVC-CA-

               Zertifikat extrahiert).

       iii. Prüfe die zeitliche Gültigkeit des
(EndEntity-)CV-Zertifikates,

               des CVC-CA-Zertifikates und CVC-Root-CA-Zertifikates

              nach dem Schalenmodell.

   2. Der Status

status

der Prüfung wird zurückgegeben.

</td></tr><tr><td>
Varianten/Alternativen

</td><td>
(



i) Mathematische Korrektheitsprüfung CV-Zertifikate mit Cross-CV-Zertifikat
(vgl. Varianten/Alternativen von TUC_KON_005)

</td></tr><tr><td>
Fehlerfälle

</td><td>
(



i) das benötigte Cross-CV-Zertifikat ist nicht vorhanden, Fehlercode 4228

(



i) kryptographische (mathematische) Prüfung des CVC-CA-Zertifikats
fehlgeschlagen, Fehlercode 4196.

(



ii) kryptographische Prüfung des (EndEntity-)CV-Zertifikats fehlgeschlagen,
Fehlercode 4196.

(



iii) zeitliche Gültigkeit eines der CV-Zertifikate ist abgelaufen, Fehlercode
4196.

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
keine

</td></tr></table>

Tabelle270: TAB_KON_819 Fehlercodes TUC_KON_042 „CV-Zertifikat prüfen“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4196

</td><td>
Technical

</td><td>
Error

</td><td>
Fehler bei der CV-Zertifikatsprüfung

</td></tr><tr><td>
4228

</td><td>
Technical

</td><td>
Error

</td><td>
das benötigte Cross-CV-Zertifikat ist nicht vorhanden

</td></tr></table>

**[\<=]**

### 4.1.9.4.3 TUC_KON_034 „Zertifikatsinformationen extrahieren“

##### TIP1-A_4697

Der Konnektor MUSS den technischen Use Case TUC_KON_034
„Zertifikatsinformationen extrahieren” umsetzen.

Tabelle271: TAB_KON_770 TUC_KON_034 „Zertifikatsinformationen extrahieren“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_034 „Zertifikatsinformationen extrahieren“

</td></tr><tr><td>
Beschreibung

</td><td>
Dieser TUC beschreibt die Extraktion der fachlich zentralen Informationen aus
bestimmten Zertifikaten einer gesteckten Karte eines Mandanten.

</td></tr><tr><td>
Auslöser

</td><td>
 ---> UL

</td></tr><tr><td>
Vorbedingungen

</td><td>
Keine

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Nachbedingungen

</td><td>
Keine

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

</td></tr><tr><td>
Varianten/Alternativen

</td><td>
Keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
(1) Wenn im Aufrufkontext (also erreichbar durch den Mandanten) zum
angegebenen CardHandle keine Karte gefunden werden kann, bricht der TUC mit
Fehlercode 4146 ab.  
(1b) Ist bei Angabe von QES=true auf der Karte keine
QES-Identität zu finden, bricht der TUC mit Fehlercode 4147 ab. Für die
Kombination QES=true mit einer eGK bricht der TUC mit Fehlercode 4148 ab
(QES-Zertifikate der eGK werden noch nicht unterstützt).  
(1) Für eGK,
HBA, SM-B gilt: Wenn crypt=ECC und Karte vom Typ \<G2.1, bricht der TUC mit
Warnung 4257 ab.  
(1) Für gSMC-K gilt: Wenn crypt=ECC und TUC_KON_216
Warnung 4256 liefert, bricht der TUC mit Warnung 4257 ab.  
(1) Wenn aus
anderen Gründen die Extraktion der Zertifikatsinformationen fehlschlägt,
bricht der TUC mit Fehlercode 4148 ab.

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
keine

</td></tr></table>

Tabelle272: TAB_KON_602 Fehlercodes TUC_KON_034 „Zertifikatsinformationen
extrahieren“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4146

</td><td>
Technical

</td><td>
Error

</td><td>
Kartenhandle existiert nicht

</td></tr><tr><td>
4147

</td><td>
Technical

</td><td>
Error

</td><td>
Zertifikat nicht vorhanden (z. B. kein QES-Zertifikat in SM-B)

</td></tr><tr><td>
4148

</td><td>
Technical

</td><td>
Error

</td><td>
Fehler beim Extrahieren von Zertifikatsinformationen

</td></tr><tr><td>
4257

</td><td>
Technical

</td><td>
Warning

</td><td>
ECC-Zertifikate nicht vorhanden auf Karte: \<cardHandle\>

</td></tr></table>

**[\<=]**

### 4.1.9.5 Operationen an der Außenschnittstelle

##### TIP1-A_4698-03

Der Konnektor MUSS Clientsystemen eine Basisanwendung Zertifikatsdienst zur
Verfügung stellen

Tabelle273: TAB_KON_771 Basisanwendung Zertifikatsdienst

<table><tr><th>
Name

</th><th colspan="2">
CertificateService

</th></tr><tr><td>
Version (KDV)

</td><td colspan="2">
6.0.0 (WSDL-Version), 6.0.1 (XSD-Version)  
6.0.1 (WSDL-Version), 6.0.2
(XSD-Version)

</td></tr><tr><td>
Namensraum

</td><td colspan="2">
Siehe GitHub

</td></tr><tr><td>
Namensraum-Kürzel

</td><td colspan="2">
CERT für Schema und CERTW für WSDL

</td></tr><tr><td rowspan="4">
Operationen

</td><td>
Name

</td><td>
Kurzbeschreibung

</td></tr><tr><td>
ReadCardCertificate

</td><td>
Zertifikat von einer Karte lesen

</td></tr><tr><td>
CheckCertificateExpiration

</td><td>
Ablaufdatum von Zertifikaten erfragen

</td></tr><tr><td>
VerifyCertificate

</td><td>
Prüfung des Status eines Zertifikats

</td></tr><tr><td>
WSDL

</td><td colspan="2">
CertificateService.wsdl (WSDL-Verion 6.0.0)  
CertificateService_v6_0_1.wsdl

</td></tr><tr><td>
Schema

</td><td colspan="2">
CertificateService.xsd (XSD-Version 6.0.1)  
CertificateService_v6_0_2.xsd

</td></tr></table>

**[\<=]**

### 4.1.9.5.1 CheckCertificateExpiration

##### TIP1-A_4699-03

Die Basisanwendung Zertifikatsdienst des Konnektors MUSS an der
Clientschnittstelle eine Operation CheckCertificateExpiration anbieten.

Tabelle274: TAB_KON_676 Operation CheckCertificateExpiration

<table><tr><th>
Name

</th><th colspan="2">
CheckCertificateExpiration

</th></tr><tr><td>
Beschreibung

</td><td colspan="2">
Gibt das Datum des Ablaufs eines bestimmten Zertifikats oder gesammelt des
Zertifikats der gSMC-K, der gSMC-KT's sowie aller gesteckten HBAx und SM-B des
Mandanten zurück.

</td></tr><tr><td rowspan="4">
Aufruf-parameter

</td><td colspan="2">
</td></tr><tr><td>
Name

</td><td>
Beschreibung

</td></tr><tr><td>
CardHandle

</td><td>
Optional. Identifiziert die Karte, deren Zertifikate geprüft werden sollen.
Wird der Parameter nicht angegeben, so werden alle für den Konnektor
erreichbaren Karten (inkl. gSMC-K und aller gSMC-KT's), die zum Mandanten
passen, berücksichtigt.  
Die Operation CheckCertificateExpiration DARF das
Lesen von Zertifikaten der eGK NICHT unterstützen.

</td></tr><tr><td>
Context

</td><td>
MandantId, CsId, WorkplaceId verpflichtend; UserId optional

</td></tr><tr><td>
Crypt

</td><td>
Optional; Default: RSA   
Gibt den kryptopraphischen Algorithmus vor, für den
das Zertifikat ermittelt werden soll.  
Wertebereich: RSA, ECC

 ---> UL

</td></tr><tr><td rowspan="3">
Rückgabe

</td><td colspan="2">
![Img-068][Img-068]

</td></tr><tr><td>
Status

</td><td>
Enthält den Ausführungsstatus der Operation.

</td></tr><tr><td>
CertificateExpiration

</td><td>
Eine Liste von Tupeln aus (CtID, CardHandle, ICCSN, subject.CommonName,
serialNumber, validity) der Zertifikate der Karten.

Für die gSMC-K soll in CertificateExpiration/CtID und
CertificateExpiration/CardHandle jeweils ein Leerstring zurückgegeben werden.

</td></tr><tr><td>
Vorbe-dingungen

</td><td colspan="2">
Keine

</td></tr><tr><td>
Nachbe-dingungen

</td><td colspan="2">
Keine

</td></tr></table>

Der Ablauf der Operation CheckCertificateExpiration ist in Tabelle TAB_KON_677
beschrieben:

Tabelle275: TAB_KON_677 Ablauf CheckCertificateExpiration

<table><tr><th>
Nr.

</th><th>
Aufruf Technischer Use Case oder Interne Operation

</th><th>
Beschreibung

</th></tr><tr><td>
1.

</td><td>
checkArguments

</td><td>
Die übergebenen Werte werden auf Konsistenz und Gültigkeit überprüft. Treten
hierbei Fehler auf, so bricht die Operation mit Fehler 4000 ab. Wird die
Operation für einen nicht unterstützten Kartentypen aufgerufen, so bricht die
Operation mit Fehler 4058 ab.

</td></tr><tr><td>
2.

</td><td>
TUC_KON_000 „Prüfe Zugriffsberechtigung“

</td><td>
Die Prüfung erfolgt durch den Aufruf  
TUC_KON_000 {  
    mandantId =
$context.mandantId;  
    clientSystemId = $context.clientsystemId; 

    workplaceId  = $context.workplaceId;  
    userId =
$context.userId;  
    cardHandle = $cardHandle  
    allWorkplaces=true 

}  
Tritt bei der Prüfung ein Fehler auf, bricht die Operation mit Fehlercode
aus TUC_KON_000 ab.

</td></tr><tr><td>
3.

</td><td>
enumerateCardHandles

</td><td>
Wenn der Parameter CardHandle übergeben wurde, wird dieser als einziges Element
in eine Liste gepackt.  
Wenn der Parameter CardHandle leer war, wird eine
Liste der CardHandles aller für den Konnektor erreichbaren Karten (inkl.
gSMC-K und gSMC-KT's), die zum Mandanten passen, erstellt.

</td></tr><tr><td colspan="3">
Für jedes CardHandle der in Schritt 3 erzeugten Liste werden folgende Schritte
ausgeführt, für die gSMC-Ks die Schritte 5 und 6:  
Falls Schritt 5 der
TUC_KON_033 die Warnung 4257 zurückgibt, wird Schritt 6 nicht ausgeführt und
die Schritte für das CardHandle der in Schritt 3 erzeugten Liste weiter
ausgeführt. Die Warnung 4257 wird über alle CardHandle akkumuliert und
\<komma-separierte List von cardHandle\> für den Fehlertext erzeugt.

</td></tr><tr><td>
4.

</td><td>
TUC_KON_026 „Liefere CardSession“

</td><td>
Ermittle CardSession über TUC_KON_026 {  
    mandatId =MandantId; 

    clientSystemId = ClientSystemId;  
    cardHandle = CardHandle; 

    userId = UserId }

</td></tr><tr><td>
5.

</td><td>
TUC_KON_033 „Zertifikatsablauf prüfen“

</td><td>
Das Gültigkeitsdatum des Zertifikats wird geprüft mit TUC_KON_033 { 

    cardSession;  
    doInformClients = false;  
    Crypt;  
} 

bzw. TUC_KON_033 {  
    checkSMCK = true;  
    doInformClients =
false;  
    Crypt;  
} 

</td></tr><tr><td>
6.

</td><td>
TUC_KON_034 „Zertifikatsinformationen extrahieren”

</td><td>
Beim Aufruf des TUC_KON_034 ist der Parameter qes = false zu setzen.  
Aus den
jeweiligen Rückgabewerten entsteht eine Liste aus Tupeln (CtID, CardHandle,
ICCSN, subject.CommonName, serialNumber, validity). Diese wird von der
Operation zurückgegeben.

</td></tr></table>

Tabelle276: TAB_KON_603 Fehlercodes „CheckCertificateExpiration“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4000

</td><td>
Technical

</td><td>
Error

</td><td>
Syntaxfehler

</td></tr><tr><td>
4058

</td><td>
Security

</td><td>
Error

</td><td>
Aufruf nicht zulässig

</td></tr><tr><td>
4257

</td><td>
Technical

</td><td>
Warning

</td><td>
ECC-Zertifikate nicht vorhanden auf Karte: \<komma-separierte List von
cardHandle\>

</td></tr></table>

**[\<=]**

### 4.1.9.5.2 ReadCardCertificate

##### TIP1-A_4700

Die Basisanwendung Zertifikatsdienst des Konnektors MUSS an der
Clientschnittstelle eine Operation ReadCardCertificate wie in Tabelle
TAB_KON_678 Operation ReadCardCertificate beschrieben anbieten.

Tabelle277: TAB_KON_678 Operation ReadCardCertificate

<table><tr><th>
Name

</th><th colspan="3">
ReadCardCertificate

</th></tr><tr><td>
Beschreibung

</td><td colspan="3">
Liest X.509-Zertifikate von einer Karte.

</td></tr><tr><td colspan="1" rowspan="6">
Aufruf-parameter

</td><td colspan="3">
</td></tr><tr><td>
Name

</td><td colspan="2">
Beschreibung

</td></tr><tr><td>
CardHandle

</td><td colspan="2">
Gibt die Karte an, von der das Zertifikat gelesen werden soll.  
Es können
Zertifikate von HBAx (HBA, HBA-VK), SM-B ausgelesen werden.  
Die Operation
ReadCardCertificate DARF das Lesen von Zertifikaten der eGK NICHT unterstützen.

</td></tr><tr><td>
Context

</td><td colspan="2">
Aufrufkontext (Mandant)

</td></tr><tr><td>
CertRefList

</td><td colspan="2">
Gibt an, welche(s) Zertifikat(e) gelesen werden soll. Mögliche Werte für
CertRef sind:  
C.AUT, C.ENC, C.SIG, C.QES

</td></tr><tr><td>
Crypt

</td><td colspan="2" rowspan="1">
Optional; Default: RSA   
Gibt den kryptographischen Algorithmus vor, für den
das Zertifikat ermittelt werden soll.  
Wertebereich: RSA, ECC

 ---> UL

</td></tr><tr><td rowspan="7">
Rückgabe

</td><td colspan="3">
</td></tr><tr><td>
Status

</td><td colspan="2">
Enthält den Ausführungsstatus der Operation.

</td></tr><tr><td>
CertRef

</td><td colspan="2">
Dieses Element beinhaltet die Referenz des Zertifikats, welches bei der Anfrage
übergeben wurde.

</td></tr><tr><td>
X509Data

</td><td colspan="2">
Inhalt des über die CertRef referenzierten Zertifikats. Ist das referenzierte
Zertifikat nicht vorhanden, so wird dieses Element nicht vom Konnektor gefüllt.

</td></tr><tr><td>
</td><td>
X509Issuer  
Name

</td><td>
Enthält den Issuer-Name des Zertifikats. Bezüglich des Encodings sind die in
[XMLDSig#4.4.4.4.1] angegebenen Regeln zu beachten (Escaping von Sonderzeichen
etc.)

</td></tr><tr><td>
</td><td>
X509Serial  
Number

</td><td>
Enthält die serialNumber des Zertifikats.

</td></tr><tr><td>
</td><td>
X509Subject  
Name

</td><td>
Enthält das Feld subject.CommonName. Bezüglich des Encodings sind die in [XML
DSig#4.4.4.4.1] angegebenen Regeln zu beachten (Escaping von Sonderzeichen etc.)

</td></tr><tr><td>
</td><td>
</td><td>
X509  
Certificate

</td><td>
Enthält das base64-codierte Zertifikat, dessen Binärstruktur wiederum
ASN.1-codiert (gemäß [COMMON_PKI]) vorliegt.

</td></tr><tr><td>
Vorbe-dingungen

</td><td colspan="3">
Keine

</td></tr><tr><td>
Nachbe-dingungen

</td><td colspan="3">
Keine

</td></tr></table>

Der Ablauf der Operation ReadCardCertificate ist in Tabelle TAB_KON_679 Ablauf
ReadCardCertificate beschrieben:

Tabelle278: TAB_KON_679 Ablauf ReadCardCertificate

<table><tr><th>
Nr.

</th><th>
Aufruf Technischer Use Case oder Interne Operation

</th><th>
Beschreibung

</th></tr><tr><td>
1.

</td><td>
checkArguments

</td><td>
Die übergebenen Werte werden auf Konsistenz und Gültigkeit überprüft. Treten
hierbei Fehler auf, so bricht die Operation mit Fehler 4000 ab.  
Wurde als
Zielkarte eine eGK adressiert, wird Fehlercode 4090 zurückgeliefert.

</td></tr><tr><td>
2.

</td><td>
TUC_KON_000 „Prüfe Zugriffs- berechtigung“

</td><td>
Die Prüfung erfolgt durch den Aufruf  
TUC_KON_000 {  
    mandantId =
$context.mandantId;  
    clientsystemId = $context.clientsystemId; 

    workplaceId  = $context.workplaceId;  
    userId =
$context.userId;  
    cardHandle = $cardHandle  
}  
Tritt bei der
Prüfung ein Fehler auf, bricht die Operation mit Fehlercode aus TUC_KON_000 ab.

</td></tr><tr><td>
3.

</td><td>
TUC_KON_026 „Liefere CardSession“

</td><td>
Ermittle CardSession über TUC_KON_026 {  
    mandatId =$context.mandantId;
 
    clientsystemId  = $context.clientsystemId;  
    cardHandle =
$context.cardHandle;  
    userId = $context.userId }

</td></tr><tr><td>
4.

</td><td>
getEF

</td><td>
Für jedes Paar von CertRef und CardHandle wird in Abhängigkeit des Parameters
Crypt gemäß Tabelle TAB_KON_858 das zu lesende File (EF) bestimmt:  
Ist die
übergebene Zertifikatsreferenz ungültig, wird Fehlercode 4149 zurückgegeben.
 
Das Lesen von Zertifikaten der eGK ist aus Sicherheitsgründen für
Clientsysteme nicht zulässig.

</td></tr><tr><td>
  

</td><td>
TUC_KON_216 „LeseZertifikat“

</td><td>
Für jedes Paar von CardHandle und EF wird nun durch Aufruf von TUC_KON_216
„LeseZertifikat“ das Zertifikat ausgelesen.  
Falls TUC_KON_216 die Warnung
4256 zurückgibt, wird die Operation abgebrochen und Fehler 4258 zurückgegeben.

</td></tr><tr><td>
6.

</td><td>
Zertifikatsattribute extrahieren

</td><td>
Aus jedem Zertifikat werden die zu liefernden Attribute extrahiert. Die
Ergebnisstruktur wird mit den erhaltenen Rückgabewerten gefüllt.

</td></tr></table>

Tabelle279: TAB_KON_604 Fehlercodes „ReadCardCertificate“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4000

</td><td>
Technical

</td><td>
Error

</td><td>
Syntaxfehler

</td></tr><tr><td>
4149

</td><td>
Technical

</td><td>
Error

</td><td>
Ungültige Zertifikatsreferenz

</td></tr><tr><td>
4090

</td><td>
Security

</td><td>
Error

</td><td>
Zugriff auf eGK nicht gestattet

</td></tr><tr><td>
4258

</td><td>
Technical

</td><td>
Error

</td><td>
ECC-Zertifikate nicht vorhanden auf Karte: \<cardHandle\>

</td></tr></table>

**[\<=]**

### 4.1.9.5.3 VerifyCertificate

##### TIP1-A_5449

Die Basisanwendung Zertifikatsdienst des Konnektors MUSS an der
Clientschnittstelle eine Operation VerifyCertificate wie in Tabelle TAB_KON_795
Operation VerifyCertificate beschrieben anbieten.

Tabelle280: TAB_KON_795 Operation VerifyCertificate

<table><tr><th>
Name

</th><th colspan="3">
VerifyCertificate

</th></tr><tr><td>
Beschreibung

</td><td colspan="3">
Prüft den Status einesZertifikats.

</td></tr><tr><td rowspan="5">
Aufruf-parameter

</td><td colspan="3">


</td></tr><tr><td>
Name

</td><td colspan="2">
Beschreibung

</td></tr><tr><td>
CCTX:Context

</td><td colspan="2">
Aufrufkontext (Mandant)

</td></tr><tr><td>
CERTCMN:X509Certificate

</td><td colspan="2">
Zu prüfendes Zertifikat (base64 kodiert), wie in Response zur Operation
ReadCardCertificate enthalten.

</td></tr><tr><td>
CERT:VerificationTime

</td><td colspan="2">
Der für die Prüfung zu verwendende Referenzzeitpunkt. Falls der Parameter
nicht angegeben ist, wird als Referenzzeitpunkt die Systemzeit verwendet.

</td></tr><tr><td rowspan="4">
Rückgabe

</td><td colspan="3">


</td></tr><tr><td colspan="2">
CONN:Status

</td><td>
Enthält den Ausführungsstatus der Operation.

</td></tr><tr><td colspan="2">
CERT:VerificationStatus

</td><td>
Enthält eines der drei möglichen Prüfungsergebnisse in CERT:VerificationResult

 ---> UL

sowie weiter Details zu den Zuständen „INCONCLUSIVE“und „INVALID“in
GERROR:Error.

</td></tr><tr><td colspan="2">
CERT:RoleList

</td><td>
OIDsderim Zertifikat gespeichertenRollen.

</td></tr><tr><td>
Vorbe-dingungen

</td><td colspan="3">
Keine

</td></tr><tr><td>
Nachbe-dingungen

</td><td colspan="3">
Keine

</td></tr></table>

Der Ablauf der Operation VerifyCertificate ist in Tabelle TAB_KON_797 Ablauf
VerifyCertificate beschrieben:

Tabelle281: TAB_KON_797 Ablauf VerifyCertificate

<table><tr><th>
Nr.

</th><th>
Aufruf Technischer Use Case oder Interne Operation

</th><th>
Beschreibung

</th></tr><tr><td>
1.

</td><td>
checkArguments

</td><td>
Die übergebenen Werte werden auf Konsistenz und Gültigkeit überprüft. Treten
hierbei Fehler auf, so bricht die Operation mit Fehler 4000 ab.

</td></tr><tr><td>
2.

</td><td>
TUC_KON_037 „Zertifikat prüfen“

</td><td>
Die Zertifikatsprüfung erfolgt durch Aufruf von TUC_KON_037. Als Parameter des
TUC-Aufrufs gilt für Zertifikate aus CERT_IMPORTED_CA_LIST: {certificate
=CERTCMN:X509CertificatequalifiedCheck=not_required;baseTime=CERT:VerificationTime;offlineAllowNoCheck=true;policyList=
keine
Einschränkung;intendedKeyUsage=empty;intendedExtendedKeyUsage=empty;gracePeriod
= empty;validationMode=NONE;ocspResponses(OCSP-Response/Liste von
OCSP-        Responses = empty }für alle anderen Zertifikate gilt:
{certifiacate
=CERTCMN:X509CertificatequalifiedCheck=if_QC_present;baseTime=CERT:VerificationTime;offlineAllowNoCheck=true;policyList=
alle zugelassenen
Zertifikatstyp-OIDs;intendedKeyUsage=empty;intendedExtendedKeyUsage=empty;gracePeriod
= empty;validationMode= OCSP;ocspResponses= empty}.

</td></tr><tr><td>
3.

</td><td>


</td><td>
Wenn der Prüfprozess fehlerhaft war und nicht zu einem Ergebnis im Sinne eines
VerificationResult führt, wirdeine FaultMessage erzeugt.War der Prüfprozess
erfolgreich, wird eine VerifyCertificateResponse mitCONN:Status/CONN:Result=OK,
demVerificationStatus(als Ergebnis der Zertifikatsprüfung)und den ermittelten
Rollen-OIDs erzeugt.Ein Prüfergebnis „INCONCLUSIVE“ bzw. „INVALID“
wirdin CERT:VerificationStatus/GERROR:Error mit den zugehörigen
Fehlermeldungen detailliert(in diesem Fall kann CONN:Status/CONN:Result=OK oder
CONN:Status/CONN:Result=Warning gesetzt sein).

</td></tr></table>

Tabelle282: TAB_KON_800 Fehlercodes „VerifyCertificate“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4000

</td><td>
Technical

</td><td>
Error

</td><td>
Syntaxfehler

</td></tr></table>

​​ **[\<=]**

### 4.1.9.6 Betriebsaspekte

### 4.1.9.6.1 TUC_KON_035 „Zertifikatsdienst initialisieren“

##### TIP1-A_4701

In der Bootup-Phase MUSS der Konnektor den Zertifikatsdienst durch Aufruf des
TUC_KON_035 „Zertifikatsdienst initialisieren“ initialisieren.

Tabelle283: TAB_KON_772 TUC_KON_035 „Zertifikatsdienst initialisieren“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_035 „Zertifikatsdienst initialisieren“

</td></tr><tr><td>
Beschreibung

</td><td>
Der TUC beschreibt den gesamten Ablauf der Initialisierung des TrustStore im
Rahmen der betrieblichen Prozesse: Prüfung der Aktualität, Integrität und
Authentizität der Einträge im TrustStore.

</td></tr><tr><td>
Auslöser

</td><td>
 ---> UL

</td></tr><tr><td>
Vorbedingungen

</td><td>
keine

</td></tr><tr><td>
Eingangsdaten

</td><td>
keine

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Nachbedingungen

</td><td>
Keine

</td></tr><tr><td>
Standardablauf

</td><td>
Für den übergebenen Status der Initialisierung des TrustStore werden folgende
Schritte durchgeführt:

 ---> OL

</td></tr><tr><td>
Varianten/  
Alternativen

</td><td>
Keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
Keine

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige  
Diagramme

</td><td>
Keine

</td></tr></table>

Tabelle284: TAB_KON_605 Fehlercodes TUC_KON_035 „Zertifikatsdienst
initialisieren“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können keine
weiteren Fehlercodes auftreten.

</td></tr></table>

**[\<=]**

##### TIP1-A_4702-04

Der Administrator MUSS die in TAB_KON_606 aufgelisteten Parameter über die
Managementschnittstelle konfigurieren und die in TAB_KON_733 aufgelisteten
Parameter ausschließlich einsehen können.

Tabelle285: TAB_KON_606 Konfiguration des Zertifikatsdienstes

<table><tr><th>
ReferenzID

</th><th>
Belegung

</th><th>
Bedeutung

</th></tr><tr><td>
CERT_TSL_DEFAULT_  
GRACE_PERIOD_DAYS

</td><td>
X Tage

</td><td>
Default Grace Period TSL in Tagen

Gibt an, wie viele Tage der Konnektor mit einer zeitlich abgelaufenen TSL weiter
betrieben werden kann.

Der Wert MUSS zwischen 1 und 30 Tagen liegen.

Default-Wert = 30 Tage

Hinweis: Vor dem zeitlichen Ablauf einer TSL wird mit ausreichendem Vorlauf eine
neue TSL verteilt. Sollte die TSL dennoch ablaufen und der Konfigurationswert
überschritten werden, kann eine neue TSL immer noch lokal geladen werden
(TIP1-A_4705 „TSL manuell importieren“).

</td></tr><tr><td>
CERT_OCSP_DEFAULT_  
GRACE_PERIOD_  
NONQES

</td><td>
X Minuten

</td><td>
Default Grace Period OCSP für nonQES in Minuten.

Der Wert MUSS zwischen 0 und 20 Minuten liegen.

Default-Wert = 10 Minuten

</td></tr><tr><td>
CERT_OCSP_TIMEOUT_  
NONQES

</td><td>
X Sekunden

</td><td>
Timeout für OCSP-Abfragen bei der Prüfung von nonQES-Zertifikaten.

Der Wert MUSS zwischen 1 und 120 Sekunden liegen.

Default-Wert = 10 Sekunden

</td></tr><tr><td>
CERT_OCSP_TIMEOUT_  
QES

</td><td>
X Sekunden

</td><td>
Timeout für OCSP-Abfragen bei der Prüfung von QES-Zertifikaten.

Der Wert muss zwischen 1 und 120 Sekunden liegen.

Default-Wert = 10 Sekunden

</td></tr><tr><td>
CERT_EXPIRATION_  
WARN_DAYS

</td><td>
X Tag(e)

</td><td>
Warnung X Tage vor Ablauf von Zertifikaten im Managementinterface und per
Ereignis.

Der Wert muss zwischen 0 und 180 Tagen (0=keine Warnung) liegen.

Default-Wert = 90 Tage

</td></tr><tr><td>
CERT_EXPIRATION_  
CARD_CHECK_DAYS

</td><td>
X Tag(e)

</td><td>
Alle X Tage wird der Ablauf aller gesteckten Karten überprüft. Der Wert muss
zwischen 0 und 365 liegen (0=kein Check).

Default-Wert = 1 Tag

</td></tr><tr><td>
CERT_IMPORTED_  
CA_LIST

</td><td>
Liste von manuell importierten CA-Zertifikaten

</td><td>
Der Administrator MUSS CA-Zertifikate importieren, anzeigen und löschen
können. Der Konnektor DARF CA-Zertifikate zur Ableitung von QES-Zertifikaten
NICHT importieren.

Default-Wert = leere Liste

</td></tr><tr><td>
CERT_BNETZA_VL_  
UPDATE_INTERVAL

</td><td>
X Stunden

</td><td>
Intervall, in dem die BNetzA VL auf Aktualität geprüft  werden muss. Der
Wert MUSS zwischen 1 Stunde und 168 Stunden (7 Tage) liegen.

Default-Wert = 24 Stunden

</td></tr><tr><td>
CERT_TSL_DOWNLOAD_ADDRESS_INTERNET_BU

</td><td>
1 URI

</td><td>
Konfigurierbare Backup Adresse der TSL im Internet

</td></tr><tr><td>
CERT_TSL_IP_ADDRESS_INTERNET_BU

</td><td>
1 URI

</td><td>
Konfigurierbare Backup Adresse der TSL im Internet (enthält IP-Adresse des
Hosts statt FQDN).  
Wird verwendet, falls Auflösen der FQDN mittels DNS bei
CERT_TSL_DOWNLOAD_ADDRESS_INTERNET_BU  
fehlschlägt.

</td></tr></table>

Tabelle286: TAB_KON_733 Einsehbare Konfigurationsparameter des
Zertifikatsdienstes

<table><tr><th>
ReferenzID

</th><th>
Belegung

</th><th>
Bedeutung

</th></tr><tr><td>
CERT_CRL_DOWNLOAD_ADDRESS

</td><td>
2 URIs

</td><td>
Download-Adressen für die CRL

</td></tr><tr><td>
CERT_OCSP_FORWARDER_ADDRESS

</td><td>
2 FQDNs

</td><td>
Adressen der OCSP-Forwarder (HTTPS-Proxy) beim Zugangsdienstprovider

Der Administrator muss in geeigneter Weise einen Test auslösen können, ob
einer der Server per ICMP-Echo (ping) erreichbar ist und ob ein (beliebiger)
OCSP-Request zu einer erhaltenen OCSP-Antwort führt.

</td></tr><tr><td>
CERT_OCSP_FORWARDER_PORT

</td><td>
TCP-Port

</td><td>
TCP-Port des OCSP-Forwarders (HTTPS-Proxy) beim Zugangsdienstprovider

</td></tr><tr><td>
CERT_TSL_DOWNLOAD_ADDRESS_INTERNET

</td><td>
1 URI

</td><td>
Adresse der TSL im Internet gemäß gemSpec_TSL

</td></tr><tr><td>
CERT_TSL_IP_ADDRESS_INTERNET

</td><td>
1 URI

</td><td>
Adresse der TSL im Internet gemäß gemSpec_TSL (enthält IP-Adresse des Hosts
statt FQDN).

Wird verwendet, falls Auflösen der FQDN mittels DNS bei
CERT_TSL_DOWNLOAD_ADDRESS_INTERNET

fehlschlägt.

</td></tr></table>

**[\<=]**

##### TIP1-A_4703-01

Das Managementinterface des Konnektors MUSS einem authentisierten Administrator
die Anzeige des Status des Vertrauensraums in Form folgender Daten anbieten:
Sequenznummer der aktuellen TSL, StatusStartingTime (des TSPService
(TSL-Signer-CA-Dienst) zum aktuell gültigen, aktiven TI-Vertrauensanker),
NextUpdate, Gültigkeit der TSL, Typ der TSL (RSA oder ECC-RSA)) sowie optional
für den Administrator einsehbar der Fingerprint des TSL-Signer-Zertifikats.
**[\<=]**

Der Typ der TSL liefert dem Administrator die Information, ob es sich um eine
TSL handelt, die den TI-Vertrauensraum ausschließlich für Zertifikate mit
kryptographischen Verfahren nach RSA-2048 (TSL(RSA)) oder für Zertifikate mit
kryptographischen Verfahren nach RSA-2048 und ECC-256 (TSL(ECC-RSA))
bereitstellt. Die Information kann aus der Signatur der TSL ermittelt werden.

##### TIP1-A_6733

Das Managementinterface des Konnektors MUSS einem authentisierten Administrator
die Anzeige des Status der BNetzA-VL in Form folgender Daten anbieten:
Sequenznummer, NextUpdate, Gültigkeitsstatus und Zeitpunkt der letzten
Prüfung der Aktualität durch TUC_KON_031. **[\<=]**

##### TIP1-A_4704

Der Administrator MUSS einen Prüflauf auf den innerhalb von
CERT_EXPIRATION_WARN_DAYS Tagen bevorstehenden Ablauf von Zertifikaten aller
für den Konnektor erreichbaren Karten (inkl. gSMC-K) an zentraler Stelle in
der Managementschnittstelle auslösen können und das Ergebnis angezeigt
bekommen.Der Konnektor MUSS die Gültigkeitsdauer der Zertifikate aller
gesteckten Karten (inkl. gSMC-K) prüfen mittels Aufruf von:für
gSMC-KTUC_KON_033{checkSMCK; doInformClients=Nein; crypt =
ECC}TUC_KON_033{checkSMCK; doInformClients=Nein; crypt = RSA}für jede
gesteckte G2.0 Karte
außer gSMC-KTUC_KON_033{cardSession; doInformClients=Nein; crypt = RSA}für
jede gesteckte ab G2.1 Karte
außer gSMC-KTUC_KON_033{cardSession; doInformClients=Nein; crypt =
ECC}TUC_KON_033{cardSession; doInformClients=Nein; crypt = RSA} **[\<=]**

##### A_18931

Der Konnektor MUSS dem Administrator die X.509-Zertifikate der verbauten gSMC-Ks
 gemäß TIP1-A_4506 anzeigen. Aus der Anzeige MUSS der
Personalisierungs-Status der X.509-Zertifikate ersichtlich sein (dual RSA- und
ECC-personalisiert oder nur RSA-personalisiert). **[\<=]**

##### TIP1-A_4705

Der Konnektor MUSS es dem Administrator ermöglichen, eine TSL manuell von
lokaler Datenquelle einzuspielen. Dabei MUSS der Konnektor
TUC_KON_032{TSL-Datei} mit der manuell importierten TSL aufrufen.

Der Konnektor MUSS den manuellen Import einer TSL auch ermöglichen, wenn er
sich im kritischen Betriebszustand EC_TSL_Out_Of_Date_Beyond_Grace_Period
befindet.

Der Konnektor MUSS den manuellen Import einer zeitlich abgelaufenen TSL
zulassen.  **[\<=]**

Auch im Fall des automatischen Imports der TSL muss dies im kritischen
BetriebszustandEC_TSL_Out_Of_Date_Beyond_Grace_Periodunterstützt werden.

##### A_20536

Der Konnektor MUSS den automatischen Import einer TSL auch ermöglichen, wenn er
sich im kritischen
BetriebszustandEC_TSL_Out_Of_Date_Beyond_Grace_Periodbefindet.  **[\<=]**

##### A_20748

Falls der Konnektor im kritischen
Betriebszustand EC_TSL_Out_Of_Date_Beyond_Grace_Period ist, und
falls onlineMode = ENABLED ist, MUSS der Konnektor periodisch und in der
BootUp Phase die TSL aktualisieren. **[\<=]**

##### TIP1-A_6728

Der Konnektor MUSS es dem Administrator ermöglichen, die BNetzA-VL manuell von
lokaler Datenquelle einzuspielen. Dabei MUSS der Konnektor
TUC_KON_031{BNetzA-VL-Datei} mit der manuell importierten BNetzA-VL-Datei
aufrufen. **[\<=]**

##### TIP1-A_4706

Der Konnektor SOLL es dem Administrator ermöglichen, eine CRL manuell von einer
lokalen Datenquelle einzuspielen. In dem Fall MUSS der Konnektor
TUC_KON_040{CRL-Datei} mit der manuell importierten CRL aufrufen. **[\<=]**

Für die ECC-Migration ist es notwendig den ECC-RSA-Vertrauensraum zu
etablieren. Dies erfolgt durch das Einspielen eines TSL-Signer-CA
Cross-Zertifikats und das neue TSL-Signer-CA-Zertifikat, wodurch der
ECC-Vertrauensanker im Konnektor im sicheren Datenspeicher gespeichert wird.
Die Prüfung des Cross-Zertifikats erfolgt durch A_17821 - Wechsel des
Vertrauensraumes mittels Cross-Zertifikaten (ECC-Migration). Danach kann die
TSL(ECC-RSA) importiert werden. Das Ergebnis ist ein etablierter
TI-Vertrauensraum für ECC und RSA.Konnektoren müssen den ECC-Vertrauensraum
automatisiert und im Rahmen des Upgrades auf PTV4 etablieren. Manuelle Schritte
durch den Administrator sind für den Regelfall zu vermeiden und sollten nur im
Fehlerfall nötig werden. Als Fallback-Lösung muss das manuelle Verfahren
dennoch unterstützt werden.

##### A_20469-02

In der BootUp-Phase MUSS ein Konnektor, der den RSA-Vertrauensraum (RSA)
verwendet, überprüfen, ob die TSL(ECC-RSA) und die entsprechenden
TSL-Signer-CA Cross-Zertifikate sowie TSL-Signer-CA-Zertifikate verfügbar
sind und MUSS sie im positiven Fall automatisiert herunterladen, nach
erfolgreicher Prüfung verwenden und dadurch den ECC-Vertrauensraum (ECC-RSA)
etablieren.Der Konnektor MUSS hierzu die Downloadpunkte, die mit A_17680-01 in
[gemSpec_TSL#6.3.1.2] definiert sind, verwenden.Falls beim Wechsel auf den 
ECC-RSA Vertrauensraum ein Fehler auftritt, MUSS der Konnektor weiterhin den
RSA-Vertrauensraum (RSA) verwenden. **[\<=]**

##### A_20508-01

Der Konnektor MUSS alle Schritte, die er zur Etablierung des
ECC-RSA-Vertrauensraums durchläuft, im Systemprotokoll des Konnektors mit dem
Log-Level "Warning" protokollieren. **[\<=]**

##### A_17345

Der Konnektor MUSS es dem Administrator ermöglichen, ein TSL-Signer-CA
Cross-Zertifikat und das TSL-Signer-CA-Zertifikat für den neuen
TI-Vertrauensanker manuell von lokaler Datenquelle einzuspielen.    **[\<=]**

##### A_17837-01

Um auf Basis des bereits etablierten Vertrauensankers (RSA) in den
Vertrauensraum (ECC-RSA) zu wechseln MUSS der Konnektor bei der Initialisierung
des neuen Vertrauensankers (ECC-RSA) Cross-Zertifikate verwenden. Das Ergebnis
ist ein neuer etablierter TI-Vertrauensanker (ECC-RSA). **[\<=]**

##### A_17548-01

Der Konnektor MUSS den neuen TI-Vertrauensanker im sicheren Datenspeicher
speichern. **[\<=]**

##### A_17549-01

Der Konnektor MUSS den Import des TSL-Signer-CA Cross-Zertifikats auch
ermöglichen, wenn er sich im kritischen Betriebszustand
EC_TSL_Out_Of_Date_Beyond_Grace_Period befindet.  **[\<=]**

##### A_17550-01

Falls der Import des TSL-Signer-CA Cross-Zertifikats nicht erfolgreich
durchgeführt werden konnte, MUSS der Konnektor den Vorgang abbrechen und einen
Fehler gemäß TAB_KON_857 dem Administrator zur Anzeige bringen und
protokollieren.

Tabelle287: TAB_KON_857 - Fehlercodes beim Import des Cross-Zertifikats für
TI-Vertrauensanker ECC

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td>
4255

</td><td>
Security

</td><td>
Error

</td><td>
Fehler beim Import des TSL-Signer-CA Cross-Zertifikats

</td></tr></table>

**[\<=]**

##### TIP1-A_5700

Beim Auftreten des Events NETWORK/VPN_TI/UP MUSS der Konnektor über DNS die
Adressen des http-Forwarders des VPN-Zugangsdienststandortes ermitteln (SRV-RR
mit Bezeichner "_ocsp._tcp.\<DOMAIN_SRVZONE_TI\>). **[\<=]**

##### A_21158

Der Konnektor MUSS mindestens 20 CV-Crosszertifikate verwalten und verarbeiten
können. **[\<=]**

### 4.1.10 Protokollierungsdienst

Der Protokollierungsdienst protokolliert system- und sicherheitsrelevante
Ereignisse, sowie Ereignisse im Kontext der Performancemessung (siehe
[gemSpec_Perf#4.1.2), innerhalb des Konnektors. Auch Ereignisse von Fachmodulen
können protokolliert werden. Im Sicherheitsprotokoll werden alle Ereignisse
eingetragen, die Auswirkungen auf Sicherheitsmerkmale des Konnektors haben
können (Änderungen an der Firewall-Konfiguration, Authentisierungsfehler
etc.). Ereignisse im Kontext der Performancemessung innerhalb des Konnektors
werden in das Konnektor-Performanceprotokoll geschrieben. Ereignisse im Kontext
der Performancemessung von Fachmodulen werden in das
Fachmodul-Performanceprotokoll geschrieben. Alle anderen Ereignisse werden in
das Systemprotokoll oder die Fachmodulprotokolle geschrieben (grundsätzlich
trifft die Entscheidung über den zu verwendenden Protokollspeicher der
Aufrufer des Protokolldienstes).

Die Protokolle werden persistiert.

Hinweis:Ereignisse im Protokollierungsdienst adressieren nicht nur zu
protokollierende Events im Sinne des Systeminformationsdienstes sondern alles,
was zu einem Protokolleintrag führen soll (z.B. Fehler, Informationen zu
Ablauf, Debug, Performance).

Innerhalb des Protokollierungsdienstes werden folgende Präfixe für Bezeichner
verwendet:

 ---> UL

### 4.1.10.1 Funktionsmerkmalweite Aspekte

##### TIP1-A_4708

Der Konnektor MUSS einen Protokollierungsdienst anbieten. Dabei MUSS der
Konnektor zwischen System- und Sicherheitsprotokoll, sowie Fachmodulprotokollen
unterscheiden. Je Fachmodul MUSS ein getrenntes Protokoll vorhanden sein.

Die Protokolleinträge MÜSSEN durch den Konnektor lokal persistiert werden. **[\<=]**

##### TIP1-A_5654

Der Konnektor MUSS herstellerspezifische Fehler, die Auswirkungen auf
Sicherheitsmerkmale des Konnektors haben, in das Sicherheitsprotokoll schreiben. **[\<=]**

##### TIP1-A_4709

Der Konnektor MUSS sicherstellen, dass Einträge in das Sicherheitsprotokoll
nicht von außen und nicht durch den Administrator verändert und gelöscht
werden können. **[\<=]**

##### TIP1-A_4710

Der Konnektor DARF medizinische Daten NICHT in die Protokolldateien
schreiben.Personenbezogene Daten DÜRFEN NICHT in Protokolleinträgen
gespeichert werden.KVNR, ICCSN und CardHolderName MÜSSEN als personenbezogene
Daten behandelt werden.Die ICCSN DARF Im Fehlerfall durch Fachmodule in
Protokolleinträgen gespeichert werden. Die ICCSN DARF NICHT im
Sicherheitsprotokoll gespeichert werden. **[\<=]**

##### TIP1-A_6479

Der Konnektor DARF vertrauliche Daten NICHT in die Protokolldateien schreiben. **[\<=]**

##### TIP1-A_4711

Der Konnektor MUSS über eine Speichergröße für
Protokolldateienverfügen,sodass Einträge (protokollierte Ereignisse ab der
Schwere „Warning“) über einen Zeitraum von bis zu einem Jahr darin
vorgehalten werden können. **[\<=]**

Da sich die Menge an Einträgen nach der Größe der Einsatzumgebung richtet,
ist die Speichergröße nach den in [gemSpec_Perf#3.1.1] beschriebenen
Einsatzumgebungen (LE-Ux, x=1,2,3,4) ausreichend zu wählen.

##### TIP1-A_4712

WennLOG_SUCCESSFUL_CRYPTO_OPS= Enabled MUSS der Konnektor die folgenden
erfolgreich durchlaufenen Außenoperationen protokollieren: - SignDocument, -
VerifyDocument, - ExternalAuthenticate, - EncryptDocument, -
DecryptDocument.Dazu MUSS erTUC_KON_256 {     topic =
„LOG/CRYPTO_OP“;     eventType = Sec;     severity = Info;    
parameters =
(„Operation=$Operationsname,                          
\<für alle betroffenen
Schlüssel:\>                                
Karte=$ICCSN,                                
Keyref=\<Referenz auf den
Schlüssel\>,                                
CARD_HANDLE=$CardHandle,                                
CardHolderName=$CardHolderName“);                                
doDisp = false}aufrufen. **[\<=]**

##### TIP1-A_4713

WennLOG_LEVEL_SYSLOG= Info MUSS der Konnektor herstellerspezifische
Informationen über den laufenden Betrieb in das Systemprotokoll eintragen, um
im Bedarfsfall das Verhalten des Konnektors analysieren zu können
(Unterstützung der Fehlersuche etc.).

Die Häufigkeit und der Inhalt der protokollierten Informationen sind
herstellerspezifisch. **[\<=]**

##### TIP1-A_4714

Der Konnektor MUSS Protokolleinträge so anlegen, dass eine Analyse der
Einträge unterstützt wird:

 ---> UL

**[\<=]**

### 4.1.10.2 Durch Ereignisse ausgelöste Reaktionen

Keine.

### 4.1.10.3 Interne TUCs, nicht durch Fachmodule nutzbar

Keine.

### 4.1.10.4 Interne TUCs, auch durch Fachmodule nutzbar

### 4.1.10.4.1 TUC_KON_271 „Schreibe Protokolleintrag“

##### TIP1-A_4715

Der Konnektor MUSS den technischen Use Case TUC_KON_271 „Schreibe
Protokolleintrag” umsetzen.

Tabelle288: TAB_KON_607 – TUC_KON_271 „Schreibe Protokolleintrag“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_271 „Schreibe Protokolleintrag“

</td></tr><tr><td>
Beschreibung

</td><td>
Dieser TUC schreibt einen Eintrag in ein Protokoll.

</td></tr><tr><td>
Auslöser

</td><td>
Aufruf durch Basisdienst, Fachmodul oder TUC_KON_256 „Systemereignis
absetzen“

</td></tr><tr><td>
Vorbedingungen

</td><td>
Im Fall eines zu protokollierenden Ereignisses des Systeminformationsdienstes
wird

 ---> UL

 ---> UL

 ---> UL

</td></tr><tr><td>
Eingangs  
anforderung

</td><td>
Keine

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
Keine

</td></tr><tr><td>
Nachbedingungen

</td><td>
</td></tr><tr><td>
Standardablauf

</td><td>
 1.      Wenn eventType = Sec, so wird das Ereignis in das  
  
Sicherheitsprotokoll geschrieben. Falls fmName angegeben ist, wird  
     er
dem Eintrag hinzugefügt.  
 2.      fmName ist angegeben (durch ein
Fachmodul aufgerufen) und  
    eventType = „Op“, so wird das Ereignis
in das zugehörige  
    Fachmodulprotokoll geschrieben.  
 a. 
          Gemäß den Festlegungen in den jeweiligen  
   
Fachmodulspezifikationen (FM_\<fmName\>_LOG_LEVEL), werden  
    nur
Ereignisse in das Fachmodulprotokoll geschrieben, deren  
    severity
mindestens dem jeweils dort festgelegten Wert entsprechen.  
 3.     fmName
ist nicht angegeben (Aufruf durch ein Fachmodul) und  
    eventType =
„Op“, dann wird das Ereignis in das Systemprotokoll  
    geschrieben. 

 a.            Gemäß den Festlegungen in LOG_LEVEL_SYSLOG 

    werden nur Ereignisse in das Systemprotokoll geschrieben, deren 

    Schwere mindestens dem Wert von LOG_LEVEL_SYSLOG  
    entsprechen. 

 4.    Wurde der TUC durch ein Fachmodul aufgerufen (fmName ist  
   
angegeben) und ist eventType = Perf, so wird das Ereignis in das  
   
zugehörige Fachmodul-Performanceprotokoll geschrieben.  
 5.    Wurde der
TUC nicht durch ein Fachmodul aufgerufen (fmName  
    ist nicht angegeben)
und ist eventType = Perf, so wird das Ereignis  
    in das
Konnektor-Performanceprotokoll geschrieben.  
     Die geschriebenen
Protokolleinträge MÜSSEN mindestens folgende  
    Attribute beinhalten:

 ---> UL

      Die Speicherung erfolgt rollierend.

Übersteigt die Anzahl der Einträge im Sicherheitsprotokoll

SECURITY_LOG_SIZE

, so werden ältere Einträge überschrieben. Für die anderen Protokolle
beginnt das Überschreiben, wenn der jeweilige Speicherplatz für das Protokoll
erschöpft ist. Dabei werden die nach der Reihenfolge der Erstellung ältesten
Einträge überschrieben, unabhängig vom Zeitstempel des Logeintrags.

Ist der Zeitstempel eines überschriebenen Logeintrags jünger als LOG_DAYS bzw.
FM_\<fmName\>_LOG_DAYS bzw. SECURITY_LOG_DAYS, so wird der Fehlerzustand
EC_LOG_OVERFLOW ausgelöst.

</td></tr><tr></tr><tr><td>
Fehlerfälle

</td><td>
Fehler in den folgenden Schritten des Standardablaufs führen zu:  
a)  Aufruf
von  
     TUC_KON_256 {  
        topic = „LOG/ERROR“;  
     
   eventType = $ErrorType;  
         severity = $Severity;  
     
   parameters = („Error=$Fehlercode, Bedeutung=$Fehlertext“);  
     
   doLog = false }  
b)  Abbruch der Verarbeitung mit den ausgewiesenen
Fehlercodes  
(1)    In das Sicherheitsprotokoll kann nicht geschrieben
werden: Fehlercode: 4152  
(2)    In das Fachmodulprotokoll kann nicht
geschrieben werden: Fehlercode: 4151  
(3)    In das Systemprotokoll
kann nicht geschrieben werden: Fehlercode: 4150  
(4)    In das
Fachmodul-Performanceprotokoll kann nicht geschrieben werden: Fehlercode: 4217 

(5)    In das Konnektor-Performanceprotokoll kann nicht geschrieben
werden: Fehlercode: 4216

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
Keine

</td></tr></table>

Tabelle289: TAB_KON_608 Fehlercodes TUC_KON_271 „Schreibe Protokolleintrag“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4150

</td><td>
Technical

</td><td>
Fatal

</td><td>
Fehler beim Schreiben des Systemprotokolls

</td></tr><tr><td>
4151

</td><td>
Technical

</td><td>
Fatal

</td><td>
Fehler beim Schreiben eines Fachmodulprotokolls

</td></tr><tr><td>
4152

</td><td>
Security

</td><td>
Error

</td><td>
Fehler beim Schreiben des Sicherheitsprotokolls

</td></tr><tr><td>
4216

</td><td>
Technical

</td><td>
Fatal

</td><td>
Fehler beim Schreiben des Konnektor-Performanceprotokolls

</td></tr><tr><td>
4217

</td><td>
Technical

</td><td>
Fatal

</td><td>
Fehler beim Schreiben eines Fachmodul-Performanceprotokolls

</td></tr></table>

**[\<=]**

Die Darstellung PIC_KON_118 veranschaulicht den Aufbau der Protokolle für
Plattform und Fachmodule und die Steuerung der Protokolleinträge in
TUC_KON_271 „Schreibe Protokolleintrag“.

![Abbildung-20][Abbildung-20]

### 4.1.10.5 Operationen an der Außenschnittstelle

Keine

### 4.1.10.6 Betriebsaspekte

##### TIP1-A_4716

Der Administrator MUSS die durch den Protokollierungsdienst geschriebenen
Protokolle über die Managementschnittstelle einsehen können.

Eine Veränderung des Sicherheitsprotokolls DARF für den Administrator NICHT
möglich sein.

Das Löschen folgender Protokolle MUSS für den Administrator möglich sein:

 ---> UL

Der Konnektor MUSS den Export von Protokolleinträgen oder ganzen
Protokolldateien unterstützen.

Der Konnektor SOLL das Sortieren und Filtern der Protokolleinträge sowie das
Suchen in den Protokolleinträgen unterstützen. **[\<=]**

##### TIP1-A_4996

Nachdem sich der Administrator an der Managementschnittstelle angemeldet hat,
MUSS der Konnektor ihn automatisch auf Sicherheitsprotokolleinträge hinweisen,
die seit dem Ausloggen dieses Administrator aufgelaufen sind. **[\<=]**

##### TIP1-A_4717

Die Managementschnittstelle MUSS es einem Administrator ermöglichen
Konfigurationsänderungen gemäß Tabelle TAB_KON_609 vorzunehmen:

Tabelle290: TAB_KON_609 Konfigurationswerte des Protokollierungsdienstes
(Administrator)

<table><tr><th>
ReferenzID

</th><th>
Belegung

</th><th>
Bedeutung und Administrator-Interaktion

</th></tr><tr><td>
LOG_LEVEL_  
SYSLOG

</td><td>
Info, Warning, Error, Fatal

</td><td>
Der Administrator MUSS den Detaillierungsgrad des Systemprotokolls durch
Festlegung der Mindest-Schwere zu protokollierender Einträge festlegen können.

Default-Wert: Warning

</td></tr><tr><td>
FM_\<fmName\>_  
LOG_LEVEL

</td><td>
Debug, Info, Warning, Error, Fatal

</td><td>
Der Administrator MUSS den Detaillierungsgrad des Fachmodulprotokolls durch
Festlegung der Mindest-Schwere zu protokollierender Einträge festlegen können.

Default-Wert: Warning

</td></tr><tr><td>
SECURITY_LOG_SIZE

</td><td>
X Einträge

</td><td>
Der Administrator MUSS die Größe des Sicherheitsprotokolls angeben können
(Anzahl der Einträge im Ringbuffer). 

Mindestgröße: \>= 10.000

Maximalgröße: herstellerspezifisch

Default-Wert: \>= 50.000

</td></tr><tr><td>
SECURITY_LOG_DAYS

</td><td>
X Tage

</td><td>
Der Administrator MUSS die erwartete Anzahl der im Sicherheitsprotokoll
gespeicherten Tage im Bereich 10 bis 365 konfigurieren können.

Default-Wert: 180

</td></tr><tr><td>
LOG_DAYS

</td><td>
X Tage

</td><td>
Der Administrator MUSS die Anzahl der gespeicherten Tage für

das Systemprotokoll und das Performanceprotokoll 

festlegen können.

 Der Konnektor kann Protokolleinträge, die älter als LOG_DAYS sind, zyklisch
löschen.

Dabei DARF der eingestellte Wert NICHT unter der Mindestgröße von 10 Tagen
oder über der Maximalgröße von einem Jahr (365 Tage) liegen.

Default-Wert: 180

</td></tr><tr><td>
FM_\<fmName\>_  
LOG_DAYS

</td><td>
X Tage

</td><td>
Der Administrator MUSS die Anzahl der gespeicherten Tage für die
fachmodulspezifischen Protokolle festlegen können.

Es kann je Fachmodul einen Konfigurationsparameter für LOG_DAYS geben, der
gemeinsam für das Fachmodulprotokoll und das Fachmodul-Performanceprotokoll
gilt.

Der Konnektor kann Protokolleinträge, die älter als FM_\<fmName\>LOG_DAYS
sind, zyklisch löschen.

Dabei DARF der eingestellte Wert NICHT unter der Mindestgröße von 10 Tagen
oder über der Maximalgröße von einem Jahr (365 Tage) liegen.

Default-Wert: 180

Die Definition des fachmodulspezifischen Konfigurationswertes ist Bestandteil
der entsprechenden Fachmodulspezifikation.

Ist kein fachmodulspezifischer Konfigurationsparameter spezifiziert, dann gilt
LOG_DAYS.

</td></tr><tr><td>
LOG_SUCCESSFUL_  
CRYPTO_OPS

</td><td>
Enabled/Disabled

</td><td>
Der Administrator MUSS festlegen können, ob auch erfolgreich ausgeführte
Kryptooperationen im Sicherheitslog protokolliert werden sollen.

Default-Wert: Disabled

</td></tr></table>

**[\<=]**

### 4.1.10.6.1 TUC_KON_272 „Initialisierung Protokollierungsdienst

##### TIP1-A_4718

Der Konnektor MUSS den technischen Use Case TUC_KON_272 „Initialisierung
Protokollierungsdienst” umsetzen.

Tabelle291: TAB_KON_610 – TUC_KON_272 „Initialisierung
Protokollierungsdienst“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_272 „Initialisierung Protokollierungsdienst”

</td></tr><tr><td>
Beschreibung

</td><td>
Der Konnektor muss zum Bootup den Protokollierungsdienst starten und die
Existenz und Schreibbarkeit der Protokolle sicherstellen.

</td></tr><tr><td>
Eingangs  
anforderung

</td><td>
Keine

</td></tr><tr><td>
Auslöser und Vorbedingungen

</td><td>
Bootup

</td></tr><tr><td>
Eingangsdaten

</td><td>
Keine

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
Keine

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

</td></tr><tr><td>
Varianten/  
Alternativen

</td><td>
Keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
Fehler in den folgenden Schritten des Standardablaufs führen zu:

a)         Aufruf von TUC_KON_256 mit folgenden Parametern {  
  
     topic = „LOG/ERROR“;  
        eventType = $ErrorType;  
   
    severity = $Severity;  
        parameters = („Error=$Fehlercode,
Bedeutung=$Fehlertext“);  
        doLog = false }

b)         Abbruch der Verarbeitung mit den ausgewiesenen Fehlercodes

     

(



1)    Zugriff nicht möglich: Fehlercode: 4153

     

(



2)    Zugriff nicht möglich: Fehlercode: 4154

     

(



3)    Zugriff nicht möglich: Fehlercode: 4155

     

(



4)    Zugriff nicht möglich: Fehlercode: 4218

     

(



5)    Zugriff nicht möglich: Fehlercode: 4219

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
Keine

</td></tr></table>

Tabelle292: TAB_KON_611 Fehlercodes TUC_KON_272 „Initialisiere
Protokollierungsdienst“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4153

</td><td>
Technical

</td><td>
Fatal

</td><td>
Zugriff auf Sicherheitsprotokoll nicht möglich

</td></tr><tr><td>
4154

</td><td>
Technical

</td><td>
Fatal

</td><td>
Zugriff auf Systemprotokoll nicht möglich

</td></tr><tr><td>
4155

</td><td>
Technical

</td><td>
Fatal

</td><td>
Zugriff auf Fachmodulprotokolle nicht möglich

</td></tr><tr><td>
4218

</td><td>
Technical

</td><td>
Fatal

</td><td>
Zugriff auf Konnektor-Performanceprotokoll nicht möglich

</td></tr><tr><td>
4219

</td><td>
Technical

</td><td>
Fatal

</td><td>
Zugriff auf Fachmodul-Performanceprotokoll nicht möglich

</td></tr></table>

**[\<=]**

### 4.1.11 TLS-Dienst

Fachmodule müssen gesicherte Verbindungen zu Fachdiensten in der TI aufbauen
können. Dabei sollen sie sich mit einer Organisationsidentität (einer SM-B)
authentisieren können. Der TLS-Dienst stellt hierfür TUCs für einen
TLS-Verbindungsaufbau und -Verbindungsabbau zur Verfügung. Die gesicherte
Kommunikation selbst erfolgt dann durch das Fachmodul unter Nutzung der
etablierten Verbindung.

Die Funktionalität steht nur zur Verfügung, wenn MGM_LU_ONLINE aktiv ist
(siehe Kapitel 4.3.6)

### 4.1.11.1 Funktionsmerkmalweite Aspekte

### 4.1.11.2 Durch Ereignisse ausgelöste Reaktionen

##### TIP1-A_4719

Tritt das Ereignis „MGM/LU_CHANGED/LU_ONLINE“ ein, so MUSS

 ---> UL

**[\<=]**

### 4.1.11.3 Interne TUCs, nicht durch Fachmodule nutzbar

Keine.

### 4.1.11.4 Interne TUCs, auch durch Fachmodule nutzbar

### 4.1.11.4.1 TUC_KON_110 „Kartenbasierte TLS-Verbindung aufbauen“

##### TIP1-A_4720-02

Der Konnektor MUSS den technischen Use Case "Kartenbasierte TLS-Verbindung
aufbauen" gemäß TUC_KON_110 umsetzen.

Tabelle293: TAB_KON_773 – TUC_KON_110 „Kartenbasierte TLS-Verbindung
aufbauen“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_110 „Kartenbasierte TLS-Verbindung aufbauen“

</td></tr><tr><td>
Beschreibung

</td><td>
Der TUC_KON_110 „Kartenbasierte TLS-Verbindung aufbauen“ baut eine
TLS-Verbindung zur angegebenen Zieladresse auf. Dabei kann für eine
gegenseitige Authentisierung eine SM-B verwendet werden.

</td></tr><tr><td>
Auslöser

</td><td>
Aufruf durch ein Fachmodul

</td></tr><tr><td>
Vorbedingungen

</td><td>
Die für die Authentisierung adressierte Karte muss freigeschaltet sein

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor, eHealth-Kartenterminal, Karte, Server des Fachdienstes

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
Der Konnektor MUSS folgende Schritte durchlaufen:

1.  Auflösen des FQDN im targetUri per 'TUC_KON_361 „DNS Namen  
    
auflösen“

2.  TLS-Verbindung mit ermittelter Adresse aufbauen:

 a)       Prüfe Server-Zertifikat mittels TUC_KON_037 „Zertifikat
prüfen“  {

      

certificate = C.FD.TLS-S;

              

qualifiedCheck = not_required;

             

offlineAllowNoCheck = true;

             

policyList  = oid_fd_tls_s;

             

intendedKeyUsage= intendedKeyUsage(C.FD.TLS-S);  
             
intendedExtendedKeyUsage = id-kp-serverAuth;  
             
validationMode  = OCSP}

       Das Server-Zertifikat MUSS C.FD.TLS-S sein

 

b)       Prüfe in a) zurückgegebene Rolle

 

(„

e

rmittelte Rolle

“)

==  
      

roleToMatch

 

c)       Wenn cardSession übergeben: Clientauthentisierung mittels 

      ID.HCI.AUT. Der Konnektor darf nur dann das ECC-Zertifikat von der
SMC-B auswählen, wenn auch das Serverzertifikat ein ECC-Zertifikat ist.

3.  tlsConnectiontId der erzeugten Verbindung zurückgeben

</td></tr><tr><td>
Varianten/  
Alternativen

</td><td>
 ---> UL

</td></tr><tr><td>
Fehlerfälle

</td><td>
Fehler in den folgenden Schritten des Ablaufs führen zu einem Abbruch der
Verarbeitung mit den ausgewiesenen Fehlercodes

(



1)    Der Name der Gegenstelle kann nicht aufgelöst werden

(



2b)  Rollenprüfung fehlgeschlagen: Fehlercode 4220

(



2)    Server konnte nicht authentisiert werden: Fehlercode 4156

(



2)    Clientauthentisierung fehlgeschlagen: Fehlercode 4157

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
keine

</td></tr></table>

Tabelle294: TAB_KON_612 Fehlercodes TUC_KON_110 „Kartenbasierte TLS-Verbindung
aufbauen“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4156

</td><td>
Security

</td><td>
Error

</td><td>
Server konnte bei TLS-Verbindungsaufbau nicht authentisiert werden

</td></tr><tr><td>
4157

</td><td>
Security

</td><td>
Error

</td><td>
Clientauthentisierung bei TLS-Verbindungsaufbau fehlgeschlagen

</td></tr><tr><td>
4220

</td><td>
Security

</td><td>
Error

</td><td>
Rollenprüfung bei TLS-Verbindungsaufbau fehlgeschlagen

</td></tr></table>

**[\<=]**

### 4.1.11.4.2 TUC_KON_111 „Kartenbasierte TLS-Verbindung abbauen“

##### TIP1-A_4721

Der Konnektor MUSS den technischen Use Case "Kartenbasierte TLS-Verbindung
abbauen" gemäß TUC_KON_111 umsetzen.

Tabelle295: TAB_KON_774 - TUC_KON_111 „Kartenbasierte TLS-Verbindung abbauen“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_111 „Kartenbasierte TLS-Verbindung abbauen“

</td></tr><tr><td>
Beschreibung

</td><td>
Der TUC_KON_111 „Kartenbasierte TLS-Verbindung abbauen“ dient der geregelten
Beendigung einer TLS-Verbindung, die zuvor über TUC_KON_110 aufgebaut wurde.

</td></tr><tr><td>
Auslöser

</td><td>
Aufruf durch ein Fachmodul

</td></tr><tr><td>
Vorbedingungen

</td><td>
Mittels TUC_KON_110 wurde eine TLS-Verbindung aufgebaut

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor, Server des Fachdienstes

</td></tr><tr><td>
Ausgangsdaten

</td><td>
Keine

</td></tr><tr><td>
Standardablauf

</td><td>
Der Konnektor MUSS folgende Schritte durchlaufen:

 ---> OL

</td></tr><tr><td>
Varianten/  
Alternativen

</td><td>
keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
Fehler in den folgenden Schritten des Ablaufs führen zu einem Abbruch der
Verarbeitung mit den ausgewiesenen Fehlercodes:

(



1) Keine Verbindung mit angegebenem TLSConnectionIdentifier  
        
vorhanden: Fehlercode 4158

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
keine

</td></tr></table>

Tabelle296: TAB_KON_613 Fehlercodes TUC_KON_111 „Kartenbasierte TLS-Verbindung
abbauen“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4158

</td><td>
Technical

</td><td>
Error

</td><td>
Adressierte TLS-Verbindung nicht vorhanden

</td></tr></table>

**[\<=]**

### 4.1.11.5 Operationen an der Außenschnittstelle

Keine.

### 4.1.11.6 Betriebsaspekte

##### TIP1-A_4722

Wenn MGM_LU_ONLINE =„Enabled“, MUSS der Basisdienst TLS-Dienst nach dem
Bootup zur Nutzung zur Verfügung stehen.

Wenn MGM_LU_ONLINE =„Disabled“, DARF der Basisdienst TLS-Dienst nach dem
Bootup NICHT zur Nutzung zur Verfügung stehen. **[\<=]**

### 4.1.12 LDAP-Proxy

Der Konnektor ermöglicht es Clientsystemen und Fachmodulen durch Nutzung des
LDAP-Proxies Daten aus dem Verzeichnisdienst der TI-Plattform (VZD) abzufragen.
Die Kommunikation erfolgt über das LDAPv3 Protokoll.

Die Funktionalität steht nur zur Verfügung, wenn MGM_LU_ONLINE=Enabled ist
(siehe Kapitel 4.3.6)

### 4.1.12.1 Funktionsmerkmalweite Aspekte

Keine.

### 4.1.12.2 Durch Ereignisse ausgelöste Reaktionen

##### TIP1-A_5516

Tritt das Ereignis „MGM/LU_CHANGED/LU_ONLINE“ ein, so MUSS

 ---> UL

**[\<=]**

### 4.1.12.3 Interne TUCs, nicht durch Fachmodule nutzbar

Keine.

### 4.1.12.4 Interne TUCs, auch durch Fachmodule nutzbar

### 4.1.12.4.1 TUC_KON_290 „LDAP-Verbindung aufbauen“

##### TIP1-A_5517-02

Der Konnektor MUSS den technischen Use Case TUC_KON_290 „LDAP-Verbindung
aufbauen“ gemäß TAB_KON_805 umsetzen.

Tabelle297: TAB_KON_805 - TUC_KON_290 „LDAP-Verbindung aufbauen“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_290 „LDAP-Verbindung aufbauen“

</td></tr><tr><td>
Beschreibung

</td><td>
Initiiert durch einen Verbindungsaufbau des LDAP-Clients zum Konnektor baut der
Konnektor eine TLS-gesicherte Verbindung zum VZD auf.

</td></tr><tr><td>
Auslöser

</td><td>
LDAP (oder LDAPS wenn ANCL_TLS_MANDATORY=Enabled) Verbindungsaufbau von einem
Fachmodul oder einem Clientsystem ist abgeschlossen. Bei Verwendung von LDAPS
authentisiert sich der Konnektor beim LDAP-Client mit der Identität ID.AK.AUT.

</td></tr><tr><td>
Vorbedingungen

</td><td>
 ---> UL

</td></tr><tr><td>
Eingangsdaten

</td><td>
keine

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor, VZD

</td></tr><tr><td>
Ausgangsdaten

</td><td>
keine

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

</td></tr><tr><td>
Varianten/Alternativen

</td><td>
keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
keine

</td></tr></table>

**[\<=]**

### 4.1.12.4.2 TUC_KON_291 „Verzeichnis abfragen“

##### TIP1-A_5518

Der Konnektor MUSS den technischen Use Case TUC_KON_291 „Verzeichnis
abfragen“ gemäß TAB_KON_815 umsetzen.

Tabelle298: TAB_KON_815 – TUC_KON_291 „Verzeichnis abfragen“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_291 „Verzeichnis abfragen“

</td></tr><tr><td>
Beschreibung

</td><td>
Der Konnektor leitet als LDAP-Proxy einen Search Request des LDAP-Clients an den
VZD weiter. Vom VZD empfängt der Konnektor eine Search Response und leitet
diese an den LDAP-Client weiter.

</td></tr><tr><td>
Auslöser

</td><td>
Aufruf durch einen LDAPv3 Search Request von einen Fachmodul-TUC oder einem
Clientsystem

</td></tr><tr><td>
Vorbedingungen

</td><td>
 ---> UL

 ---> UL

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor, VZD

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

</td></tr><tr><td>
Varianten/Alternativen

</td><td>
keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
Auftretende Fehler werden gemäß [RFC4511]# Appendix A behandelt.

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
keine

</td></tr></table>

**[\<=]**

### 4.1.12.4.3 TUC_KON_292 „LDAP-Verbindung trennen"

##### TIP1-A_5519

Der Konnektor MUSS den technischen Use Case „LDAP-Verbindung trennen" gemäß
TAB_KON_816 umsetzen.

Tabelle299: TAB_KON_816 – TUC_KON_292 „LDAP-Verbindung trennen"

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_292 „LDAP-Verbindung trennen"

</td></tr><tr><td>
Beschreibung

</td><td>
Der Konnektor beendet die Verbindung zum VZD und zum LDAP-Client.

</td></tr><tr><td>
Auslöser

</td><td>
Aufruf durch einen LDAPv3 Unbind Request von einen Fachmodul-TUC oder einem
Clientsystem

</td></tr><tr><td>
Vorbedingungen

</td><td>
 ---> UL

 ---> UL

</td></tr><tr><td>
Eingangsdaten

</td><td>
keine

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor, VZD

</td></tr><tr><td>
Ausgangsdaten

</td><td>
keine

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

</td></tr><tr><td>
Varianten/Alternativen

</td><td>
keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
Auftretende Fehler werden gemäß [RFC4511]# Appendix A behandelt.

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
keine

</td></tr></table>

**[\<=]**

### 4.1.12.4.4 TUC_KON_293 „Verzeichnisabfrage abbrechen"

##### TIP1-A_5520

Der Konnektor MUSS den technischen Use Case TUC_KON_293 „Verzeichnisabfrage
abbrechen" gemäß TAB_KON_817 umsetzen.

Tabelle300: TAB_KON_817 – TUC_KON_293 „Verzeichnisabfrage abbrechen“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_293 „Verzeichnisabfrage abbrechen"

</td></tr><tr><td>
Beschreibung

</td><td>
Der Konnektor bricht einen unbeantworteten Search Request ab.

</td></tr><tr><td>
Auslöser

</td><td>
Aufruf durch einen LDAPv3 Abandon Request von einen Fachmodul-TUC oder einem
Clientsystem

</td></tr><tr><td>
Vorbedingungen

</td><td>
 ---> UL

</td></tr><tr><td>
Eingangsdaten

</td><td>
keine

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor, VZD

</td></tr><tr><td>
Ausgangsdaten

</td><td>
keine

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

</td></tr><tr><td>
Varianten/Alternativen

</td><td>
keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
Auftretende Fehler werden gemäß [RFC4511]# Appendix A behandelt.

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
keine

</td></tr></table>

**[\<=]**

### 4.1.12.5 Operationen an der Außenschnittstelle

### 4.1.12.5.1 Unterstützte LDAPv3 Operationen

##### TIP1-A_5521

Der Konnektor MUSS an der Client-Schnittstelle die folgenden LDAPv3 Operationen
gemäß [RFC4511] anbieten.

 ---> UL

Andere LDAPv3 Operationen werden mit dem LDAP-Fehler unwillingToPerform (53)
beantwort.

Wenn ANCL_TLS_MANDATORY=Enabled, muss der Konnektor sicherstellen, dass nur
über eine LDAPS-Verbindung (Voreinstellung TCP Port 636) Daten abgefragt
werden können.

Wenn ANCL_TLS_MANDATORY=Disabled, muss der Konnektor sicherstellen, dass über
eine LDAP-Verbindung (Voreinstellung TCP Port 389) und über eine
LDAPS-Verbindung (Voreinstellung TCP Port 636) Daten abgefragt werden können.

Fehler müssen gemäß [RFC4511]#Appendix A behandelt werden. **[\<=]**

### 4.1.12.6 Betriebsaspekte

keine

### 4.1.13 Authentifizierungsdienst

Der Authentifizierungsdienst bietet Clientsystemen und Fachmodulen eine
Schnittstelle zum Signieren von Binärstrings zum Zweck der externen
Authentisierung.

Innerhalb des Authentifizierungsdienstes werden folgende Präfixe für
Bezeichner verwendet:

 ---> UL

Eine Prüfung der Signatur bietet der Konnektor nicht an.

### 4.1.13.1 Funktionsmerkmalweite Aspekte

### 4.1.13.1.1 Externe Authentisierung

##### TIP1-A_5437-02

Der Signaturdienst MUSS für die Operation ExternalAuthenticate die
Signaturverfahren entsprechend TAB_KON_780 – Signaturverfahren Externe
Authentisierung unterstützen.

Tabelle301: TAB_KON_780 – Signaturverfahren Externe Authentisierung

<table><tr><th>
Signaturformat

</th><th>
Standard

</th><th>
Dokument  
formate

</th><th>
QES/  
nonQES

</th><th>
Bemerkung

</th></tr><tr><td>
PKCS#1  
(V2.1)

</td><td>
[RFC3447]

</td><td>
Binär

</td><td>
nonQES

</td><td colspan="1" rowspan="2">
Die Low-Level-Signatur von Bitstrings DARF NUR in Verbindung mit dem zur
Authentisierung vorgesehenen Schlüssel des HBAx und des SM-B genutzt werden. 

Die Nutzung ist auf Bitstrings (Hash-Werte) von maximal 512 bit Länge
beschränkt.

</td></tr><tr><td>
ECDSA

</td><td>
[BSI-TR-03111]

</td><td>
Binär

</td><td>
nonQES

</td></tr></table>

     **[\<=]**

##### TIP1-A_5149-01

Der Hersteller des Konnektors MUSS den Anwender (Clientsystem) im Handbuch des
Konnektors geeignet und ausreichend darüber informieren, dass die Operation
ExternalAuthenticate nur zu Authentisierungszwecken mit dem
Authentisierungsschlüssel des HBAx und des SM-B verwendet werden darf.
**[\<=]**

### 4.1.13.2 Durch Ereignisse ausgelöste Reaktionen

keine

### 4.1.13.3 Interne TUCs

keine

### 4.1.13.4 Operationen an der Außenschnittstelle

##### TIP1-A_5665-03

Der Konnektor MUSS Clientsystemen den Basisdienst Authentifizierungsdienst
anbieten.

Tabelle302: TAB_KON_839 Basisdienst Authentifizierungsdienst

<table><tr><th>
Name

</th><th colspan="2">
AuthSignatureService

</th></tr><tr><td>
Version (KDV)

</td><td colspan="2">
7.4.0 (WSDL-Version)  
7.4.1 (WSDL-Version)

</td></tr><tr><td>
Namensraum

</td><td colspan="2">
Siehe GitHub

</td></tr><tr><td>
Namensraum-Kürzel

</td><td colspan="2">
SIG für Schema und SIGW für WSDL

</td></tr><tr><td rowspan="2">
Operationen

</td><td>
Name

</td><td>
Kurzbeschreibung

</td></tr><tr><td>
ExternalAuthenticate

</td><td>
Binärstring signieren (nonQES)

</td></tr><tr><td>
WSDL

</td><td colspan="2">
AuthSignatureService_V7_4_1.wsdl  
AuthSignatureService.wsdl (WSDL-Version 7.4.0)

</td></tr><tr><td>
Schema

</td><td colspan="2">
Kein

</td></tr></table>

**[\<=]**

### 4.1.13.4.1 ExternalAuthenticate

##### TIP1-A_5439

Der Authentifizierungsdienst des Konnektors MUSS an der Clientschnittstelle eine
Operation ExternalAuthenticate anbieten.

Tabelle303: TAB_KON_781 Operation ExternalAuthenticate

<table><tr><th>
Name

</th><th colspan="3">
ExternalAuthenticate

</th></tr><tr><td>
Beschrei

bung

</td><td colspan="3">
Diese Operation versieht einen Binärstring der maximalen Länge 512 Bit mit
einer nicht-qualifizierten elektronischen Signatur (nonQES).

Dazu wird das Signaturverfahren PKCS#1

oder ECDSA

verwendet. Das AUT-Zertifikat der SM-B und das AUT-Zertifikat des HBAx werden
unterstützt.

</td></tr><tr><td rowspan="8">
Aufruf

parameter

</td><td colspan="3">
![Img-070][Img-070]

</td></tr><tr><td colspan="2">
Name

</td><td>
Beschreibung

</td></tr><tr><td colspan="2">
CONN:

CardHandle

</td><td>
Identifiziert die zu verwendende Signaturkarte.

Die Operation unterstützt HBAx und SM-B.

</td></tr><tr><td colspan="2">
CCTX:

Context

</td><td>
Aufrufkontext für HBAx

:

MandantId, ClientSystemId, WorkplaceId, UserId verpflichtend

Aufrufkontext für SM-B

:

MandantId, ClientSystemId, WorkplaceId verpflichtend; UserId nicht ausgewertet

</td></tr><tr><td colspan="2">
SIG:

Optional

Inputs

</td><td>
Enthält optionale Eingangsparameter:

![Img-071][Img-071]

</td></tr><tr><td colspan="2">
SIG:

Binary

String

</td><td>
Dieses Element enthält im Kindelement

dss:Base64Data

den zu signierenden Binärstring.

Das XML Attribut SIG:BinaryString/dss:Base64Data/@MimeType MUSS den Wert
"application/octet-stream" haben.

Die maximale Länge des Binärstrings beträgt 512 Bit entsprechend der maximal
zu erwartenden Hash-Größe.

Aus der Länge des Binärstrings wird auf das verwendete

Hashverfahren geschlossen. Es werden folgende Längen unterstützt:  

 ---> UL

Im Falle des Signaturverfahrens RSASSA-PKCS1-v1_5 werden SHA-256, SHA-384 und
SHA-512 unterstützt.

Im Falle des Signaturverfahrens RSASSA-PSS wird SHA-256 unterstützt.

Im Falle des Signaturverfahrens ECDSA wird SHA-256 unterstützt.

Für die Signaturerstellung gilt:

 ---> UL

</td></tr><tr><td colspan="2">
dss:

Signature

Type

</td><td>
Durch dieses in [OASIS-DSS] (Abschnitt 3.5.1) beschriebene Element wird der Typ
der zu erzeugenden Signatur bestimmt. Als Signaturtyp wird unterstützt :

 ---> UL

Andere

SignatureType

-Angaben führen zu einer Fehlermeldung 4111 (Ungültiger Signaturtyp oder
Signaturvariante).

Fehlt dieses Element, so wird ebenfalls der Signaturtyp PKCS#1-Signatur
verwendet.

</td></tr><tr><td colspan="2">
SIG:

Signature

Schemes

</td><td>
Durch dieses Element wird für PKCS#1-Signaturen zwischen den folgenden
SignatureScheme-Optionen

unterschieden:

 ---> UL

Fehlt dieses Element, so wird als Default-SignatureScheme RSASSA-PSS gewählt.

</td></tr><tr><td rowspan="3">
Rückgabe

</td><td colspan="3">
![Img-072][Img-072]

</td></tr><tr><td>
CONN:

Status

</td><td colspan="2">
Enthält den Status der ausgeführten Operation.

</td></tr><tr><td>
dss:

Signature

Object

</td><td colspan="2">
Enthält im Erfolgsfall die erzeugte Signatur in Form eines

dss:SignatureObject

-Elements gemäß [OASIS-DSS] (Abschnitt 3.2).

Der Signaturwert wird im XML-Element

dss:SignatureObject/dss:Base64Signature

übergeben.

Die Signatur wird binär gemäß [BSI-TR-03111]#5.2.2 in der ASN.1 Struktur
ECDSA-Sig-Value zurückgegeben.

Das XML-Attribut

dss:SignatureObject/dss:Base64Signature/@Type

kennzeichnet durch den Wert:

 ---> UL

bzw.

 ---> UL

Die XML-Elemente

dss:SignatureObject/ds:Signature

dss:SignatureObject/dss:Timestamp

dss:SignatureObject/dss:SignaturePtr

dss:SignatureObject/dss:Other

werden nicht verwendet.

</td></tr><tr><td>
Vorbeding

ungen

</td><td colspan="3">
Keine

</td></tr><tr><td>
Nachbeding

ungen

</td><td colspan="3">
Keine

</td></tr></table>

Der Ablauf der Operation ExternalAuthenticate ist in Tabelle TAB_KON_782
beschrieben:

Tabelle304: TAB_KON_782 Ablauf Operation ExternalAuthenticate

<table><tr><th>
Nr.

</th><th>
Aufruf Technischer Use Case oder Interne Operation

</th><th>
Beschreibung

</th></tr><tr><td>
1.

</td><td>
checkArguments

</td><td>
Alle übergebenen Parameterwerte werden auf Konsistenz und Gültigkeit
überprüft. Treten hierbei Fehler auf, so bricht die Operation mit Fehler 4000
ab.

</td></tr><tr><td>
2.

</td><td>
TUC_KON_000 „Prüfe Zugriffs-

berechtigung“

</td><td>
Die Prüfung erfolgt durch den Aufruf

TUC_KON_000 {$context.mandantId; $context.clientsystemId;

$context.workplaceId; $context.userId; $cardHandle}

Tritt bei der Prüfung ein Fehler auf, bricht die Operation mit Fehlercode aus
TUC_KON_000 ab.

</td></tr><tr><td>
3.

</td><td>
TUC_KON_026 „Liefere CardSession“

</td><td>
Ermittle CardSession über TUC_KON_026 { MandantId, CsId, CardHandle, UserId }

</td></tr><tr><td>
4.

</td><td>
TUC_KON_218 „Signiere“

</td><td>
Signaturberechnung durch Aufruf des TUC_KON_218 {

PinRef = PIN.CH bzw. PIN.SMC;

KeyRef = PrK.HP.AUT bzw. PrK.HCI.AUT;

AlgorithmusID = signPKCS1_V1_5 oder signPSS

oder signECDSA;

DTBS = Binärstring

}

</td></tr></table>

Tabelle305: TAB_KON_783 Übersicht Fehler Operation ExternalAuthenticate

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen TUCs können folgende weitere Fehlercodes
auftreten:

</td></tr><tr><td>
4000

</td><td>
Technical

</td><td>
Error

</td><td>
Syntaxfehler

</td></tr><tr><td>
4058

</td><td>
Security

</td><td>
Error

</td><td>
Aufruf nicht zulässig

</td></tr></table>

Die folgende Tabelle führt die zulässigen privaten Schlüssel für die
Operation ExternalAuthenticate auf:

Tabelle306: TAB_KON_784 Privater Schlüssel je Karte für ExternalAuthenticate

<table><tr><th>
Karte

</th><th>
Schlüssel

</th></tr><tr><td>
SM-B

</td><td>
PrK.HCI.AUT in DF.ESIGN

</td></tr><tr><td>
HBAx

</td><td>
PrK.HP.AUT in DF.ESIGN

</td></tr></table>

**[\<=]**

### 4.1.13.5 Betriebsaspekte

Keine

### 4.1.14 Betriebsdatenmeldedienst

##### A_21136

Der Konnektor MUSS die Operation I_Registration_Service#sendData benutzen, um
die Betriebsdaten täglich zu versenden. **[\<=]**

##### A_21137

Der Konnektor MUSS die Betriebsdaten als XML-Dokument gemäß dem Schema
„conn/OperatingData.xsd“ mit

 ---> UL

senden. **[\<=]**

##### A_21225

Der Konnektor MUSS die XML Elemente der Betriebsdaten gemäß der Annotations im
Schema OperatingData.xsd befüllen. **[\<=]**

##### A_21138

Liefert I_Registration_Service einen Fehler, MUSS der Konnektor das Senden der
Betriebsdaten 3 Mal im Abstand von 5 Minuten erneut versuchen. **[\<=]**

##### A_21139

Meldet I_Registration_Service, dass die Soap Operation sendData nicht vorhanden
ist, DARF der Konnektor die Operation NICHT sofort wiederholen. Erst zum
nächsten regulären Termin soll wieder gesendet werden. **[\<=]**

##### A_21140

Der Konnektor DARF NICHT personenbezogene, personenbeziehbare oder medizinische
Daten senden. **[\<=]**

##### A_23275

Der Konnektor SOLL dem Administrator an der Management-Oberfläche ein manuelles
Versenden der Betriebsdaten ermöglichen. Dabei wird die Operation
I_Registration_Service#sendData aufgerufen. **[\<=]**

### 4.2 Netzkonnektor

### 4.2.1 Anbindung LAN/WAN

Unter Anbindung LAN/WAN werden die Mechanismen beschrieben, mit denen der
Konnektor auf der einen Seite in das lokale Netz der Einsatzumgebung, auf der
anderen Seite in die TI bzw. die Bestandsnetze angebunden wird. Diese
wesentlichen Aspekte betreffen Routing und Firewall.

Innerhalb des Kapitels Anbindung LAN/WAN werden folgende Präfixe für
Bezeichner verwendet:

 ---> UL

### 4.2.1.1 Funktionsmerkmalweite Aspekte

##### TIP1-A_4723

Der Konnektor MUSS sich nach den in [RFC1812#1.1.3] definierten
Rahmenbedingungen als IP Version 4 (IPv4) Router verhalten.Hiervon ausgenommen
sind die in den folgenden Kapiteln aufgeführten Anforderungen des [RFC1812]:

 ---> UL

Die in [RFC2644] geforderten Aktualisierungen zum [RFC1812] müssen vom
Konnektor umgesetzt werden. **[\<=]**

##### TIP1-A_5406

Der Konnektor DARF NICHT IP-Pakete mitgesetzter Source Route Option gemäß
[RFC791] erzeugen oder weiterleiten. **[\<=]**

In der folgenden Anforderung wird die Terminologie gemäß [RFC2663] verwendet.

##### TIP1-A_5407

Der Konnektor MUSS für die Kommunikation aus den Adressbereichen
NET_LEKTR-Umgebung mit den Adressbereichen NET_TI_OFFENE_FD und
ANLW_BESTANDSNETZE eine Network Address Port Translation (NAPT) gemäß
[RFC3022#2.2, 3, 4.1-4.3] vornehmen.Für die Umsetzung der Private Local
Address aus den Adressbereichen der Einsatzumgebung MUSS die IP-Adresse
VPN_TUNNEL_TI_INNER_IP als Global Address genutzt werden.Der Konnektor MUSS
für die Kommunikation aus den Adressbereichen der NET_LEKTR-Umgebung mit dem
Internet über den VPN-Tunnel SIS eine Network Address Port Translation (NAPT)
gemäß RFC3022#2.2, 3, 4.1-4.3 vornehmen. Für die Umsetzung der Local Address
MUSS die IP-Adresse VPN_TUNNEL_SIS_INNER_IP als Global Address genutzt werden.
**[\<=]**

##### TIP1-A_4724

Der Konnektor MUSS sicherstellen, dass nur über den LAN-Adapter (Adressen aus
ANLW_LAN_NETWORK_SEGMENT oder Adressen aus einem der Netzwerksegmente in
ANLW_LEKTR_INTRANET_ROUTES) mit den Clientsystemen und den
Kartenterminalskommuniziert werden kann. **[\<=]**

##### TIP1-A_4725

Für den Betrieb in Reihe (ANLW_ANBINDUNGS_MODUS=InReihe) MUSS der Konnektor den
WAN-Adapter für den Zugang zumInternet über das IAGder
Einsatzumgebungverwenden. **[\<=]**

##### TIP1-A_4726

Der Hersteller des Konnektors MUSS sicherstellen, dass eine Anbindung an das
Transportnetz/Internet nur möglich ist, wenn (MGM_LU_ONLINE=Enabled) gesetzt
ist. **[\<=]**

##### TIP1-A_4728

Der Konnektor MUSS IP Version 4 (IPv4) für alle seine IP-Schnittstellen
unterstützen.Die Hardware des Konnektors MUSS für den Einsatz von IPv4 und
IPv6 im Dual-Stack-Mode geeignet sein.Bis zu einer Migration von IPv4 auf IPv6
MUSS der Konnektor sämtliche empfangene IP-Pakete der Version 6 (IPv6)
verwerfen. **[\<=]**

##### TIP1-A_4728-01

Der Konnektor MUSS IP Version 4 (IPv4) und IP Version 6 (IPv6) für alle seine
physikalischen Adapter unterstützen.Die Hardware des Konnektors MUSS für den
Einsatz von IPv4 und IPv6 im Dual-Stack-Mode geeignet sein. **[\<=]**

##### TIP1-A_4729

Dynamische Routing-Protokolle dürfen vom Konnektor nicht eingesetzt werden.
Wird in einem der an den Konnektor angeschlossenen Netzwerke ein
dynamischesRouting genutzt, so DÜRFEN Routing Updates vom Konnektor NICHT
akzeptiert werden und keine Routen eingetragen werden. **[\<=]**

##### TIP1-A_5152

Falls Parameter MGM_LU_ONLINE=Enabled,MUSS der Konnektor einmal täglich
TUC_KON_283 „Infrastruktur Konfiguration aktualisieren“aufrufen. **[\<=]**

### 4.2.1.1.1 Netzwerksegmentierung

In Anlehnung an die in der [gemSpec_Net#2.3.3] definierten Netzwerksegmente
werden in der Konnektorspezifikation die folgenden Bezeichner verwendet:

<table><tr><th>
ReferenzID im  
Konnektor

</th><th>
Adressbereich für die TI-Produktivumgebung

</th><th>
Adressbereich für die TI-Testumgebung

</th><th>
Adressbereich für die TI-Referenzumgebung

</th></tr><tr><td>
NET_SIS

</td><td>
TI_Dezentral_SIS  
- Konnektoren

</td><td>
TI_Test_Dezentral_SIS  
- Konnektoren

</td><td>
Ist durch den Testbetriebsverantwortlichen zu definieren.

</td></tr><tr><td>
NET_TI_  
DEZENTRAL

</td><td>
TI_Dezentral  
- Konnektoren

</td><td>
TI_Test_Dezentral  
- Konnektoren

</td><td>
Ist durch den Testbetriebsverantwortlichen zu definieren.

</td></tr><tr><td>
NET_TI_  
ZENTRAL

</td><td>
TI_Zentral  
- Zentrale Dienste

</td><td>
TI_Test_Zentral  
- Zentrale Dienste

</td><td>
Ist durch den Testbetriebsverantwortlichen zu definieren.

</td></tr><tr><td>
NET_TI_  
OFFENE_FD

</td><td>
Anwendungsdienste  
- Offene Fachdienste  
- WANDA Smart  
- WANDA Basic

</td><td>
Test_Anwendungsdienste  
- Offene Fachdienste  
- WANDA Smart  
- WANDA Basic

</td><td>
Ist durch den Testbetriebsverantwortlichen zu definieren.

</td></tr><tr><td>
NET_TI_  
GESICHERTE_  
FD

</td><td>
Anwendungsdienste  
- Gesicherte Fachdienste

</td><td>
Test_Anwendungsdienste  
- Gesicherte Fachdienste

</td><td>
Ist durch den Testbetriebsverantwortlichen zu definieren.

</td></tr><tr><td>
NET_LEKTR

</td><td colspan="3">
Liste der Netzwerke die in der Einsatzumgebung über den Konnektor erreichbar
sind. Ein Eintrag der Liste enthält die Netzwerkadresse und den Netzwerkprefix.

</td></tr><tr><td>
ANLW_  
BESTANDS  
NETZE

</td><td colspan="3">
Liste der an die TI angeschlossenen Bestandsnetze (u. a. das Sichere Netz der
KVen). Ein Eintrag der Liste enthält die Netzwerkadresse und den
Netzwerkprefix.

</td></tr><tr><td>
ANLW_  
AKTIVE_  
BESTANDS  
NETZE

</td><td colspan="3">
Liste der an die TI angeschlossenen und aktivierten Bestandsnetze

</td></tr></table>

<table><tr><th>
ReferenzID  

</th><th>
Bedeutung/Belegung

</th></tr><tr><td>
VPN_TI

</td><td>
Logischer Adapter des VPN-Tunnel zur TI mit dessen VPN_TUNNEL_TI_INNER_IP aus
dem Adresssegment NET_TI_DEZENTRAL

</td></tr><tr><td>
VPN_SIS

</td><td>
Logischer Adapter des VPN-Tunnel zur SIS mit dessen VPN_TUNNEL_SIS_INNER_IP aus
dem Addresssegment NET_SIS

</td></tr></table>

<table><tr><th>
ReferenzID  

</th><th>
Bedeutung/Belegung

</th></tr><tr><td>
ANLW_LAN_IP_ADDRESS

</td><td>
Dies ist die IP-Adresse des LAN-Adapters.

Aus dem Netz der Einsatzumgebung (ANLW_LAN_NETWORK_SEGMENT) die vom Konnektor
verwendete IP-Adresse. Unter dieser Adresse werden die Dienste des Konnektor im
lokalen Netzwerk bereitgestellt.

Diese Adresse entspricht dem in Tabelle TAB_KON_683 LAN-Adapter

IP-Konfiguration 

definierten Parameter ANLW_LAN_IP_ADDRESS.

</td></tr><tr><td>
ANLW_WAN_IP_ADDRESS

</td><td>
Dies ist die IP-Adresse des WAN-Adapters.

</td></tr></table>

### 4.2.1.1.2 Routing und Firewall

Darstellung der Kommunikationsregeln des Konnektors

Diese Abbildung dient der Veranschaulichung der im Konnektor verwendeten
Kommunikationsregeln welche in den nachfolgenden Afo definiert werden.

![Abbildung-21][Abbildung-21]

##### TIP1-A_4730

Der Konnektor MUSS sicherstellen, dass IP-Pakete mit einer Absenderadresse aus
dem Adressbereich NET_TI_GESICHERTE_FD verworfen werden, wenn sie nicht aus dem
VPN-Tunnel der TI (VPN_TI) stammen.Der Konnektor MUSS die Kommunikation mit
Systemen des Netzwerksegments NET_TI_GESICHERTE_FD für folgende Fälle
unterstützen:

 ---> UL

Der Konnektor MUSS insbesondere die Kommunikation an seinen Außenschnittstellen
mit Systemen des Netzwerksegments NET_TI_GESICHERTE_FD für folgende Fälle
blockieren:

 ---> UL

Der Konnektor MUSS sicherstellen, dass die aus einer unterstützten
Kommunikation mit Systemen aus dem Netzwerksegment NET_TI_GESICHERTE_FD
bestimmten IP-Pakete ausschließlich in den VPN-Tunnel der TI (VPN_TI) geleitet
werden. **[\<=]**

##### TIP1-A_5530

Der Konnektor MUSS sicherstellen, dass IP-Pakete mit einer Absenderadresse aus
dem Adressbereich NET_TI_OFFENE_FD verworfen werden, wenn sie nicht aus dem
VPN-Tunnel der TI (VPN_TI) stammen.Der Konnektor MUSS die Kommunikation mit
Systemen des Netzwerksegments NET_TI_OFFENE_FD für folgende Fälle
unterstützen:

 ---> UL

Der Konnektor MUSS insbesondere die Kommunikation an seinen Außenschnittstellen
mit Systemen des Netzwerksegments NET_TI_OFFENE_FD für folgende Fälle
blockieren:

 ---> UL

Der Konnektor MUSS sicherstellen, dass die aus einer unterstützten
Kommunikation mit Systemen aus dem Netzwerksegment NET_TI_OFFENE_FD bestimmten
IP-Pakete ausschließlich in den VPN-Tunnel der TI (VPN_TI) geleitet werden. **[\<=]**

##### TIP1-A_4731

Der Konnektor MUSS sicherstellen, dassIP-Paketemit einer Absenderadresse aus dem
Adressbereich NET_TI_ZENTRAL verworfen werden, wenn sie nicht aus dem
VPN-Tunnel der TI (VPN_TI) stammen.

Der Konnektor MUSS die Kommunikationmit Systemen
desNetzwerksegmentsNET_TI_ZENTRAL für folgende Fälle unterstützen:

 ---> UL

Der Konnektor MUSSinsbesonderedie Kommunikation an seinen
Außenschnittstellenmit Systemen des NetzwerksegmentsNET_TI_ZENTRAL für
folgende Fälle blockieren:

 ---> UL

Der Konnektor MUSS sicherstellen, dass die aus einer unterstützten
Kommunikation mit Systemen aus dem Netzwerksegment NET_TI_ZENTRAL
bestimmtenIP-Paketeausschließlich in den VPN-Tunnel der TI (VPN_TI) geleitet
werden. **[\<=]**

##### TIP1-A_4732

Der Konnektor MUSS sicherstellen, dass die Adressen aus dem Adressbereich
NET_TI_DEZENTRAL nur für die Kommunikation mit der TI/den weiteren Anwendungen
des Gesundheitswesens in Form der inner IP (VPN_TUNNEL_TI_INNER_IP) des
VPN-Tunnel der TI (VPN_TI) verwendet wird.Der Konnektor MUSS die Kommunikation
mit Systemen des Netzwerksegments NET_TI_DEZENTRAL für folgende Fälle
unterstützen:

 ---> UL

Der Konnektor MUSS insbesondere die Kommunikation an seinen Außenschnittstellen
mit Systemen des Netzwerksegments NET_TI_DEZENTRAL für folgende Fälle
blockieren:

 ---> UL

**[\<=]**

##### TIP1-A_4733

Der Konnektor MUSS sicherstellen, dass IP-Pakete mit einer Absenderadresse aus
dem Adressbereich ANLW_AKTIVE_BESTANDSNETZE verworfen werden, wenn sie nicht
aus dem VPN-Tunnel der TI (VPN_TI) stammen.Der Konnektor MUSS die Kommunikation
mit Systemen des Netzwerksegments ANLW_AKTIVE_BESTANDSNETZE für folgende
Fälle unterstützen:

 ---> UL

Der Konnektor MUSS insbesondere die Kommunikation an seinen Außenschnittstellen
mit Systemen des Netzwerksegments ANLW_AKTIVE_BESTANDSNETZE für folgende
Fälle blockieren:

 ---> UL

Der Konnektor MUSS sicherstellen, dass die aus einer unterstützten
Kommunikation mit Systemen aus dem Netzwerksegment ANLW_AKTIVE_BESTANDSNETZE
bestimmten IP-Pakete ausschließlich in den VPN-Tunnel der TI (VPN_TI) geleitet
werden. **[\<=]**

##### TIP1-A_4734

Der Konnektor MUSS sicherstellen, dasseineAdresse aus dem Adressbereich NET_SIS
nur für die Kommunikation mit dem Internet (via SIS) in Form der inner IP
(VPN_TUNNEL_SIS_INNER_IP) des VPN-Tunnel der SIS (VPN_SIS) verwendet wird.

Der Konnektor MUSSinsbesonderedie Kommunikationmit Systemen des
NetzwerksegmentsNET_SIS für folgende Fälle unterstützen:

 ---> UL

Der Konnektor MUSS die Kommunikation an seinen Außenschnittstellen mit NET_SIS
für folgende Fälle blockieren:

 ---> UL

**[\<=]**

##### TIP1-A_4735

Der Konnektor MUSS sicherstellen, dass IP-Pakete mit einer Absenderadresse aus
dem Adressbereich NET_TI_ZENTRAL, NET_TI_GESICHERTE_FD; NET_TI_OFFENE_FD,
NET_TI_DEZENTRAL, ANLW_AKTIVE_BESTANDSNETZE, ANLW_LAN_ADDRESS_SEGMENT, aus
einem der Netzwerksegmente in ANLW_LEKTR_INTRANET_ROUTES oder
ANLW_WAN_NETWORK_SEGMENT verworfen werden, wenn sie aus dem VPN-Tunnel der SIS
(VPN_SIS) stammen.

Der Konnektor MUSS die Kommunikation mit Systemendes NetzwerksegmentsInternet
(via SIS) für folgende Fälle unterstützen:

 ---> UL

Der Konnektor MUSS insbesondere die Kommunikation anseinenAußenschnittstellen
mit Internet (via SIS) für folgende Fälle blockieren oder umleiten:

 ---> UL

Der Konnektor MUSS sicherstellen, dass die für die Kommunikation mit dem
Internet (via SIS) bestimmten IP-Pakete ausschließlich in den VPN-Tunnel des
SIS (VPN_SIS) geleitet werden. **[\<=]**

##### TIP1-A_4736-02

Der Konnektor MUSS sicherstellen, dass eingehende IP-Pakete von der
Kommunikation mit dem Internet mit der Empfängeradresse ungleich
(ANLW_LAN_IP_ADDRESS oder aus einem der Netzwerksegmente in
ANLW_LEKTR_INTRANET_ROUTES wenn ANLW_WAN_ADAPTER_MODUS=DISABLED) oder
(ANLW_WAN_IP_ADDRESS wenn ANLW_WAN_ADAPTER_MODUS=ENABLED) verworfen werden.Der
Konnektor MUSS sicherstellen, dass ausgehende IP-Pakete für die Kommunikation
mit dem Internet mit der Absenderadresse ungleich (ANLW_LAN_IP_ADDRESS oder aus
einem der Netzwerksegmente in ANLW_LEKTR_INTRANET_ROUTES wenn
ANLW_WAN_ADAPTER_MODUS=DISABLED) oder (ANLW_WAN_IP_ADDRESS wenn
ANLW_WAN_ADAPTER_MODUS=ENABLED) verworfen werden.Der Konnektor MUSS die
Kommunikation mit Systemen des Netzwerksegments Internet (via IAG) für
folgende Fälle unterstützen:

 ---> UL

Der Konnektor MUSS insbesondere die Kommunikation an seinen Außenschnittstellen
mit Internet (via IAG) für folgende Fälle blockieren oder umleiten:

 ---> UL

**[\<=]**

##### TIP1-A_4737

Der Konnektor MUSS sicherstellen, dass ausgehendeIP-Paketefür die Kommunikation
mit „AktiveKomponenten“mit einer Absenderadresse ungleich
ANLW_LAN_IP_ADDRESS, einer Adresse aus einem Netzwerksegment
inANLW_LEKTR_INTRANET_ROUTESoder 0.0.0.0 verworfenwerden.

Der Konnektor MUSS die Kommunikation mit „Aktive Komponenten“für folgende
Fälle unterstützen:

 ---> UL

Der Konnektor MUSS insbesondere die Kommunikation anseinen Außenschnittstellen
mit „Aktive Komponenten“für folgende Fälle blockieren:

 ---> UL

**[\<=]**

##### TIP1-A_4738

Der Konnektor MUSS die Kommunikation mit dem IAGder Einsatzumgebungfür folgende
Fälle unterstützen:

 ---> UL

Der Konnektor MUSS insbesondere die Kommunikation an seinen Außenschnittstellen
mit dem IAGder Einsatzumgebungfür folgende Fälle blockieren:

 ---> UL

**[\<=]**

##### TIP1-A_4740

Die Firewall des Konnektor MUSS alle vom Administrator in
ANLW_FW_SIS_ADMIN_RULES definierten Firewall-Regeln als zusätzliche
Einschränkung übernehmen. **[\<=]**

##### TIP1-A_4741

Der KonnektorMUSS die Kommunikation mit Systemen aus einem Intranet-VPN (einem
der Netzwerksegmente ANLW_LEKTR_INTRANET_ROUTES) für folgende
Fälleunterstützen:

 ---> UL

**[\<=]**

##### TIP1-A_4742

Der Konnektor MUSS die Kommunikation mit den Fachmodulen für folgende Fälle
unterstützen:

 ---> UL

Der Konnektor MUSS insbesondere die Kommunikation an seinen Außenschnittstellen
mit den Fachmodulen für folgende Fälle blockieren:

 ---> UL

**[\<=]**

##### TIP1-A_4744

Die Firewall des Konnektor MUSS alle abgelehnten IP-Pakete verwerfen (DROP) ohne
ein ICMP-Destination-Unreachable (Type 3) zu schicken. **[\<=]**

##### TIP1-A_4746

Der Konnektor MUSS geeignete technische Funktionen zur Abwehr von IP-Spoofing
und DoS/DDoS-Angriffen implementieren.

Der Konnektor MUSS Martian Packets (Absender– oder Empfängeradressen aus den
von der IETF als Special-Purpose definierten Netzbereichen), mindestens jedoch
aus folgenden Netzbereichen 0.0.0.0/8, 127.0.0.0/8, 169.254.0.0/16,
192.0.0.0/24, 192.0.2.0/24, 198.18.0.0/15, 198.51.100.0/24, 203.0.113.0/24,
224.0.0.0/4, 240.0.0.0/4 verwerfen. Die in [RFC1918] und [RFC 6598] definierten
Netzbereiche sind hiervonausgenommen. **[\<=]**

##### TIP1-A_4745

Die Firewall des Konnektor MUSS TCP-Port-7(Echo)-Pakete verwerfen.Die Firewall
des Konnektor MUSS ICMP-Echo-Request (Typ 8) und ICMP-Echo-Response (Typ 0)
ausschließlich für die folgenden Kommunikationen zulassen:

 ---> UL

Die Firewall des Konnektors MUSS für alle anderen Kommunikationen ein
ICMP-Echo-Request (Typ 8) verwerfen. **[\<=]**

##### TIP1-A_4747

Der Konnektor MUSS alle IP-Protokolle außer 1 (ICMP), 4 (IP in IP
(encapsulation)), 17 (UDP), 6 (TCP), 50 (ESP) und 108 (IPComp) für alle ein-
oder ausgehenden Pakete an allen seinen Adaptern verwerfen. **[\<=]**

##### TIP1-A_4748

Der Konnektor DARF seine Routing-Regeln NICHT durch IP-Kommunikation
beeinflussen lassen, weder mittels eines Routing-Protokolls (wie BGP oder RIP)
noch mittels ICMP-Kommandos (wie Redirect (5), Router Advertisement (9/10) oder
auch Mobile Host Redirect (32)) sondern MUSS diese ausschließlich
durchTUC_KON_304 „Netzwerk-Routen einrichten“setzen.

Die Firewall des Konnektor MUSS alle aus einem der Tunnel (VPN_TI oder VPN_SIS)
kommenden DHCP-Pakete verwerfen.

Die Firewall des Konnektors MUSS an den Konnektor gerichtete IPsec-Pakete (IKE,
ESP und IPsec NAT-T) verwerfen, sofern sie nicht einer vom Konnektor
initiierten IPsec-Verbindung (VPN_TI und VPN_SIS) zugeordnet werden können. **[\<=]**

##### TIP1-A_4749

Der Konnektor MUSS gewährleisten, dass unmittelbar nach einer Änderung der
Parameter eines Adapters (LAN-Adapter, WAN-Adapter, virtueller Adapter VPN_TI
oder virtueller Adapter VPN_SIS) die Firewall des Konnektor neu erstellt und
geladen wird.

Wenn der WAN-Adapter verwendet wird (ANLW_WAN_ADAPTER_MODUS=ENABLED) DARF die
Firewall des Konnektor bei einer Änderung der ANLW_WAN_IP_ADDRESS NICHT die
Verbindungen über den LAN-Adapter durch einen Restart der Firewall
beeinflussen.

Wenn der WAN-Adapter verwendet wird (ANLW_WAN_ADAPTER_MODUS=ENABLED), DARF die
Firewall des Konnektor bei einer Änderung derANLW_LAN_IP_ADDRESS NICHT die
Verbindungen über die Adapter WAN, VPN_TI oder VPN_SIS durch einen Restart der
Firewall beeinflussen. **[\<=]**

Umsetzungshinweis für den Hersteller: Es können zwei getrennten
Firewall-Regelsets für den LAN- bzw. für den WAN-Adapter verwendet werden.

##### TIP1-A_4750

Der Konnektor MUSS bei Start und Stopp der Firewall einen Protokolleintrag mit
der Schwere „Warning“und dem Typ „Operations“sowie mindestens folgenden
Informationen generieren:

 ---> UL

Der Konnektor MUSS bei Konfigurationsänderungen der Firewall einen
Protokolleintrag mit der Schwere „Warning“und dem Typ „Operations“sowie
mindestens folgenden Informationen generieren:

 ---> UL

Der Konnektor MUSS für alle vom Konnektor ausgehenden, nicht zugelassenen
Kommunikationsversuche einen Protokolleintrag mit der Schwere „Warning“und
dem Typ „Security“sowie mindestens folgenden Informationen generieren:

 ---> UL

Der Konnektor MUSS für alleverworfenenIP-Spoofing- und Martian-Packets einen
Protokolleintrag mit der Schwere „Warning“und dem Typ „Security“sowie
mindestens folgenden Informationen generieren:

 ---> UL

Der Konnektor MUSS für alle von der Firewall verworfenen IP-Pakete einen
Protokolleintrag mit der Schwere „Info“und dem Typ „Security“sowie
mindestens folgenden Informationengenerieren, wobei Layer 3 Broadcasts von der
Protokollierung ausgenommen werden können:

 ---> UL

Der Konnektor MUSS für die Firewall-Protokollierung den TUC_KON_271 „Schreibe
Protokolleintrag“nutzen. **[\<=]**

### 4.2.1.2 Durch Ereignisse ausgelöste Reaktionen

##### TIP1-A_4751

Beim Auftreten eines dernachfolgenden Events MUSS der Konnektor denTUC_KON_305
„LAN-Adapter initialisieren“starten.

 ---> UL

**[\<=]**

##### TIP1-A_4752

Beim Auftreten eines der nachfolgenden Events MUSS der Konnektor TUC_KON_306
„WAN-Adapter initialisieren“ starten.

 ---> UL

**[\<=]**

##### TIP1-A_4753

Beim Auftreten einesder nachfolgenden Events MUSS der Konnektor denTUC_KON_304
„Netzwerk-Routen einrichten“aufrufen.

 ---> UL

**[\<=]**

### 4.2.1.3 Interne TUCs, nicht durch Fachmodule nutzbar

### 4.2.1.3.1 TUC_KON_305 „LAN-Adapter initialisieren“

##### TIP1-A_4754

Der Konnektor MUSS den technischen Use Case TUC_KON_305 „LAN-Adapter
initialisieren“ umsetzen.

Tabelle310: TAB_KON_614 - TUC_KON_305 „LAN-Adapter initialisieren“

<table><tr><th>
Element

</th><th>
Beschreibung

</th></tr><tr><td>
Name

</td><td>
TUC_KON_305 LAN-Adapter initialisieren

</td></tr><tr><td>
Beschreibung

</td><td>
Initialisieren der LAN-Netzwerkschnittstelle

</td></tr><tr><td>
Auslöser

</td><td>
 ---> UL

</td></tr><tr><td>
Vorbedingungen

</td><td>
 ---> UL

</td></tr><tr><td>
Eingangsdaten

</td><td>
Keine

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
Keine

</td></tr><tr><td>
Standardablauf

</td><td>
1) Die in „Tabelle TAB_KON_683 LAN-Adapter

IP-Konfiguration

„ und „Tabelle TAB_KON_684 LAN-Adapter Erweiterte

Parameter

„ gesetzten Werte sind zur Konfiguration des LAN-Adapter zu verwenden.

2) Rufe TUC_KON_304 „Netzwerk-Routen einrichten“

3) Wenn (ANLW_WAN_ADAPTER_MODUS = DISABLED)

und MGM_LU_ONLINE = ENABLED:

 ---> UL

4) Firewall-Regeln aktualisieren und aktivieren. Tritt der Fehler 4164 auf, geht
der Konnektor in den Betriebszustand EC_Firewall_Not_Reliable über.

</td></tr><tr><td>
Varianten/

Alternativen

</td><td>
Keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
(



1) Fehlerhafte LAN IP-Konfiguration; 4162

(



4) Beim Aktualisieren oder Aktivieren der Firewall-Regeln ist es zu einem Fehler
gekommen; 4164

</td></tr><tr><td>
Nichtfunktionale

Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige

Diagramme

</td><td>
Keine

</td></tr></table>

Tabelle311: TAB_KON_615 Fehlercodes TUC_KON_305 „LAN-Adapter initialisieren“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4162

</td><td>
Technical

</td><td>
Error

</td><td>
Es liegt eine fehlerhafte LAN IP-Konfiguration vor.

</td></tr><tr><td>
4164

</td><td>
Technical

</td><td>
Fatal

</td><td>
Beim Aktualisieren oder Aktivieren der Firewall-Regeln ist es zu einem Fehler
gekommen.

</td></tr></table>

**[\<=]**

### 4.2.1.3.2 TUC_KON_306 „WAN-Adapter initialisieren“

##### TIP1-A_4755

Der Konnektor MUSS den technischen Use Case TUC_KON_306 „WAN-Adapter
initialisieren“ umsetzen.

Tabelle312: TAB_KON_616 - TUC_KON_306 „WAN-Adapter initialisieren“

<table><tr><th>
Element

</th><th>
Beschreibung

</th></tr><tr><td>
Name

</td><td>
TUC_KON_306 WAN-Adapter initialisieren

</td></tr><tr><td>
Beschreibung

</td><td>
Initialisieren der WAN-Netzwerkschnittstelle

</td></tr><tr><td>
Auslöser

</td><td>
 ---> UL

</td></tr><tr><td>
Vorbedingungen

</td><td>
</td></tr><tr><td>
Eingangsdaten

</td><td>
Keine

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
Keine

</td></tr><tr><td>
Standardablauf

</td><td>
1) Wenn ANLW_WAN_ADAPTER_MODUS = DISABLED oder MGM_LU_ONLINE = Disabled:

a) Aktive VPN-Tunnel TI oder SIS (VPN_TI oder VPN_SIS) müssen gestoppt werden,

2) Wenn ANLW_WAN_ADAPTER_MODUS = ENABLED und  MGM_LU_ONLINE = ENABLED:

a) Der WAN-Adapter wird abhängig von DHCP_CLIENT_WAN_STATE statisch oder
dynamisch über DHCP konfiguriert. Die in „Tabelle TAB_KON_685 WAN-Adapter
IP-Konfiguration„ und „Tabelle TAB_KON_686 WAN-Adapter Erweiterte
Parameter„ gesetzten Werte sind zur Konfiguration des WAN-Adapter zu
verwenden.

b) Rufe TUC_KON_304 „Netzwerk-Routen einrichten“

c) Rufe TUC_KON_321 „Verbindung zu dem VPN-Konzentrator der TI aufbauen“.

d) Rufe TUC_KON_322 „Verbindung zu dem VPN-Konzentrator des SIS aufbauen“

e) Firewall-Regeln aktualisieren und aktivieren. Tritt der Fehler 4164 auf, geht
der Konnektor in den Betriebszustand EC_Firewall_Not_Reliable über.

</td></tr><tr><td>
Varianten/

Alternativen

</td><td>
Keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
(



1) Fehlerhafte WAN IP-Konfiguration; 4163

(



2) Beim Aktualisieren oder Aktivieren der Firewall-Regeln ist es zu einem Fehler
gekommen; 4164

</td></tr><tr><td>
Nichtfunktionale

Anforderungen

</td><td>
Keine

</td></tr></table>

Tabelle313: TAB_KON_617 Fehlercodes TUC_KON_306 „WAN-Adapter initialisieren“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4163

</td><td>
Technical

</td><td>
Error

</td><td>
Es liegt eine fehlerhafte WAN-IP-Konfiguration vor.

</td></tr><tr><td>
4164

</td><td>
Technical

</td><td>
Fatal

</td><td>
Beim Aktualisieren oder Aktivieren der Firewall-Regeln ist es zu einem Fehler
gekommen.

</td></tr></table>

**[\<=]**

### 4.2.1.3.3 TUC_KON_304 „Netzwerk-Routen einrichten“

##### TIP1-A_4758

Der Konnektor MUSS den technischen Use Case TUC_KON_304 „Netzwerk-Routen
einrichten“ umsetzen.

Tabelle314: TAB_KON_622 - TUC_KON_304 „Netzwerk-Routen einrichten“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_304 Netzwerk-Routen einrichten

</td></tr><tr><td>
Beschreibung

</td><td>
Anpassen der Routing-Tabelle

</td></tr><tr><td>
Auslöser

</td><td>
 ---> UL

</td></tr><tr><td>
Vorbedingungen

</td><td>
keine

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
Keine

</td></tr><tr><td>
Nachbedingungen

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablau

</td><td>
Alle bestehenden Routen MÜSSEN vollständig durch die in diesem TUC ermittelten
Routen ersetzt werden.

1) Wenn (MGM_LU_ONLINE=Enabled)

Der Konnektor MUSS die nachfolgenden Routen bereitstellen

a)

       i.           Ziel: Lokale Netze

der Einsatzumgebung

           gemäß ANLW_LEKTR_INTRANET_ROUTES

           

Next Hop: gemäß  
           ANLW_LEKTR_INTRANET_ROUTES

b)             Wenn die VPN-Tunnel zur TI und zum SIS nicht  
    
aufgebaut sind:

       

i.        Ziel: Default Route

           

Next Hop: ANLW_IAG_ADDRESS

c)             Wenn der VPN-Tunnel zur TI aufgebaut und der  
   
VPN-Tunnel zum SIS nicht aufgebaut sind:

      

i.        Ziel: Default Route  
           Next Hop:
ANLW_IAG_ADDRESS

      

ii.       Ziel: TI (NET_TI_OFFENE_FD,  
          
NET_TI_GESICHERTE_FD und NET_TI_ZENTRAL)  
           Next Hop: Innere
Tunnel IP-Adresse des VPN-  
           Konzentrators TI

     

iii.       Ziel: ANLW_AKTIVE_BESTANDSNETZE  
           Next
Hop: Innere Tunnel IP-Adresse des VPN-  
           Konzentrators TI

     

iv.       Ziel: VPN-Konzentrator TI  
           Next Hop:
ANLW_IAG_ADDRESS

d)            Wenn die VPN-Tunnel zur TI und zum SIS  
    
aufgebaut sind:

        

i.       Ziel: Default Route  
           Next Hop: Innere
Tunnel IP-Adresse des VPN-  
           Konzentrators SIS

       

ii.       Ziel: TI (NET_TI_OFFENE_FD,  
          
NET_TI_GESICHERTE_FD und NET_TI_ZENTRAL)  
           Next Hop:
Innere Tunnel IP-Adresse des VPN-  
           Konzentrators TI

      

iii.      Ziel: ANLW_AKTIVE_BESTANDSNETZE  
           Next Hop:
Innere Tunnel IP-Adresse des VPN-  
           Konzentrators TI

      

iv.      Ziel: VPN-Konzentrator TI  
           Next Hop:
ANLW_IAG_ADDRESS

       

v.       Ziel: VPN-Konzentrator SIS  
           Next Hop:
ANLW_IAG_ADDRESS

Hinweis: Wenn der VPN-Tunnel zur TI nicht existiert, kann  
auch kein VPN-Tunnel
zum SIS existieren, da die Default  
Route zum IAG zeigen muss, um einen
VPN-Tunnel zur TI  
aufbauen zu können.

2) Wenn (MGM_LU_ONLINE=Disabled)

1.          Der Konnektor MUSS die nachfolgenden Routen  
    
bereitstellen.

     

i.        Ziel: Lokale Netze

der Einsatzumgebung

           

gemäß ANLW_LEKTR_INTRANET_ROUTES  
           Next Hop: gemäß 

           ANLW_LEKTR_INTRANET_ROUTES

3) Firewall aktualisieren:

Die Firewall des Konnektors MUSS die neu eingerichteten  
Routen
berücksichtigen und seine Regeln entsprechend aktualisieren und aktivieren.
Tritt der Fehler 4164 auf, geht der Konnektor in den Betriebszustand
EC_Firewall_Not_Reliable über.

</td></tr><tr><td>
Varianten/Alternativen

</td><td>
Keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
(



1-2) Eine oder mehrere Variablen enthalten eine ungültige oder keine IP; 4167

(



3) Beim Aktualisieren oder Aktivieren der Firewall-Regeln ist es zu einem Fehler
gekommen; 4164

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
Keine

</td></tr></table>

Tabelle315: TAB_KON_623 Fehlercodes TUC_KON_304 „Netzwerk-Routen einrichten“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4167

</td><td>
Technical

</td><td>
Fatal

</td><td>
CreateRoutes:

Ein oder mehrere Adressen sind ungültig.

</td></tr><tr><td>
4164

</td><td>
Technical

</td><td>
Fatal

</td><td>
Beim Aktualisieren oder Aktivieren der Firewall-Regeln ist es zu einem Fehler
gekommen.

</td></tr></table>

**[\<=]**

### 4.2.1.4 Interne TUCs, auch durch Fachmodule nutzbar

Keine.

### 4.2.1.5 Operationen an der Außenschnittstelle

Keine

### 4.2.1.6 Betriebsaspekte

##### TIP1-A_5414

Der KonnektorMUSS in der Bootup-Phase zur Initialisierung des Funktionsmerkmals
„Anbindung LAN/WAN“:

 ---> UL

**[\<=]**

##### TIP1-A_4759

Der Konnektor MUSS gewährleisten, dass die Konfiguration nur dann gespeichert
wird, wenn alle Parameter der nachfolgenden Tabellen den dazugehörigen
Bedingungen entsprechen, sowie grundsätzlich zulässige Werte darstellen
(gemäß RFCs).Wenn die Konfiguration per Managementschnittstelle geändert
wurde, MUSS das folgende Systemereignis ausgelöst
werden:TUC_KON_256 {      topic =
"ANLW/LAN/IP_CHANGED";      eventType = Op;      severity =
Info;      parameters = („IP=$dieNeueIP”);      doDisp =
false}Wenn (DHCP_CLIENT_LAN_STATE=Disabled) gesetzt ist, MUSS der Administrator
des Konnektor die Werte der folgenden Tabelle über die Managementschnittstelle
setzen können.Wenn (DHCP_CLIENT_LAN_STATE=Enabled) gesetzt ist, MUSS der
Administrator des Konnektor die Werte der folgenden Tabelle angezeigt bekommen,
kann diese jedoch nicht ändern.

Tabelle316: TAB_KON_683 LAN-Adapter IP-Konfiguration

<table><tr><th>
ReferenzID

</th><th>
Belegung

</th><th>
Bedeutung und Administrator-Interaktion

</th></tr><tr><td>
ANLW_LAN_IP_  
ADDRESS

</td><td>
IP-Adresse

</td><td>
Dies ist die IP-Adresse des LAN-Adapters.

Nur wenn DHCP_CLIENT_LAN_STATE=Disabled MUSS der Administrator die LAN-seitige
IP-Adresse des Konnektors setzen können.

Diese IP-Adresse MUSS innerhalb des ANLW_LAN_NETWORK_SEGMENT liegen.

</td></tr><tr><td>
ANLW_LAN_  
SUBNETMASK

</td><td>
Subnetzmaske

</td><td>
Dies ist die zu ANLW_LAN_IP_ADDRESS gehörende Subnetzmaske.

Der Administrator MUSS die Subnetzmaske setzen können.

Der Konnektor MUSS gewährleisten das nur eine gültige Subnetzmaske gespeichert
werden kann.

</td></tr><tr><td>
ANLW_LAN_  
NETWORK_  
SEGMENT

</td><td>
IP-Adresse / Subnetzmaske

</td><td>
ANLW_LAN_NETWORK_SEGMENT ist ein Zustandswert, der sich aus den Werten von
ANLW_LAN_IP_ADDRESS und ANLW_LAN_SUBNETMASK ergibt.

Der Wert bezeichnet ein lokales Netzwerk in der Umgebung des Anwenders an das
der LAN-Adapter des Konnektors angeschlossen ist.

Der Konnektor MUSS gewährleisten, das das Netzwerksegment NICHT mit einem der
folgenden Netzwerksegmente überlappt:

1. NET_TI_DEZENTRAL

2. NET_TI_ZENTRAL

3. NET_TI_OFFENE_FD

4. NET_TI_GESICHERTE_FD

5. NET_SIS

6. ANLW_BESTANDSNETZE

7. ANLW_AKTIVE_BESTANDSNETZE

8. ANLW_WAN_NETWORK_SEGMENT

9. ANLW_LEKTR_INTRANET_ROUTES

</td></tr></table>

Der Administrator des Konnektor MUSS die Werte der folgenden Tabelle über die
Managementschnittstelle setzen können.

Tabelle317: TAB_KON_684 LAN-Adapter Erweiterte Parameter

<table><tr><th>
ReferenzID

</th><th>
Belegung

</th><th>
Bedeutung und Administrator-Interaktion

</th></tr><tr><td>
ANLW_LAN_MTU

</td><td>
Nummer

</td><td>
Der Administrator MUSS Maximum Transmission Unit (MTU) setzen können.

Der Konnektor MUSS sicherstellen, das der konfigurierte Wert in den Grenzen von
576 bis 9000 liegt.

Default-Wert: 1400

</td></tr><tr><td>
ANLW_LAN_PARAMETER

</td><td>
Liste von IP, UDP und/oder TCP Parametern

</td><td>
Der Administrator SOLL weitere Konfigurationsparameter gemäß
[gemSpec_Net#2.2.2.1,2.5] konfigurieren können.

</td></tr></table>

**[\<=]**

##### TIP1-A_4760

Der Konnektor MUSS gewährleisten, dass die Konfiguration nur dann gespeichert
wird, wenn alle Parameter der nachfolgenden Tabellen den dazugehörigen
Bedingungen entsprechen.Wenn die Konfiguration per Managementschnittstelle
geändert wurde, MUSS das folgende Systemereignis ausgelöst
werden:    TUC_KON_256 {topic = "ANLW/WAN/IP_CHANGED";eventType =
Op;severity = Info;parameters = („IP=$dieNeueIP“);doDisp = false}Wenn
(DHCP_CLIENT_WAN_STATE=Disabled) gesetzt ist, MUSS der Administrator des
Konnektors die Werte der folgenden Tabelle über die Managementschnittstelle
setzen können.Wenn (DHCP_CLIENT_WAN_STATE=Enabled) gesetzt ist, MUSS der
Administrator des Konnektors die Werte der folgenden Tabelle angezeigt
bekommen, kann diese jedoch nicht ändern.

Tabelle318: TAB_KON_685 WAN-Adapter IP-Konfiguration

<table><tr><th>
ReferenzID

</th><th>
Belegung

</th><th>
Bedeutung und Administrator-Interaktion

</th></tr><tr><td>
ANLW_WAN_  
IP_ADDRESS

</td><td>
IP-Adresse

</td><td>
Dies ist die IP-Adresse des WAN-Adapters.

Nur wenn DHCP_CLIENT_WAN_STATE=Disabled und ANLW_WAN_ADAPTER_MODUS=ENABLED MUSS
der Administrator die WAN-seitige IP-Adresse des Konnektors setzen können.

Diese IP-Adresse MUSS innerhalb des ANLW_WAN_NETWORK_SEGMENT liegen.

</td></tr><tr><td>
ANLW_WAN_  
SUBNETMASK

</td><td>
Subnetzmaske

</td><td>
Dies ist die zu ANLW_WAN_IP_ADDRESS gehörende Subnetzmaske.

Der Administrator MUSS die Subnetzmaske setzen können.

Der Konnektor MUSS gewährleisten, dass nur eine gültige Subnetzmaske
gespeichert werden kann.

</td></tr><tr><td>
ANLW_WAN_  
NETWORK_  
SEGMENT

</td><td>
IP-Adresse / Subnetzmaske

</td><td>
ANLW_WAN_NETWORK_SEGMENT ist ein Zustandswert, der sich aus den Werten von
ANLW_WAN_IP_ADDRESS und ANLW_WAN_SUBNETMASK ergibt.

Der Wert bezeichnet ein lokales Netzwerk in der Umgebung des Anwenders an das
der WAN-Adapter des Konnektors angeschlossen ist.

Der Konnektor MUSS gewährleisten, dass das Netzwerksegment nicht mit einem der
folgenden Netzwerksegmente überlappt:

1. NET_TI_DEZENTRAL

2. NET_TI_ZENTRAL

3. NET_TI_OFFENE_FD

4. NET_TI_GESICHERTE_FD

5. NET_SIS

6. ANLW_ BESTANDSNETZE

7. ANLW_AKTIVE_BESTANDSNETZE

8. ANLW_LAN_NETWORK_SEGMENT

9. ANLW_LEKTR_INTRANET_ROUTES

</td></tr></table>

Der Administrator des Konnektor MUSS die Werte der folgenden Tabelle über die
Managementschnittstelle setzen können.

Tabelle319: TAB_KON_686 WAN-Adapter Erweiterte Parameter

<table><tr><th>
ReferenzID

</th><th>
Belegung

</th><th>
Bedeutung und Administrator-Interaktion

</th></tr><tr><td>
ANLW_WAN_MTU

</td><td>
Nummer

</td><td>
Der Administrator MUSS Maximum Transmission Unit (MTU) setzen können.

Der Konnektor MUSS sicherstellen, das der konfigurierte Wert in den Grenzen von
576 bis 9000 liegt.

Default-Wert: 1400 

</td></tr><tr><td>
ANLW_WAN_PARAMETER

</td><td>
Liste von IP, UDP und/oder TCP Parametern

</td><td>
Der Administrator SOLL weitere Konfigurationsparameter gemäß
[gemSpec_Net#2.2.2.1,2.5] konfigurieren können.

</td></tr></table>

**[\<=]**

##### TIP1-A_4761

Die Managementschnittstelle MUSS es einem Administrator ermöglichen
Konfigurationsänderungen gemäß Tabelle TAB_KON_624 –
„Konfigurationsparameter der Anbindung LAN/WAN vorzunehmen.Wenn
(ANLW_INTRANET_ROUTES_MODUS = REDIRECT) gesetzt ist, MUSS der Konnektor jedes
Paket aus einem konfigurierten Intranet mit einem ICMP-Redirect mit dem
hinterlegten Next Hop beantworten und der Konnektor MUSS gewährleisten, dass
keine IP-Pakete in eines oder mehrere der konfigurierten Intranet geroutet
werden.Wenn (ANLW_INTRANET_ROUTES_MODUS = BLOCK) gesetzt ist, MUSS der
Konnektor alle IP-Pakete für ein Intranet (gemäß ANLW_LEKTR_INTRANET_ROUTES)
ablehnen.

Tabelle320: TAB_KON_624 – „Konfigurationsparameter der Anbindung LAN/WAN“

<table><tr><th>
ReferenzID

</th><th>
Belegung

</th><th>
Bedeutung und Administrator-Interaktion

</th></tr><tr><td rowspan="2">
ANLW_

ANBINDUNGS_

MODUS

</td><td>
InReihe

</td><td>
Der Konnektor ist in Reihe zu dem IAG der Einsatzumgebung geschaltet.

Wenn ANLW_WAN_ADAPTER_MODUS= ENABLED befindet sich der Konnektor in diesem
Anbindungsmodus.

Der Administrator MUSS diesen Wert einsehen und DARF ihn NICHT ändern können.

</td></tr><tr><td>
Parallel

</td><td>
Der Konnektor ist parallel (zu allen bestehenden Systemen) ins Netzwerk der
Einsatzumgebung angebunden.

Wenn ANLW_WAN_ADAPTER_MODUS= DISABLED befindet sich der Konnektor in diesem
Anbindungsmodus.

Der Administrator MUSS diesen Wert einsehen und DARF ihn NICHT ändern können.

</td></tr><tr><td rowspan="3">
ANLW_

INTERNET_

MODUS

</td><td>
SIS

</td><td>
Der (am Konnektor LAN-seitig ankommende) Internet-Traffic wird per VPN an den
SIS geschickt.

</td></tr><tr><td>
IAG

</td><td>
Bei Anfragen ins Internet wird der Aufrufer per ICMP-Redirect (Type 5) auf die
Route zum IAG verwiesen.

Wenn (ANLW_ANBINDUNGS_MODUS = InReihe) DARF dieser Wert NICHT auswählbar sein -
statt dessen MUSS dann der Wert SIS verwendet werden.

</td></tr><tr><td>
KEINER

</td><td>
Es wird kein Traffic ins Internet geroutet

</td></tr><tr><td rowspan="2">
ANLW_

INTRANET_

ROUTES_

MODUS

</td><td>
REDIRECT

</td><td>
Der Konnektor MUSS sicherstellen, dass dieser Wert nur gesetzt werden kann, wenn
der Administrator zuvor ein oder mehrere Intranet (ANLW_LEKTR_INTRANET_ROUTES)
definiert hat.

</td></tr><tr><td>
BLOCK

</td><td>
Der Konnektor MUSS alle IP-Pakete für ein Intranet (gemäß
ANLW_LEKTR_INTRANET_ROUTES) ablehnen.

</td></tr><tr><td rowspan="2">
ANLW_WAN_

ADAPTER_

MODUS

</td><td>
ENABLED

</td><td>
Dieser Parameter ändert den Interface-Status des WAN-Adapters.

Der Administrator MUSS diesen Wert einsehen können.

Der Administrator MUSS diesen Wert ändern können.

</td></tr><tr><td>
DISABLED

</td><td>
Dieser Parameter ändert den Interface-Status des WAN-Adapters.

Der Administrator MUSS diesen Wert einsehen können.

Der Administrator MUSS diesen Wert ändern können.

</td></tr><tr><td>
ANLW_

LEKTR_

INTRANET_

ROUTES

</td><td>
Tupel aus Netzwerksegment und dazugehörigem Next-Hop

</td><td>
Der Administrator MUSS in diese Liste Einträge hinzufügen, editieren und
löschen können.

Liste von Routen zur Erreichung der Clientsysteme und Kartenterminals vom
Konnektor; jeweils mit IP-Netzwerk dazugehörigem Next Hop.

Die Netzwerksegmente DÜRFEN NICHT mit den Netzbereichen

 ---> UL

NET_TI_ZENTRAL

 ---> UL

kollidieren.

</td></tr><tr><td>
ANLW_IAG_

ADDRESS

</td><td>
IP Adresse

</td><td>
ANLW_IAG_ADDRESS ist die Adresse des Default Gateways. Diese IP-Adresse MUSS
innerhalb des ANLW_WAN_NETWORK_SEGMENT

liegen.

Die Adresse wird entweder über DHCP automatisch (DHCP_CLIENT_WAN_STATE=ENABLED
oder DHCP_CLIENT_LAN_STATE=ENABLED) oder anderenfalls manuell durch den
Administrator konfiguriert. Bei automatischer Konfiguration per DHCP MUSS der
Administrator den Wert von ANLW_IAG_ADDRESS ausschließlich einsehen können.

</td></tr><tr><td>
ANLW_

AKTIVE_

BESTANDS

NETZE

</td><td>
Liste von IP-Address-Segmenten

</td><td>
Der Administrator MUSS manuell aus der empfangenen Liste der zur Verfügung
stehenden angeschlossene Netze des Gesundheitswesens mit WANDA Basic (gemäß
TUC_KON_283 „Infrastruktur Konfiguration aktualisieren“) einzelne
deaktivieren, bzw. nach vorheriger Deaktivierung, freischalten können. Nur die
freigegeben Netze werden in dieser Variablen erfasst und sind aus den
Netzwerken der Einsatzumgebung  erreichbar.

Wird eine Änderung an der Liste der freigegebenen Netze vorgenommen, so MUSS
der Konnektor für jedes dieser freigegebenen Netz in DNS_SERVERS_BESTANDSNETZE
ein DNS-Referer-Eintrag für jede der dazugehörigen Domains mit allen
zugehörigen DNS-Servern im Konnektor hinterlegen. Die Werte hierzu werden der
via TUC_KON_283 aktualisierten Bestandsnetze.xml entnommen.

Für hier „nicht freigegebene“ oder zwischenzeitlich gelöschte Netze DARF
der Konnektor NICHT Referer-Einträge in DNS_SERVERS_BESTANDSNETZE enthalten.

Die Einträge in DHCP_AKTIVE_BESTANDSNETZE_ROUTES sind entsprechend zu
aktualisieren.

Der Konnektor MUSS nach jeder Änderung dieser Variablen durch den Administrator
den TUC_KON_304 „Netzwerk-Routen einrichten“ aufrufen.

</td></tr><tr><td rowspan="2">
ANLW_

IA_

BESTANDSNETZE

</td><td>
AN

</td><td>
Der Konnektor MUSS alle über TUC_KON_283 übermittelten

angeschlossenen Netze des Gesundheitswesens mit WANDA Basic

aktivieren. Eine spätere manuelle Deaktivierung über das Management-Interface
durch den Administrator ist möglich. Dieses Verhalten ist als
Standardverhalten zu konfigurieren.

</td></tr><tr><td>
AUS

</td><td>
Der Konnektor MUSS alle über TUC_KON_283 übermittelten angeschlossenen Netze
des Gesundheitswesens mit WANDA Basic anbieten, diese aber nicht aktivieren.
Eine spätere manuelle Aktivierung erfolgt über das Mangement-Interface durch
den Administrator.

</td></tr></table>

**[\<=]**

##### TIP1-A_5537

Der Konnektor MUSS über die Managmentschnittstelle die konfigurierten IP-Routen
und die aktuelle IP-Routingtabelle mit mindestens folgenden Informationen
anzeigen:

 ---> UL

**[\<=]**

##### TIP1-A_4762

Im Anschluss an eine Anpassung der ANLW_FW_SIS_ADMIN_RULES MUSS der Konnektor
die Firewall neu erstellen und laden.

Tabelle321: TAB_KON_625 - Konfigurationsparameter Firewall-Schnittstelle

<table><tr><th>
ReferenzID

</th><th>
Belegung

</th><th>
Bedeutung und Administrator-Interaktion

</th></tr><tr><td>
ANLW_FW_SIS_  
ADMIN_RULES

</td><td>
Firewall Regelset

</td><td>
Der Administrator MUSS Firewall-Regeln (für den einschränkenden Zugriff auf
die SIS), auf Grundlage der Parameter Absender-IP-Adresse,
Empfänger-IP-Adresse, Protokoll (ggf. mit Absender-Port und Empfänger-Port)
und Verbindungsrichtung, einfügen, editieren und löschen können.

</td></tr></table>

**[\<=]**

### 4.2.2 DHCP-Server

Innerhalb des Kapitels DHCP-Servers werden folgende Präfixe für Bezeichner
verwendet:

 ---> UL

### 4.2.2.1 Funktionsmerkmalweite Aspekte

##### TIP1-A_4763

Der Konnektor MUSS an seiner LAN-Schnittstelle einen DHCP-Server
gemäß[RFC2131] und [RFC2132] anbieten. **[\<=]**

### 4.2.2.2 Durch Ereignisse ausgelöste Reaktionen

Keine.

### 4.2.2.3 Interne TUCs, nicht durch Fachmodule nutzbar

Keine.

### 4.2.2.4 Interne TUCs, auch durch Fachmodule nutzbar

Keine.

### 4.2.2.5 Operationen an der Außenschnittstelle

### 4.2.2.5.1 Liefere Netzwerkinformationen über DHCP

##### TIP1-A_4765

Der DHCP-Server des Konnektors MUSS an der Client-Schnittstelle eine Operation
zur Lieferung von Netzwerkinformationen über DHCP anbieten.

Tabelle322: TAB_KON_626 „Liefere Netzwerkinformationen über DHCP“

<table><tr><th>
Name

</th><th>
Liefere Netzwerkinformationen über DHCP

</th></tr><tr><td>
Beschreibung

</td><td>
Der Konnektor MUSS anfragenden Clients per DHCP die konfigurierten
Netwerkinformationen liefern (siehe Tabelle TAB_KON_628 und Tabelle
TAB_KON_629).

</td></tr><tr><td>
Aufrufparameter

</td><td>
gemäß [RFC2131], [RFC2132]

</td></tr><tr><td>
Rückgabe

</td><td>
gemäß [RFC2131], [RFC2132]

</td></tr><tr><td>
Standardablauf

</td><td>
Die an den aufrufenden Client zu übergebenden Parameter ergeben sich aus
Tabelle TAB_KON_628 und Tabelle TAB_KON_629:

Falls DHCP_SERVER_STATE = Enabled:

 ---> UL

</td></tr><tr><td>
Fehlercodes

</td><td>
Vgl. [RFC2131], [RFC2132]

</td></tr><tr><td>
Vorbedingungen

</td><td>
Der DHCP-Server des Konnektors MUSS aktiviert und konfiguriert sein.

</td></tr><tr><td>
Nachbedingungen

</td><td>
Der DHCP-Server MUSS die DHCP-Antwort geliefert haben. Die Statusinformationen
(z.B. Client Lease) müssen gemäß [RFC2131] gespeichert werden.

</td></tr><tr><td>
Hinweise

</td><td>
Keine

</td></tr></table>

**[\<=]**

### 4.2.2.6 Betriebsaspekte

##### TIP1-A_4766

Der DHCP- Server des KonnektorsMUSSdurch den Administrator über die
Managementschnittstelle aktivierbar und deaktivierbarsein(gemäß
TAB_KON_627).Der DHCP-ServerMUSSbei der Auslieferung deaktiviert sein.

Bei der Aktivierung MUSS der Konnektor
denTUC_KON_343"InitialisierungDHCP-Server"durchlaufen.

Sobald DHCP_SERVER_STATE geändert wurde,
mussTUC_KON_256{"DHCP/SERVER/STATECHANGED"; Op; Info;
"STATE=$DHCP_SERVER_STATE"} aufgerufen werden.

Tabelle323: TAB_KON_627„Aktivierung des DHCP-Servers“

<table><tr><th>
Referenz ID

</th><th>
Belegung

</th><th>
Bedeutung

</th></tr><tr><td>
DHCP_SERVER_STATE

</td><td>
Enabled/Disabled

</td><td>
Der DHCP-Server MUSS durch den Administrator aktivierbar und deaktivierbar sein.

</td></tr></table>

**[\<=]**

##### TIP1-A_4767

Der Konnektor MUSS die Möglichkeit bieten die in Tabelle TAB_KON_628 und
Tabelle TAB_KON_629 beschriebenen Parameter des DHCP-Servers über die
Managementschnittstelle zu konfigurieren.

Tabelle324: TAB_KON_628 „Basiskonfiguration des DHCP-Servers“

<table><tr><th>
Referenz ID

</th><th>
Belegung

</th><th>
Bedeutung

</th></tr><tr><td>
DHCP_SERVER_NETWORK

</td><td>
IP-Adresse

</td><td>
IP-Netzwerk der Einsatzumgebung.

</td></tr><tr><td>
DHCP_SERVER_BROADCAST

</td><td>
IP-Adresse

</td><td>
Die Broadcast-Adresse des Konnektors am LAN-Interface

</td></tr><tr><td>
DHCP_SERVER_  
DYNAMIC_RANGE

</td><td>
von – bis IP-Adresse

</td><td>
Adressbereich für Adressen die dynamisch vergeben werden dürfen.

</td></tr><tr><td>
DHCP_SERVER_  
CLIENTGROUPS

</td><td>
Name der Clientgruppe;

Liste an MAC-Adressen

</td><td>
Der Konnektor MUSS dem Administrator über die Managementschnittstelle die
Möglichkeit bieten mindestens zwei Client-Gruppen zu verwalten.

</td></tr><tr><td>
DHCP_SERVER_  
DEFAULT_CLIENTGROUP

</td><td>
Client-Gruppe

</td><td>
Standardmäßig eingestellte Client-Gruppe. Wird verwendet falls DHCP-Anfrage
keiner anderen Client-Gruppe zugeordnet werden kann.

</td></tr></table>

Tabelle325: TAB_KON_629 „Client-Gruppenspezifische Konfigurationsoptionen des
Konnektor-DHCP-Servers“

<table><tr><th>
ReferenzID

</th><th>
Belegung

</th><th>
Bedeutung

</th></tr><tr><td colspan="3">
Die gesamte Parameterliste ist für jede Client-Gruppe getrennt konfigurierbar

</td></tr><tr><td>
DHCP_  
OWNDNS_  
ENABLED

</td><td>
Enabled/Disabled

</td><td>
Der Administrator MUSS konfigurieren können, ob der konnektoreigene DNS-Server
als Parameter übergeben wird.  
Default-Wert: Disabled

</td></tr><tr><td>
DHCP_DNS_  
ADDR

</td><td>
IP-Adressen der DNS-Server

</td><td>
Falls der konnektoreigene DNS-Server nicht übergeben werden soll, müssen die
Adressen externer aus dem Netz der Einsatzumgebung erreichbaren DNS-Server als
Parameter übergeben werden. Der Administrator MUSS diese Adressen
konfigurieren können.

</td></tr><tr><td>
DHCP_NTP

</td><td>
Enabled/Disabled

</td><td>
Der Administrator MUSS konfigurieren können, ob der Konnektor die Adresse des
Konnektor internen NTP-Servers per DHCP an die Clients sendet.  
Default-Wert:
Enabled

</td></tr><tr><td>
DHCP_  
OWNDGW_  
ENABLED

</td><td>
Enabled/Disabled

</td><td>
Der Administrator MUSS konfigurieren können, ob der Konnektor beim Client als
Default-Gateway gesetzt werden soll.  
Default-Wert: Disabled

</td></tr><tr><td>
DHCP_DGW_  
ADDR

</td><td>
IP-Adresse des DGW

</td><td>
Falls der Konnektor nicht als Default Gateway gesetzt werden soll, muss die
Adresse des zu verwendenden DGW als Parameter übergeben werden. Der
Administrator MUSS die Adresse des DGW konfigurieren können.

</td></tr><tr><td>
DHCP_IP_  
NETMASK

</td><td>
Netzmaske

</td><td>
Der Administrator MUSS die Netmask des Clients konfigurieren können.

</td></tr><tr><td>
DHCP_  
DOMAINNAME

</td><td>
Domainname

</td><td>
Der Administrator MUSS den Domainnamen des Clients konfigurieren können.

</td></tr><tr><td>
DHCP_  
HOSTNAME

</td><td>
Liste von Tupel aus Hostname und Mac-Adresse

</td><td>
Der Administrator MUSS eine Liste von Hostname der Clients konfigurieren können
(Einträge einfügen, ändern, löschen).

</td></tr><tr><td>
DHCP_  
STATIC_LEASE

</td><td>
Liste von Tupel aus IP- und Mac-Adresse

</td><td>
Der Administrator MUSS für jede MAC-Adresse Static Lease konfigurieren können.

</td></tr><tr><td>
DHCP_  
LEASE_TTL

</td><td>
X Minuten

</td><td>
Der Administrator MUSS Lease-Dauer der dynamischen Adressen konfigurieren
können.

</td></tr><tr><td>
DHCP_  
AKTIVE_  
BESTANDS  
NETZE_  
ROUTES

</td><td>
Liste von Tupel: Netzwerksegment je INTRANET und Adresse für Next Hop je
freigegebenem angeschlossenen Netze des Gesundheitswesens mit WANDA Basic

</td><td>
Der Administrator MUSS je freigegebenem angeschlossenen Netze des
Gesundheitswesens mit WANDA Basic (aus ANLW_AKTIVE_BESTANDSNETZE) den an den
Client zu übermittelnden Routen-Eintrag aktivieren oder deaktivieren können.

</td></tr><tr><td>
DHCP_  
INTRANET_  
ROUTES

</td><td>
Liste von Tupel: Netzwerksegment je INTRANET und Adresse für Next Hop in die
definierten Intranets

</td><td>
Der Administrator MUSS je Intranet-Tupel (aus ANLW_LEKTR_INTRANET_ROUTES) den an
den Client zu übermittelnden Routen-Eintrag aktivieren oder deaktivieren
können.

</td></tr><tr><td>
DHCP_  
ROUTES

</td><td>
Tupel Netzwerksegment und Adresse für Next Hop

</td><td>
Der Administrator MUSS Routen zur Verteilung an die Clients frei konfigurieren
können. Der Konnektor MUSS sicherstellen, diese Listeneinträge keine
Überschneidungen mit folgenden Netzsegmenten haben:  
- dem Netzwerksegment
ANLW_LAN_NETWORK_SEGMENT   
- dem Netzwerksegment  
ANLW_WAN_NETWORK_SEGMENT 

- jedes Netzsegmente in  
ANLW_BESTANDSNETZE  
ANLW_AKTIVE_BESTANDSNETZE 

ANLW_LEKTR_INTRANET_ROUTES  
Die Routen SOLLEN über DHCP Option 121 (Windows
Vista oder höher) bzw.  
DHCP Option 249 (Windows XP und darunter) verteilt
werden.

</td></tr><tr><td>
DHCP_  
OPTIONS

</td><td>
Liste an weiteren DHCP-Optionen.

</td><td>
Vom Administrator konfigurierbare Liste an weiteren DHCP-Options gemäß
[RFC2132].  
Die Umsetzung dieser Konfigurationsmöglichkeit KANN entfallen.

</td></tr></table>

**[\<=]**

### 4.2.2.6.1 TUC_KON_343 „Initialisierung DHCP-Server“

##### TIP1-A_4768

Der Konnektor MUSS in der Bootup-Phase TUC_KON_343 "Initialisierung DHCP-Server"
durchlaufen.

Tabelle326: TAB_KON_630 - TUC_KON_343 „Initialisierung DHCP-Server“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_343 ”Initialisierung DHCP-Server”

</td></tr><tr><td>
Beschreibung

</td><td>
Falls DHCP-Server Konfiguration aktiv ist, muss der Konnektor in der
Bootup-Phase oder bei einer Aktivierung des Servers den DHCP-Server starten.

</td></tr><tr><td>
Anwendungsumfeld

</td><td>
Bereitstellen der Netzwerkkonfiguration für den Betrieb

</td></tr><tr><td>
Eingangsanforderung

</td><td>
Keine

</td></tr><tr><td>
Auslöser und Vorbedingungen

</td><td>
Bootup oder Ereignis DHCP/SERVER/STATECHANGED

</td></tr><tr><td>
Eingangsdaten

</td><td>
Keine

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
Keine

</td></tr><tr><td>
Standardablauf

</td><td>
Falls DHCP_SERVER_STATE = enabled

  -               den DHCP-Server starten

Falls DHCP_SERVER_STATE = disabled

  -               den DHCP-Server stoppen

</td></tr><tr><td>
Varianten/Alternativen

</td><td>
Keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
4168: DHCP-Server konnte nicht gestartet werden

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
Keine

</td></tr></table>

Tabelle327: TAB_KON_631 Fehlercodes TUC_KON_343 „Initialisierung DHCP-Server“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td>
4168

</td><td>
Technical

</td><td>
Error

</td><td>
Der DHCP-Server des Konnektors konnte nicht gestartet werden.

</td></tr></table>

**[\<=]**

### 4.2.3 DHCP-Client

Innerhalb des Kapitels DHCP-Client werden folgende Präfixe für Bezeichner
verwendet:

 ---> UL

### 4.2.3.1 Funktionsmerkmalweite Aspekte

##### TIP1-A_4769

Der Konnektor MUSS an seiner LAN- und WAN-Schnittstelle die Möglichkeit bieten
jeweils DHCP zu nutzen.Der DHCP-Client des Konnektors MUSS die empfangenen
Parameter wie folgt verwenden:

 ---> UL

Weitere DHCP-Parameter DÜRFEN nicht übernommen werden. **[\<=]**

### 4.2.3.2 Durch Ereignisse ausgelöste Reaktionen

##### TIP1-A_4771

Wenn das Ereignis DHCP/LAN_CLIENT/STATECHANGED
oderDHCP/WAN_CLIENT/STATECHANGEDempfangenwird, MUSS
TUC_KON_341„DHCP-Informationen beziehen“aufgerufenwerden. **[\<=]**

### 4.2.3.3 Interne TUCs, nicht durch Fachmodule nutzbar

### 4.2.3.3.1 TUC_KON_341 „DHCP-Informationen beziehen“

##### TIP1-A_4772

Der Konnektor MUSS den technischen Use Case TUC_KON_341 „DHCP-Informationen
beziehen“ umsetzen.

Tabelle328: TAB_KON_632 – TUC_KON_341 „DHCP Informationen beziehen“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_341 DHCP-Informationen beziehen

</td></tr><tr><td>
Beschreibung

</td><td>
Der Konnektor muss seine WAN- und/oder LAN-Schnittstelle individuell über einen
DHCP-Server aus dem Netz

der Einsatzumgebung beziehen

können.

</td></tr><tr><td>
Anwendungsumfeld

</td><td>
Netzwerkkonfiguration für den Betrieb des Konnektors

</td></tr><tr><td>
Eingangsanforderung

</td><td>
Der Konnektor muss zur Netzwerk-Interface-Konfiguration DHCP nutzen sofern keine
statischen Informationen vorhanden sind.

</td></tr><tr><td>
Auslöser

</td><td>
Bootup, Ablauf einer DHCP-Lease, manuell angestoßenes DHCP-Renew, Aktivierung
der DHCP-Client-Funktionalität.

</td></tr><tr><td>
Vorbedingung

</td><td>
aktivierte DHCP-Client Funktion über die Variablen DHCP_CLIENT_LAN_STATE bzw.
DHCP_CLIENT_WAN_STATE

</td></tr><tr><td>
Eingangsdaten

</td><td>
Netzwerk-Adapter (LAN oder WAN) für den DHCP-Informationen bezogen werden sollen

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
DHCP-Informationen vom DHCP-Server

der Einsatzumgebung

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> UL

</td></tr><tr><td>
Varianten/Alternativen

</td><td>
Keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
4169: Konnektor erhält keine DHCP-Informationen

4170: Konnektor besitzt identische IP-Adressen am WAN- und LAN-Interface

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
Keine

</td></tr></table>

Tabelle329: TAB_KON_633 Fehlercodes TUC_KON_341 „DHCP-Informationen beziehen“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td>
4169

</td><td>
Technical

</td><td>
Error

</td><td>
Konnektor erhält keine DHCP-Informationen.

</td></tr><tr><td>
4170

</td><td>
Technical

</td><td>
Error

</td><td>
Konnektor besitzt identische IP-Adressen am WAN und LAN

</td></tr></table>

**[\<=]**

### 4.2.3.4 Interne TUCs, auch durch Fachmodule nutzbar

Keine.

### 4.2.3.5 Operationen an der Außenschnittstelle

Keine.

### 4.2.3.6 Betriebsaspekte

##### TIP1-A_4773

Die DHCP-Client Funktionalität MUSS für LAN- und WAN-Interface vom
Administrator getrennt aktivierbar und deaktivierbar sein (gemäß
TAB_KON_634). Falls der DHCP-Client nicht verwendet wird MUSS sichergestellt
werden, dass eine statische Konfiguration, für den LAN-Adapter gemäß Tabelle
TAB_KON_683 LAN-Adapter IP-Konfiguration bzw. für den WAN-Adapter gemäß
Tabelle TAB_KON_685 WAN-Adapter IP-Konfiguration, existiert bevor die
Netzwerkeinstellungen übernommen werden.Sobald Parameter geändert wurden,
MUSS TUC_KON_256 „Systemereignis absetzen“ je nachdem auf welchem Interface
der Client aktiviert oder deaktiviert wurde mit folgenden Parameter aufgerufen
werden:TUC_KON_256{"DHCP/LAN_CLIENT/STATECHANGED"; Op;
Info;    "STATE=$DHCP_CLIENT_LAN_STATE"; doDisp =
false}oderTUC_KON_256{"DHCP/WAN_CLIENT/STATECHANGED "; Op;
Info;    "STATE=$DHCP_CLIENT_WAN_STATE "; doDisp = false}

Tabelle330: TAB_KON_634 „Konfiguration des DHCP-Clients“

<table><tr><th>
ReferenzID

</th><th>
Belegung

</th><th>
Bedeutung

</th></tr><tr><td>
DHCP_CLIENT_  
LAN_STATE

</td><td>
Enabled/Disabled

</td><td>
Der Administrator muss den DHCP-Client an der LAN-Schnittstelle aktivieren oder
deaktivieren können.

</td></tr><tr><td>
DHCP_CLIENT_  
WAN_STATE

</td><td>
Enabled/Disabled

</td><td>
Der Administrator muss den DHCP-Client an der WAN-Schnittstelle aktivieren oder
deaktivieren können.

</td></tr></table>

**[\<=]**

##### TIP1-A_4774

Der Administrator MUSS die Möglichkeit haben die DHCP-Lease des Konnektors für
jedes Interface getrennt zu erneuern. **[\<=]**

##### TIP1-A_4776

Falls der DHCP-Client auf der LAN-Seite nach einem Timeout von 30s keine
IP-Adresse bezogen hat, MUSS gemäß [RFC3927] eine Default-Adresse aus
169.254/16 vergeben werden. **[\<=]**

### 4.2.4 VPN-Client

Der VPN-Client beschreibt die Absicherung der Anbindung des Konnektors an die TI
und die Bestandsnetze. Während der technische Kern dieser Funktion, der Aufbau
der VPN- Kanäle zu den Konzentratoren, in [gemSpec_VPN_ZugD#TUC_VPN-ZD_0001]
und [gemSpec_VPN_ZugD#TUC_VPN-ZD_0002] beschrieben wird, regelt dieses Kapitel
die Interaktion, sowie die Konfiguration des VPN-Clients innerhalb des
Konnektors.

Innerhalb des Kapitels VPN-Client werden folgende Präfixe für Bezeichner
verwendet:

 ---> UL

### 4.2.4.1 Funktionsmerkmalweite Aspekte

##### TIP1-A_4778

Der Konnektor MUSS sich im Rahmen des IPsec-Verbindungsaufbaus gegenüber den
VPN-Konzentratoren mit seiner Identität ID.NK.VPN ausweisen.

Der VPN-Client im Konnektor MUSS das folgendeEvent generieren, sobald der
VPN-Tunnel zur TI nicht mehr zur Verfügung steht:

Rufe TUC_KON_256 {"NETWORK/VPN_TI/DOWN"; Op; Warning;}

Der VPN-Client im Konnektor MUSS das folgende Event generieren, sobald der
VPN-Tunnel zum SIS nicht mehr zur Verfügung steht:

Rufe TUC_KON_256 {"NETWORKVPN_SIS/DOWN"; Op; Warning;}

Der Hersteller des Konnektor MUSS sicherstellen, dass eine Anbindung an einen
Konzentrator ausschließlich dann möglich ist, wenn (MGM_LU_ONLINE = Enabled)
gesetzt ist.

Der Administrator des Konnektor MUSS durchdieManagementschnittstelle manuell
einen Verbindungsaufbau und einen Verbindungsabbau eines VPN-Tunnelzur TI
(VPN_TI) oder zu den SIS (VPN_SIS) initiieren können. **[\<=]**

##### TIP1-A_4779

Der Konnektor MUSS gewährleisten, dass nach einem Fehler beim
VPN-Verbindungsaufbau nicht unmittelbar ein weiterer Versuch des
Verbindungsaufbaus durchgeführt wird.

Hierzu MUSS der Hersteller ein inkrementelles (schrittweise anwachsend)Verfahren
wählen, welcher den zeitlichen Abstand zwischen einzelnen Versuchen des
VPN-Verbindungsaufbau definiert. Dieser Abstand MUSS maximal fünf
Minutenbetragen.(Diese Pausesolles dem Konnektor ermöglichen, noch ausreichend
Ressourcen für die verbleibenden Services zur Verfügung zu stellen). **[\<=]**

### 4.2.4.2 Durch Ereignisse ausgelöste Reaktionen

##### TIP1-A_4780

Beim Auftreten einer der nachfolgenden Events MUSS der Konnektor denTUC_KON_321
„Verbindung zu dem VPN-Konzentrator der TI aufbauen“starten, sofern auch
MGM_LU_ONLINE = Enabled.

 ---> UL

**[\<=]**

##### TIP1-A_4781

Beim Auftreten einer der nachfolgenden Events MUSS der Konnektor denTUC_KON_322
„Verbindung zu dem VPN-Konzentrator des SIS aufbauen“starten, sofern
ANLW_INTERNET_MODUS = SIS, MGM_LU_ONLINE = Enabled und die Verbindung
VPN-Konzentrator TI aufgebaut ist:

 ---> UL

**[\<=]**

##### TIP1-A_5417

Beim Auftreten einer der nachfolgenden Events MUSS der Konnektor den VPN-Tunnel
zur TI beenden:

 ---> UL

**[\<=]**

##### TIP1-A_4782

Beim Auftreten einer der nachfolgenden Events MUSS der Konnektor den VPN-Tunnel
zum SIS beenden:

 ---> UL

**[\<=]**

Hinweis: Wenn der IPsec-Tunnel VPN_SIS aufgebaut ist, zeigt die Default Route im
Konnektor auf die innere Tunnel-IP-Adresse des VPN-Konzentrators SIS. Dies ist
bei einer Trennung und dem Wiederaufbau der Verbindung VPN_TI zu beachten.

### 4.2.4.3 Interne TUCs, nicht durch Fachmodule nutzbar

### 4.2.4.3.1 TUC_KON_321 „Verbindung zu dem VPN-Konzentrator der TI aufbauen“

##### TIP1-A_4783

Der Konnektor MUSS den technischen Use Case TUC_KON_321 „Verbindung zu dem
VPN-Konzentrator der TI aufbauen“ umsetzen.

Tabelle331: TAB_KON_635 – TUC_KON_321 „Verbindung zu dem VPN-Konzentrator
der TI aufbauen“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_321 Verbindung zu dem VPN-Konzentrator der TI aufbauen

</td></tr><tr><td>
Beschreibung

</td><td>
Es wird ein IPsec-Tunnel zum VPN-Konzentrator der TI aufgebaut werden. Über den
erfolgreichen Aufbau wird per Event informiert.

</td></tr><tr><td>
Auslöser

</td><td>
Bootup-Phase  
TUC_KON_305 „LAN-Adapter initialisieren“  
TUC_KON_306
„WAN-Adapter initialisieren“  
Event MGM/LU_CHANGED/LU_ONLINE  
Event
NETWORK/VPN/CONFIG_CHANGED  
Optional: Änderungen ANLW_AKTIVE_BESTANDSNETZE 

Manueller Aufruf über Managementschnittstelle

</td></tr><tr><td>
Vorbedingungen

</td><td>
Der TUC_KON_304 „Netzwerk-Routen einrichten“ MUSS fehlerfrei durchgelaufen
sein.

</td></tr><tr><td>
Eingangsdaten

</td><td>
</td></tr><tr><td>
Komponenten

</td><td>
Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
Der virtuelle Adapter VPN_TI mit der IP-Adresse VPN_TUNNEL_TI_INNER_IP des
Konnektors wurde zur Verfügung gestellt.

 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
1) Wenn der Auslöser = Event NETWORK/VPN/CONFIG_CHANGED oder eine Änderung
von ANLW_AKTIVE_BESTANDSNETZE ist, muss der VPN-Tunnel TI abgebaut werden.  
2)
Wenn der VPN-Tunnel TI noch aktiv ist, ist der Ablauf abgeschlossen.
Anderenfalls ist mit Ablaufschritt 3) fortzufahren.  
3) Prüfen, MGM_LU_ONLINE
= Enabled, falls nicht ist der TUC ohne Ausgabe einer Fehlermeldung zu beenden.
 
4) Prüfen, ob die im Konnektor hinterlegte CRL noch gültig ist.  
falls
nicht, muss der TUC_KON_040 „CRL aktualisieren“ aufgerufen werden,
Anschließend erneut prüfen, ob die im Konnektor hinterlegte CRL nun gültig
ist.  
Falls die CRL nicht gültig ist, ist der TUC mit Fehler zu beenden.  
5)
Aufrufen von TUC_VPN-ZD_0001 „IPsec Tunnel TI aufbauen”  
Die folgenden
Rückgabewerte des TUC_VPN-ZD_0001 „IPsec Tunnel TI aufbauen” sind in die
laufende Konfiguration des Konnektors zu übernehmen:

 ---> UL

6) Aufrufen von TUC_KON_304 „Netzwerk-Routen einrichten“  
Sobald der Tunnel
erfolgreich aufgebaut wurde, ist der folgende Event zu generieren: 

TUC_KON_256 {"NETWORK/VPN_TI/UP"; Op; Info;IP= $VPN_TUNNEL_TI_INNER_IP}

</td></tr><tr><td>
Varianten/Alternativen

</td><td>
Keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
(4) CRL ist abgelaufen (outdated); 
          
          
         
         
 Herstellerspezifisch kann entweder (4a) oder (4b) umgesetzt werden: 
         

          
          (4a) Kritischer Fehlerzustand EC_CRL_Out_Of_Date wurde
noch nicht festgestellt: 
          4173 
          
          
          (4b)
kritischer Fehlerzustand EC_CRL_Out_Of_Date wurde bereits festgestellt: 4002  


          (-\>4) Wenn Fehler 4173 bzw. 4002 nicht zutreffen, ist ein
herstellerspezifischer Fehler zu verwenden.  
(5) VPN-Tunnel konnte nicht
aufgebaut werden; Fehlercode: 4174

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
Keine

</td></tr></table>

Tabelle332: TAB_KON_636 Fehlercodes TUC_KON_321 „Verbindung zu dem
VPN-Konzentrator der TI aufbauen“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4002

</td><td>
Security

</td><td>
Fatal

</td><td>
Der Konnektor befindet sich in einem kritischen Betriebszustand

</td></tr><tr><td>
4172

</td><td>
Technical

</td><td>
Fatal

</td><td>
Es ist keine Online-Verbindung zulässig.

</td></tr><tr><td>
4173

</td><td>
Technical

</td><td>
Fatal

</td><td>
Die CRL ist nicht mehr gültig (outdated).

</td></tr><tr><td>
4174

</td><td>
Technical

</td><td>
Fatal

</td><td>
TI-VPN-Tunnel:  
Verbindung konnte nicht aufgebaut werden

</td></tr></table>

**[\<=]**

### 4.2.4.3.2 TUC_KON_322 „Verbindung zu dem VPN-Konzentrator des SIS aufbauen“

##### TIP1-A_4784

Der Konnektor MUSS den technischen Use Case TUC_KON_322 „Verbindung zu dem
VPN-Konzentrator der SIS aufbauen“ umsetzen.

Tabelle333: TAB_KON_637 – TUC_KON_322 „Verbindung zu dem VPN-Konzentrator
der SIS aufbauen“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_322 Verbindung zu dem VPN-Konzentrator der SIS aufbauen

</td></tr><tr><td>
Beschreibung

</td><td>
Es muss ein IPsec-Tunnel zum VPN-Konzentrator der SIS aufgebaut werden

</td></tr><tr><td>
Auslöser

</td><td>
Bootup-Phase  
TUC_KON_305 „LAN-Adapter initialisieren  
TUC_KON_306
„WAN-Adapter initialisieren  
Event NETWORK/VPN/CONFIG_CHANGED  
Optional:
Event MGM/LU_CHANGED/LU_ONLINE  
Manueller Aufruf über Managementschnittstelle

</td></tr><tr><td>
Vorbedingungen

</td><td>
ANLW_INTERNET_MODUS = SIS  
Die Verbindung VPN-Konzentrator TI ist aufgebaut. 

Der TUC_KON_304 „Netzwerk-Routen einrichten“ muss erfolgreich
durchgeführt worden sein.

</td></tr><tr><td>
Eingangsdaten

</td><td>
Keine

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
Der virtuelle Adapter VPN_SIS mit der IP-Adresse VPN_TUNNEL_SIS_INNER_IP wurde
zur Verfügung gestellt.

 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
1) Wenn der Auslöser Event NETWORK/VPN/CONFIG_CHANGED ist, muss der VPN-Tunnel
SIS abgebaut werden.  
2) Wenn der VPN-Tunnel SIS noch aktiv ist, ist der
Ablauf abgeschlossen. Anderenfalls ist mit Ablaufschritt 3) fortzufahren.  
3)
Prüfen, ob (MGM_LU_ONLINE=Enabled). falls nicht ist der TUC ohne Ausgabe einer
Fehlermeldung zu beenden.  
4) entfällt  
5) Prüfen, ob die im Konnektor
hinterlegte CRL noch gültig ist.  
falls nicht, MUSS der TUC_KON_040 „CRL
aktualisieren“ aufgerufen werden, Anschließend erneut prüfen, ob die im
Konnektor hinterlegte CRL nun gültig ist.  
Falls die CRL nicht gültig ist,
ist der TUC mit Fehler zu beenden.  
6) Aufrufen von TUC_VPN-ZD_0002 „IPsec
Tunnel SIS aufbauen”  
7) Aufrufen von TUC_KON_304 „Netzwerk-Routen
einrichten“  
Sobald der Tunnel erfolgreich aufgebaut wurde, ist der folgende
Event zu generieren:  
TUC_KON_256 {"NETWORK/VPN_SIS/UP"; Op; Info;IP=
$VPN_TUNNEL_SIS_INNER_IP}

</td></tr><tr><td>
Varianten/Alternativen

</td><td>
Keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
(3) Keine Online-Verbindung zulässig; 4172  
(5) CRL ist abgelaufen
(outdated);  
 
          
         
           Herstellerspezifisch kann
entweder (5a) oder (5b) umgesetzt werden:  
(5a) Kritischer Fehlerzustand
EC_CRL_Out_Of_Date wurde noch nicht festgestellt: 4173 
          
         
  
        (5b) kritischer Fehlerzustand EC_CRL_Out_Of_Date wurde bereits
festgestellt: 4002  
 
         
         
         (-\>5) Wenn Fehler 4173
bzw. 4002 nicht zutreffen, ist ein herstellerspezifischer Fehler zu verwenden. 

 (6) VPN Tunnel konnte nicht aufgebaut werden; Fehlercode: 4176

</td></tr><tr><td>
Nichtfunktionale  
Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige  
Diagramme

</td><td>
Keine

</td></tr></table>

Tabelle334: TAB_KON_638 Fehlercodes TUC_KON_322 „Verbindung zu dem
VPN-Konzentrator der SIS aufbauen“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4002

</td><td>
Security

</td><td>
Fatal

</td><td>
Der Konnektor befindet sich in einem kritischen Betriebszustand

</td></tr><tr><td>
4172

</td><td>
Technical

</td><td>
Fatal

</td><td>
Es ist keine Online-Verbindung zulässig.

</td></tr><tr><td>
4173

</td><td>
Technical

</td><td>
Fatal

</td><td>
Die CRL ist nicht mehr gültig (outdated).

</td></tr><tr><td>
4176

</td><td>
Technical

</td><td>
Fatal

</td><td>
SIS-VPN-Tunnel:  
Verbindung konnte nicht aufgebaut werden

</td></tr></table>

**[\<=]**

### 4.2.4.4 Interne TUCs, auch durch Fachmodule nutzbar

Keine

### 4.2.4.5 Operationen an der Außenschnittstelle

Keine

### 4.2.4.6 Betriebsaspekte

##### TIP1-A_5415

Der KonnektorMUSS in der Bootup-Phase zur Initialisierung des Funktionsmerkmals
„VPN-Client“:

 ---> UL

**[\<=]**

##### TIP1-A_4785-03

Die Managementschnittstelle MUSS es einem Administrator ermöglichen
Konfigurationsänderungen am VPN-Client gemäß Tabelle TAB_KON_639
vorzunehmen.Der Konnektor MUSS bei einer Änderung der Konfigurationswerte den
folgenden Event auslösen:Rufe TUC_KON_256 {"NETWORK/VPN/CONFIG_CHANGED"; Op;
Info;; doDisp = false}

Tabelle335: TAB_KON_639 – Konfigurationsparameter VPN-Client

<table><tr><th>
ReferenzID

</th><th>
Belegung

</th><th>
Bedeutung und Administrator-Interaktion

</th></tr><tr><td>
IKE_  
KEEPALIVE_  
MODUS

</td><td>
Enabled/Disabled

</td><td>
Der Administrator MUSS einstellen können, ob IKE Keep-Alive-Pakete gesendet
werden.

Ein Hinweis MUSS ausgegeben werden, dass dies bei Nutzung von
Dial-Up-Verbindungen nicht zu empfehlen ist. Dies dient der Vermeidung von
Kosten bei Nutzung eines Internetzugangs ohne Flatrate.

Default-Wert: Enabled

</td></tr><tr><td>
IKE_  
KEEPALIVE_  
INTERVAL

</td><td>
X Sekunden

</td><td>
Der Administrator MUSS die Zeit in Sekunden angeben können, nach der ein neues
IKE Keep-Alive-Paket gesendet wird.

Default-Wert: 30

</td></tr><tr><td>
IKE_  
KEEPALIVE_  
RETRY

</td><td>
X

</td><td>
Der Administrator MUSS angeben können, nach wie vielen IKE Keep-Alive-Paketen
ohne Acknowledge Message die Verbindung beendet wird.

Default-Wert: 3

</td></tr><tr><td>
VPN_IDLE_  
TIMEOUT_  
MODUS

</td><td>
Enabled/Disabled

</td><td>
Der Administrator MUSS einstellen können, ob nach Inaktivität die
VPN-Verbindung automatisch abgebaut werden soll.

Ein Hinweis MUSS ausgegeben werden, dass dies insbesondere bei Nutzung von
Dial-Up-Verbindungen Enabled werden sollte.

Default-Wert: Disabled

</td></tr><tr><td>
VPN_IDLE_  
TIMEOUT

</td><td>
X Sekunden

</td><td>
Der Administrator MUSS die Zeit in Sekunden angeben können, nach der eine
inaktive VPN-Verbindung zu einem Abbau der Verbindung führt.

Default-Wert: 600

</td></tr><tr><td>
NAT_  
KEEPALIVE_  
MODUS

</td><td>
Enabled/Disabled

</td><td>
Der Administrator MUSS einstellen können, ob NAT Keep-Alive-Pakete gesendet
werden.

Ein Hinweis MUSS ausgegeben werden, dass dies insbesondere bei Nutzung von
Dial-Up-Verbindungen nicht zu empfehlen ist.

Default-Wert: Enabled

</td></tr><tr><td>
NAT_  
KEEPALIVE_  
INTERVAL

</td><td>
X Sekunden

</td><td>
Der Administrator MUSS die Zeit in Sekunden angeben können, nach der ein neues
NAT Keep-Alive-Paket gesendet wird.

Default-Wert: 20

</td></tr><tr><td>
VPN_  
KONZENTRATOR_  
TI_IP_ADDRESS

</td><td>
IP-Adresse

</td><td>
IP-Adresse des VPN-Konzentrators TI im Transportnetz zu dem der IPsec-Tunnel
VPN_TI aufgebaut wird. Der Wert kann vom Administrator nur eingesehen werden.

</td></tr><tr><td>
VPN_  
KONZENTRATOR_  
SIS_IP_ADDRESS

</td><td>
IP-Adresse

</td><td>
IP-Adresse des VPN-Konzentrators SIS im Transportnetz zu dem der IPsec-Tunnel
VPN_SIS aufgebaut wird. Der Wert kann vom Administrator nur eingesehen werden.

</td></tr><tr><td>
VPN_TI_MTU

</td><td>
Paketgröße in Byte

</td><td>
Der Administrator MUSS die MTU für ESP-Pakete zur TI (excl. ESP-Header-Size) in
den Grenzen von 576 bis 8076 konfigurieren können.

Default-Wert: 1318

</td></tr><tr><td>
VPN_SIS_MTU

</td><td>
Paketgröße in Byte

</td><td>
Der Administrator MUSS die MTU für ESP Pakete zum SIS (excl. ESP-Header-Size)
in den Grenzen von 576 bis 8076 konfigurieren können.

Default-Wert: 1318

</td></tr><tr><td>
HASH_AND_URL

</td><td>
Enabled/Disabled

</td><td>
Der Administrator MUSS die Nutzung des hash&URL-Verfahrens zum
Zertifikatsaustausch konfigurieren können.

Wenn HASH_AND_URL = Enabled gesetzt ist, wird die URL für das
hash&URL-Verfahren automatisch durch DNS SRV- und TXT-Anfragen mit Owner
„_hashandurl._tcp.\<DNS_DOMAIN_VPN_ZUGD_INT\>„ ermittelt.

Default-Wert: Disabled

</td></tr></table>

**[\<=]**

### 4.2.5 Zeitdienst

Der Zeitdienst schafft die Grundlage einer gleichen Systemzeit für alle in der
TI einzusetzenden Produkttypen. Grundsätzlich ist ein NTP-Server der
Stratum-3-Ebene innerhalb des Konnektors erforderlich, welcher die Zeitangaben
eines NTP-Servers Stratum-2-Ebene abfragt (GS-A_3942). Die in [gemSpec_Net#5.1]
„NTP-Topologie“ getroffenen Anforderungen werden durch dieses Kapitel
erweitert.

Innerhalb des Zeitdienstes werden folgende Präfixe für Bezeichner verwendet:

 ---> UL

### 4.2.5.1 Funktionsmerkmalweite Aspekte

##### TIP1-A_4786

Falls der Leistungsumfang Online nicht aktiviert ist (MGM_LU_ONLINE=Disabled),
MUSS sichergestellt werden, dass der maximale zulässige Fehler von +/-
20ppm(part per million) gegenüber einer Referenzuhr nicht überschritten wird.
Dies entspricht einer maximalen Abweichung im Freilauf von +/- 34,56 Sekunden
über 20 Tage. **[\<=]**

##### TIP1-A_4787

Der NTP-Server des Konnektors MUSS deaktiviert sein, falls der Konnektor
Leistungsumfang Online nicht aktiviert ist (MGM_LU_ONLINE=Disabled. **[\<=]**

Falls die Systemzeit des Konnektors zu stark von der Zeit der zentralen
TI-Plattform abweicht, deutet dies auf ein schwerwiegendes Problem im Konnektor
oder der Umgebung hin, da dies im ordnungsgemäßen Betrieb nicht auftreten
sollte.

##### TIP1-A_4788

Der KonnektorDARF die im Konnektor vorgehaltene Systemzeit im Rahmen einer
automatisierten Synchronisation NICHT aktualisieren, wenn die lokaleZeit von
der im Rahmen der Synchronisation erhaltenen Zeit um mehr
alsNTP_MAX_TIMEDIFFERENCEabweicht.Dies betrifft NICHT Änderungen in der
Darstellung der Systemzeit, die zeitzonenbedingt sind (MEZ -\> MESZ -\> MEZ),
da die Zeitsynchronisation grundsätzlich UTC berücksichtigt.Bei einer
erstmaligen Synchronisierung nach dem Boot-Vorgang oder bei einer erstmaligen
Synchronisierung bei der Inbetriebnahme des Konnektors darf eine
Synchronisation trotz einer Zeitabweichung größer einer Stunde durchgeführt
werden.Daher MUSS der Konnektor bei einer Abweichung von mehr als einer Stunde
indenkritischen BetriebszustandEC_TIME_DIFFERENCE_INTOLERABLEübergehen, ein
weiterer fachlicher Betrieb des Konnektors DARF NICHT mehr erfolgen. **[\<=]**

Der kritische Betriebszustand kann anschließend über einen manuellen Eingriff
(z. B. Reboot) behoben werden (siehe 3.3 Betriebszustand).

##### TIP1-A_4789

TAB_KON_640 listet die zu verwendenden Zustandsvariablen des Konnektor
NTP-Servers. Diese Werte DÜRFEN NICHT durch den Administrator geändert werden.

Tabelle336: TAB_KON_640 Zustandswerte für Konnektor NTP-Server

<table><tr><th>
ReferenzID

</th><th>
Belegung

</th><th>
Zustandswerte

</th></tr><tr><td>
NTP_WARN_PERIOD

</td><td>
30

</td><td>
Anzahl an Tagen nach der ersten erfolglosen Zeitsynchronisierung nach der eine
Warnung an den Betreiber erfolgen soll

</td></tr><tr><td>
NTP_GRACE_PERIOD

</td><td>
50

</td><td>
Anzahl an Tagen nach der ersten erfolglosen Zeitsynchronisierung nach welcher
der Konnektor in einen kritischen Betriebszustand übergehen muss.

Dieser Parameter wirkt nur bei MGM_LU_ONLINE = Enabled.

</td></tr><tr><td>
NTP_MAX_  
TIMEDIFFERENCE

</td><td>
3600

</td><td>
Maximale Zeitabweichung in Sekunden zwischen Systemzeit und Zeit des
Stratum-2-Zeitservers zum Zeitpunkt der Zeitsynchronisierung.

Dieser Parameter wirkt nur bei MGM_LU_ONLINE = Enabled.

</td></tr></table>

**[\<=]**

### 4.2.5.2 Durch Ereignisse ausgelöste Reaktionen

Keine.

### 4.2.5.3 Interne TUCs, nicht durch Fachmodule nutzbar

Keine.

### 4.2.5.4 Interne TUCs, auch durch Fachmodule nutzbar

### 4.2.5.4.1 TUC_KON_351 “Liefere Systemzeit”

##### TIP1-A_4790

Der Konnektor MUSS den technischen Use Case TUC_KON_351 „Liefere Systemzeit“
umsetzen.

Tabelle337: TAB_KON_776 TUC_KON_351 „Liefere Systemzeit“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_351 „Liefere Systemzeit”

</td></tr><tr><td>
Beschreibung

</td><td>
Der Konnektor MUSS die Systemzeit auf Anforderung an Fachmodule liefern können.

</td></tr><tr><td>
Anwendungsumfeld

</td><td>
Den Fachanwendungen ist die Systemzeit zu liefern.

</td></tr><tr><td>
Eingangsanforderung

</td><td>
Die Echtzeituhr des Konnektors wurde gemäß den geforderten
Synchronisationsintervallen aktualisiert (bei MGM_LU_ONLINE=Enabled) oder
manuell gesetzt (bei MGM_LU_ONLINE=Disabled)

</td></tr><tr><td>
Auslöser und Vorbedingungen

</td><td>
Fachmodule benötigen die aktuelle Systemzeit des Konnektors.

</td></tr><tr><td>
Eingangsdaten

</td><td>
Echtzeituhr des Konnektors

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor, Fachmodule

</td></tr><tr><td>
Ausgangsdaten

</td><td>
Systemzeit des Konnektors

</td></tr><tr><td>
Standardablauf

</td><td>
Siehe [gemSpec_Net]

</td></tr><tr><td>
Varianten/Alternativen

</td><td>
Keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
4178: Konnektor retourniert keine Systemzeit

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
Keine

</td></tr></table>

Tabelle338: TAB_KON_641 Fehlercodes TUC_KON_351 „Liefere Systemzeit“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td>
4178

</td><td>
Technical

</td><td>
Error

</td><td>
Das Fachmodul konnte die aktuelle Systemzeit des Konnektors nicht abrufen

</td></tr></table>

**[\<=]**

### 4.2.5.5 Operationen an der Außenschnittstelle

### 4.2.5.5.1 Sync_Time

##### TIP1-A_4791

Der NTP-Server des Konnektors MUSS an der Client-Schnittstelle eine Operation
sync_Time anbieten.

Tabelle339: TAB_KON_642 Operation sync_Time

<table><tr><th>
Name

</th><th>
I_NTP_Time_Information:sync_Time

</th></tr><tr><td>
Beschreibung

</td><td>
Der Konnektor MUSS anfragenden Clients (z.B. Ärztearbeitsplatz) per NTP-Version
4 die Systemzeit liefern

</td></tr><tr><td>
Aufrufparameter

</td><td>
Vgl. [NTPv4]

</td></tr><tr><td>
Rückgabe

</td><td>
Vgl. [NTPv4]

</td></tr><tr><td>
Vorbedingungen

</td><td>
MGM_LU_ONLINE=Enabled

</td></tr><tr><td>
Nachbedingungen

</td><td>
Der anfragende Client hat die korrekte Zeit geliefert bekommen.

</td></tr><tr><td>
Hinweise

</td><td>
Keine

</td></tr><tr><td>
Fehler

</td><td>
Der Aufruf schlägt fehl (bleibt unbeantwortet), wenn MGM_LU_ONLINE=Disabled

</td></tr></table>

**[\<=]**

### 4.2.5.6 Betriebsaspekte

##### TIP1-A_4792

Der KonnektorMUSSdemAdministrator die Möglichkeit bieten, eine Synchronisation
mit dem zentralen Zeitdienst explizit anzustoßen. **[\<=]**

##### TIP1-A_4793

Der Administrator MUSS die in TAB_KON_643 aufgelisteten Parameter über die
Managementschnittstelle konfigurieren und die in TAB_KON_730 aufgelisteten
Parameter ausschließlich einsehen können.

Tabelle340: TAB_KON_643 Konfiguration des Konnektor NTP-Servers

<table><tr><th>
ReferenzID

</th><th>
Belegung

</th><th>
Bedeutung

</th></tr><tr><td>
NTP_TIMEZONE

</td><td>
Zeitzone

</td><td>
Der Administrator MUSS die Zeitzone des Konnektors einstellen können.

Default-Wert: Central European Time/Mitteleuropäische Zeit (CET/MEZ)

</td></tr><tr><td>
NTP_TIME

</td><td>
Zeit

</td><td>
Der Administrator MUSS die Zeit des Konnektors (NTP_TIME) über die
Managementschnittstelle manuell einstellen können.

</td></tr></table>

Tabelle341: TAB_KON_730 Einsehbare Konfigurationsparameter des Konnektor
NTP-Servers

<table><tr><th>
ReferenzID

</th><th>
Belegung

</th><th>
Bedeutung

</th></tr><tr><td>
NTP_SERVER_  
ADDR

</td><td>
IP-Adressen

</td><td>
Die Adressen des primären und sekundären Stratum-2-Zeitserver der zentralen
TI-Plattform für die Synchronisation mit dem NTP-Server des Konnektors.

</td></tr></table>

**[\<=]**

##### TIP1-A_4794

Befindet sich der Konnektor im Zustand EC_TIME_SYNC_PENDING_CRITICAL oder
EC_Time_Difference_Intolerable, MUSS der Administrator eine Korrektur oder
Bestätigung der Systemzeit vornehmen können. Anschließend MUSS der Konnektor
wie nach einer erfolgreichen Zeitsynchronisation verfahren, d. h. der
Tagezähler wird auf 0 zurückgesetzt. **[\<=]**

### 4.2.5.6.1 TUC_KON_352 Initialisierung Zeitdienst

##### TIP1-A_4795

Der Konnektor MUSS in der Bootup-Phase TUC_KON_352 "Initialisierung Zeitdienst"
durchlaufen.

Tabelle342: TAB_KON_644 – TUC_KON_352 „Initialisierung Zeitdienst“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_352 „Initialisierung Zeitdienst“

</td></tr><tr><td>
Beschreibung

</td><td>
Der Konnektor muss zum Bootup den konnektoreigenen NTP-Server mit einem
NTP-Server der zentralen TI-Plattform synchronisieren falls
MGM_LU_ONLINE=Enabled.

</td></tr><tr><td>
Anwendungsumfeld

</td><td>
Synchronisierung der Systemzeit zur Startzeit

</td></tr><tr><td>
Eingangsanforderung

</td><td>
Keine

</td></tr><tr><td>
Auslöser

</td><td>
 ---> UL

</td></tr><tr><td>
Vorbedingungen

</td><td>
Verbindung zum VPN-Konzentrator TI muss aufgebaut sein

</td></tr><tr><td>
Eingangsdaten

</td><td>
NTP-Server der zentralen TI-Plattform

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
Keine

</td></tr><tr><td>
Standardablauf

</td><td>
Falls MGM_LU_ONLINE=Enabled:

 ---> UL

</td></tr><tr><td>
Varianten/Alternativen

</td><td>
Keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
4177: Der NTP-Server des Konnektors empfängt keine Systemzeit

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
Keine

</td></tr></table>

Tabelle343: TAB_KON_645 Fehlercodes TUC_KON_352 „Initialisierung Zeitdienst“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td>
4177

</td><td>
Technical

</td><td>
Warning

</td><td>
Der NTP-Server des Konnektors konnte nicht synchronisiert werden.

</td></tr></table>

**[\<=]**

### 4.2.6 Namensdienst und Dienstlokalisierung

Innerhalb des Namensdienstes werden folgende Präfixe für Bezeichner verwendet:

 ---> UL

### 4.2.6.1 Funktionsmerkmalweite Aspekte

##### TIP1-A_4796

Der Konnektor MUSS einen Recursive Caching Nameserver zur Auflösung von
DNS-Anfragen sowie einen autoritativen Nameserver zur Verwaltung der Zone
„konlan.“ bereitstellen.Der Caching-Nameserver des Konnektors MUSS für
Clientsysteme aus dem lokalen Netzwerk (ANLW_LAN_NETWORK_SEGMENT oder
ANLW_LEKTR_INTRANET_ROUTES) erreichbar sein.Der Caching-Nameserver des
Konnektors MUSS einen Timeout für die Bearbeitung von DNS-Abfragen beachten.
Konnte eine DNS-Abfrage nicht durchgeführt werden, MUSS die Bearbeitung
abgebrochen werden. **[\<=]**

##### TIP1-A_6480

Der Konnektor MUSS in der Zone „konlan.“ die folgenden Resource Records
bereitstellen:

 ---> UL

Die in spitzen Klammern angegebenen Werte müssen implementierungs- und
konfigurationsabhängig vergeben werden. **[\<=]**

##### TIP1-A_4797

Der DNS-Server des Konnektors MUSS die folgenden DNS-Forwards durchführen:

Tabelle344: TAB_KON_687 DNS-Forwards des DNS-Servers

<table><tr><th>
Domain

</th><th>
Forwarders

</th><th>
Bemerkungen

</th></tr><tr><td>
Namensraum TI, *.DNS_TOP_  
LEVEL_DOMAIN_TI

</td><td>
DNS_SERVERS_TI

</td><td>
DNS Forward Rule zur Auflösung aller DNS-Namen innerhalb des Namensraums der
TI  mit der Top Level Domain telematik (für die PU) und telematik-test (für
die RU und TU).

</td></tr><tr><td>
Namensraum TI, Top Level Domain ti-wa (PU) und ti-wa-test (RU und TU).

</td><td>
DNS_SERVERS_TI

</td><td>
DNS Forward Rule zur Auflösung aller DNS-Namen innerhalb des Namensraums der TI
mit der Top Level Domain ti-wa (für die PU) und ti-wa-test (für die RU und
TU).

</td></tr><tr><td>
Namensraum angeschlossene Netze des Gesundheitswesens mit WANDA Basic 

(Domainnamen  
von angeschlossenen Netzen des Gesundheitswesens mit WANDA
Basic gemäß  
Bestandsnetze.xml)

</td><td>
DNS_  
SERVERS_  
BESTANDS  
NETZE  
(Je Domainnamen eines angeschlossenen
Netzes des Gesundheitswesens mit WANDA Basic alle zugehörigen DNS-Server
IP-Adressen gemäß Bestandsnetze.xml)

</td><td>
Je angeschlossenes Netz des Gesundheitswesens mit WANDA Basic in
ANLW_AKTIVE_BESTANDSNETZE wird eine DNS Forward Rule zur Auflösung von
DNS-Namen innerhalb dieses Netzes verwendet.

</td></tr><tr><td>
Namensraum lokale Einsatzumgebung  
(DNS_DOMAIN_  
LEKTR)

</td><td>
DNS_  
SERVERS_  
LEKTR

</td><td>
DNS Forward Rule zur Auflösung aller DNS-Namen innerhalb der DNS-Domain
DNS_DOMAIN_LEKTR

</td></tr><tr><td>
Namensraum  
Internet

</td><td>
DNS_  
SERVERS_  
SIS

</td><td>
Wenn der VPN-Tunnel SIS aktiv ist, muss eine Forward Rule für den Namensraum
Internet über die DNS_SERVERS_SIS existieren.

</td></tr><tr><td>
Namensraum  
Internet

</td><td>
DNS_  
SERVERS_  
INT

</td><td>
Wenn der VPN-Tunnel SIS nicht aktiv ist, muss eine Forward Rule für den
Namensraum Internet über die DNS_SERVERS_INT existieren

</td></tr><tr><td>
Lokale Zone  
„konlan.“

</td><td>
autoritativer Nameserver des Konnektors

</td><td>
DNS Forward Rule zur Auflösung aller DNS-Namen innerhalb der Zone „konlan.“

</td></tr></table>

**[\<=]**

##### TIP1-A_4798

Der Stub-Resolver im Konnektor MUSS von alleninternenDiensten zur
Namensauflösung genutzt werden.

Der Stub-Resolver im Konnektor MUSS immer denCaching-Nameserverim Konnektor
anfragen. **[\<=]**

##### TIP1-A_4799

Der Konnektor,der einen Caching Nameserver als Validating Resolver umsetzt, MUSS
den DNSSEC-Vertrauensanker der TI aus dem Zertifikatspeicher in den
Caching-Nameserver übernehmen, wenn ein Fehler bei der Validierung der
Namensauflösung der TI aufgetreten ist. **[\<=]**

### 4.2.6.2 Durch Ereignisse ausgelöste Reaktionen

Keine.

### 4.2.6.3 Interne TUCs, nicht durch Fachmodule nutzbar

Keine.

### 4.2.6.4 Interne TUCs, auch durch Fachmodule nutzbar

### 4.2.6.4.1 TUC_KON_361 „DNS-Namen auflösen“

##### TIP1-A_4801

Der Konnektor MUSS den technischen Use Case TUC_KON_361 „DNS-Namen
auflösen“ umsetzen.

Tabelle345: TAB_KON_646 – TUC_KON_361 „DNS-Namen auflösen“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_361 „DNS-Namen auflösen“

</td></tr><tr><td>
Beschreibung

</td><td>
Ein FQDN wird in ein oder mehrere IPs aufgelöst

</td></tr><tr><td>
Auslöser

</td><td>
interne Anfrage (Basisdienst oder Fachmodul)

</td></tr><tr><td>
Vorbedingungen

</td><td>
Die vom Konnektor zu verwendenden DNS-Server (DNS_SERVERS_INT, DNS_SERVERS_TI,
DNS_SERVERS_SIS, DNS_SERVERS_BESTANDSNETZE) müssen konfiguriert sein.

</td></tr><tr><td>
Eingangsdaten

</td><td>
FQDN (Name, für den die IP-Adressen ermittelt werden sollen)

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
LIST_OF_IP_ADDRESSES

</td></tr><tr><td>
Standardablauf

</td><td>
1) Mit dem FQDN wird eine Anfrage an den Stub-Resolver des Konnektors (Typ A und
AAAA) durchgeführt.  
Für alle ermittelten IPv4-Adressen und IPv6-Adressen
werden als LIST_OF_IP_ADDRESSES zurückgeliefert.  
Da IPv6 nicht produktiv
eingesetzt wird muss die aufrufende Instanz die IPv6-Adressen ignorieren. 

Falls keine IP-Adressen ermittelt werden konnten, wird eine leere Liste
zurückgeliefert.

</td></tr><tr><td>
Varianten/Alternativen

</td><td>
Keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
( 1) Timeout der Anfrage; Fehlercode 4179  
( 1) DNS-Fehler; Fehlercode
4180

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
Keine

</td></tr></table>

Tabelle346: TAB_KON_647 Fehlercodes TUC_KON_361 „DNS Namen auflösen“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4179

</td><td>
Technical

</td><td>
Error

</td><td>
„DNS: Anfrage

wurde wegen Timeout abgebro

chen.”

</td></tr><tr><td>
4180

</td><td>
Technical

</td><td>
Fatal

</td><td>
„DNS: Es ist ein Fehler bei der Namensauflösung aufgetreten“  
Die
Fehlerdetails sind gemäß DNS-Protokoll zu ergänzen.

</td></tr></table>

**[\<=]**

##### TIP1-A_4801-02

Der Konnektor MUSS den technischen Use Case TUC_KON_361 „DNS-Namen
auflösen“ umsetzen.

Tabelle347: TAB_KON_646 – TUC_KON_361 „DNS-Namen auflösen“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_361 „DNS-Namen auflösen“

</td></tr><tr><td>
Beschreibung

</td><td>
Ein FQDN wird in ein oder mehrere IPs aufgelöst

</td></tr><tr><td>
Auslöser

</td><td>
interne Anfrage (Basisdienst oder Fachmodul)

</td></tr><tr><td>
Vorbedingungen

</td><td>
Die vom Konnektor zu verwendenden DNS-Server (DNS_SERVERS_INT, DNS_SERVERS_TI,
DNS_SERVERS_SIS, DNS_SERVERS_BESTANDSNETZE) müssen konfiguriert sein.

</td></tr><tr><td>
Eingangsdaten

</td><td>
FQDN (Name, für den die IP-Adressen ermittelt werden sollen)

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
LIST_OF_IP_ADDRESSES

</td></tr><tr><td>
Standardablauf

</td><td>
1) Mit dem FQDN wird eine Anfrage an den Stub-Resolver des Konnektors (Typ A und
AAAA) durchgeführt.

Für alle ermittelten IPv4-Adressen und IPv6-Adressen werden als
LIST_OF_IP_ADDRESSES zurückgeliefert.

Wird IPv6 nicht produktiv eingesetzt, muss die aufrufende Instanz die
IPv6-Adressen ignorieren.

Falls keine IP-Adressen ermittelt werden konnten, wird eine leere Liste
zurückgeliefert.

</td></tr><tr><td>
Varianten/Alternativen

</td><td>
Keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
(



1) Timeout der Anfrage; Fehlercode 4179

(



1) DNS-Fehler; Fehlercode 4180

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
Keine

</td></tr></table>

Tabelle348: TAB_KON_647 Fehlercodes TUC_KON_361 „DNS Namen auflösen“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4179

</td><td>
Technical

</td><td>
Error

</td><td>
„DNS: Anfrage wurde wegen Timeout abgebrochen.”

</td></tr><tr><td>
4180

</td><td>
Technical

</td><td>
Fatal

</td><td>
„DNS: Es ist ein Fehler bei der Namensauflösung aufgetreten“  
Die
Fehlerdetails sind gemäß DNS-Protokoll zu ergänzen.

</td></tr></table>

**[\<=]**

### 4.2.6.4.2 TUC_KON_362 „Liste der Dienste abrufen“

##### TIP1-A_4802

Der Konnektor MUSS den technischen Use Case TUC_KON_362 „Liste der Dienste
abrufen“ umsetzen.

Tabelle349: TAB_KON_648 – TUC_KON_362 „Liste der Dienste abrufen“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_362 „Liste der Dienste abrufen“

</td></tr><tr><td>
Beschreibung

</td><td>
Ermittlung aller zu einer DNS-SD-Gruppe gehörenden DNS-Namen.

</td></tr><tr><td>
Auslöser

</td><td>
interne Anfrage (Basisdienst oder Fachmodul)

</td></tr><tr><td>
Vorbedingungen

</td><td>
Die vom Konnektor zu verwendenden DNS-Server müssen konfiguriert sein.

</td></tr><tr><td>
Eingangsdaten

</td><td>
FQDN des PTR Resource Records

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
LIST_OF_SRV_ENTITIES

</td></tr><tr><td>
Standardablauf

</td><td>
Mit dem FQDN wird eine Typ „PTR“ Anfrage an den Stub-Resolver des Konnektor
gestellt.

</td></tr><tr><td>
Varianten/Alternativen

</td><td>
Keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
(



1) Timeout der Anfrage; Fehlercode 4179

(



1) DNS-Fehler; Fehlercode 4180

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
Keine

</td></tr></table>

Tabelle350: TAB_KON_649 Fehlercodes TUC_KON_362 „Liste der Dienste abrufen“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4179

</td><td>
Technical

</td><td>
Error

</td><td>
„DNS: Anfrage wur

de wegen Timeout abgeb

rochen.”

</td></tr><tr><td>
4180

</td><td>
Technical

</td><td>
Fatal

</td><td>
„DNS: Es ist ein Fehler bei der Namensauflösung aufgetreten“  
Die
Fehlerdetails sind gemäß [gemSpec_Net] zu ergänzen.

</td></tr></table>

**[\<=]**

### 4.2.6.4.3 TUC_KON_363 „Dienstdetails abrufen“

##### TIP1-A_4803

Der Konnektor MUSS den technischen Use Case TUC_KON_363 „Dienstdetails
abrufen“ umsetzen.

Tabelle351: TAB_KON_650 - TUC_KON_363 „Dienstdetails abrufen“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_363 Dienstdetails abrufen

</td></tr><tr><td>
Beschreibung

</td><td>
Ermitteln aller DNS-SD-Details zu einem vollqualifizierten DNS-Namen.

</td></tr><tr><td>
Auslöser

</td><td>
interne Anfrage (Basisdienst oder Fachmodul)

</td></tr><tr><td>
Vorbedingungen

</td><td>
Die vom Konnektor zu verwendenden DNS-Server müssen konfiguriert sein.

</td></tr><tr><td>
Eingangsdaten

</td><td>
FQDN (der Name eines DNS-SD-Elements)

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
LIST_OF_SRV_ENTRIES

LIST_OF_SRV_DETAILS

</td></tr><tr><td>
Standardablauf

</td><td>
1) Mit dem FQDN wird eine Typ-„SRV“-Anfrage an den Stub-Resolver des
Konnektors gestellt.

Die vom DNS-Server zurück gelieferten SRV-Einträge werden als
LIST_OF_SRV_ENTRIES (bestehend aus TTL, Priority, Weight, Port, Target)
zurückgeliefert.

Wenn kein Eintrag gefunden werden konnte, wird eine leere Liste
LIST_OF_SRV_ENTRIES zurückgeliefert.

2) Mit dem FQDN wird zusätzlich eine Typ-„TXT“-Anfrage an den Stub-Resolver
des Konnektors gestellt.

Wenn ein oder mehrere entsprechende Einträge gefunden werden konnten, werden
diese in einer gemeinsamen Liste

LIST_OF_SRV_DETAILS (bestehend aus TTL und TXT) zusammengefasst.

Wenn kein Eintrag gefunden werden konnte, wird eine leere Liste
LIST_OF_SRV_DETAILS zurückgeliefert.

Falls keine FQDN ermittelt werden konnten, wird je eine leere Liste
LIST_OF_SRV_ENTRIES und LIST_OF_SRV_DETAILS zurückgeliefert.

</td></tr><tr><td>
Varianten/Alternativen

</td><td>
Keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
(



1-2) Timeout der Anfrage; Fehlercode 4179

(



1-2) DNS Fehler; Fehlercode 4180

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
Keine

</td></tr></table>

Tabelle352: TAB_KON_651 Fehlercodes TUC_KON_363 „Dienstdetails abrufen“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4179

</td><td>
Technical

</td><td>
Error

</td><td>
„DNS: Anfrage wurde wegen Timeout abgebrochen.”

</td></tr><tr><td>
4180

</td><td>
Technical

</td><td>
Fatal

</td><td>
„DNS: Es ist ein Fehler bei der Namensauflösung aufgetreten“  
Die
Fehlerdetails sind gemäß [gemSpec_Net] zu ergänzen.

</td></tr></table>

**[\<=]**

### 4.2.6.5 Operationen an der Außenschnittstelle

##### TIP1-A_4804

Der Konnektor MUSS für Clients eine Basisanwendung Namensdienst anbieten.

Tabelle353: TAB_KON_652 Basisanwendung Namensdienst

<table><tr><th>
Name

</th><th colspan="2">
Namendienst

</th></tr><tr><td>
Version

</td><td colspan="2">
wird im Produktsteckbrief des Konnektors definiert

</td></tr><tr><td>
Namensraum

</td><td colspan="2">
Keiner

</td></tr><tr><td>
Namensraum-Kürzel

</td><td colspan="2">
Keiner

</td></tr><tr><td rowspan="2">
Operationen

</td><td>
Name

</td><td>
Kurzbeschreibung

</td></tr><tr><td>
GetIPAddress

</td><td>
Diese Operation ermöglicht die Auflösung von FQDNs in IP-Adressen

</td></tr><tr><td>
WSDL

</td><td colspan="2">
Keines

</td></tr><tr><td>
Schema

</td><td colspan="2">
Keines

</td></tr></table>

**[\<=]**

### 4.2.6.5.1 GetIPAddress

##### TIP1-A_5035

Der Namensdienst des Konnektors MUSS an der Client-Schnittstelle eine Operation
GetIPAddress anbieten.

Tabelle354: TAB_KON_653 Operation GetIPAddress

<table><tr><td>
Name

</td><td>
GetIPAddress

</td></tr><tr><td>
Beschreibung

</td><td>
Diese Operation ermöglicht die Auflösung von FQDN in IP-Adressen.

(DNS-Forwarder Abfrage ohne Cache)

</td></tr><tr><td>
Aufrufparameter

</td><td>
Address (FQDN)

DNSSECValidation (Boolean)

</td></tr><tr><td>
Rückgabe

</td><td>
IPAddr (IPAddress)

DNSSECValidated (Boolean)

</td></tr><tr><td>
Vorbedingungen

</td><td>
Der DNS-Server im Konnektor muss aktiv sein.

Die Forward Nameserver (DNS_SERVERS_TI, DNS_SERVERS_SIS,
DNS_SERVERS_BESTANDSNETZE) müssen konfiguriert sein.

</td></tr><tr><td>
Nachbedingungen

</td><td>
Keine

</td></tr><tr><td>
Standardablauf

</td><td>
Für Details zu DNS Namensauflösung wird auf [gemSpec_Net] verweisen.

</td></tr></table>

**[\<=]**

### 4.2.6.6 Betriebsaspekte

##### TIP1-A_5416

Der KonnektorMUSS in der Bootup-Phase zur Initialisierung des Funktionsmerkmals
„Namensdienst und Dienstlokalisierung“:

 ---> UL

**[\<=]**

##### TIP1-A_4805

Der Administrator MUSS die in TAB_KON_654 aufgelisteten Parameter über die
Managementschnittstelle konfigurieren und die in TAB_KON_731 aufgelisteten
Parameter ausschließlich einsehen können.Nach jeder Änderung MUSS
sichergestellt werden, dass die Änderungen sofort am autoritativen bzw. am
Caching-Nameserver zur Verfügung stehen.

Tabelle355: TAB_KON_654 - Konfigurationsparameter Namensdienst

<table><tr><th>
ReferenzID

</th><th>
Belegung

</th><th>
Bedeutung und Administrator-Interaktion

</th></tr><tr><td>
DNS_SERVERS_INT

</td><td>
Liste von IP-Adressen der DNS-Server

</td><td>
Liste von DNS-Servern für das Transportnetz.

Die IP-Adressen KÖNNEN auf einen öffentlich zugänglichen Adressbereich
eingeschränkt sein.

</td></tr><tr><td>
DNS_DOMAIN_

VPN_ZUGD_INT

</td><td>
DNS Domainname

</td><td>
DNS-Domainname für die Service Discovery der VPN-Konzentratoren des
VPN-Zugangsdienstes

</td></tr><tr><td>
DNS_SERVERS_

LEKTR

</td><td>
Liste von IP-Adressen der DNS-Server

</td><td>
Liste von DNS-Servern, die zur Namensauflösung von Namensräumen in der
Einsatzumgebung verwendet werden.

Der Administrator MUSS die Liste von DNS-Servern, die die DNS_DOMAIN_LEKTR
auflösen, bearbeiten können.

Die IP-Adressen der DNS-Server KÖNNEN auf den Adressbereich der
ANLW_LAN_IP_ADDRESS eingeschränkt sein.

</td></tr><tr><td>
DNS_DOMAIN_

LEKTR

</td><td>
DNS

Domainname

</td><td>
DNS Domainname, der von einem DNS-Server der Einsatzumgebung aufgelöst wird.
Der Name DARF NICHT mit einem „.“ beginnen und nicht mit einem „.“
enden.

</td></tr><tr><td>
DNS_TA_CONFIG

</td><td>
Ist abhängig von der gewählten Umsetzung

</td><td>
Wenn der Konnektor als Validating Resolver für den Namensraum Internet
implementiert ist gilt:

Der Administrator MUSS die aktuellen DNSSEC Trustanchor für den Namensraum
Internet auf geeignetem Weg in den Konnektor übernehmen können.

</td></tr></table>

Tabelle356: TAB_KON_731 Einsehbare Konfigurationsparameter Namensdienst

<table><tr><th>
ReferenzID

</th><th>
Belegung

</th><th>
Bedeutung

</th></tr><tr><td>
DNS_SERVERS_TI

</td><td>
Liste von IP-Adressen der DNS-Server

</td><td>
Liste von DNS-Servern, die zur Namensauflösung des Namensraums der TI verwendet
werden

</td></tr><tr><td>
DNS_SERVERS_SIS

</td><td>
Liste von IP-Adressen der DNS-Server

</td><td>
Liste von DNS-Servern, die zur Namensauflösung des Namensraums Internet bei
Nutzung des SIS verwendet werden

</td></tr><tr><td>
DNS_SERVERS_

BESTANDSNETZE

</td><td>
Liste von IP-Adressen der DNS-Servern je Domäne je freigegebenem
angeschlossenen Netz des Gesundheitswesens mit WANDA Basic

</td><td>
Liste von DNS-Servern je Domain eines dieser freigegebenen Netze.

</td></tr><tr><td>
DNS_TOP_LEVEL_

DOMAIN_TI

</td><td>
DNS Domainname

</td><td>
Top Level Domain des Namensraumes TI

</td></tr></table>

**[\<=]**

### 4.2.7 Optionale Verwendung von IPv6

Der Konnektor kann zusätzlich eine IPv6-Adresse an den Netzwerkschnittstellen
zum Transportnetz implementieren. Entscheidet sich der Hersteller für den
parallelen Einsatz von IPv4 und IPv6 (Dual-Stack-Mode), sind die nachfolgenden
Anforderungen dieses Kapitels umzusetzen. Einhergehend mit der Entscheidung,
IPv6 an diesem Interface zu konfigurieren, ist der spätere VPN-Tunnelaufbau
zur TI und SIS über das IPv6 Interface möglich. Die durch den jeweiligen
IPv6-Tunnel zu transportierenden IP-Pakete sind IPv4 adressierte Pakete.

##### A_17199

Der Konnektor MUSS bei Verwendung von IPv6 für den VPN-Tunnelaufbau zur TI und
SIS auf geeignete Weise (z.B. DHCP vom IAG) mit einer IPv6-Adresse auf dem
physikalischen Interface in Richtung Internet konfiguriert werden
(Dual-Stack-Mode). **[\<=]**

##### A_17200

Der Konnektor MUSS bei Verwendung von IPv6 für den VPN-Tunnelaufbau zur TI und
SIS die Fragmentierung von IKEv2 Nachrichten gemäß [RFC7383] unterstützen.
**[\<=]**

##### A_17201

Der Konnektor MUSS bei Verwendung von IPv6 für den VPN-Tunnelaufbau zur TI und
SIS die notwendige Route für das Erreichen des Internets bereitstellen.
**[\<=]**

### 4.3 Konnektormanagement

Das Konnektormanagement dient ausschließlich Betriebsaspekten des Konnektors.
Daher wird in diesem Kapitel weitestgehend auf die übliche Strukturierung nach
TUCs (intern/für Fachmodule), Außenoperationen und Betriebsaspekten
verzichtet. Lediglich der KSR-Client verwendet diese Kapitelstruktur.

Innerhalb des Konnektormanagements werden vorrangig folgende Präfixe für
Bezeichner verwendet:

 ---> UL

Eine Ausnahme hiervon bildet der Anteil der Software-Aktualisierung
(KSR-Client). Dieser verwendet folgende Präfixe für Bezeichner:

 ---> UL

##### TIP1-A_4806

Der Konnektor MUSS LAN-seitig über eine Managementschnittstelle für
Konfiguration und Diagnose verfügen.Die Ausführung der Schnittstelle ist
herstellerspezifisch, MUSS aber entweder als Konfigurations-Frontend im Sinne
einer eigenständigen Client-Applikation oder als Web-Oberfläche ausgeprägt
sein.Wenn die Schnittstelle als Web-Oberfläche ausgeprägt ist, MUSS im
Handbuch beschrieben sein, wo angegeben ist, welche Browser-Versionen für
welche Betriebssysteme unterstützt werden (bspw. im Handbuch selbst oder über
einen Link auf eine Web-Seite des Herstellers), und wo diese als
installierbares Softwarepaket oder direkt ausführbare Datei bezogen werden
können.Die Verbindung zur Managementschnittstelle MUSS zur Sicherung der
Vertraulichkeit, Integrität und Authentizität durch Nutzung eines
kryptographischen Verfahrens gemäß [gemSpec_Krypt] abgesichert werden, falls
die Sicherheit der übertragenen Daten nicht auf andere Weise erreicht wird.
Die Absicherung der Daten kann z. B. durch Nutzung von TLS unter
Berücksichtigung der in [gemSpec_Krypt] angegebenen Algorithmen und
Schlüssellängen geschehen.Die Managementschnittstelle MUSS in thematisch
gegliederte Konfigurationsbereiche unterteilt sein. Die konkrete Gliederung
selbst ist herstellerspezifisch.Die Managementschnittstelle KANN einen
Managementbereich aufweisen, der nur für autorisierte Techniker des
Herstellers zugänglich ist. Ein Zugriff auf diesen Bereich MUSS durch eine
eigene Authentisierungsfunktion geschützt werden (z. B. durch
Passwortschutz). **[\<=]**

Die über die Managementschnittstelle zu erreichenden und zu verändernden
Inhalte werden erhoben in:

 ---> UL

Eine Ergänzung um weitere, herstellerspezifische Konfigurationsinhalte ist
möglich.

##### TIP1-A_5661

Der Konnektor MUSS für die Automatisierung von Konnektor-Tests alle Funktionen,
die über die Managementschnittstelle bereitgestellt werden,über
eineLAN-seitigeSchnittstelle ohne graphische Benutzerführung bereitstellen.

Der Konnektorhersteller MUSS eine Dokumentation der Schnittstelle bereitstellen,
welche die Nutzung so beschreibt, dass die Schnittstelle von der gematik in
vollem Umfang genutzt werden kann. Die Dokumentation MUSS der gematik im
Regelfall zwei Wochen vor Einreichung des Zulassungsobjekts bereitgestellt
werden. Von diesem Regelfall KANN in Abstimmung mit der gematik abgewichen
werden.

Die Schnittstelle SOLL mittels JSON [RFC7159] bereitgestellt werden. Wenn die
Bereitstellung nicht mittels JSON erfolgt, MUSS sie über eine vergleichbare
Technologie erfolgen.

Der Zugriff auf die Schnittstelle MUSS in RU/TU erlaubt sein. Falls der Zugriff
in der PU erlaubt ist, MUSS er dort ebenso wie die Managementschnittstelle
abgesichert sein:

 ---> UL

Ansonsten DARF der Zugriff in der PU NICHT möglich sein. **[\<=]**

##### TIP1-A_4807

Das Management des Konnektors MUSS über die Managementschnittstelle
mandantenübergreifend erfolgen. Dies bedeutet insbesondere, dass ein
Administrator(gemäß seiner Zugriffsberechtigungen) in einer
Management-Session alle Einstellungen einsehen und verändern können MUSS,
egal welchem Mandanten diese Werte zugeordnet sind. **[\<=]**

##### TIP1-A_5658

Der Konnektor MUSS die Managementschnittstelle mit zwei getrennten Endpunkten
implementieren. Der Konnektor MUSS sicherstellen, dass auf den einen Endpunkt
nur Nutzer mit der Rolle Lokaler-Administrator oder Super-Administrator
zugreifen können, und auf den anderen Endpunkt nur Nutzer mit der Rolle
Remote-Administrator. **[\<=]**

##### TIP1-A_5005

Jede Änderung, die ein Administrator vornimmt, MUSS protokolliert werden durch
TUC_KON_271 „Schreibe Protokolleintrag“
{    topic=„MGM/ADMINCHANGES“;    eventType=Op;    severity=Info;    parameters
=(„User=$AdminUsername,                          
RefID=$ReferenzID,                          
NewVal=$NeuEingestellterWert“)}Der hier geforderte Logging-Level gilt, wenn
nicht an anderer Stelle eine abweichende Regelung spezifiziert ist.Wenn die
Änderung über ein Remote-Management-System durchgeführt wird, ohne dass ein
Remote-Administrator im Konnektor konfiguriert ist, so MUSS als User eine
Referenz auf das Remote-Management-System verwendet werden.Passwörter DÜRFEN
NICHT in den Protokolleinträgen geschrieben werden. **[\<=]**

### 4.3.1 Zugang und Benutzerverwaltung des Konnektormanagements

Der Konnektor verfügt über keine Verwaltung der fachlichen Nutzer, wohl aber
über eine Verwaltung der Nutzer, die in der Rolle eines Administrators den
Konnektor konfigurieren und die Protokolle einsehen dürfen. Dabei werden drei
Administrator-Rollen unterschieden:

 ---> OL

##### TIP1-A_4808-01

Der Konnektor MUSS sicherstellen, dass die Managementschnittstelle vor
unberechtigtem Zugang geschützt ist. Die Managementschnittstelle MUSS durch
eine Kombination aus Benutzername und Passwort oder einen mindestens gleich
starken Mechanismus vor unberechtigtem Zugang geschützt sein.Für die
Passworterstellung MUSS der Konnektor mindestens folgende Aspekte
berücksichtigen:

 ---> UL

Für die Passwortverarbeitung MUSS der Konnektor mindestens folgende Aspekte
berücksichtigen:

 ---> UL **[\<=]**

Näheres hierzu regeln die Schutzprofile des Konnektors.

##### TIP1-A_4810

Der Konnektor MUSS eine Benutzerverwaltung für die Managementschnittstelle
enthalten, in der anmeldeberechtigte Administratoren-Benutzer definiert werden
können.Die Benutzerverwaltung MUSS die Administrator-Rollen
Lokaler-Administrator, Remote-Administrator und Super-Administrator
unterstützen.Den Administrator-Rollen MÜSSEN folgende Rechte zugewiesen sein:

 ---> UL

Tabelle357: TAB_KON_655 Konfigurationen der Benutzerverwaltung
(Super-Administrator)

<table><tr><th>
ReferenzID

</th><th>
Belegung

</th><th>
Bedeutung und Administrator-Interaktion

</th></tr><tr><td>
MGM_USER_LIST

</td><td>
Liste von Benutzernamen und deren Kontaktdaten

</td><td>
Liste von Benutzern und deren Kontaktdaten.  
Benutzerkonten MÜSSEN angelegt,
geändert und gelöscht werden können.  
Das Passwort eines Benutzerkontos
MUSS neu gesetzt werden können.

</td></tr><tr><td>
MGM_ADMIN  
_RIGHTS

</td><td>
Liste von Zugriffsrechten eines Benutzers

</td><td>
i. Eindeutige Zuordnung eines Benutzerkontos  
  zu einer Rolle.  
   Die
Benutzerverwaltung MUSS sicherstellen,  
  dass zu jeder Zeit mindestens ein 

  Benutzerkonto mit der Rolle Super-  
   Administrator vorhanden ist.  
 
Gewähren/Entziehen von Rechten für  
   Benutzerkonten:  
ii.
Zugriffsrechte bezüglich der  
    Konfigurationsbereiche.  
iii. Recht zum
Aufbau einer Remote-  
    Manage

ment-Session und/oder zur Konfiguration des Remote-Management gemäß TAB_KON_663

(USER_INIT_REMOTESESSION).  
iv. Recht für einen Werksreset  
   
(USER_RESET_PERMISSION)

</td></tr></table>

Die Benutzerverwaltung MUSS es jedem Benutzer ermöglichen
Konfigurationsänderungen gemäß Tabelle TAB_KON_656 vorzunehmen:

Tabelle358: TAB_KON_656 Konfigurationen der Benutzerverwaltung

<table><tr><th>
ReferenzID

</th><th>
Belegung

</th><th>
Bedeutung und Administrator-Interaktion

</th></tr><tr><td>
MGM_USER_INFO

</td><td>
Kontaktdaten

</td><td>
Der angemeldete Benutzer MUSS seine Kontaktdaten ändern können. Der
Benutzername DARF NICHT änderbar sein.

</td></tr></table>

**[\<=]**

### 4.3.2 Konnektorname und Versionsinformationen

##### TIP1-A_4811

Der Konnektor MUSS die Konfiguration und Nutzung eines sprechenden
Konnektornamens unterstützen, der identisch zum Hostnamen des Konnektors ist.
Der Konnektorname MUSS dauerhaft an der Managementschnittstelle angezeigt
werden.Die Managementschnittstelle MUSS es einem Administrator ermöglichen
Konfigurationsänderungen gemäß Tabelle TAB_KON_657 vorzunehmen:

Tabelle359: TAB_KON_657 Konfigurationsparameter des Konnektornamens

<table><tr><th>
ReferenzID

</th><th>
Belegung

</th><th>
Bedeutung und Administrator-Interaktion

</th></tr><tr><td>
MGM_KONN_  
HOSTNAME

</td><td>
12 Zeichen

</td><td>
Der

Konnektorname MUSS folgende Anforderungen erfüllen (in Anlehnung an die
Definition eines „Labels“ in [RFC1034]):

• Verwendung der Buchstaben „A bis Z“ und „a bis z“,

•

Verwendung

der Ziffern „0 bis 9“,

• als

Sonderzeichen

„–“ (Minus), sowie

• eine

maximale

Länge von 12 Zeichen,

Die

Verwendung weiterer Sonderzeichen sowie des Leerzeichens DARF NICHT möglich
sein.

</td></tr></table>

Optional KANN ein Hersteller zusätzlich zum Konnektor- bzw. Hostnamen die
Konfiguration eines DNS-Suffixes vorsehen. Der DNS-Suffix DARF NICHT
Bestandteil des Konnektornamens sein. **[\<=]**

##### TIP1-A_4812

Der Administrator MUSS die Versionsinformationen des Konnektors einsehen
können. Dabei MÜSSEN alle über ProductInformation.xsd definierten Elemente
verständlich angezeigt werden.

Ferner MUSS der Administrator dabei die aktuelle Firmware-Gruppenversion des
Konnektors einsehen können. **[\<=]**

##### A_18929

Der Hersteller MUSS die ECC-Vorbereitung der gSMC-K durch die Bezeichnung
„ECC-Vorbereitet“ zusammen mit den Versionsinformationen des Konnektors an
der Managementschnittstelle sichtbar machen. **[\<=]**

##### TIP1-A_7255

Der Administrator MUSS die Versionen der in der Firmware des Konnektors
enthaltenen Fachmodule einsehen können. **[\<=]**

Fachmodulversionsinformationen sind nicht Bestandteil der Selbstauskunft gemäß
ProductInformation.xsd.

### 4.3.3 Konfigurationsdaten: Persistieren sowie Export-Import

##### TIP1-A_4813

Der Konnektor MUSS die Konfigurationsdaten nach Änderung persistieren. Dabei
MÜSSEN Integrität, Authentizität und Vertraulichkeit der Konfigurationsdaten
gewährt sein. Der Mechanismus hierfür ist herstellerspezifisch.

Der Konnektor MUSS sicherstellen, dass immer ein integerer Konfigurationssatz
persistiert ist.

Bei der Konnektorinitialisierung MÜSSEN die persistierten Konfigurationsdaten
eingelesen werden.

Die Verpflichtung zur Persistierung gilt für alle innerhalb der Konnektor- und
Fachmodul-Spezifikationen erhobenen Konfigurationsdaten. **[\<=]**

##### TIP1-A_4814

Der Administrator MUSS die gesamten Konfigurationsdaten des Konnektors ex- und
importieren können. Dazu gehören die Konfigurationsparameter des Konnektors,
die persistenten Daten wie im Informationsmodell des Konnektors (Tabelle
TAB_KON_507 Informationsmodell Entitäten) definiert  und die Pairing
Informationen der Kartenterminals.Die Konfigurationsdaten des Anwendungs- und
Netzkonnektors KÖNNEN gemeinsam oder getrennt exportiert bzw. importiert
werden. Das Format der Konfigurationsdaten ist herstellerspezifisch.Auf
hardwareseitig baugleichen Geräten:

 ---> UL

Der Import von Konfigurationsdateien, die von einem Konnektor mit anderer
Hardwareversion exportiert wurden, KANN ermöglicht werden.

(für Fachmodule siehe Kapitel 4.3.4)

Der Konnektor MUSS sicherstellen, dass der Exportvorgang nur von einem am
Konnektor angemeldeten User mit mindestens der Rolle Administrator ausgelöst
werden kann.

Der Konnektor MUSS sicherstellen, dass der Importvorgang nur von einem am
Konnektor angemeldeten User mit der Rolle Super-Administrator ausgelöst werden
kann.

Sowohl Ex- als auch Import MÜSSEN protokolliert werden durch TUC_KON_271
„Schreibe Protokolleintrag“ {    

    topic = „MGM/CONFIG_EXIMPORT“;

    eventType = Op;

    severity = Info;

    parameters = („User=$AdminUsername,

                            Mode=[Export/Import]“)}. **[\<=]**

##### A_19738

DerKonnektor KANN einem am Konnektor angemeldeten User mit der Rolle
Lokaler-Administrator erlauben, den Importvorgang von Konfigurationsdateien
auszulösen, wennin den Konfigurationsdaten keine Benutzerdatengemäß Tabelle
TAB_KON_655 enthalten sind. **[\<=]**

Nähere Vorgaben zum Ablauf des Imports der Kartenterminalinformationen finden
sich im Kapitel 4.1.4.6.3.

##### TIP1-A_4815

DieIntegrität, Authentizität und Nichtabstreitbarkeitder exportierten Daten
MUSS sichergestellt werden. Dies MUSS durch eine Signatur mit der
OSIG-Identität der SM-B oder mit einem herstellerspezifischenSchlüsselpaar
realisiert werden. In die zu signierenden Daten MUSS eine Zeitangabe zum
Signaturzeitpunkt integriert werden. Beim Import MUSS die Signatur vor der
Übernahme der Daten erfolgreich verifiziert worden sein. Im Laufe des
Importvorgangs MUSS dem Administrator das zur Signatur zugehörige Zertifikat
(oder der herstellerspezifische öffentliche Schlüssel) sowie die Zeitangabe
zum Signaturzeitpunkt der exportierten Konfiguration angezeigt werden, undder
Administrator MUSS explizit bestätigen, dass er die zu dem angezeigten
Zeitpunkt gehörige Konfiguration importieren will.

Wird die SM-B zur Signatur eingesetzt, so MUSS die Prüfung des genutzten
Signaturzertifikats anhand von TUC_KON_037 erfolgen. Das Zertifikat der
OSIG-Identität, mit dem die Daten signiert wurden, MUSS zusammen mit den
exportierten Daten gespeichert werden, um eine Verifikation der Signatur auf
neuen Konnektoren auch ohne Zugriff auf die entsprechende SM-B zu ermöglichen.

DaKonfigurationsdaten mit einem Schutzbedarf von mindestens „Hoch“für
Authentizität und Nichtabstreitbarkeit exportiertwerden(z. B.
Pairing-Geheimnisse (ShS.KT.AUT) der Kartenterminals), MUSS durch geeignete
Maßnahmen sichergestellt werden, dass der Zugriff auf die Daten auf eine
natürliche Person rückführbar ist. Dies kann organisatorisch(durch Einträge
des Administrators in ein Betriebsführungs-HandbuchbeimNutzer)technisch (durch
eine personenbezogene Administratorenverwaltung) oder äquivalent
herstellerspezifischerreicht werden. **[\<=]**

##### TIP1-A_4816

Zum Schutz derVertraulichkeitder exportierten Daten MÜSSEN die Daten vor dem
Export verschlüsselt werden. Dies kann durch asymmetrische oder symmetrische
Verschlüsselungsverfahrennach [gemSpec_Krypt]realisiert werden.

Wird ein rein symmetrisches Verfahren eingesetzt, so MUSS als Mindestanforderung
eine Passphrase einer Mindestlänge von16Zeichen(Groß- und Kleinbuchstaben,
Ziffern und Sonderzeichen)zur Verschlüsselung der Daten eingesetzt werden.
Diese Passphrase MUSS dabei vom Konnektor zufällig generiert werdenund aus
einer Kombination von Buchstaben und Ziffern bestehen.Diese Passphrase MUSS dem
Administrator anschließend angezeigt werden. **[\<=]**

### 4.3.4 Administration von Fachmodulen

Die Konfiguration von Fachmodulen ist innerhalb der Managementschnittstelle des
Konnektors von der Konfiguration der Plattformanteile des Konnektors logisch
entkoppelt. Die Festlegungen, welche Konfigurationsparameter und welche
zusätzlichen administrativen Funktionen für ein Fachmodul benötigt werden,
werden in den jeweiligen Fachmodulspezifikationen getroffen. Der Konnektor muss
aber für jedes Fachmodul hinsichtlich der Administrierbarkeit des Fachmoduls
die folgende Basisfunktionalität zur Verfügung stellen:

##### TIP1-A_4818

Neben den Konfigurationsbereichen der Plattformanteile des Konnektors, MUSS die
Managementschnittstelle auch die Konfiguration der im Konnektor enthaltenen
Fachmodule unterstützen.

Ein Administrator MUSS die in den Fachmodulspezifikationen enthaltenen
Konfigurationsparameter ändern und die dort definierten Informationen einsehen
können.

Der Konnektor MUSS die Konfigurationsdaten von Fachmodulen nach deren Änderung
persistieren, sowie bei einem Neustart eines Fachmoduls die
Fachmodul-Konfigurationsdaten vor der Initialisierung des Fachmoduls einlesen.

Die persistierten Fachmodulkonfigurationsdaten MÜSSEN ebenso wie die
plattformeigenen Konfigurationsdaten hinsichtlich ihrer Integrität und
Authentizität sowie ihrer Vertraulichkeit geschützt werden.

Der Ex- und Import von Fachmodulkonfigurationen MUSS äquivalent zum Ex- und
Import der Plattformanteile für den Administrator möglich sein (siehe4.3.3).
Die Konfigurationsdaten der Fachmodule KÖNNEN dabei in der Gesamt
Export-Dateides Konnektors enthalten sein oder separat exportiert und
importiert werden. **[\<=]**

##### TIP1-A_5484

Der Konnektor MUSS den Fachmodulen die Möglichkeit bereitstellen, die in den
Fachmodulspezifikationen gekennzeichneten Konfigurationsdaten persistent zu
speichern, auszulesen und zu löschen. Je Fachmodul muss ein exklusiv durch das
Fachmodul nutzbarer Speicherbereich verwendet werden.Namenskonvention zur
Kennzeichnung der Konfigurationsdaten der Fachmodule für persistent zu
speichernde Daten:FM_\<fmName\>_\<fmDataName\>

Tabelle360: TAB_KON_833 Bezeichner für persistente Konfigurationsdaten für
Fachmodule

<table><tr><th>
Bezeichner

</th><th>
Bedeutung

</th></tr><tr><td>
FM

</td><td>
fester Namensbestandteil zur Kennzeichnung von persistenten
fachmodulspezifischen Konfigurationsdaten

</td></tr><tr><td>
_

</td><td>
Trennzeichen

</td></tr><tr><td>
\<fmName\>

</td><td>
Name des Fachmoduls (innerhalb eines Fachmoduls konstanter Bezeichner)

</td></tr><tr><td>
_

</td><td>
Trennzeichen

</td></tr><tr><td>
\<fmDataName\>

</td><td>
Name der persistent zu speichernden fachmodulspezifischen Konfigurationsdaten

</td></tr></table>

**[\<=]**

### 4.3.5 Neustart und Werksreset

##### TIP1-A_4819

Der Administrator MUSS einen Neustart des Konnektors auslösen können. **[\<=]**

##### TIP1-A_4820

Ein Administrator mit USER_RESET_PERMISSION MUSS einen Werksreset des Konnektors
auslösen können.Zur Durchführung des Werksreset MUSS der Administrator nach
Funktionsaufruf per Sicherheitsabfrage zur Bestätigung des Werksresets
aufgefordert werden. Nach bestätigter Sicherheitsabfrage MUSS der Konnektor
die gesamte Konfiguration des Konnektors und alle internen Speicher, mit
Ausnahme des aktuellen Vertrauensraums sowie der Sicherheitsprotokolle und der
installierten Firmware, auf den Auslieferungszustand zurücksetzen. Die in
CERT_IMPORTED_CA_LIST enthaltenen Zertifikate MÜSSEN aus dem aktuellen
Vertrauensraum gelöscht werden.Die Durchführung des Werksresets MUSS
protokolliert werden durch TUC_KON_271 „Schreibe Protokolleintrag“
{    topic = „MGM/FACTORYSETTINGS“;    eventType =
Op;    severity = Info;    parameters =
„User=$AdminUsername“}.Dieser Protokolleintrag DARF NICHT durch einen
erfolgreichen Werksreset verloren gehen.Der Hersteller MUSS ferner einen
alternativen, herstellerspezifischen Weg zum Auslösen des Werksresets
vorsehen, welcher die Arbeitsabläufe beim Nutzer nur minimal unterbricht. Auch
für diesen zusätzlichen Weg MUSS zuvor eine Authentisierung durch eine
Kombination aus Benutzername und Passwort oder einem mindestens gleich starken
Mechanismus erfolgen. Der Mechanismus MUSS auch dann funktionieren, wenn sich
keiner der in der Benutzerverwaltung definierten Administratoren mehr
erfolgreichen anmelden kann. **[\<=]**

### 4.3.6 Leistungsumfänge und Standalone-Szenarios

Obgleich der Konnektor in seinem Auslieferungszustand alle Leistungsmerkmale
aufweisen muss, die gemäß Produkttypssteckbrief gefordert werden, so soll es
dem Administrator doch ermöglicht werden grundsätzliche Leistungsumfänge
gezielt deaktivieren zu können, um den Konnektor so besser in die
organisatorische/technische Struktur der Betriebsstätte eingliedern zu können.

##### TIP1-A_4821-02

Die Managementschnittstelle MUSS es einem Administrator ermöglichen
Konfigurationsänderungen gemäß Tabelle TAB_KON_658 vorzunehmen:

Tabelle361: TAB_KON_658 Aktivieren/Deaktivieren von Leistungsumfängen

<table><tr><th>
ReferenzID

</th><th>
Belegung

</th><th>
Bedeutung und Administrator-Interaktion

</th></tr><tr><td>
MGM_LU_ONLINE

</td><td>
Enabled/  
Disabled

</td><td>
Der Administrator MUSS den „Leistungsumfang Online“ aktivieren und
deaktivieren können.

Bei Veränderung MUSS TUC_KON_256 gerufen werden {  
  topic = „MGM/

LU

_CHANGED/LU_ONLINE“;  
  eventType = Op;  
  severity = Info; 

  parameters = „Active=$MGM_LU_ONLINE“}

</td></tr><tr><td>
MGM_LU_SAK

</td><td>
Enabled/  
Disabled

</td><td>
Der Administrator MUSS den „Leistungsumfang Signaturanwendungskomponente“
aktivieren und deaktivieren können.

Default-Wert: Enabled

Bei Veränderung MUSS TUC_KON_256 gerufen werden {  
  topic = „MGM/

LU

_CHANGED/LU_SAK“;  
  eventType = Op;  
  severity = Info; 

  parameters = „Active=$MGM_LU_SAK“}

</td></tr></table>

**[\<=]**

Der Konfigurationsparameter MGM_LU_SAK wirkt hauptsächlich in dem
Funktionsmerkmal „Signaturdienst“ (siehe Kapitel 4.1.8).

Ist MGM_LU_ONLINE Disabled, so baut der Konnektor grundsätzlich keine
Online-Verbindungen auf (weder zur TI, noch zum SIS). Der Parameter wirkt
hauptsächlich in den Funktionsmerkmalen:

 ---> UL

Ob es sich bei einem Konnektor um den losgelöst (stand alone) vom Netz der
Einsatzumgebung betriebenen handelt, also einen Konnektor, auf welchen kein
Clientsystem zugreift, muss diesem mitgeteilt werden:

##### TIP1-A_4822

Die Managementschnittstelle MUSS es einem Administrator ermöglichen
Konfigurationsänderungen gemäß Tabelle TAB_KON_659 vorzunehmen:

Tabelle362: TAB_KON_659 Konnektor Standalone einsetzen

<table><tr><th>
ReferenzID

</th><th>
Belegung

</th><th>
Bedeutung und Administrator-Interaktion

</th></tr><tr><td>
MGM_STANDALONE _KON

</td><td>
Enabled/Disabled

</td><td>
Der Administrator MUSS den Konnektor als alleinstehend konfigurieren
können.Default-Wert: DisabledBei Veränderung MUSS TUC_KON_256 gerufen werden
{  topic = „MGM/STANDALONE_CHANGED“;  eventType = Op;  severity =
Info;  parameters = „Active=$MGM_STANDALONE_KON“}

</td></tr></table>

​​ **[\<=]**

Das Setzen von MGM_STANDALONE_KON auf Enabled dient dem Konnektor als Anzeige,
dass dieser ohne angeschlossenes Clientsystem (Primärsystem) betrieben wird.
Diese Information kann seitens der Fachmodule verwendet werden, damit diese
sich im Standalone-Fall anders als im Normalfall verhalten.

### 4.3.7 Online-Anbindung verwalten

Um Zugang zur TI erlangen zu können, muss der Betriebsstättenverantwortliche
einen Vertrag mit einem Zugangsdienstprovider (ZGDP) abgeschlossen haben. Von
diesem erhält er eine ContractID. Der Administrator muss den Konnektor
(genauer das NK-Zertifikat C.NK.VPN) mit dieser Information unter Nutzung einer
SM-B über den Registrierungsdienst des ZGDP bei diesem freischalten.

Die Berechtigung zur Einwahl in die TI ist von der Gültigkeit derbeidenbei der
Freischaltung übermittelten Zertifikate abhängig (C.NK.VPN und C.HCI.OSIG).
Die Berechtigung zur Einwahl in die TI wird verweigert, bzw. eine bestehende
Verbindung zur TI wird beendet, wenn ein Zertifikat abgelaufen oder gesperrt
ist. Aus diesem Grund muss der Administrator vor Ablauf eines der beiden
Zertifikate eine wiederholte Registrierung mit neuem Netzkonnektorzertifikat
bzw. neuer SM-B beim ZGDP durchführen. (Hinweis: neue NK-Zertifikate werden
erst mit Etablierung der Nachladefunktionalität für gSMC-K verfügbar sein.)

Soll ein Konnektor außer Betrieb genommen werden oder wird der Vertrag mit
einem ZGDP gekündigt, muss der Administrator den Konnektor über den
Registrierungsdienst des ZGDP abmelden.

##### TIP1-A_4824

Der Administrator MUSS die in TAB_KON_661 aufgelisteten Parameter über die
Managementschnittstelle konfigurieren und die in TAB_KON_732 aufgelisteten
Parameter ausschließlich einsehen können.

Tabelle363: TAB_KON_661 Konfigurationsparameter der Konnektorfreischaltung

<table><tr><th>
ReferenzID

</th><th>
Belegung

</th><th>
Bedeutung und Administrator-Interaktion

</th></tr><tr><td>
MGM_ZGDP_CONTRACTID

</td><td>
String

</td><td>
Der Administrator MUSS die vom Zugangsdienstprovider für die Freischaltung des
Konnektors erhaltene ContractID eingeben können.

</td></tr><tr><td>
MGM_ZGDP_SMCB

</td><td>
ICCSN

</td><td>
Der Administrator MUSS die zur Freischaltung zu verwendende SM-B aus der Liste
der verwalteten SM-Bs auswählen können.

</td></tr></table>

Tabelle364: TAB_KON_732 Einsehbare Konfigurationsparameter der
Konnektorfreischaltung

<table><tr><th>
ReferenzID

</th><th>
Belegung

</th><th>
Bedeutung und Administrator-Interaktion

</th></tr><tr><td>
MGM_ZGDP_REGSERVER

</td><td>
URI

</td><td>
URI des Registrierungsservers des Zugangsdienstproviders

</td></tr></table>

Den Zustand der Freischaltung verwaltet der Konnektor gemäß Tabelle
TAB_KON_662 Zustandswerte der Konnektorfreischaltung.Im Auslieferungszustand
MUSS MGM_TI_ACCESS_GRANTED=Disabled belegt sein.

Tabelle365: TAB_KON_662 Zustandswerte der Konnektorfreischaltung

<table><tr><th>
ReferenzID

</th><th>
Belegung

</th><th>
Zustandswerte

</th></tr><tr><td>
MGM_TI_ACCESS_GRANTED

</td><td>
Enabled/Disabled

</td><td>
Status der Freischaltung des Konnektors:- Enabled: Konnektor wurde erfolgreich
beim Zugangsdienstprovider freigeschaltet- Disabled: Freischaltung noch nicht
erfolgt

</td></tr></table>

​​ **[\<=]**

##### TIP1-A_4825

Der Administrator MUSS den Konnektor über folgenden Mechanismus zur Nutzung
freischalten bzw. eine vorhandene Freischaltung mit einer neuen SM-B
aktualisieren können (Voraussetzung ist eine korrekte Konfiguration aller für
einen Online-Zugang erforderlicher Parameter):

 ---> OL

Tritt während der Verarbeitungskette ein Fehler auf, so bricht die weitere
Verarbeitung ab und der Administrator MUSS darüber geeignet informiert werden
(u.a. Klartextanzeige des vom Registrierungsdienst gemeldeten Fehlers).

Wenn eine Reregistrierung mit einer neuen SMC-B fehlschlägt (Request wird mit
einem SOAP-Error beantwortet ) dann ist der Konnektor nicht registriert
(MGM_TI_ACCESS_GRANTED = Disabled). **[\<=]**

##### TIP1-A_4826-01

Der Administrator MUSS über die Managementschnittstelle den aktuellen
Freischaltstatus einsehen können (MGM_TI_ACCESS_GRANTED). Ist der Konnektor
aktuell freigeschaltet, so MÜSSEN der VPN:ContractStatus, die für die
Freischaltung verwendete(n) SMC-B und die verwendeten C.NK.VPN-Zertifikate
angezeigt werden (RSA und/oder ECC). **[\<=]**

Möchte ein Konnektoreigentümer das Gerät weiterveräußern oder vollständig
außer Betrieb nehmen, so sollte er eine vorhandene Freischaltung zuvor
rückgängig machen.

##### TIP1-A_4827

Ist MGM_TI_ACCESS_GRANTED=Enabled, dann MUSS der Administrator über die
Managementschnittstelle des Konnektors die Freischaltung über den folgenden
Mechanismus zurücknehmen können:

 ---> OL

Tritt während der Verarbeitungskette ein Fehler auf, so bricht die weitere
Verarbeitung ab und der Administrator MUSS darüber geeignet informiert werden
(u.a. Klartextanzeige des vom Registrierungsdienst gemeldeten Fehlers).

Wenn eine Deregistrierung mit einer neuen SMC-B fehlschlägt (Request wird mit
einem SOAP-Error beantwortet) dann ist der Konnektor weiterhin registriert
(MGM_TI_ACCESS_GRANTED = Enabled). **[\<=]**

##### TIP1-A_5655

Der Hersteller des Konnektors MUSS im Handbuch den Administrator darüber
informieren, dass der Konnektor bei dauerhafter Außerbetriebnahme (z. B.
Verkauf, Schenkung, Entsorgung) beim Zugangsdienstprovider deregistriert werden
muss. **[\<=]**

##### A_23120

Der Konnektor DARF die automatische Re-Registrierung mit seinem
ECC-NK-Zertifikat NICHT öfter als einmal am Tag versuchen. **[\<=]**

##### A_23150

Der Konnektor MUSS dem Administrator über den Mechanismus in TUC_KON_411
ermöglichen, den Konnektor zu registrieren bzw. eine vorhandene Registrierung
zu aktualisieren. Dabei MUSS der Administrator das für die Registrierung zu
verwendende NK-Zertifikat (RSA oder ECC) und die zu verwendende SMC-B
auswählen können. **[\<=]**

##### A_23122

Der Konnektor MUSS dem Administrator ermöglichen, die automatische
Re-Registrierung mit dem ECC-NK-Zertifikat ein- und auszuschalten. Im
Auslieferungszustand muss die automatische Re-Registrierung eingeschaltet sein.
**[\<=]**

##### A_23121

Der Konnektor MUSS dem Administrator ermöglichen, die Verwendung von ECC bei
IPsec/IKE-Verbindungen ein- und auszuschalten. Die Verwendung von ECC darf nur
eingeschaltet werden, wenn der Konnektor mit seinem ECC-NK-Zertifikat beim
VPN-Zugangsdienst registriert ist. Die Verwendung von ECC darf nur
ausgeschaltet werden, wenn der Konnektor mit seinem RSA-NK-Zertifikat beim
VPN-Zugangsdienst registriert ist.Im eingeschalteten Zustand MUSS der Konnektor
die Vorgaben in A_17125 umsetzen. Im ausgeschalteten Zustand MUSS der Konnektor
die Vorgaben in GS-A_4382 umsetzen. **[\<=]**

##### A_23149

Der Konnektor MUSS dem Administrator ermöglichen, die Verwendung von
ECDSA-basierten Ciphersuiten bei TLS-Verbindungen ein- und auszuschalten. Im
ausgeschalteten Zustand DARF der Konnektor ECDSA-basierte Ciphersuiten NICHT
anbieten (Rolle TLS-Client) und NICHT auswählen (Rolle TLS-Server). Ebenfalls
DARF der Konnektor dann NICHT während des TLS-Verbindungsaufbaus (genauer bei
der Signatur der ephemeren (EC)DH-Schlüssel) mit ECDSA-basierten Zertifikaten
bzw. deren privaten ECC-Schlüsselmaterial Daten authentisieren. **[\<=]**

Es können separate Konfigurationsschalter für einzelne TLS-Strecken umgesetzt
werden.

Es gelten darüber hinaus:

 ---> UL

### 4.3.8 Re-Registrierung des Konnektors mit weiterem NK-Zertifikat

Eine Re-Registrierung eines Konnektors am VPN-Zugangsdienst mit einem neuen
NK-Zertifikat wird im Rahmen der ECC-Migration der IPsec-Kommunikation zum
VPN-Zugangsdienst mit einem ECC-Zertifikat notwendig

##### A_22332-01

Solange der Konnektor nur mit einem RSA-Zertifikat am VPN-Zugangsdienst
registriert ist, MUSS er mindestens einmal wöchentlich die Re-Registrierung
mit seinem ECC-NK-Zertifikat beim Registrierungsdienst durchführen. **[\<=]**

##### A_21758-05

Der Konnektor MUSS den technischen Use Case TUC_KON_411 "Konnektor mit neuem
NK-Zertifikat registrieren"umsetzen.

Tabelle 366: TAB_KON_932 – TUC_KON_411 „Konnektor mit neuem NK-Zertifikat
registrieren“

<table><tr><th>
Element

</th><th>
Beschreibung

</th></tr><tr><td>
Name

</td><td>
TUC_KON_411 "Konnektor mit neuem NK-Zertifikat registrieren"

</td></tr><tr><td>
Beschreibung

</td><td>
Dieser TUC führt eine Neuregistrierung mit einem neuen (ECC) NK-Zertifikat
durch.

</td></tr><tr><td>
Auslöser

</td><td>
A_

22332-01, A_23150

</td></tr><tr><td>
Vorbedingungen

</td><td>
Die gSMC-K

ist gemäß A_18928 dual-personalisiert.

</td></tr><tr><td>
Eingangsdaten

</td><td>
Keine

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor, VPN-ZugD

</td></tr><tr><td>
Ausgangsdaten

</td><td>
Keine

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

</td></tr><tr><td>
Varianten/Alternativen

</td><td>
Manuelle Registrierung:  
(-\>2) Der Administrator soll die zu verwendende SM-B
auswählen können.

</td></tr><tr><td>
Fehlerfälle

</td><td>
(



 2

) Es konnte keine freigeschaltete SM-B ausgewählt werden:  
     
Fail=No_Smcb  
(-\>2,3) Im Fehlerfall  
       TUC_KON_256 {  
       
    topic = „SMC_K/REGISTER/ERROR“;  
            eventType = Op; 

            severity = Error;  
            parameters =
„$Parameters“;  
            doLog = true;  
            doDisp
= true }  
Die Registrierung soll herstellerspezifisch erneut mehrmals versucht
werden.  
Bei allen Fehlerfällen, die zum Abbruch führen:  
TUC_KON_256 { 

       topic = „SMC_K/REGISTER/ERROR“;  
       eventType =
Op;  
       severity = Error;  
       parameters =
„$Parameters“;  
       doLog = true;  
       doDisp = true }

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
Keine

</td></tr></table>

Tabelle 367: Tab_Kon_933 Fehlercodes TUC_KON_411"Konnektor mit neuem
NK-Zertifikat registrieren"

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td colspan="4" rowspan="1">
herstellerspezifisch

</td></tr></table>

**[\<=]**

##### A_21781

Der Hersteller des Konnektors MUSS in seinem Handbuch den Nutzer/Administrator
darauf hinweisen, dass das Ereignis mit dem Topic=SMC_K/REGISTER/ERROR dringend
durch das Primärsystem abonniert werden sollte. Bei Auftreten des Fehlers mit
Fail=No_Smcb muss in der Leistungserbringerumgebung dafür gesorgt werden, dass
eine freigeschaltete SMC-B verfügbar ist, die der Konnektor beim nächsten
Re-Registrierungsversuch verwenden kann. **[\<=]**

### 4.3.9 Remote Management (Optional)

Im Betreibermodell der TI wird unter Remote Management ein delegierter Betrieb
dezentraler Produkte durch einen durch den Anwender beauftragten Servicepartner
verstanden. Der Servicepartner stellt als Vertragsbestandteil bevollmächtigte
Personen zur Verfügung, die sich ständig um die Betriebs- und Datensicherheit
der dezentralen Produkte im Rahmen eines Remote Managements kümmern.

Voraussetzung für die Etablierung dieses Bestandteils des Betreibermodells der
TI ist, dass ein dezentrales Produkt ein Remote Management technisch
unterstützt. Die nachfolgend aufgeführten Anforderungen bilden die Grundlage
für die Nutzung von Remote Management am Konnektor.

Zum Remote Management gehören die Verwaltung von Konfigurationsdaten und die
Durchführung weiterer Administratoraktionen wie z. B. die Aktualisierung der
Software des Konnektors. Im Rahmen des Remote Managements kann der Konnektor
Remote Monitoring unterstützen. Dazu übermittelt der Konnektor
Betriebszustandsdaten an das Remote- Management-System.

##### TIP1-A_7276-01

Der Konnektor KANN Remote Management technisch unterstützen.Falls der Konnektor
das Remote Management technisch unterstützt, MUSS der Konnektor
alle Anforderungen, die das Remote Management (z.B. auch Remote-Administrator)
betreffen, umsetzen.Andernfalls sind die Anforderungen, die das Remote
Management (z.B. auch Remote-Administrator) betreffen, für den Konnektor nicht
relevant. **[\<=]**

##### TIP1-A_5647

Der Konnektor DARF über die Remote-Managementschnittstelle KEINE
personenbezogenen Daten übertragen oder darstellen. **[\<=]**

##### TIP1-A_5648

Der Hersteller des Konnektors MUSS die zur Nutzung der
Remote-Managemenschnittstelle notwendigen Informationen offenlegen. Der
Hersteller des Konnektors MUSS die Remote-Managementschnittstelle so
spezifizieren und implementieren, dass diese auch für Dritte (z.B. einen durch
den Anwender beauftragten Servicepartner) nutzbar ist. **[\<=]**

##### TIP1-A_5649

Der Hersteller des Konnektors SOLL für die Implementierung der
Remote-Managementschnittstelle standardbasierte Verfahren und Protokolle
einsetzen. **[\<=]**

##### TIP1-A_5650

Der Konnektor MUSS sicherstellen, dass die Initiierung einer
Remote-Managementverbindung im Sinne des Verbindungsaufbaus immer vom Konnektor
ausgeht. **[\<=]**

##### TIP1-A_5651

Der Konnektor MUSS die Remote-Management-Verbindung durch Nutzung eines
kryptographischen Verfahrens gemäß [gemSpec_Krypt] hinsichtlich
Vertraulichkeit, Integrität und Authentizität absichern. **[\<=]**

Das Remote-Management-System authentisiert sich auf Transportebene
zertifikatsbasiert gegenüber dem Konnektor.

##### TIP1-A_7277

Der Konnektor MUSS eine zertifikatsbasierte Authentifizierung des
Remote-Management-Systems auf Transportebene durchführen. **[\<=]**

##### TIP1-A_7278

Der Konnektor MUSS sich gegenüber dem Remote-Management-System
zertifikatsbasiert oder mittels Username/Password authentisieren. **[\<=]**

##### TIP1-A_7281

Das Remote-Management-System MUSS eine Authentifizierung des Konnektors
durchführen. **[\<=]**

Die Authentifizierung des Remote-Management-Systems durch den Konnektor auf
Transportebene ist verpflichtend gefordert.

Darüber hinaus können optional Remote-Administratoren in der
Benutzerverwaltung des Konnektors konfiguriert werden. Wenn
Remote-Administratoren in der Benutzerverwaltung konfiguriert sind, muss der
Konnektor diese verpflichtend auf Anwendungsebene authentifizieren.  

Wenn kein Remote-Administrator konfiguriert ist, vertraut der Konnektor der
Benutzerverwaltung des Remote-Management-Systems. Auch wenn die Verwaltung von
Remote-Administratoren an das Remote-Management-System delegiert ist, werden
alle Zugriffe über das Remote-Management-System auf den Konnektor mit der
Rolle Remote-Administrator ausgeführt. Das Remote-Management-System muss die
Authentisierung der Remote-Administratoren und die Nachvollziehbarkeit der
Zugriffe sicherstellen.

##### TIP1-A_7279

Wenn in der Benutzerverwaltung des Konnektors Administratoren mit der
Administrator-Rolle Remote-Administrator konfiguriert sind, MUSS der Konnektor
diese gemäß TIP1-A_4808 authentifizieren. **[\<=]**

##### TIP1-A_7280

Der Konnektor DARF Remote-Administratoren Rechte gemäß TAB_KON_851 und
TAB_KON_655 NICHT gewähren. **[\<=]**

<table><tr><th colspan="3">
Fachliche Anbindung der Clientsysteme

</th></tr><tr><td>
TIP1-A_4517

</td><td>
Schlüssel und X.509-Zertifikate für die Authentisierung des Clientsystems
erzeu­gen und exportieren sowie X.509-Zertifikate importieren

</td><td>
 

</td></tr><tr><td>
TIP1-A_4518

</td><td>
Konfiguration der Anbindung Clientsysteme

</td><td>
 

</td></tr><tr><td colspan="3">
Kartendienst

</td></tr><tr><td>
TIP1-A_5110

</td><td>
Übersicht über alle verfügbaren Karten

</td><td>
Karten vom Typ eGK und HBA DÜRFEN dem Remote-Administrator NICHT angezeigt
werden

</td></tr><tr><td>
TIP1-A_5111

</td><td>
PIN-Management der SM-Bs für den Administrator

</td><td>
 

</td></tr><tr><td colspan="3">
Zertifikatsdienst

</td></tr><tr><td>
TIP1-A_4704

</td><td>
Zertifikatsablauf anzeigen

</td><td>
Zertifikate von Karten vom Typ eGK und HBA DÜRFEN dem Remote-Administrator
NICHT angezeigt werden

</td></tr><tr><td colspan="3">
Protokollierungsdienst

</td></tr><tr><td>
TIP1-A_4716

</td><td>
Einsichtnahme und Veränderung der Protokolle

</td><td>
Personenbezogene Daten DARF der Remote-Administrator NICHT einsehen und
exportieren. Fachmodulprotokolle müssen daher entweder gesperrt, oder die
personenbezogenen Daten aus diesen für den Remote-Administrator gefiltert
werden.

</td></tr><tr><td>
TIP1-A_4814

</td><td>
Export- Import von Konfigurationsdaten

</td><td>
 

</td></tr><tr><td colspan="3">
Neustart und Werksreset

</td></tr><tr><td>
TIP1-A_4820

</td><td>
Werksreset des Konnektors

</td><td>
 

</td></tr></table>

##### TIP1-A_5652

Der Konnektor MUSS sicherstellen, dass es ausschließlich einem Administrator
mit einer der Rollen {Lokaler Administrator; Super-Administrator} und dem Recht
USER_INIT_REMOTESESSION möglich ist, Konfigurationsänderungen gemäß
TAB_KON_663 vorzunehmen.

Tabelle369: TAB_KON_663 Konfigurationen des Remote Managements

<table><tr><th>
ReferenzID

</th><th>
Belegung

</th><th>
Bedeutung und Administrator-Interaktion

</th></tr><tr><td>
MGM_REMOTE_ALLOWED

</td><td>
Enabled/Disabled

</td><td>
Der Administrator MUSS einstellen können, ob derKonnektor eine
Remote-Management-Verbindungaufbauen kann, über die Konfigurationen
vorgenommen werden können.Enabled: Der Konnektor kann eine
Remote-Management-Verbindung aufbauenund erlaubt Konfiguration über das
Remote-Management System.Disabled: Der Konnektorerlaubt keine Konfiguration
über das Remote Management-SystemDefault-Wert: Disabled

</td></tr><tr><td>
MGM_REMOTE_MONITORING_ALLOWED

</td><td>
Enabled / Disabled

</td><td>
Der Konnektor KANN Remote-Monitoring unterstützen.In diesem Fall MUSS der
Konnektor dem Administrator die Aktivierung und Deaktivierung des
Remote-Monitoring ermöglichen.Enabled: Der Konnektor baut eine
Remote-Managementverbindung auf.Der Konnektor übermittelt Betriebszustände
gemäß TAB_KON_503 an das Remote-Management-System.Disabled: Remote-Monitoring
ist deaktiviert. Der Konnektor übermittelt keine Betriebszustände an das
Remote-Management-System.Default-Wert: Disabled

</td></tr><tr><td colspan="3">
Der Konnektor SOLL die Konfiguration der URL des Remote-Management-Systems, der
 Zertifikatsinformationen zur Authentisierung des Remote-Management-Systems
und der Credentials für die Authentisierung des Konnektors beim
Remote-Management-System ermöglichen.

</td></tr></table>

​​ **[\<=]**

##### TIP1-A_5653

Der Konnektor MUSS im Rahmen des Remote-Managements folgende Aktionen
protokollieren:

 ---> UL

**[\<=]**

Ein Softwareupdate gemäß TIP1-A_5657 kann auch über das Remote Management
initiiert, aktiviert und freigeschaltet werden.

### 4.3.10 Software- und Konfigurationsaktualisierung (KSR-Client)

Die Umsetzung des KSR-Clients bezüglich des Mechanismus zur Durchführung der
Aktualisierungen, sowie die Art der Darstellung an der Managementschnittstelle
sind herstellerspezifisch.

Innerhalb der Software- und Konfigurationsaktualisierung (KSR-Client) werden
folgende Präfixe für Bezeichner verwendet:

 ---> UL

### 4.3.10.1 Funktionsmerkmalweite Aspekte

Der Konnektor muss einen KSR-Client bereitstellen, über den der Administrator
sowohl den Konnektor selbst als auch die vom Konnektor verwalteten
Kartenterminals (CT-Objects in CTM_CT_LIST mit CT.CORRELATION\>=„gepairt“
und CT.VALID_VERSION=True und CT.IS_PHYSICAL = Ja) softwareseitig aktualisieren
kann.

Weiterhin muss über den KSR-Client eine Aktualisierung von ausgewählten
Konfigurationsdaten möglich sein.

##### TIP1-A_4829

DieSoftware-AktualisierungdesKonnektor SOLL sicherstellen, dass alle
Software-Bestandteile des Konnektors aktualisiert werden können, damit eine
ungehinderte Nachnutzung der Hardware-Basis im Feld mit neuen Funktionalitäten
nicht durch nichtaktualisierbare Software-Bestandteile gefährdet wird. Weicht
ein Hersteller für sein Konnektormodell von dieser Forderung in Teilen ab, so
MUSS er im Rahmender Zulassung nachweisen, dass dies auf Grund von
Sicherheitsaspekten für sein eingereichtes Konnektormodell zwingend
erforderlich ist. **[\<=]**

##### TIP1-A_5657-02

Der Konnektor MUSS die Möglichkeit bieten, dass Softwareupdates durch den
Nutzer bzw. einen von ihm beauftragten Administrator einzeln freigeschaltet
werden. **[\<=]**

##### A_18387

Der Konnektor MUSS die Möglichkeit bieten, die automatische Installation von
Softwareupdates pro Gerät (Konnektor und Kartenterminals) ein- und
auszuschalten. **[\<=]**

##### A_18389

Der Hersteller des Konnektors MUSS in seinem Handbuch den Nutzer darauf
hinweisen, dass er sich bei der Arbeit mit dem Konnektor vergewissern muss,
dass er mit einer zugelassenen Version arbeitet und beschreiben, wie der Nutzer
diese Information mittels seines Primärsystems erhalten kann. **[\<=]**

##### TIP1-A_6476

Der Hersteller des Konnektors MUSS jede zugelassene Firmware-Version umgehend
als Update-Paket über die in [gemSpec_KSR] definierte Schnittstelle
P_KSRS_Upload im Konfigurationsdienst (KSR) ablegen.

Der Hersteller des Konnektors MUSS in den jeweiligen
UpdateInformation/Firmware/FirmwareReleaseNotes eine Internet-URL zum Download
des FW-Updates bereitstellen. **[\<=]**

##### TIP1-A_6026

Das Managementinterface des Konnektors MUSS einem authentisierten Administrator
die Internet-URL zum Download des FW-Updates anzeigen. **[\<=]**

### 4.3.10.2 Durch Ereignisse ausgelöste Reaktionen

##### TIP1-A_4831

Wenn aus (TIP1-A_4840 Auslösen der durchzuführenden Updates) heraus für ein
Kartenterminal noch ein ausstehendes Updates vorhanden ist, dessen
Ausführungszeitpunkt nicht gesetzt oder überschritten ist, und für dieses
Kartenterminal das Ereignis „CT/CONNECTED“eintritt, so MUSS TUC_KON_281
„Kartenterminalaktualisierung anstoßen“für dieses KT gerufen werden. **[\<=]**

### 4.3.10.3 Interne TUCs, nicht durch Fachmodule nutzbar

### 4.3.10.3.1 TUC_KON_280 „Konnektoraktualisierung durchführen“

##### TIP1-A_4832-02

Der Konnektor MUSS den technischen Use Case TUC_KON_280
„Konnektoraktualisierung durchführen“ umsetzen.

Tabelle370: TAB_KON_664 – TUC_KON_280 „Konnektoraktualisierung
durchführen“

<table><tr><th>
Element

</th><th>
Beschreibung

</th></tr><tr><td>
Name

</td><td>
TUC_KON_280 „Konnektoraktualisierung durchführen“

</td></tr><tr><td>
Beschreibung

</td><td>
Dieser TUC aktualisiert den Konnektor mit einem Update, dessen Update-Dateien
entweder direkt übergeben oder per UpdateInformation (vom KSRS bezogen)
referenziert werden

</td></tr><tr><td>
Auslöser

</td><td>
 ---> UL

 ---> UL

</td></tr><tr><td>
Vorbedingungen

</td><td>
</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

oder

 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor, Konfigurationsdienst

</td></tr><tr><td>
Ausgangsdaten

</td><td>
Keine

</td></tr><tr><td>
Nachbedingungen

</td><td>
Der Konnektor arbeitet basierend auf der übergebenen, im Updatepaket
enthaltenen neuen Version.

</td></tr><tr><td>
Standardablauf

</td><td>
Der Konnektor MUSS die zur Anwendung übergebene UpdateInformation wie folgt
anwenden:

 ---> OL

Der TUC endet in jedem Fall mit:

TUC_KON_256 {

    topic = „KSR/UPDATE/END“;

    eventType = Sec;

    severity = Info;

    parameters = („Target=Konnektor,

                           Name=$MGM_KONN_HOSTNAME“)
}

(betroffene Fachmodule und Basisdienste reagieren und starten sich)

</td></tr><tr><td>
Varianten/Alternativen

</td><td>
Sofern direkt ein Updatepaket (mit enthaltenen FirmwareFiles) übergeben wurde
beginnt der Ablauf ab Nummer 4 mit der Integritätsprüfung des Updatepakets

</td></tr><tr><td>
Fehlerfälle

</td><td>
Fehler in den folgenden Schritten des Ablaufs führen zu:

a) Aufruf von TUC_KON_256 {

          topic = „KSR/ERROR“;

          eventType = $ErrorType;

          severity = $Severity;

          parameters = („Target=Konnektor,

                 Name= $MGM_KONN_HOSTNAME,

                 Error=$Fehlercode,

                 Bedeutung=$Fehlertext“) }

b) Abbruch der Verarbeitung mit den ausgewiesenen Fehlercodes

(



1) Integritätsprüfung UpdateInformation fehlgeschlagen, Fehlercode: 4181

(



2) Fehler bei der Downloaddurchführung, Fehlercode: 4182

(



3) Integritätsprüfung eines FirmwareFiles fehlgeschlagen, Fehlercode: 4183

(



4) Firmwaregruppenprüfung fehlgeschlagen, Fehlercode: 4185

(



5b) Interne Aktualisierung fehlgeschlagen, dann:

          1. Rollback auf vorherige Version

          2. Abbruch mit Fehlercode: 4184

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Der laufende Updatevorgang MUSS in der Managementschnittstelle ausgewiesen und
der Fortschritt mindestens für die Schritte 1-5b dargestellt werden.

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
Abbildung PIC_KON_105 Aktivitätsdiagramm Konnektoraktualisierung durchführen

</td></tr></table>

Tabelle371: TAB_KON_665 Fehlercodes TUC_KON_280 „Konnektoraktualisierung
durchführen“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4181

</td><td>
Security

</td><td>
Error

</td><td>
Integritätsprüfung UpdateInformation fehlgeschlagen.

</td></tr><tr><td>
4182

</td><td>
Security

</td><td>
Error

</td><td>
Download nicht aller UpdateFiles möglich.

</td></tr><tr><td>
4183

</td><td>
Security

</td><td>
Error

</td><td>
Integritätsprüfung UpdateFiles fehlgeschlagen.

</td></tr><tr><td>
4184

</td><td>
Security

</td><td>
Error

</td><td>
Anwendung der UpdateFiles fehlgeschlagen (\<Details\>).

</td></tr><tr><td>
4185

</td><td>
Security

</td><td>
Error

</td><td>
Firmware-Version liegt außerhalb der gültigen Firmware-Gruppe

</td></tr></table>

![Img-074][Img-074]

Abbildung22: PIC_KON_105 Aktivitätsdiagramm Konnektoraktualisierung
durchführen   **[\<=]**

### 4.3.10.3.2 TUC_KON_281 „Kartenterminalaktualisierung anstoßen“

Im Vergleich zur Durchführung des Konnektor-Update (TUC_KON_280), werden die
Updates der Kartenterminals nur durch den Konnektor initiiert. Der Konnektor
liefert dem Kartenterminal das Updatefile, der eigentliche Updatevorgang
(inklusive der Prüfung des Updatepakets auf Integrität und Authentizität)
erfolgt ausschließlich und eigenverantwortlich auf Seiten des Kartenterminals.

##### TIP1-A_4833-02

Der Konnektor MUSS den technischen Use Case TUC_KON_281
„Kartenterminalaktualisierung anstoßen“ umsetzen.

Tabelle372: TAB_KON_666 – TUC_KON_281 „Kartenterminalaktualisierung
anstoßen“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_281 „Kartenterminalaktualisierung anstoßen“

</td></tr><tr><td>
Beschreibung

</td><td>
Dieser TUC fordert ein Kartenterminal auf einen Update durchzuführen, dessen
Update-Dateien entweder direkt übergeben oder per UpdateInformation (vom KSRS
bezogen) referenziert werden

</td></tr><tr><td>
Auslöser

</td><td>
 ---> UL

 ---> UL

</td></tr><tr><td>
Vorbedingungen

</td><td>
 ---> UL

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor, Kartenterminal

</td></tr><tr><td>
Ausgangsdaten

</td><td>
Keine

</td></tr><tr><td>
Nachbedingungen

</td><td>
Das Kartenterminal arbeitet basierend auf der übergebenen, im Updatepaket
enthaltenen neuen Version.

</td></tr><tr><td>
Standardablauf

</td><td>
Der Konnektor MUSS die zur Anwendung übergebene UpdateInformation wie folgt
anwenden:

 ---> OL

a)         Wechsel in eine Admin-Session durch TUC_KON_050  
    
„Beginne Kartenterminalsitzung“{role=„Admin“; ctId}

b)         Senden der SICCT Kommandos: SICCT CT Download INIT, 

     SICCT CT Download DATA (Übermittlung des UpdateFiles) und  
    
SICCT CT Download FINISH an ctId

c)         TUC_KON_256{  
          topic =
„KSR/UPDATE/SUCCESS”;  
          eventType = Sec; 

          severity = Info;  
          parameters =
(„Target=KT,  
                 Name= $CT.HOSTNAME, CtID
=$ctId,  
                 NewFirmwareversion = 

                          \<UpdateInformation.FirmwareVersion\>„}

Der TUC endet in jedem Fall mit:

 ---> UL

</td></tr><tr><td>
Varianten/Alternativen

</td><td>
Sofern direkt ein Updatepaket (mit enthaltenem FirmwareFile) übergeben wurde
beginnt der Ablauf ab Nummer 2 mit Signalisierung des Beginns des KT-Updates

</td></tr><tr><td>
Fehlerfälle

</td><td>
Fehler in den folgenden Schritten des Ablaufs führen zu:

a)           Aufruf von TUC_KON_256 {  
           topic =
„KSR/ERROR”;  
           eventType = $ErrorType; 

           severity = $Severity;  
           parameters =
(„Target=KT, Name=$CT.HOSTNAME, 

                       CtID =$ctId, Error=$Fehlercode, 

                       Bedeutung=$Fehlertext“) }

b)           Abbruch der Verarbeitung mit den ausgewiesenen Fehlercodes

(



1) Download fehlgeschlagen, Fehlercode: 4186

(



3b) SICCT-Download fehlgeschlagen, Fehlercode: 4187

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Die Durchführung eines KT-Updates DARF die weitere Operation des Konnektors
NICHT behindern (weder auf Schnittstellenebene noch in der
Managementschnittstelle).

Der laufende Updatevorgang eines KT MUSS in der Managementschnittstelle
ausgewiesen und der Fortschritt dargestellt werden.

Der Konnektor MUSS mindestens 5 Kartenterminal-Updates parallel durchführen
können.

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
keine

</td></tr></table>

Tabelle373: TAB_KON_667 Fehlercodes TUC_KON_281 „Kartenterminalaktualisierung
anstoßen“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4186

</td><td>
Security

</td><td>
Error

</td><td>
Download nicht aller UpdateFiles möglich.

</td></tr><tr><td>
4187

</td><td>
Security

</td><td>
Error

</td><td>
KT-Update fehlgeschlagen (\<Fehlerinfo gemäß SICCT\>)

</td></tr></table>

**[\<=]**

### 4.3.10.3.3 TUC_KON_282 „UpdateInformationen beziehen“

##### TIP1-A_4834

Der Konnektor MUSS den technischen Use Case TUC_KON_282 „UpdateInformationen
beziehen“ umsetzen.

Tabelle374: TAB_KON_668 – TUC_KON_282 „UpdateInformationen beziehen“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_282 „UpdateInformationen beziehen“

</td></tr><tr><td>
Beschreibung

</td><td>
Dieser TUC ermittelt vom zentralen Konfigurationsdienst sowohl für den
Konnektor als auch für alle durch ihn verwalteten Kartenterminals die
verfügbaren UpdateInformationen

</td></tr><tr><td>
Auslöser

</td><td>
 ---> UL

</td></tr><tr><td>
Vorbedingungen

</td><td>
Keine

</td></tr><tr><td>
Eingangsdaten

</td><td>
Keine

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor, Konfigurationsdienst

</td></tr><tr><td>
Ausgangsdaten

</td><td>
Keine

</td></tr><tr><td>
Nachbedingungen

</td><td>
Der Konnektor verfügt über alle aktuellen UpdateInformationen

</td></tr><tr><td>
Standardablauf

</td><td>
Der Konnektor MUSS folgende Schritte durchlaufen:

 ---> OL

 ---> OL

</td></tr><tr><td>
Varianten/Alternativen

</td><td>
Keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
Fehler in den folgenden Schritten des Ablaufs führen zu:

a)          Aufruf von TUC_KON_256 {  
           topic =
„KSR/ERROR“;  
           eventType = $ErrorType;  
          
severity = $Severity;  
           parameters =
(„Error=$Fehlercode; Bedeutung=$Fehlertext“)}

b)          Abbruch der Verarbeitung mit den ausgewiesenen Fehlercodes

(



1) Konfigurationsdienst nicht erreichbar, Fehlercode: 4188

(



1) Serverzertifikat ist nicht C.ZD.TLS_S, Fehlercode: 4189

(



2b) Fehler beim Beziehen der Updatelisten, Fehlercode: 4190

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Der Konnektor muss die Vorgaben aus [gemSpec_Krypt#3.3.2] für TLS-Verbindungen
und hinsichtlich ECC-Migration die Vorgaben aus [gemSpec_Krypt#5] befolgen.

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
keine

</td></tr></table>

Tabelle375: TAB_KON_669 Fehlercodes TUC_KON_282 „UpdateInformationen
beziehen“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases, sowie der
Fehlercodes von „I_KSRS_Download::listUpdates Response“ können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4188

</td><td>
Technical

</td><td>
Error

</td><td>
Konfigurationsdienst nicht erreichbar, konfigurierte Adresse kontrollieren.

</td></tr><tr><td>
4189

</td><td>
Security

</td><td>
Fatal

</td><td>
Konfigurationsdienst liefert falsches Zertifikat

</td></tr><tr><td>
4190

</td><td>
Technical

</td><td>
Error

</td><td>
Fehler beim Beziehen der Updatelisten

</td></tr></table>

**[\<=]**

### 4.3.10.3.4 TUC_KON_283 „Infrastruktur Konfiguration aktualisieren“

##### TIP1-A_5153

Der Konnektor MUSS den technischen Use Case TUC_Kon_283 „Infrastruktur
Konfiguration aktualisieren“ umsetzen.

Tabelle376: TAB_KON_799 – TUC_KON_283 „Infrastruktur Konfiguration
aktualisieren“

<table><tr><th>
Element

</th><th>
Beschreibung

</th></tr><tr><td>
Name

</td><td>
TUC_KON_283 Infrastruktur Konfiguration aktualisieren

</td></tr><tr><td>
Beschreibung

</td><td>
Dieser TUC liest die Infrastrukturdaten vom KSR ein.

</td></tr><tr><td>
Auslöser

</td><td>
Automatisch einmal täglich; BOOTUP, Administrator

</td></tr><tr><td>
Vorbedingungen

</td><td>
Der TUC_KON_304 „Netzwerk-Routen einrichten“ MUSS fehlerfrei durchgelaufen
sein.

Der TUC_KON_321 „Verbindung zu dem VPN-Konzentrator der TI aufbauen“ MUSS
fehlerfrei durchgelaufen sein.

</td></tr><tr><td>
Eingangsdaten

</td><td>
Keine

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor, Konfigurationsdienst

</td></tr><tr><td>
Ausgangsdaten

</td><td>
Keine

</td></tr><tr><td>
Standardablauf

</td><td>
Der Konnektor MUSS folgende Schritte durchlaufen:

 ---> OL

</td></tr><tr><td>
Varianten/Alternativen

</td><td>
Keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
(



1-5) Es ist ein unerwarteter Fehler aufgetreten; Fehlercode: 4198

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
Keine

</td></tr></table>

Tabelle377: Tab_Kon_726 Fehlercodes TUC_KON_283 „Infrastruktur Konfiguration
aktualisieren“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4198

</td><td>
Technical

</td><td>
Error

</td><td>
Beim Übernehmen der angeschlossenen Netze des Gesundheitswesens mit WANDA Basic
ist ein Fehler aufgetreten.

</td></tr></table>

**[\<=]**

### 4.3.10.4 Interne TUCs, auch durch Fachmodule nutzbar

### 4.3.10.4.1 TUC_KON_285 „UpdateInformationen für Fachmodul beziehen“

##### TIP1-A_6018

Der Konnektor MUSS den technischen Use Case TUC_KON_285 „UpdateInformationen
für Fachmodul beziehen“ umsetzen.

Tabelle378: TAB_KON_833 – TUC_KON_285 „UpdateInformationen für Fachmodul
beziehen“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_285 „UpdateInformationen für Fachmodul beziehen“

</td></tr><tr><td>
Beschreibung

</td><td>
Dieser TUC ermittelt vom zentralen Konfigurationsdienst für ein Fachmodul die
verfügbaren UpdateInformationen eines angegebenen SW-Pakets.

</td></tr><tr><td>
Auslöser

</td><td>
 ---> UL

</td></tr><tr><td>
Vorbedingungen

</td><td>
 ---> UL

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

Hinweis: Definition von productVendorID, productCode, hwVersion, fwVersion
(entspricht FWVersion) siehe [gemSpec_KSR#TIP1-A_3331]

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor, Konfigurationsdienst

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Nachbedingungen

</td><td>
keine

</td></tr><tr><td>
Standardablauf

</td><td>
Der Konnektor MUSS folgende Schritte durchlaufen:

 ---> OL

 ---> OL

</td></tr><tr><td>
Varianten/Alternativen

</td><td>
Keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
Fehler in den folgenden Schritten des Ablaufs führen zu: 

(1)    Konfigurationsdienst nicht erreichbar, Fehlercode: 4188  
(1)
Serverzertifikat ist nicht C.ZD.TLS_S, Fehlercode: 4189  
(3) Fehler beim
Beziehen der Updatelisten, Fehlercode: 4190

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Der Konnektor muss die Vorgaben aus [gemSpec_Krypt#3.3.2] für TLS-Verbindungen
und hinsichtlich ECC-Migration die Vorgaben aus [gemSpec_Krypt#5] befolgen.

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
keine

</td></tr></table>

Tabelle379: TAB_KON_834 Fehlercodes TUC_KON_285 „UpdateInformationen für
Fachmodul beziehen“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases, sowie der
Fehlercodes von „I_KSRS_Download::listUpdates Response“ können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4188

</td><td>
Technical

</td><td>
Error

</td><td>
Konfigurationsdienst nicht erreichbar, konfigurierte Adresse kontrollieren.

</td></tr><tr><td>
4189

</td><td>
Security

</td><td>
Fatal

</td><td>
Konfigurationsdienst liefert falsches Zertifikat

</td></tr><tr><td>
4190

</td><td>
Technical

</td><td>
Error

</td><td>
Fehler beim Beziehen der Updatelisten

</td></tr></table>

**[\<=]**

### 4.3.10.4.2 TUC_KON_286 „Paket für Fachmodul laden“

##### TIP1-A_6019

Der Konnektor MUSS den technischen Use Case TUC_KON_286 „Paket für Fachmodul
laden“ umsetzen.

Tabelle380: TAB_KON_835 – TUC_KON_286 „Paket für Fachmodul laden“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_286 „Paket für Fachmodul laden“

</td></tr><tr><td>
Beschreibung

</td><td>
Dieser TUC lädt ein bestimmtes SW-Paket für ein Fachmodul vom zentralen
Konfigurationsdienst.

</td></tr><tr><td>
Auslöser

</td><td>
Aufruf durch Fachmodul

</td></tr><tr><td>
Vorbedingungen

</td><td>
 ---> UL

</td></tr><tr><td>
Eingangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor, Konfigurationsdienst

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Nachbedingungen

</td><td>
keine

</td></tr><tr><td>
Standardablauf

</td><td>
 ---> OL

Das Server-Zertifikat C.ZD.TLS-S MUSS für den Konfigurationsdienst ausgestellt
sein.

 ---> OL

</td></tr><tr><td>
Varianten/Alternativen

</td><td>
keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
(



1) Verbindung zum KSR konnte nicht aufgebaut werden; Fehlercode: 4188

(



1) Serverzertifikat ist nicht C.ZD.TLS_S, Fehlercode: 4189

(



2) Wenn Größe des Pakets größer als 25MB, Fehlercode: 4242

(



2) Sonstige Fehler beim Download: Das Paket konnte nicht geladen werden,
Fehlercode: 4238

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
Keine

</td></tr></table>

Tabelle381: TAB_KON_836 Fehlercodes TUC_KON_286 „Paket für Fachmodul laden“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können folgende
weitere Fehlercodes auftreten:

</td></tr><tr><td>
4188

</td><td>
Technical

</td><td>
Error

</td><td>
Konfigurationsdienst nicht erreichbar, konfigurierte Adresse kontrollieren.

</td></tr><tr><td>
4189

</td><td>
Security

</td><td>
Fatal

</td><td>
Konfigurationsdienst liefert falsches Zertifikat

</td></tr><tr><td>
4238

</td><td>
Technical

</td><td>
Error

</td><td>
Der Download des Pakets vom KSR ist fehlgeschlagen.

</td></tr><tr><td>
4242

</td><td>
Technical

</td><td>
Error

</td><td>
Der Download des Pakets vom KSR ist fehlgeschlagen. Das Paket ist größer als
25MB.

</td></tr></table>

**[\<=]**

### 4.3.10.5 Operationen an der Außenschnittstelle

Keine.

### 4.3.10.6 Betriebsaspekte

##### A_21899

Der Konnektor DARF NICHT nach einer Aktualisierung der Datei Bestandsnetze.xml
einen Restart durchführen. **[\<=]**

##### A_21900

Der Konnektor MUSS die Anzahl der Reboots minimieren. **[\<=]**

### 4.3.10.6.1 TUC_KON_284 KSR-Client initialisieren

##### TIP1-A_5938

Der Konnektor MUSS in der Bootup-Phase TUC_KON_284 „KSR-Client
initialisieren“ durchlaufen.

Tabelle382: TAB_KON_864 – TUC_KON_284 „KSR-Client initialisieren“

<table><tr><td>
Element

</td><td>
Beschreibung

</td></tr><tr><td>
Name

</td><td>
TUC_KON_284 ”KSR-Client initialisieren”

</td></tr><tr><td>
Beschreibung

</td><td>
Der Konnektor muss während des Bootups die Downloadpunkte für
Konfigurationsdaten und Firmware ermitteln.

</td></tr><tr><td>
Eingangsanforderung

</td><td>
Keine

</td></tr><tr><td>
Auslöser und Vorbedingungen

</td><td>
Bootup

Verbindung zum VPN-Konzentrator TI muss aufgebaut sein

</td></tr><tr><td>
Eingangsdaten

</td><td>
Keine

</td></tr><tr><td>
Komponenten

</td><td>
Konnektor

</td></tr><tr><td>
Ausgangsdaten

</td><td>
 ---> UL

</td></tr><tr><td>
Standardablauf

</td><td>
 -             Falls MGM_LU_ONLINE=Enabled:

            -              Durch DNS-Anfragen an den
DNS-Forwarder zur  
                 Auflösung der SRV-RR und
TXT-RR mit den Bezeichnern  
               
„_ksrkonfig._tcp.ksr.\<TOP_LEVEL_DOMAIN_TI\>„ und 

               
„_ksrfirmware._tcp.ksr.\<TOP_LEVEL_DOMAIN_TI\>„ erhält 

                 der Konnektor URLs der Downloadpunkte des KSR
für  
                Konfigurationsdaten (MGM_KSR_KONFIG_URL)
und für  
                Firmware (MGM_KSR_FIRMWARE_URL).

</td></tr><tr><td>
Varianten/Alternativen

</td><td>
Keine

</td></tr><tr><td>
Fehlerfälle

</td><td>
Keine

</td></tr><tr><td>
Nichtfunktionale Anforderungen

</td><td>
Keine

</td></tr><tr><td>
Zugehörige Diagramme

</td><td>
Keine

</td></tr></table>

Tabelle383: TAB_KON_822 Fehlercodes TUC_KON_284 „KSR-Client initialisieren“

<table><tr><th>
Fehlercode

</th><th>
ErrorType

</th><th>
Severity

</th><th>
Fehlertext

</th></tr><tr><td colspan="4">
Neben den Fehlercodes der aufgerufenen technischen Use Cases können keine
weiteren Fehlercodes auftreten.

</td></tr></table>

**[\<=]**

##### TIP1-A_4835-02

Der Administrator MUSS die in TAB_KON_670 aufgelisteten Parameter über die
Managementschnittstelle konfigurieren und die in TAB_KON_820 aufgelisteten
Parameter ausschließlich einsehen können.

Tabelle384: TAB_KON_670 Konfigurationsparameter der Software-Aktualisierung

<table><tr><th>
ReferenzID

</th><th>
Belegung

</th><th>
Bedeutung und Administrator-Interaktion

</th></tr><tr><td>
MGM_KSR_

AUTODOWNLOAD

</td><td>
Enabled/

Disabled

</td><td>
Der Administrator MUSS den automatischen Download verfügbarer Update-Pakete
über den Konfigurationsparameter MGM_KSR_AUTODOWNLOAD an- und abschalten
können.

Default-Wert: Enabled

</td></tr><tr><td>
MGM_KSR_SHOW_

TRIAL_UPDATES

</td><td>
Enabled /

Disabled

</td><td>
Der Administrator MUSS einschalten können, dass zusätzlich zur Anzeige von
Update-Paketen für den Online-Produktivbetrieb auch die Anzeige von
Erprobungs-Update-Paketen erfolgt.

Wenn

MGM_KSR_SHOW_TRIAL_UPDATES

von Disabled auf Enabled gesetzt wird, muss ein Warnhinweis angezeigt werden,
dass die Installation von Erprobungs-Update-Paketen nur für Teilnehmer der
Erprobungen vorgesehen ist.

Default-Wert: Disabled

</td></tr><tr><td>
MGM_KSR_AUTO_UPDATE

</td><td>
Enabled / Disabled

</td><td>
Der Administrator MUSS pro Gerät (Konnektor und Kartenterminals) das
automatische Softwareupdate ein- und ausschalten können.

Default-Wert: Enabled

Falls

MGM_KSR_AUTO_UPDATE

=Enabled wird 

MGM_KSR_  
AUTODOWNLOAD=

Enabled gesetzt.

</td></tr><tr><td>
MGM_KSR_AUTO_  
UPDATE_TIME

</td><td>
Wochentag / Uhrzeit

Oder

täglich / Uhrzeit

</td><td>
Der Administrator MUSS den Wochentag und die Uhrzeit einstellen können, wann
automatische Softwareupdates durchgeführt werden.

Als Wochentag MUSS es neben den einzelnen Wochentagen auch einen Wert für eine
tägliche Prüfung auf Aktualität und gegebenenfalls Durchführung von
Softwareupdates geben.

Default-Wert: Montag / 1:00 Uhr

</td></tr></table>

Tabelle385: TAB_KON_820 Einsehbare Konfigurationsparameter der
Software-Aktualisierung

<table><tr><th>
ReferenzID

</th><th>
Belegung

</th><th>
Bedeutung und Administrator-Interaktion

</th></tr><tr><td>
MGM_KSR_

KONFIG_URL

</td><td>
URL

</td><td>
SOAP-Endpunkt des Konfigurationsdienstes zum Download von Konfigurationsdaten

</td></tr><tr><td>
MGM_KSR_

FIRMWARE_URL

</td><td>
URL

</td><td>
SOAP-Endpunkt des Konfigurationsdienstes zum Download der Firmware

</td></tr></table>

**[\<=]**

Hinweis: Die Adressen des Konfigurationsdienstes werden im Rahmen des
VPN-Verbindungsaufbaus ermittelt (siehe [gemSpec_VPN_ZugD#5.1.1.2
TUC_VPN-ZD_0001])

##### TIP1-A_6025

Der Konnektor MUSS täglich überprüfen, ob unter den auf die aktuelle
Konnektor-Firmware anwendbaren Updates  ein Update mit FWPriority =
„Kritisch“ ist, dessen Deadline
(entsprichtUpdateInformation/DeploymentInformation/Deadline) abgelaufen ist,
d.h. Deadline \<= Systemzeit. In diesem Fall MUSS der Konnektor den
Verbindungsaufbau zur TI Plattform verhindern, bestehende Verbindungen in die
TI abbauen und den kritischen Betriebszustand EC_FW_Not_Valid_Status_Blocked
annehmen. **[\<=]**

##### TIP1-A_4836

Der Konnektor MUSS täglich die folgenden Schritte durchführen:

 ---> OL

TUC_KON_256 „Systemereignis absetzen“ {

        topic = „KSR/UPDATE/KONNEKTOR_DOWNLOAD_END“;

        eventType = Op;     

        severity = Info;     

        parameters  = (\<Param\>)}    

informieren. Je heruntergeladenem FW-Paket MUSS \<Param\> mit folgenden Werten
belegt sein:    

\<Param\> =     „ProductVendorID= $UpdateInformation/ProductVendorID;

                     ProductCode=
$UpdateInformation/ProductCode;

                    
ProductName=$UpdateInformation/ProductName;

                    
FirmwareVersion=$UpdateInformation/Firmware/FWVersion;

                    
Deadline=$UpdateInformation/DeploymentInformation/Deadline;

                    

FWPriority

=$UpdateInformation/Firmware/

FWPriority;

                     F

irmwareReleaseNotes

                                    
=$UpdateInformation/Firmware/FirmwareReleaseNotes“

 ---> OL

Der Konnektor MUSS immer nur die neusten Update-Pakete für eine Nutzung
vorhalten. Eventuell vorhandene ältere, nicht genutzte Update-Pakete KÖNNEN
überschrieben werden. **[\<=]**

##### TIP1-A_4836-02

Der Konnektor MUSS täglich die folgenden Schritte durchführen:

 ---> OL

TUC_KON_256 „Systemereignis absetzen“ {

        topic = „KSR/UPDATE/KONNEKTOR_DOWNLOAD_END“;

        eventType = Op;     

        severity = Info;     

        parameters  = (\<Param\>)}    

informieren. Je heruntergeladenem FW-Paket MUSS \<Param\> mit folgenden Werten
belegt sein:    

\<Param\> =     „ProductVendorID= $UpdateInformation/ProductVendorID;

                     ProductCode=
$UpdateInformation/ProductCode;

                    
ProductName=$UpdateInformation/ProductName;

                    
FirmwareVersion=$UpdateInformation/Firmware/FWVersion;

                    
Deadline=$UpdateInformation/DeploymentInformation/Deadline;

                    
FWPriority=$UpdateInformation/Firmware/FWPriority;

                     FirmwareReleaseNotes

                                    
=$UpdateInformation/Firmware/FirmwareReleaseNotes“

 ---> OL

Der Konnektor MUSS immer nur die neusten Update-Pakete für eine Nutzung
vorhalten. Eventuell vorhandene ältere, nicht genutzte Update-Pakete KÖNNEN
überschrieben werden.

Nach einem erfolgreichen Download DÜRFEN die Namen der Dateien eines
Update-Paketes beim Abspeichern NICHT verändert werden. **[\<=]**

##### TIP1-A_7220

Der Konnektor KANN für den Download von Update-Paketen über
I_KSRS_Download::get_Updates die Option Range Requests [RFC7233#3.1] zur
Fortsetzung von unterbrochenen Transfers nutzen. **[\<=]**

##### TIP1-A_4837

Die Administrationsoberfläche desKSR-Clients MUSS dem Administrator eine
Übersichtseite anbieten, die einen Geräteeintrag für den Konnektor selbst,
sowie eine Liste von Geräteeinträgen für jedes Kartenterminal (CT) aus
CTM_CT_LIST mit CT.IS_PHYSICAL=Ja und CT.CORRELATION\>=„gepairt“enthält.

Der Administrator MUSS die Liste der Kartenterminals nach Kartenterminalmodellen
gruppieren können (gleiche Werte für ProductVendorID,ProductCode,
HardwareVersion und FirmwareVersion).

Je Geräteeintrag MÜSSEN die über „Automatische Prüfung und Download
vonUpdate-Paketen“ ermittelten listUpdatesResponse bereitstehen.

Je Geräteeintrag MUSS die Version der aktuell installierten Software
dargestellt werden. Sind Bestandteile der installierten Software unabhängig
aktualisierbar, so MUSS für jedes der Bestandteile die Version angezeigt
werden.

Der Administrator MUSS eine Aktualisierung aller listUpdatesResponse über
TUC_KON_282 „UpdateInformationen beziehen“ auslösen können.

Geräteeinträge, die über listUpdatesResponse mit neuerer Firmwareversion als
das zugehörige Gerät verfügen, MÜSSEN hervorgehoben werden.

Je Geräteeintrag MUSS die Zugehörigkeit der installierten Software und der
Software-Updates zum Online-Produktivbetrieb oder zu einer Erprobung (inklusive
Name der Erprobung) dargestellt werden. **[\<=]**

##### TIP1-A_4838

Für alle Geräteeinträge MUSS der Administrator zu den listUpdatesResponse
sowohl die FirmwareGroupReleaseNotes als auch jedes enthaltene
UpdateInformation-Element einsehen können. Dazu MUSS der Konnektor

 ---> UL

**[\<=]**

##### TIP1-A_4839-01

Der Administrator MUSS in der Übersichtsliste einzelne Geräteeinträge bzw.
Gruppen mit der jeweils anzuwendenden UpdateInformation für die Durchführung
eines Updates markieren können.Alternativ MUSS der Administrator neben der
Markierung je Geräteeintrag bzw. Gruppe Update-Pakete lokal einspielen können
(etwa durch ein Upload- bzw. Download-Interface in der
Administrationsoberfläche).Je Geräteeintrag MUSS der Administrator einen
individuellen Ausführungszeitpunkt für die Durchführung des Updates
einstellen können.Der Administrator MUSS für den Geräteeintrag Konnektor
festlegen können, ob dieses Update erst gestartet werden darf, wenn zuvor alle
festgelegten KT-Updates erfolgreich durchlaufen wurden.Der Administrator MUSS
zu jeder Zeit die gerätebezogene Festlegung für ein Update ändern bzw.
löschen können, sofern dieses konkrete Update noch nicht begonnen wurde.Je
Geräteeintrag MUSS der Administrator automatische Softwareupdates aktivieren
und deaktivieren können. **[\<=]**

##### TIP1-A_4840-01

Der Administrator MUSS für die Liste der markierten Geräteeinträge ein
gesammeltes Update auslösen können. Dieses MUSS nach folgendem Muster
ablaufen:

 ---> OL

 ---> UL

 ---> OL

 ---> UL

Wenn der Administrator ein Erprobungs-Update zur Installation auswählt, MUSS er
über einen Warnhinweis darüber informiert werden,

 ---> UL

dass, falls die Institution oder Organisation des Gesundheitswesens nicht an der
Erprobung teilnimmt und dennoch das Update installiert wird, es zu funktionalen
Einschränkungen des Konnektors kommen kann. **[\<=]**

##### A_18390

Wenn für mindestens ein Gerät das automatische Softwareupdate aktiviert ist,
MUSS der Konnektor zur MGM_KSR_AUTO_UPDATE_TIME die Updates nach folgendem
Muster durchführen:

 ---> UL

**[\<=]**

##### A_18391

Sofern der Konnektor zu MGM_KSR_AUTO_UPDATE_TIME nicht in Betrieb war, DÜRFEN
die automatischen Updates später NICHT nachgeholt werden. **[\<=]**

##### A_18779

Wenn mit einem Update erstmalig MGM_KSR_AUTO_UPDATE=Enabled aktiv wird, MUSS der
Konnektorhersteller über das entsprechende KSR-Paket den Admin an der
Konnektor Oberfläche darauf hinweisen, dass mit diesem Update der automatische
Softwareupdate aktiv wird. **[\<=]**

##### A_20531

Der Konnektor MUSS eine Bestandsnetze.xml mit einer Größe von mindestens 3
MByte und 2000 Netzen (XML Element \<Network\>) verarbeiten können. **[\<=]**

### 4.3.11 Konnektorstatus

##### TIP1-A_5542

Der Konnektor MUSS an der Managementschnittstelle eine Funktion anbieten, die es
ermöglicht die Erreichbarkeit von Systemen durch Eingabe der IP-Adresse oder
des FQDN zu prüfen. Das Ergebnis des Tests MUSS angezeigt werden. **[\<=]**

##### A_23276

Der Konnektor MUSS dem Administrator an der Management-Oberfläche automatisch
die Erreichbarkeit und die FQDNs von folgenden Systemen und ggf. ihren
Backupservern anzeigen:

 ---> UL

**[\<=]**

### 4.4 Hardware-Merkmale des Konnektors

##### TIP1-A_4841

Der Konnektor MUSS sowohl in seiner Stromversorgung als auch in seinen
restlichen Hardwarekomponenten auf einen 24x7-Dauerbetrieb ausgelegt sein.

Der Hersteller DARF NICHT davon ausgehen oder gar in seiner Guidance darauf
verweisen, dass der Konnektor mehrere Stunden am Tag nicht betrieben wird. **[\<=]**

Diese Anforderung verlangt keinen Schutz gegen Stromausfall in den
Betriebsräumen.

##### TIP1-A_4842

Jeder Konnektor, der als Appliance (dezidierte, geschlossene Kombination aus
spezifischer Hard- und Software) ausgeprägt ist,MUSS über eine
fälschungssichere Gehäuseversiegelung verfügen. Die Versiegelung MUSS so
angebracht werden, dass eine Öffnung des Gehäuses nicht ohne Beschädigung
des Siegels erfolgen kann.

Der Konnektor MUSS die Umsetzung entsprechend der Festlegungen für das
Kartenterminal nach der TR-03120 [BSI TR-03120], Kapitel bzgl.
Gehäuseversiegelung 9 vornehmen.

Die optische Gestaltung der Siegel ist herstellerspezifisch. **[\<=]**

Die Prüfung auf Einhaltung der Versiegelungsvorgaben erfolgt nicht im Rahmen
der CC-Evaluierung, sondern im Zuge der Prüfung auf funktionale Eignung.

##### TIP1-A_4843

Im Betrieb MUSS der Zustand des Konnektors erkennbar sein. Zur Anzeige des
Betriebszustandes des Konnektors SOLL es eine Signaleinrichtung (z. B. über
Status-LEDs) am Konnektor geben. Falls keine Signalvorrichtung am
Konnektorgehäuse verwendet wird MUSS es eine softwareseitige Lösung über das
Managementinterface geben. Bei verbauter Hardware-Signalgebung KANN eine
softwareseitige Lösung zusätzlich angeboten werden.Es MÜSSEN mindestens
folgende angezeigt werden:

 ---> UL

Es SOLLEN folgende Zustände angezeigt werden:

 ---> UL

**[\<=]**

##### TIP1-A_4844-02

Der Konnektor MUSS mindestens zwei Ethernetinterfaces nach [IEEE802.3] als
physikalische Schnittstellen zur Verfügung stellen. **[\<=]**

##### TIP1-A_4845

Als normaler Einsatzort wird für den Konnektor ein Büroraum angenommen. Der
Konnektor MUSS die in Tabelle TAB_KON_671 aufgeführten Anforderungen
erfüllen, welche unter der Annahme des normalen Einsatzortes erhoben werden.

Tabelle386: TAB_KON_671 Anforderungen Klima

<table><tr><td>
Prüfung Klima

</td></tr><tr><td>
Trockene Wärme (Dry Heat) nach DIN EN 60068-2-2 Methode Bb wird für die
Bedingungen als obere Lagertemperatur von 55°C und einer Beanspruchungsdauer
von 16 h geprüft und die Funktionsfähigkeit MUSS bestätigt werden.

</td></tr><tr><td>
Kälte (Cold) nach DIN EN 60068-2-1 Methode Ab wird für die Bedingungen als
untere Lagertemperatur von -10°C und einer Beanspruchungsdauer von 16 h
geprüft und die Funktionsfähigkeit MUSS bestätigt werden.

</td></tr><tr><td>
Nach den beiden oben genannten Belastungen durch extreme Lagertemperaturen und
der Nachbehandlungsdauer von 1 h MUSS die Funktionsfähigkeit des Konnektors
gewährleistet sein, was durch Funktionsprüfungen nachzuweisen ist.

</td></tr><tr><td>
Die Funktionsfähigkeit im Betrieb MUSS bei einer oberen Temperatur von 40°C
über eine Dauer von 24 h gewährleistet sein. Dies wird für den Konnektor
durch Prüfung nach DIN EN 60068-2-2 Methode Bb bei gleichzeitigen
Funktionsprüfungen nachgewiesen.

</td></tr></table>

**[\<=]**

##### TIP1-A_4846

Die durch Vibrationen und mechanische Schockbelastungen auftretenden Belastungen
MÜSSEN vom Konnektor schadensfrei gemäß IEC 68-2 Methode nach den
Anforderungen aus TAB_KON_672 absolviert, geprüft und nachgewiesen werden.

Tabelle387: TAB_KON_672 Anforderungen Vibration

<table><tr><td>
Prüfung Vibration

</td></tr><tr><td>
Sinusförmige Schwingungstests (Vibration, sinusoidal) nach DIN EN 60068-2-6
Methode Fc in drei senkrecht stehenden Achsen in einem Frequenzbereich von
2 Hz bis 200 Hz üblicherweise 1 h je Achse MÜSSEN erfolgreich
nachgewiesen werden. Bis zu einer Frequenz von 9 Hz wird dabei mit einer
konstanten Amplitude von 1,5 mm belastet, darüber bis zur oberen Frequenz
wird mit einer konstanten Beschleunigung von 5 m/s2 (0,5 g) belastet.

</td></tr><tr><td>
Es MÜSSEN mechanische Schockprüfungen (Shock) nach DIN EN 60068-2-27 Methode
Ea in drei senkrecht stehenden Achsen (sechs Richtungen) erfolgreich
nachgewiesen werden. Es wird dabei für jede Achse mit 3 positiven und
3 negativen Schocks mit 150 m/s2 (15 g) Amplitude und einer Dauer von 11 ms
belastet.

</td></tr><tr><td>
Dauerschocktests (Bump) nach DIN EN 60068-2-29 Methode Eb in drei senkrecht
stehenden Achsen mit halbsinusförmigen Schocks MÜSSEN erfolgreich
nachgewiesen werden. Es wird dabei für jede Achse mit 1000 positiven und 1000
negativen Schocks mit 100 m/s2 (10 g) Amplitude und einer Dauer von 16 ms
belastet.

</td></tr></table>

**[\<=]**

##### TIP1-A_4846-02

Die durch Vibrationen und mechanische Schockbelastungen auftretenden Belastungen
MÜSSEN vom Konnektor schadensfrei gemäß IEC 68-2 Methode nach den
Anforderungen aus TAB_KON_672 absolviert, geprüft und nachgewiesen werden.

Tabelle388: TAB_KON_672 Anforderungen Vibration

<table><tr><td>
Prüfung Vibration

</td></tr><tr><td>
Sinusförmige Schwingungstests (Vibration, sinusoidal) nach DIN EN 60068-2-6
Methode Fc in drei senkrecht stehenden Achsen in einem Frequenzbereich von
2 Hz bis 200 Hz üblicherweise 1 h je Achse MÜSSEN erfolgreich
nachgewiesen werden. Bis zu einer Frequenz von 9 Hz wird dabei mit einer
konstanten Amplitude von 1,5 mm belastet, darüber bis zur oberen Frequenz
wird mit einer konstanten Beschleunigung von 5 m/s2 (0,5 g) belastet.

</td></tr><tr><td>
Es MÜSSEN mechanische Schockprüfungen (Shock) nach DIN EN 60068-2-27 Methode
Ea in drei senkrecht stehenden Achsen (sechs Richtungen) erfolgreich
nachgewiesen werden. Es wird dabei für jede Achse mit 3 positiven und
3 negativen Schocks mit 150 m/s2 (15 g) Amplitude und einer Dauer von 11 ms
belastet.

</td></tr><tr><td>
Dauerschocktests (Bump) nach DIN EN 60068-2-

27

Methode Eb in drei senkrecht stehenden Achsen mit halbsinusförmigen Schocks
MÜSSEN erfolgreich nachgewiesen werden. Es wird dabei für jede Achse mit 1000
positiven und 1000 negativen Schocks mit 100 m/s2 (10 g) Amplitude und einer
Dauer von 16 ms belastet.

</td></tr></table>

**[\<=]**

### 5 Anhang A – Verzeichnisse

### 5.1 Abkürzungen

<table><tr><th>
Kürzel

</th><th>
Erläuterung

</th></tr><tr><td>
AMTS

</td><td>
Arzneimitteltherapiesicherheit

</td></tr><tr><td>
APPL DO

</td><td>
Application Label Data Object

</td></tr><tr><td>
CC

</td><td>
Common Criteria

</td></tr><tr><td>
DHCP

</td><td>
Dynamic Host Configuration Protocol

</td></tr><tr><td>
DNS

</td><td>
Domain Name Service

</td></tr><tr><td>
DO

</td><td>
Datenobjekt

</td></tr><tr><td>
DSL

</td><td>
Digital Subscriber Line

</td></tr><tr><td>
ECC

</td><td>
Elliptic Curve Cryptography

</td></tr><tr><td>
EVG

</td><td>
Evaluierungsgegenstand

</td></tr><tr><td>
gSMC-K

</td><td>
Security Module Card Typ K (Konnektor)

</td></tr><tr><td>
gSMC-KT

</td><td>
Security Module Card Typ KT (Kartenterminal)

</td></tr><tr><td>
HBA

</td><td>
Heilberufsausweis

</td></tr><tr><td>
HSM-B

</td><td>
Hardware Security Module Typ B

</td></tr><tr><td>
IAG

</td><td>
Internet Access Gateway

</td></tr><tr><td>
ID

</td><td>
Identifier

</td></tr><tr><td>
ISP

</td><td>
Internet Service Provider

</td></tr><tr><td>
KT

</td><td>
Kartenterminal

</td></tr><tr><td>
KVK

</td><td>
Krankenversichertenkarte

</td></tr><tr><td>
LAN

</td><td>
Local Area Network

</td></tr><tr><td>
MTOM

</td><td>
Message Transmission Optimization Mechanism

</td></tr><tr><td>
NFDM

</td><td>
Notfalldatenmanagement

</td></tr><tr><td>
NK

</td><td>
Netzkonnektor

</td></tr><tr><td>
NTP

</td><td>
Netzwork Time Protokoll

</td></tr><tr><td>
OCSP

</td><td>
Online Certificate Status Protocol

</td></tr><tr><td>
OID

</td><td>
Object Identifier

</td></tr><tr><td>
PIN

</td><td>
Personal

</td></tr><tr><td>
PKI

</td><td>
Public Key Infrastructure

</td></tr><tr><td>
PP

</td><td>
Protection Profile

</td></tr><tr><td>
PU

</td><td>
Produktivumgebung

</td></tr><tr><td>
PUK

</td><td>
Personal Unblocking Key

</td></tr><tr><td>
QES

</td><td>
Qualifizierte elektronische Signatur

</td></tr><tr><td>
RU

</td><td>
Referenzumgebung

</td></tr><tr><td>
SIS

</td><td>
Secure Internet Service

</td></tr><tr><td>
SMC-B

</td><td>
Security Module Card Typ B

</td></tr><tr><td>
SMTBD DO

</td><td>
SICCT Message-To-Be-Displayed Data Object

</td></tr><tr><td>
SOAP

</td><td>
Standard für die Kommunikation innerhalb der WEB-Services

</td></tr><tr><td>
TI

</td><td>
Telematikinfrastruktur

</td></tr><tr><td>
TLS

</td><td>
Transport Layer Security

</td></tr><tr><td>
TSF

</td><td>
TOE Security Functionality

</td></tr><tr><td>
TU

</td><td>
Testumgebung

</td></tr><tr><td>
TUC

</td><td>
Technischer Use Case

</td></tr><tr><td>
URL

</td><td>
Uniform Resource Locator

</td></tr><tr><td>
VPN

</td><td>
Virtual Private Network

</td></tr><tr><td>
VSDM

</td><td>
Versichertenstammdatenmanagement

</td></tr><tr><td>
VZD

</td><td>
Verzeichnisdienst

</td></tr><tr><td>
WAN

</td><td>
Wide Area Network

</td></tr><tr><td>
WANDA Basic

</td><td>
Weitere Anwendungen für den Datenaustausch ohne Nutzung der TI oder derer
kryptografischen Identitäten 

</td></tr><tr><td>
WANDA Smart

</td><td>
Weitere Anwendungen für den Datenaustausch mit Nutzung der TI oder
derer kryptografischen Identitäten für eigene Anwendungszwecke

</td></tr><tr><td>
XML

</td><td>
Extensible Markup Language

</td></tr><tr><td>
ZD

</td><td>
Zertifizierungsdienst

</td></tr><tr><td>
ZOD 2.0

</td><td>
Zahnärzte Online Deutschland 2.0

</td></tr></table>

### 5.2 Glossar

<table><tr><th>
Begriff

</th><th>
Erläuterung

</th></tr><tr><td>
Funktionsmerkmal

</td><td>
Der Begriff beschreibt eine Funktion oder auch einzelne, eine logische Einheit
bildende Teilfunktionen der TI im Rahmen der funktionalen Zerlegung des Systems.

</td></tr></table>

Das Glossar wird als eigenständiges Dokument, vgl. [gemGlossar] zur Verfügung
gestellt.

### 5.3 Abbildungsverzeichnis

- [Abbildung-1] - PIC_KON_116 Schnittstellen des Konnektors von und zu anderen Produkttypen
- [Abbildung-2] - PIC_KON_117 Logische Zerlegung des Konnektors in Anwendungs- und Netzkonnektor
- [Abbildung-3] - PIC_KON_107 XML-Struktur des Status-Elements einer SOAP-Antwort
- [Abbildung-4] - PIC_Kon_100 Informationsmodell des Konnektors
- [Abbildung-5] - PIC_KON_101 Aufrufkontext der Operation
- [Abbildung-6] - PIC_KON_118 Aktivitätsdiagramm zu „TUC_KON_000 Prüfe Zugriffsberechtigung“
- [Abbildung-7] - PIC_KON_071 Korrelationszustände eines eHealth-KT
- [Abbildung-9] - PIC_KON_057 Aktivitätsdiagramm zu „PaireKartenterminal“
- [Abbildung-13] - PIC_KON_058 Aktivitätsdiagramm „Daten hybrid verschlüsseln“
- [Abbildung-15] - PIC_KON_103 Use Case Diagramm Signaturdienst (nonQES)
- [Abbildung-16] - PIC_KON_104 Use Case Diagramm Signaturdienst (QES)
- [Abbildung-17] - PIC_KON_102
- [Abbildung-20] - PIC_KON_118 Aufbau und Struktur der Protokolldateien für Plattform und Fachmodule
- [Abbildung-21] - PIC_KON_115 Kommunikationsregeln Konnektor
- [Abbildung-23] - PIC_KON_120 Abbildung von CardSessions auf logische Kanäle
- [Abbildung-24] -  Szenario einer einfachen Installation
- [Abbildung-25] - Szenario einer Installation mit mehreren Behandlungsräumen
- [Abbildung-26] - Szenario einer Integration der TI Produkte in eine bestehende Infrastruktur
- [Abbildung-27] - Szenario einer Integration der TI Produkte in eine bestehende Infrastruktur mit existierendem Router
- [Abbildung-28] - Szenario mit zentral gesteckten HBA und SMC-B
- [Abbildung-29] - Szenario mit zentralem Primärsystem als Clientsystem
- [Abbildung-30] - Szenario für den Zugriff
- [Abbildung-31] -   Standalone-Szenario mit physischer Trennung im Konnektor

### 5.4 Tabellenverzeichnis

- [Tabelle-1] - Fehlercodes TAB_KON_890 Mindestanforderungen an Dokumente und Nachrichten
- [Tabelle-2] - Fehlercodes TAB_KON_891 Unerlaubte Inhalte in Dokumenten und Nachrichten
- [Tabelle-3] - TAB_KON_500 Wertetabelle Kartentypen
- [Tabelle-4] - TAB_KON_856: Identitäten des Konnektors auf der gSMC-K
- [Tabelle-5] - TAB_KON_503 Betriebszustand_Fehlerzustandsliste
- [Tabelle-6] - TAB_KON_504 Ausführungserlaubnis für Dienste in kritischen Fehlerzuständen
- [Tabelle-7] - TAB_KON_502 Fehlercodes „Betriebszustand“
- [Tabelle-9] - TAB_KON_852 Konfigurationsvarianten der Verbindungen zwischen Konnektor und Clientsystemen
- [Tabelle-10] - TAB_KON_865-01 Konfigurationsvarianten der Verbindungen zwischen Konnektor und Clientsystemen bei LDAP
- [Tabelle-11] - TAB_KON_506-01 Konfigurationsparameter der Clientsystem-Authentisierung
- [Tabelle-12] - TAB_KON_812 Umgebungsabhängige Konfigurationsparameter
- [Tabelle-13] - TAB_KON_507 Informationsmodell Entitäten
- [Tabelle-14] - TAB_KON_508 Informationsmodell Attribute
- [Tabelle-15] - TAB_KON_509 Informationsmodell Entitätenbeziehungen
- [Tabelle-16] - TAB_KON_510 Informationsmodell Constraints
- [Tabelle-17] - TAB_KON_511-01 – TUC_KON_000 „Prüfe Zugriffsberechtigung“
- [Tabelle-18] - TAB_KON_512 Zugriffsregeln Beschreibung
- [Tabelle-19] - TAB_KON_513 Zugriffsregeln Regelzuordnung
- [Tabelle-20] - TAB_KON_514-01 Zugriffsregeln Definition
- [Tabelle-21] - TAB_KON_515 Fehlercodes TUC_KON_000 „Prüfe Zugriffsberechtigung“
- [Tabelle-22] - TAB_KON_143 – TUC_KON_080 „Dokument validieren“
- [Tabelle-23] - TAB_KON_144 Fehlercodes TUC_KON_080 „Dokument validieren“
- [Tabelle-24] - TAB_KON_516 Basisanwendung Dienstverzeichnisdienst
- [Tabelle-26] - TAB_KON_518 Schemabeschreibung Serviceinformation (Serviceinformation.xsd)
- [Tabelle-27] - TAB_KON_519 - TUC_KON_041 „Einbringen der Endpunktinformationen während der Bootup-Phase“
- [Tabelle-28] - TAB_KON_520 Fehlercodes TUC_KON_041 „Einbringen der Endpunktinformationen während der Bootup-Phase“
- [Tabelle-30] - TAB_KON_522 Parameterübersicht des Kartenterminaldienstes
- [Tabelle-31] - TAB_KON_785 Erlaubte SICCT-Kommandos bei CT.CONNECTED=Nein
- [Tabelle-32] - TAB_KON_727 Terminalanzeigen beim Anfordern und Auswerfen von Karten
- [Tabelle-33] - TAB_KON_039 – TUC_KON_050 „Beginne Kartenterminalsitzung“
- [Tabelle-34] - TAB_KON_523 Fehlercodes TUC_KON_050 „Beginne Kartenterminalsitzung“
- [Tabelle-35] - TAB_KON_524 – TUC_KON_054 „Kartenterminal hinzufügen“
- [Tabelle-36] - TAB_KON_525 Fehlercodes TUC_KON_054 „Kartenterminal hinzufügen“
- [Tabelle-37] - TAB_KON_041 – TUC_KON_053 „Paire Kartenterminal“
- [Tabelle-38] - TAB_KON_113 Fehlercodes TUC_KON_053 „Paire Kartenterminal“
- [Tabelle-39] - TAB_KON_526 – TUC_KON_055 „Befülle CT-Object“
- [Tabelle-40] - TAB_KON_112 – TUC_KON_051 „Mit Anwender über Kartenterminal interagieren“
- [Tabelle-41] - TAB_KON_114 Fehlercodes TUC_KON_051 „Mit Anwender über Kartenterminal interagieren“
- [Tabelle-42] - TAB_KON_723 - TUC_KON_056 „Karte anfordern“
- [Tabelle-43] - TAB_KON_724 Fehlercodes TUC_KON_056 „Karte anfordern“
- [Tabelle-44] - TAB_KON_725 – TUC_KON_057 „Karte auswerfen“
- [Tabelle-45] - TAB_KON_796 Fehlercodes TUC_KON_057 „Karte auswerfen“
- [Tabelle-46] - TAB_KON_854 – TUC_KON_058 „Displaygröße ermitteln“
- [Tabelle-47] - TAB_KON_855 Fehlercodes TUC_KON_058 „Displaygröße ermitteln“
- [Tabelle-48] - TAB_KON_722 Basisdienst Kartenterminaldienst
- [Tabelle-49] - TAB_KON_716 Operation RequestCard
- [Tabelle-50] - TAB_KON_717 Ablauf RequestCard
- [Tabelle-51] - TAB_KON_718 Fehlercodes „RequestCard“
- [Tabelle-52] - TAB_KON_719 Operation EjectCard
- [Tabelle-53] - TAB_KON_720 Ablauf EjectCard
- [Tabelle-54] - TAB_KON_721 Fehlercodes Operation „EjectCard“
- [Tabelle-55] - TAB_KON_527 Konfigurationswerte eines Kartenterminalobjekts
- [Tabelle-56] - TAB_KON_528 Informationsparamter des Kartenterminaldienstes
- [Tabelle-57] - TAB_KON_529 Anzeigewerte zu einem Kartenterminalobjekt
- [Tabelle-58] - TAB_KON_530 Konfigurationswerte eines Kartenterminalobjekts
- [Tabelle-59] - TAB_KON_531 Parameterübersicht des Kartendienstes
- [Tabelle-60] - TAB_KON_090 Terminalanzeigen beim Eingeben der PIN am Kartenterminal
- [Tabelle-61] - TAB_KON_734 – TUC_KON_001 „Karte öffnen“
- [Tabelle-62] - TAB_KON_735 - TUC_KON_026
- [Tabelle-63] - TAB_KON_824 Fehlercodes TUC_KON_026 „Liefere CardSession“
- [Tabelle-64] - TAB_KON_087 – TUC_KON_012 „PIN verifizieren“
- [Tabelle-65] - TAB_KON_089 Fehlercodes TUC_KON_012 „PIN verifizieren“
- [Tabelle-66] - TAB_KON_736 – TUC_KON_019 „PIN ändern“
- [Tabelle-67] - TAB_KON_093 Fehlercodes TUC_KON_019 „PIN ändern“
- [Tabelle-68] - TAB_KON_236 – TUC_KON_021 „PIN entsperren“
- [Tabelle-69] - TAB_KON_193 Fehlercodes TUC_KON_021 „PIN entsperren“
- [Tabelle-70] - TAB_KON_532 – TUC_KON_022 „Liefere PIN-Status“
- [Tabelle-71] - TAB_KON_091 Fehlercodes TUC_KON_022 „Liefere PIN-Status“
- [Tabelle-72] - TAB_KON_240 - TUC_KON_027 „PIN-Schutz ein-/ausschalten”
- [Tabelle-73] - TAB_KON_838 Mapping von pinRef auf ANW
- [Tabelle-74] - TAB_KON_241 Fehlercodes TUC_KON_027 „PIN-Schutz ein/ausschalten“
- [Tabelle-75] - TAB_KON_533 - TUC_KON_023 „Karte reservieren”
- [Tabelle-76] - TAB_KON_534 Fehlercodes TUC_KON_023 „Karte reservieren“
- [Tabelle-77] - TAB_KON_096 – TUC_KON_005 „Card-to-Card authentisieren”
- [Tabelle-78] - TAB_KON_673 AuthMode für C2C
- [Tabelle-79] - TAB_KON_674 Erlaubte Parameterkombinationen und resultierende CV-Zertifikate für C2C
- [Tabelle-80] - TAB_KON_535 Fehlercodes TUC_KON_005 „Card-to-Card authentisieren“
- [Tabelle-81] - TAB_KON_218 – TUC_KON_202 „LeseDatei“
- [Tabelle-82] - TAB_KON_536 Fehlercodes TUC_KON_202 „LeseDatei“
- [Tabelle-83] - TAB_KON_219 – TUC_KON_203 „SchreibeDatei“
- [Tabelle-84] - TAB_KON_537 Fehlercodes TUC_KON_203 „Schreibe Datei“
- [Tabelle-85] - TAB_KON_204 – TUC_KON_204 „LöscheDateiInhalt“
- [Tabelle-86] - TAB_KON_785 Fehlercodes TUC_KON_204 „LöscheDateiInhalt“
- [Tabelle-87] - TAB_KON_538 – TUC_KON_209 „LeseRecord“
- [Tabelle-88] - TAB_KON_539 Fehlercodes TUC_KON_209 „LeseRecord“
- [Tabelle-89] - TAB_KON_224 – TUC_KON_210 „SchreibeRecord“
- [Tabelle-90] - TAB_KON_540 Fehlercodes TUC_KON_210 „SchreibeRecord“
- [Tabelle-91] - TAB_KON_211 – TUC_KON_211 „LöscheRecordInhalt“
- [Tabelle-92] - TAB_KON_786 Fehlercodes TUC_KON_211 „LöscheRecordInhalt“
- [Tabelle-93] - TAB_KON_228 – TUC_KON_214 „FügeHinzuRecord“
- [Tabelle-94] - TAB_KON_541 Fehlercodes TUC_KON_214 „FügeHinzuRecord“
- [Tabelle-95] - TAB_KON_229 – TUC_KON_215 „SucheRecord“
- [Tabelle-96] - TAB_KON_542 Fehlercodes TUC_KON_215 „SucheRecord“
- [Tabelle-97] - TAB_KON_110 - TUC_KON_018 „eGK-Sperrung prüfen“
- [Tabelle-98] - TAB_KON_239 Fehlercodes TUC_KON_018 „eGK-Sperrung prüfen“
- [Tabelle-99] - TAB_KON_108 - TUC_KON_006 „Datenzugriffsaudit eGK schreiben“
- [Tabelle-100] - TAB_KON_238 Fehlercodes TUC_KON_006 „Datenzugriffsaudit eGK schreiben“
- [Tabelle-101] - TAB_KON_231 – TUC_KON_218 „Signiere“
- [Tabelle-102] - TAB_KON_543 Fehlercodes TUC_KON_218 „Signiere“
- [Tabelle-103] - TAB_KON_232 – TUC_KON_219 „Entschlüssele“
- [Tabelle-104] - TAB_KON_210 Fehlercodes TUC_KON_219 „Entschlüssele“
- [Tabelle-105] - TAB_KON_215 TUC_KON_200 „SendeAPDU“
- [Tabelle-106] - TAB_KON_216 Fehlercodes TUC_KON_200 „SendeAPDU“
- [Tabelle-107] - TAB_KON_737 – TUC_KON_024 „Karte zurücksetzen“
- [Tabelle-108] - TAB_KON_544 Fehlercodes TUC_KON_024 „Karte zurücksetzen“
- [Tabelle-109] - TAB_KON_230 – TUC_KON_216 „LeseZertifikat“
- [Tabelle-110] - TAB_KON_209 Fehlercodes TUC_KON_216 „LeseZertifikat“
- [Tabelle-111] - TAB_KON_827 TUC_KON_036 „LiefereFachlicheRolle“
- [Tabelle-112] - TAB_KON_829 Fehlercodes TUC_KON_036 „LiefereFachlicheRolle“
- [Tabelle-113] - TAB_KON_038 Basisanwendung Karten- und Kartenterminaldienst
- [Tabelle-114] - TAB_KON_047 Operation VerifyPin
- [Tabelle-115] - TAB_KON_738 Ablauf VerifyPin
- [Tabelle-116] - TAB_KON_545 Fehlercodes „VerifyPin“
- [Tabelle-117] - TAB_KON_049 Operation ChangePin
- [Tabelle-118] - TAB_KON_546 Ablauf ChangePin
- [Tabelle-119] - TAB_KON_547 Fehlercodes „ChangePin“
- [Tabelle-120] - TAB_KON_051 Operation GetPinStatus
- [Tabelle-121] - TAB_KON_548 Ablauf GetPinStatus
- [Tabelle-122] - TAB_KON_549 Fehlercodes „GetPinStatus“
- [Tabelle-123] - TAB_KON_053 Operation UnblockPin
- [Tabelle-124] - TAB_KON_550 Ablauf UnblockPIN
- [Tabelle-125] - TAB_KON_551 Fehlercodes „UnblockPin“
- [Tabelle-126] - TAB_KON_242 Operation EnablePin
- [Tabelle-127] - TAB_KON_243 Ablauf EnablePin
- [Tabelle-128] - TAB_KON_244 Fehlercodes „EnablePin“
- [Tabelle-129] - TAB_KON_245 Operation DisablePin
- [Tabelle-130] - TAB_KON_246 Ablauf DisablePin
- [Tabelle-131] - TAB_KON_247 Fehlercodes „DisablePin“
- [Tabelle-132] - TAB_KON_554 Konfiguration des Kartendienstes
- [Tabelle-133] - TAB_KON_555 - TUC_KON_025 „Initialisierung Kartendienst“
- [Tabelle-135] - TAB_KON_556 - TUC_KON_256 „Systemereignis absetzen“
- [Tabelle-136] - TAB_KON_557 Fehlercodes TUC_KON_256 „Systemereignis absetzen“
- [Tabelle-137] - TAB_KON_558 – TUC_KON_252 „Liefere KT_Liste“
- [Tabelle-138] - TAB_KON_559 – TUC_KON_253 „Liefere Karten_Liste“
- [Tabelle-139] - TAB_KON_560 Fehlercodes TUC_KON_253 „Liefere Karten_Liste“
- [Tabelle-140] - TAB_KON_561 - TUC_KON_254 „Liefere Ressourcendetails“
- [Tabelle-141] - TAB_KON_562 Fehlercodes TUC_KON_254 „Liefere Ressourcendetails“
- [Tabelle-142] - TAB_KON_029 Basisanwendung Systeminformationsdienst
- [Tabelle-146] - TAB_KON_565 Operation GetCards
- [Tabelle-147] - TAB_KON_566 Ablauf GetCards
- [Tabelle-148] - TAB_KON_567 Fehlercodes „GetCards“
- [Tabelle-149] - TAB_KON_568 Operation GetResourceInformation
- [Tabelle-150] - TAB_KON_569 Ablauf GetResourceInformation
- [Tabelle-151] - TAB_KON_570 Fehlercodes „GetResourceInformation“
- [Tabelle-166] - TAB_KON_747 KeyReference für Encrypt-/DecryptDocument
- [Tabelle-167] - TAB_KON_859 Werteliste und Defaultwert des Parameters crypt bei hybrider Verschlüsselung
- [Tabelle-168] - TAB_KON_739 - TUC_KON_070 „Daten hybrid verschlüsseln“
- [Tabelle-169] - TAB_KON_073 Vorgaben zum Format verschlüsselter XML-Dokumente
- [Tabelle-170] - TAB_KON_740 Fehlercodes TUC_KON_070 „Daten hybrid verschlüsseln“
- [Tabelle-171] - TAB_KON_140 – TUC_KON_071 „Daten hybrid entschlüsseln“
- [Tabelle-172] - TAB_KON_142 Fehlercodes TUC_KON_071 „Daten hybrid entschlüsseln“
- [Tabelle-173] - TAB_KON_741 – TUC_KON_072 „Daten symmetrisch verschlüsseln“
- [Tabelle-174] - TAB_KON_742 Fehlercodes TUC_KON_072 „Daten symmetrisch verschlüsseln“
- [Tabelle-175] - TAB_KON_743 - TUC_KON_073 „Daten symmetrisch entschlüsseln“
- [Tabelle-176] - TAB_KON_744 Fehlercodes TUC_KON_073 „Daten symmetrisch entschlüsseln“
- [Tabelle-177] - TAB_KON_860 – TUC_KON_075 „Symmetrisch verschlüsseln“
- [Tabelle-178] - TAB_KON_861 - TUC_KON_076 „Symmetrisch entschlüsseln“
- [Tabelle-179] - TAB_KON_745 Basisdienst Verschlüsselungsdienst
- [Tabelle-180] - TAB_KON_071 Operation EncryptDocument
- [Tabelle-181] - TAB_KON_746 Ablauf EncryptDocument
- [Tabelle-182] - TAB_KON_141 Fehlercodes „EncryptDocument“
- [Tabelle-183] - TAB_KON_075 Operation DecryptDocument
- [Tabelle-184] - TAB_KON_076 Ablauf DecryptDocument
- [Tabelle-185] - TAB_KON_145 Fehlercodes „DecryptDocument“
- [Tabelle-186] - TAB_KON_582 – Signaturverfahren Dokumentensignatur
- [Tabelle-187] - TAB_KON_778 – Einsatzbereich der Signaturvarianten für XAdES, CAdES und PAdES
- [Tabelle-188] - TAB_KON_583 – Default-Signaturverfahren
- [Tabelle-189] - TAB_KON_584 nonQES-Operationen für EVT_MONITOR_OPERATIONS
- [Tabelle-191] - TAB_KON_862-01 Werteliste und Defaultwert des Parameters crypt bei QES-Erzeugung
- [Tabelle-192] - TAB_KON_863 Werteliste und Defaultwert des Parameters crypt bei nonQES-Erzeugung
- [Tabelle-193] - TAB_KON_748 - TUC_KON_155 „Dokumente zur Signatur vorbereiten“
- [Tabelle-194] - TAB_KON_586 Fehlercodes TUC_KON_155 „Dokumente zur Signatur vorbereiten“
- [Tabelle-195] - TAB_KON_749 – TUC_KON_165 „Signaturvoraussetzungen für nonQES prüfen“
- [Tabelle-196] - TAB_KON_587 Fehlercodes TUC_KON_165 „Signaturvoraussetzungen für nonQES prüfen“
- [Tabelle-197] - TAB_KON_750 – TUC_KON_166 „nonQES Signaturen erstellen“
- [Tabelle-198] - TAB_KON_120 Fehlercodes TUC_KON_166 „nonQES Signaturen erstellen“
- [Tabelle-199] - TAB_KON_751 – TUC_KON_152 „Signaturvoraussetzungen für QES prüfen“
- [Tabelle-200] - TAB_KON_588 Fehlercodes TUC_KON_152 „Signaturvoraussetzungen für QES prüfen“
- [Tabelle-201] - TAB_KON_752 – TUC_KON_154 „QES Signaturen erstellen"
- [Tabelle-202] - TAB_KON_126 Fehlercodes TUC_KON_154 „QES Signaturen erstellen“
- [Tabelle-203] - TAB_KON_293 - TUC_KON_168 „Einzelsignatur QES erstellen“
- [Tabelle-204] - TAB_KON_590 Fehlercodes TUC_KON_168 „Einzelsignatur QES erstellen“
- [Tabelle-205] - TAB_KON_870 – TUC_KON_158 „Komfortsignaturen erstellen"
- [Tabelle-206] - TAB_KON_873 Fehlercodes TUC_KON_158 „Komfortsignaturen erstellen“
- [Tabelle-207] - TAB_KON_753 – TUC_KON_160 „Dokumente nonQES signieren“
- [Tabelle-208] - TAB_KON_127 Fehlercodes TUC_KON_160 „Dokumente nonQES signieren“
- [Tabelle-209] - TAB_KON_753 – TUC_KON_160 „Dokumente nonQES signieren“
- [Tabelle-210] - TAB_KON_127 Fehlercodes TUC_KON_160 „Dokumente nonQES signieren“
- [Tabelle-211] - TAB_KON_121 - TUC_KON_161 „nonQES Dokumentsignatur prüfen“
- [Tabelle-212] - TAB_KON_124 Fehlercodes TUC_KON_161 „nonQES Dokumentensignatur prüfen“
- [Tabelle-213] - TAB_KON_754 Übersicht Status für Prüfung einer Dokumentensignatur
- [Tabelle-214] - TAB_KON_786 Übersicht unterstützte Zertifikatstyp-OIDs
- [Tabelle-215] - TAB_KON_430 – TUC_KON_162 „Kryptographische Prüfung der XML-Dokumentensignatur“
- [Tabelle-216] - TAB_KON_431 Fehlercodes TUC_KON_162 „Kryptographische Prüfung der XML-Dokumentensignatur“
- [Tabelle-217] - TAB_KON_755 – TUC_KON_150 „Dokumente QES signieren“
- [Tabelle-218] - TAB_KON_128 Fehlercodes TUC_KON_150 „Dokument QES signieren“
- [Tabelle-219] - TAB_KON_192 Verhalten des Konnektors beim Abbruch einer Stapelsignatur
- [Tabelle-220] - TAB_KON_591 - TUC_KON_151 „QES-Dokumentensignatur prüfen“
- [Tabelle-221] - TAB_KON_592 Fehlercodes TUC_KON_151 „QES Dokumentensignatur prüfen“
- [Tabelle-222] - TAB_KON_593 Übersicht Status für Prüfung einer Dokumentensignatur
- [Tabelle-223] - TAB_KON_871 – TUC_KON_170 „Dokumente mit Komfort signieren“
- [Tabelle-224] - TAB_KON_872 Fehlercodes TUC_KON_170 „Dokumente mit Komfort signieren“
- [Tabelle-225] - TAB_KON_883 – TUC_KON_171 „Komfortsignatur einschalten“
- [Tabelle-226] - TAB_KON_886 Fehlercodes TUC_KON_171 „Komfortsignatur einschalten“
- [Tabelle-227] - TAB_KON_884 – TUC_KON_172 „Komfortsignatur ausschalten“
- [Tabelle-228] - TAB_KON_887 Fehlercodes TUC_KON_172 „Komfortsignatur ausschalten“
- [Tabelle-229] - TAB_KON_885 – TUC_KON_173 „Liefere Signaturmodus“
- [Tabelle-230] - TAB_KON_888 Fehlercodes TUC_KON_173 „Liefere Signaturmodus“
- [Tabelle-231] - TAB_KON_197 Basisdienst Signaturdienst (nonQES und QES)
- [Tabelle-232] - TAB_KON_065 Operation SignDocument (nonQES und QES)
- [Tabelle-233] - TAB_KON_756 Ablauf Operation SignDocument (nonQES und QES)
- [Tabelle-234] - TAB_KON_757 Fehlercodes „SignDocument (nonQES und QES)“
- [Tabelle-235] - TAB_KON_066 Operation VerifyDocument (nonQES und QES)
- [Tabelle-236] - TAB_KON_760 Ablauf Operation VerifyDocument (nonQES und QES)
- [Tabelle-237] - TAB_KON_761 Fehlercodes „VerifyDocument (nonQES und QES)“
- [Tabelle-238] - TAB_KON_840 Operation StopSignature
- [Tabelle-239] - TAB_KON_841 Ablauf Operation StopSignature
- [Tabelle-240] - TAB_KON_842 Fehlercodes „StopSignature“
- [Tabelle-241] - TAB_KON_843 Operation GetJobNumber
- [Tabelle-242] - TAB_KON_844 Ablauf Operation GetJobNumber
- [Tabelle-243] - TAB_KON_845 Fehlercodes „GetJobNumber“
- [Tabelle-244] - TAB_KON_874 ActivateComfortSignature
- [Tabelle-245] - TAB_KON_877 Ablauf ActivateComfortSignature
- [Tabelle-246] - TAB_KON_879 Fehlercodes ActivateComfortSignature
- [Tabelle-247] - TAB_KON_875 DeactivateComfortSignature
- [Tabelle-248] - TAB_KON_878 Ablauf DeactivateComfortSignature
- [Tabelle-249] - TAB_KON_880 Fehlercodes DeactivateComfortSignature
- [Tabelle-250] - TAB_KON_876 GetSignatureMode
- [Tabelle-251] - TAB_KON_882 Ablauf GetSignatureMode
- [Tabelle-252] - TAB_KON_881 Fehlercodes GetSignatureMode
- [Tabelle-253] - TAB_KON_596 Konfigurationswerte des Signaturdienstes (Administrator)
- [Tabelle-254] - TAB_KON_853- intendedKeyUsage bei Zertifikatsprüfung
- [Tabelle-255] - TAB_KON_858 Kartenobjekt in Abhängigkeit vom kryptographischen Verfahren
- [Tabelle-256] - TAB_KON_825 Fehlercodes „TLS-Verbindungsaufbau zum TSL-Dienst“
- [Tabelle-258] - TAB_KON_597 Operationen in EVT_MONITOR_OPERATIONS
- [Tabelle-259] - TAB_KON_766 TUC_KON_032 „TSL aktualisieren“
- [Tabelle-260] - TAB_KON_598 Fehlercodes TUC_KON_032 „TSL aktualisieren“
- [Tabelle-261] - TAB_KON_618 TUC_KON_031 „BNetzA-VL aktualisieren“
- [Tabelle-262] - TAB_KON_619 Fehlercodes TUC_KON_031 „BNetzA-VL aktualisieren“
- [Tabelle-263] - TAB_KON_767 TUC_KON_040 „CRL aktualisieren“
- [Tabelle-264] - TAB_KON_599 Fehlercodes TUC_KON_040 „CRL aktualisieren“
- [Tabelle-265] - TAB_KON_768 TUC_KON_033 „Zertifikatsablauf prüfen“
- [Tabelle-266] - TAB_KON_600 Fehlercodes TUC_KON_033 „Zertifikatsablauf prüfen“
- [Tabelle-267] - TAB_KON_769 TUC_KON_037 „Zertifikat prüfen“
- [Tabelle-268] - TAB_KON_601 Fehlercodes TUC_KON_037 „Zertifikat prüfen“
- [Tabelle-269] -  TAB_KON_818 TUC_KON_042 „CV-Zertifikat prüfen“ 
- [Tabelle-270] - TAB_KON_819 Fehlercodes TUC_KON_042 „CV-Zertifikat prüfen“
- [Tabelle-271] - TAB_KON_770 TUC_KON_034 „Zertifikatsinformationen extrahieren“
- [Tabelle-272] - TAB_KON_602 Fehlercodes TUC_KON_034 „Zertifikatsinformationen extrahieren“
- [Tabelle-273] - TAB_KON_771 Basisanwendung Zertifikatsdienst
- [Tabelle-274] - TAB_KON_676 Operation CheckCertificateExpiration
- [Tabelle-275] - TAB_KON_677 Ablauf CheckCertificateExpiration
- [Tabelle-276] - TAB_KON_603 Fehlercodes „CheckCertificateExpiration“
- [Tabelle-277] - TAB_KON_678 Operation ReadCardCertificate
- [Tabelle-278] - TAB_KON_679 Ablauf ReadCardCertificate
- [Tabelle-279] - TAB_KON_604 Fehlercodes „ReadCardCertificate“
- [Tabelle-283] - TAB_KON_772 TUC_KON_035 „Zertifikatsdienst initialisieren“
- [Tabelle-284] - TAB_KON_605 Fehlercodes TUC_KON_035 „Zertifikatsdienst initialisieren“
- [Tabelle-285] - TAB_KON_606 Konfiguration des Zertifikatsdienstes
- [Tabelle-286] - TAB_KON_733 Einsehbare Konfigurationsparameter des Zertifikatsdienstes
- [Tabelle-287] - TAB_KON_857 - Fehlercodes beim Import des Cross-Zertifikats für TI-Vertrauensanker ECC
- [Tabelle-288] - TAB_KON_607 – TUC_KON_271 „Schreibe Protokolleintrag“
- [Tabelle-289] - TAB_KON_608 Fehlercodes TUC_KON_271 „Schreibe Protokolleintrag“
- [Tabelle-290] - TAB_KON_609 Konfigurationswerte des Protokollierungsdienstes (Administrator)
- [Tabelle-291] - TAB_KON_610 – TUC_KON_272 „Initialisierung Protokollierungsdienst“
- [Tabelle-292] - TAB_KON_611 Fehlercodes TUC_KON_272 „Initialisiere Protokollierungsdienst“
- [Tabelle-293] - TAB_KON_773 – TUC_KON_110 „Kartenbasierte TLS-Verbindung aufbauen“
- [Tabelle-294] - TAB_KON_612 Fehlercodes TUC_KON_110 „Kartenbasierte TLS-Verbindung aufbauen“
- [Tabelle-295] - TAB_KON_774 - TUC_KON_111 „Kartenbasierte TLS-Verbindung abbauen“
- [Tabelle-296] - TAB_KON_613 Fehlercodes TUC_KON_111 „Kartenbasierte TLS-Verbindung abbauen“
- [Tabelle-297] - TAB_KON_805 - TUC_KON_290 „LDAP-Verbindung aufbauen“
- [Tabelle-298] - TAB_KON_815 – TUC_KON_291 „Verzeichnis abfragen“
- [Tabelle-299] - TAB_KON_816 – TUC_KON_292 „LDAP-Verbindung trennen"
- [Tabelle-300] - TAB_KON_817 – TUC_KON_293 „Verzeichnisabfrage abbrechen“
- [Tabelle-301] - TAB_KON_780 – Signaturverfahren Externe Authentisierung
- [Tabelle-302] - TAB_KON_839 Basisdienst Authentifizierungsdienst
- [Tabelle-303] - TAB_KON_781 Operation ExternalAuthenticate
- [Tabelle-304] - TAB_KON_782 Ablauf Operation ExternalAuthenticate
- [Tabelle-305] - TAB_KON_783 Übersicht Fehler Operation ExternalAuthenticate
- [Tabelle-306] - TAB_KON_784 Privater Schlüssel je Karte für ExternalAuthenticate
- [Tabelle-307] - TAB_KON_680 Mapping der Netzwerksegmente
- [Tabelle-308] - TAB_KON_681 Definition der vom Konnektor verwendeten VPN-Tunnel
- [Tabelle-309] - TAB_KON_682 Definition der Konnektor IP-Adressen
- [Tabelle-310] - TAB_KON_614 - TUC_KON_305 „LAN-Adapter initialisieren“
- [Tabelle-311] - TAB_KON_615 Fehlercodes TUC_KON_305 „LAN-Adapter initialisieren“
- [Tabelle-312] - TAB_KON_616 - TUC_KON_306 „WAN-Adapter initialisieren“
- [Tabelle-313] - TAB_KON_617 Fehlercodes TUC_KON_306 „WAN-Adapter initialisieren“
- [Tabelle-314] - TAB_KON_622 - TUC_KON_304 „Netzwerk-Routen einrichten“
- [Tabelle-315] - TAB_KON_623 Fehlercodes TUC_KON_304 „Netzwerk-Routen einrichten“
- [Tabelle-316] - TAB_KON_683 LAN-Adapter IP-Konfiguration
- [Tabelle-317] - TAB_KON_684 LAN-Adapter Erweiterte Parameter
- [Tabelle-318] - TAB_KON_685 WAN-Adapter IP-Konfiguration
- [Tabelle-319] - TAB_KON_686 WAN-Adapter Erweiterte Parameter
- [Tabelle-320] - TAB_KON_624 – „Konfigurationsparameter der Anbindung LAN/WAN“
- [Tabelle-321] - TAB_KON_625 - Konfigurationsparameter Firewall-Schnittstelle
- [Tabelle-322] - TAB_KON_626 „Liefere Netzwerkinformationen über DHCP“
- [Tabelle-324] - TAB_KON_628 „Basiskonfiguration des DHCP-Servers“
- [Tabelle-325] - TAB_KON_629 „Client-Gruppenspezifische Konfigurationsoptionen des Konnektor-DHCP-Servers“
- [Tabelle-326] - TAB_KON_630 - TUC_KON_343 „Initialisierung DHCP-Server“
- [Tabelle-327] - TAB_KON_631 Fehlercodes TUC_KON_343 „Initialisierung DHCP-Server“
- [Tabelle-328] - TAB_KON_632 – TUC_KON_341 „DHCP Informationen beziehen“
- [Tabelle-329] - TAB_KON_633 Fehlercodes TUC_KON_341 „DHCP-Informationen beziehen“
- [Tabelle-330] - TAB_KON_634 „Konfiguration des DHCP-Clients“
- [Tabelle-331] - TAB_KON_635 – TUC_KON_321 „Verbindung zu dem VPN-Konzentrator der TI aufbauen“
- [Tabelle-332] - TAB_KON_636 Fehlercodes TUC_KON_321 „Verbindung zu dem VPN-Konzentrator der TI aufbauen“
- [Tabelle-333] - TAB_KON_637 – TUC_KON_322 „Verbindung zu dem VPN-Konzentrator der SIS aufbauen“
- [Tabelle-334] - TAB_KON_638 Fehlercodes TUC_KON_322 „Verbindung zu dem VPN-Konzentrator der SIS aufbauen“
- [Tabelle-335] - TAB_KON_639 – Konfigurationsparameter VPN-Client
- [Tabelle-336] - TAB_KON_640 Zustandswerte für Konnektor NTP-Server
- [Tabelle-337] - TAB_KON_776 TUC_KON_351 „Liefere Systemzeit“
- [Tabelle-338] - TAB_KON_641 Fehlercodes TUC_KON_351 „Liefere Systemzeit“
- [Tabelle-339] - TAB_KON_642 Operation sync_Time
- [Tabelle-340] - TAB_KON_643 Konfiguration des Konnektor NTP-Servers
- [Tabelle-341] - TAB_KON_730 Einsehbare Konfigurationsparameter des Konnektor NTP-Servers
- [Tabelle-342] - TAB_KON_644 – TUC_KON_352 „Initialisierung Zeitdienst“
- [Tabelle-343] - TAB_KON_645 Fehlercodes TUC_KON_352 „Initialisierung Zeitdienst“
- [Tabelle-344] - TAB_KON_687 DNS-Forwards des DNS-Servers
- [Tabelle-345] - TAB_KON_646 – TUC_KON_361 „DNS-Namen auflösen“
- [Tabelle-346] - TAB_KON_647 Fehlercodes TUC_KON_361 „DNS Namen auflösen“
- [Tabelle-347] - TAB_KON_646 – TUC_KON_361 „DNS-Namen auflösen“
- [Tabelle-348] - TAB_KON_647 Fehlercodes TUC_KON_361 „DNS Namen auflösen“
- [Tabelle-349] - TAB_KON_648 – TUC_KON_362 „Liste der Dienste abrufen“
- [Tabelle-350] - TAB_KON_649 Fehlercodes TUC_KON_362 „Liste der Dienste abrufen“
- [Tabelle-351] - TAB_KON_650 - TUC_KON_363 „Dienstdetails abrufen“
- [Tabelle-352] - TAB_KON_651 Fehlercodes TUC_KON_363 „Dienstdetails abrufen“
- [Tabelle-353] - TAB_KON_652 Basisanwendung Namensdienst
- [Tabelle-354] - TAB_KON_653 Operation GetIPAddress
- [Tabelle-355] - TAB_KON_654 - Konfigurationsparameter Namensdienst
- [Tabelle-356] - TAB_KON_731 Einsehbare Konfigurationsparameter Namensdienst
- [Tabelle-357] - TAB_KON_655 Konfigurationen der Benutzerverwaltung (Super-Administrator)
- [Tabelle-358] - TAB_KON_656 Konfigurationen der Benutzerverwaltung
- [Tabelle-359] - TAB_KON_657 Konfigurationsparameter des Konnektornamens
- [Tabelle-360] - TAB_KON_833 Bezeichner für persistente Konfigurationsdaten für Fachmodule
- [Tabelle-361] - TAB_KON_658 Aktivieren/Deaktivieren von Leistungsumfängen
- [Tabelle -366] - TAB_KON_932 – TUC_KON_411 „Konnektor mit neuem NK-Zertifikat registrieren“
- [Tabelle-368] - TAB_KON_851 Einschränkung der Rechte des Remote-Administrators (Denylist)
- [Tabelle-370] - TAB_KON_664 – TUC_KON_280 „Konnektoraktualisierung durchführen“
- [Tabelle-371] - TAB_KON_665 Fehlercodes TUC_KON_280 „Konnektoraktualisierung durchführen“
- [Tabelle-372] - TAB_KON_666 – TUC_KON_281 „Kartenterminalaktualisierung anstoßen“
- [Tabelle-373] - TAB_KON_667 Fehlercodes TUC_KON_281 „Kartenterminalaktualisierung anstoßen“
- [Tabelle-374] - TAB_KON_668 – TUC_KON_282 „UpdateInformationen beziehen“
- [Tabelle-375] - TAB_KON_669 Fehlercodes TUC_KON_282 „UpdateInformationen beziehen“
- [Tabelle-376] - TAB_KON_799 – TUC_KON_283 „Infrastruktur Konfiguration aktualisieren“
- [Tabelle-377] - Tab_Kon_726 Fehlercodes TUC_KON_283 „Infrastruktur Konfiguration aktualisieren“
- [Tabelle-378] - TAB_KON_833 – TUC_KON_285 „UpdateInformationen für Fachmodul beziehen“
- [Tabelle-379] - TAB_KON_834 Fehlercodes TUC_KON_285 „UpdateInformationen für Fachmodul beziehen“
- [Tabelle-380] - TAB_KON_835 – TUC_KON_286 „Paket für Fachmodul laden“
- [Tabelle-381] - TAB_KON_836 Fehlercodes TUC_KON_286 „Paket für Fachmodul laden“
- [Tabelle-382] - TAB_KON_864 – TUC_KON_284 „KSR-Client initialisieren“
- [Tabelle-383] - TAB_KON_822 Fehlercodes TUC_KON_284 „KSR-Client initialisieren“
- [Tabelle-384] - TAB_KON_670 Konfigurationsparameter der Software-Aktualisierung
- [Tabelle-385] - TAB_KON_820 Einsehbare Konfigurationsparameter der Software-Aktualisierung
- [Tabelle-386] - TAB_KON_671 Anforderungen Klima
- [Tabelle-387] - TAB_KON_672 Anforderungen Vibration
- [Tabelle-388] - TAB_KON_672 Anforderungen Vibration
- [Tabelle-389] - TAB_KON_779-01 „Profilierung der Signaturformate“
- [Tabelle-390] - TAB_KON_775 „Mindestanforderungen an Dimensionierung von Dokumenten und Nachrichten“
- [Tabelle-391] - TAB_KON_889 „Unerlaubte Inhalte in Dokumenten und Nachrichten“
- [Tabelle-392] - TAB_KON_777 Events Interne Mechanismen
- [Tabelle-393] - TAB_KON_711 Architektur der TI-Plattform, Berechtigt Fachmodule
- [Tabelle-394] - TAB_KON_712 Architektur der TI-Plattform, Berechtigt Clientsysteme
- [Tabelle-395] - TAB_KON_713 Architektur der TI-Plattform, Berechtigt eHealth-KT
- [Tabelle-396] - TAB_KON_714 Architektur der TI-Plattform, Berechtigt Administrator
- [Tabelle-397] - Aufzähltypen

### 5.5 Referenzierte Dokumente

### 5.5.1 Dokumente der gematik

Die nachfolgende Tabelle enthält die Bezeichnung der in dem vorliegenden
Dokument referenzierten Dokumente der gematik zur Telematikinfrastruktur. Der
mit der vorliegenden Version korrelierende Entwicklungsstand dieser Konzepte
und Spezifikationen wird pro Release in einer Dokumentenlandkarte definiert,
Version und Stand der referenzierten Dokumente sind daher in der nachfolgenden
Tabelle nicht aufgeführt. Deren zu diesem Dokument passende jeweils gültige
Versionsnummer sind in der aktuellsten, von der gematik veröffentlichten
Dokumentenlandkarte enthalten, in der die vorliegende Version aufgeführt wird.

<table><tr><th>
[Quelle]

</th><th>
Herausgeber: Titel

</th></tr><tr><td>
[gemGlossar]

</td><td>
gematik: Glossar

</td></tr><tr><td>
[gemKPT_Arch_TIP]

</td><td>
gematik: Konzept Architektur der TI-Plattform

</td></tr><tr><td>
[gemKPT_Sich_Kon]

</td><td>
gematik: Sicherheitskonzept Konnektor

</td></tr><tr><td>
[gemKPT_Test]

</td><td>
gematik: Testkonzept

</td></tr><tr><td>
[gemSpec_COS]

</td><td>
gematik: Spezifikation des Card Operating System (COS) – Elektrische
Schnittstelle

</td></tr><tr><td>
[gemSpec_Karten_Fach_TIP]

</td><td>
gematik: Befüllvorschriften für die Plattformanteile der Karten der TI

</td></tr><tr><td>
[gemSpec_eGK_ObjSys]

</td><td>
gematik: Spezifikation der elektronischen Gesundheitskarte eGK-Objektsystem -
für Karten der Generation 2

</td></tr><tr><td>
[gemSpec_eGK_ObjSys_G2.1]

</td><td>
gematik: Spezifikation der elektronischen Gesundheitskarte eGK-Objektsystem -
für Karten der Generation 2.1

</td></tr><tr><td>
[gemSpec_eGK_P1]

</td><td>
gematik: Die Spezifikation der elektronische Gesundheitskarte; Teil 1 –
Spezifikation der elektrischen Schnittstelle

- für Karten der Generation 1+

</td></tr><tr><td>
[gemSpec_eGK_P2]

</td><td>
gematik: Die Spezifikation der elektronische Gesundheitskarte; Teil 2 –
Grundlegende Applikationen

- für Karten der Generation 1+

</td></tr><tr><td>
[gemSpec_gSMC-K_ObjSys]

</td><td>
gematik: Spezifikation der gSMC-K Objektsystem

</td></tr><tr><td>
[gemSpec_gSMC-KT_ObjSys]

</td><td>
gematik: Spezifikation gSMC-KT Objektsystem

</td></tr><tr><td>
[gemSpec_HBA_ObjSys]

</td><td>
gematik: Spezifikation HBA Objektsystem

</td></tr><tr><td>
[gemSpec_Krypt]

</td><td>
gematik: Übergreifende Spezifikation Verwendung kryptographischer Algorithmen
in der Telematikinfrastruktur

</td></tr><tr><td>
[gemSpec_KSR]

</td><td>
gematik: Spezifikation Konfigurationsdienst

</td></tr><tr><td>
[gemSpec_KT]

</td><td>
gematik: Spezifikation eHealth-Kartenterminal

</td></tr><tr><td>
[gemSpec_Net]

</td><td>
gematik: Spezifikation Netzwerk

</td></tr><tr><td>
[gemSpec_OID]

</td><td>
gematik: Spezifikation OID

</td></tr><tr><td>
[gemSpec_OM]

</td><td>
gematik: Übergreifende Spezifikation Operations und Maintenance

</td></tr><tr><td>
[gemSpec_Perf]

</td><td>
gematik: Performance und Mengengerüst TI-Plattform

</td></tr><tr><td>
[gemSpec_PKI]

</td><td>
gematik: Spezifikation PKI

</td></tr><tr><td>
[gemSpec_SMC-B_ObjSys]

</td><td>
gematik: Spezifikation SMC-B Objektsystem

</td></tr><tr><td>
[gemSpec_VPN_ZugD]

</td><td>
gematik: Spezifikation VPN-Zugangsdienst

</td></tr><tr><td>
[gemSpec_VZD]

</td><td>
gematik: Spezifikation Verzeichnisdienst

</td></tr><tr><td>
gemGitHub_tslSig]

</td><td>
https://github.com/gematik/examples-TelematikInterfaces/tree/master/tslService/detachedSignature

 

</td></tr></table>

### 5.5.2 Weitere Dokumente

<table><tr><th>
[Quelle]

</th><th>
Herausgeber (Erscheinungsdatum): Titel

</th></tr><tr><td>
[7816–4]

</td><td>
ISO/IEC 7816-4: 2005 (2nd edition) Identification cards — Integrated circuit
cards - Part 4: Organization, security and commands for interchange

</td></tr><tr><td>
[ALGCAT]

</td><td>
SOG-IS Crypto Evaluation Scheme - Agreed Cryptographic Mechanisms, Version 1.2,
Januar 2020.

</td></tr><tr><td>
[Basic Profile1.2]

</td><td>
Basic Profile Version 1.2

http://www.ws-i.org/Profiles/BasicProfile-1.2-2010-11-09.html

</td></tr><tr><td>
[Basic Profile2.0]

</td><td>
Basic Profile Version 2.0

http://www.ws-i.org/Profiles/BasicProfile-2.0-2010-11-09.html

</td></tr><tr><td>
[BSI-TR-03111]

</td><td>
Technical Guideline BSI TR-03111

Elliptic Curve Cryptography, Version 2.10, Date: 2018-06-01

https://www.bsi.bund.de/SharedDocs/Downloads/EN/BSI/Publications/TechGuidelines/TR03111/BSI-TR-03111_V-2-1_pdf.pdf?__blob=publicationFile&v=2

 

</td></tr><tr><td>
[BSI-TR03114]

</td><td>
BSI (22.10.2007): Technische Richtlinie – Stapelsignatur mit dem
Heilberufsausweis; Version 2.0

https://www.bsi.bund.de/SharedDocs/Downloads/DE/BSI/
Publikationen/TechnischeRichtlinien/TR03114/BSI-TR-03114.pdf?
__blob=publicationFile&v=1

     

</td></tr><tr><td>
[BSI TR-03120]

</td><td>
BSI (23.10.2007): BSI - Technische Richtlinie – Sichere
Kartenterminalidentität (Betriebskonzept); Version 1.0

https://www.bsi.bund.de/SharedDocs/Downloads/DE/BSI/
Publikationen/TechnischeRichtlinien/TR03120/BSI-TR-03120.pdf?
__blob=publicationFile&v=1

    

</td></tr><tr><td>
[CAdES]

</td><td>
ETSI: Electronic Signature Formats, Electronic Signatures and Infrastructures
(ESI) – Technical Specification, ETSI TS 101 733 V2.2.1, via

http://www.etsi.org

</td></tr><tr><td>
[Canon XML1.1]

</td><td>
Canonical XML Version 1.1

http://www.w3.org/TR/2008/REC-xml-c14n11-20080502/

</td></tr><tr><td>
[CDA]

</td><td>
ISO/HL7 27932:2009 Data Exchange Standards -- HL7 Clinical Document
Architecture, Release 2

</td></tr><tr><td>
[CDA-Sig]

</td><td>
Erstellung von XML-Signaturen für Dokumente nach Clinical Documents
Architecture – R2, Elektronische Signatur von Arztbriefen,  Ärztekammern
in NRW im Auftrag der Bundesärztekammer, Version 1.6 vom 19.04.2010

</td></tr><tr><td>
[COMMON_PKI]

</td><td>
Common PKI Specifications for Interoperable Applications

Version 2.0, 20 January 2009

http://www.t7ev.org/themen/entwickler/common-pki-v20-spezifikation.html

ISIS-MTT Core Specification, 2004, Version 1.1

https://www.teletrust.de/fileadmin/files/ ISIS-MTT_Profile_SigGOptions_v1.1.pdf

  

</td></tr><tr><td>
[CMS]

</td><td>
Cryptographic Message Syntax (CMS), September 2009

https://datatracker.ietf.org/doc/html/rfc5652

 

</td></tr><tr><td>
[DIN 66003]

</td><td>
DIN 66003:1999

Informationsverarbeitung; 7-Bit-Code

</td></tr><tr><td>
[HPC-P1]

</td><td>
Spezifikation des elektronischen Heilberufsausweises

Version 2.3.2, 05.08.2009, Teil I: Kommandos, Algorithmen und Funktionen der COS
Plattform

</td></tr><tr><td>
[HPC-P2]

</td><td>
Spezifikation des elektronischen Heilberufsausweises

Version 2.3.2, 05.08.2009, Teil II: HPC - Anwendungen und Funktionen

</td></tr><tr><td>
[HPC-P3]

</td><td>
Spezifikation des elektronischen Heilberufsausweises

Version 2.3.2, 05.08.2009, Teil III: SMC - Anwendungen und Funktionen

</td></tr><tr><td>
[HüKo06]

</td><td>
BSI (2006):

Hühnlein, Detlef/Korte, Ulrike:Grundlagen der elektronischen Signatur

</td></tr><tr><td>
[IEEE 802.3]

</td><td>
Technical Committee Computer Communications of the IEEE Computer Society, USA
(1985):

IEEE standards for local area networks: carrier sense multiple access with
collision detection (CSMA/CD) access method and physical layer specifications

ISBN: 0-7381-4253-0

</td></tr><tr><td>
[ISO 8601]

</td><td>
International Organization for Standardization (2006-09): Data elements and
interchange formats -- Information interchange -- Representation of dates and
times

</td></tr><tr><td>
[KVK]

</td><td>
Spitzenverbände der Krankenkassen, Kassenärztliche Bundesvereinigung und
Kassenzahnärztlichen Bundesvereinigung (gültig ab 25. November 2009):

Technische Spezifikation der Versichertenkarte Version: 2.08

</td></tr><tr><td>
[MIME]

</td><td>
RFC 2045

,

RFC 2046

,

RFC 2047

,

RFC 2048

,

RFC 2049

</td></tr><tr><td>
[NTPv4]

</td><td>
Internet Engineering Task Force (IETF) (06/2010): Network Time Protocol Version
4: Protocol and Algorithms Specification

https://datatracker.ietf.org/doc/html/rfc5905

 

</td></tr><tr><td>
[OASIS-

AdES]

</td><td>
OASIS: Advanced Electronic Signature Profiles of the OASIS Digital Signature
Service Version 1.0, OASIS Standard,

http://docs.oasis-open.org/dss/v1.0/oasis-dss-profiles-AdES-spec-v1.0-os.pdf

</td></tr><tr><td>
[OASIS-DSS]

</td><td>
OASIS: Digital Signature Service Core Protocols, Elements, and Bindings, Version
1.0, OASIS Standard, via

http://docs.oasis-open.org/dss/v1.0/oasis-dss-core-spec-v1.0-os.pdf

</td></tr><tr><td>
[OASIS-SP]

</td><td>
OASIS: Signature Policy Profile of the OASIS Digital Signature Services Version
1.0, Committee Draft 01, 18 May
2009, http://docs.oasis-open.org/dss-x/profiles/sigpolicy/oasis-dssx-1.0-profiles-sigpolicy-cd01.pdf

</td></tr><tr><td>
[OASIS-VR]

</td><td>
OASIS: Profile for comprehensive multi-signature verification reports for OASIS
Digital Signature Services Version 1.0, Committee Specification 01, 12 November
2010, http://docs.oasis-open.org/dss-x/profiles/verificationreport/oasis-dssx-1.0-profiles-vr-cs01.pdf

</td></tr><tr><td>
[PAdES-1]

</td><td>
European Telecommunications Standards Institute (ETSI): Electronic Signatures
and Infrastructures (ESI); PDF Advanced Electronic Signature Profiles; Part 1:
PAdES Overview – a framework document for PAdES,

ETSI TS 102 778-1 V1.1.1, Technical Specification, 2009

</td></tr><tr><td>
[PAdES-3]

</td><td>
European Telecommunications Standards Institute (ETSI): Electronic Signatures
and Infrastructures (ESI); PDF Advanced Electronic Signature Profiles; Part 3:
PAdES Enhanced – PAdES-BES and PAdES-EPES Profiles, ETSI TS 102 778-3 V1.1.2,
Technical Specification, 2009

</td></tr><tr><td>
[PAdES-4]

</td><td>
European Telecommunications Standards Institute (ETSI): Electronic Signatures
and Infrastructures (ESI); PDF Advanced Electronic Signature Profiles; Part 4:
PAdES Long Term – PAdES-LTV Profile, ETSI TS 102 778-4 V1.1.2, Technical
Specification, 2009

</td></tr><tr><td>
[ISO 19005]

</td><td>
ISO 19005 – Document management – Electronic document file format for
long-term preservation

</td></tr><tr><td>
[PDF/A-2]

</td><td>
ISO 19005-2:2011 – Document management – Electronic document file format for
long-term preservation – Part 2: Use of ISO 32000-1 (PDF/A-2)

</td></tr><tr><td>
[PP_NK]

</td><td>
Common  Criteria  Schutzprofil  (Protection  Profile)

Schutzprofil 1: Anforderungen an den Netzkonnektor

BSI-CC-PP-0097

</td></tr><tr><td>
[PP_KON]

</td><td>
Common  Criteria  Schutzprofil  (Protection  Profile)

Schutzprofil 2: Anforderungen an den Konnektor:

BSI-CC-PP-0098

</td></tr><tr><td>
[RFC792]

</td><td>
IETF (September 1981) INTERNET CONTROL MESSAGE PROTOCOL

https://datatracker.ietf.org/doc/html/rfc792

 

</td></tr><tr><td>
[RFC1034]

</td><td>
RFC 1034 (November 1987): Domain Names – Concepts and Facilities

https://datatracker.ietf.org/doc/html/rfc1034

 

</td></tr><tr><td>
[RFC1122]

</td><td>
RFC 1122 (Oktober 1989): Requirements for Internet Hosts -- Communication Layers

https://datatracker.ietf.org/doc/html/rfc1122

 

</td></tr><tr><td>
[RFC1812]

</td><td>
F. Baker (ed.): Requirements for IP Version 4 Routers

, IETF RFC 1812

https://datatracker.ietf.org/doc/html/rfc1812

 

</td></tr><tr><td>
[RFC1918]

</td><td>
RFC1918 (Februar 1996): Address Allocation for Private Internets

https://datatracker.ietf.org/doc/html/rfc1918

 

</td></tr><tr><td>
[RFC2119]

</td><td>
RFC 2119 (März 1997): Key words for use in RFCs to Indicate Requirement Levels
S. Bradner https://datatracker.ietf.org/doc/html/rfc2119 

</td></tr><tr><td>
[RFC2131]

</td><td>
Network Working Group (03/1997): Dynamic Host Configuration Protocol

https://datatracker.ietf.org/doc/html/rfc2131

 

</td></tr><tr><td>
[RFC2132]

</td><td>
Network Working Group (03/1997): DHCP Options and BOOTP Vendor Extensions

https://datatracker.ietf.org/doc/html/rfc2132

 

</td></tr><tr><td>
[RFC2616]

</td><td>
Network Working Group (06/1999): Hypertext Transfer Protocol -- HTTP/1.1 

https://datatracker.ietf.org/doc/html/rfc2616 

</td></tr><tr><td>
[RFC2617]

</td><td>
Network Working Group (06/1999): HTTP Authentication: Basic and Digest Access
Authentication

https://datatracker.ietf.org/doc/html/rfc2617

 

</td></tr><tr><td>
[RFC2644]

</td><td>
D. Senie:

Changing the Default for Directed Broadcasts in Routers

, IETF RFC 2644,  
https://datatracker.ietf.org/doc/html/rfc2644 

</td></tr><tr><td>
[RFC2663]

</td><td>
P. Srisuresh, M. Holdrege:

IP Network Address Translator (NAT) Terminology and Considerations

, IETF RFC 2663, https://datatracker.ietf.org/doc/html/rfc2663 

</td></tr><tr><td>
[RFC2818]

</td><td>
Network Working Group (05/2000): HTTP Over TLS

https://datatracker.ietf.org/doc/html/rfc2818

 

</td></tr><tr><td>
[RFC3022]

</td><td>
RFC 3022 (Januar 2001): Traditional IP Network Address Translator (Traditional
NAT)

https://datatracker.ietf.org/doc/html/rfc3022

 

</td></tr><tr><td>
[RFC3275]

</td><td>
D. Eastlage, J. Reagle, D. Solo:

(Extensible Markup Language) XMLSignature Syntax and Processing

, IETF RFC 3275, https://datatracker.ietf.org/doc/html/rfc3275 

</td></tr><tr><td>
[RFC3279]

</td><td>
W, Polk, R. Hously, L. Bassham:

Algorithms and Identifiers for the Internet X.509 Public Key Infrastructure
Certificate and Certificate Revocation List (CRL) Profile

, IETF RFC 3279,

https://datatracker.ietf.org/doc/html/rfc3279

 

</td></tr><tr><td>
[RFC3447]

</td><td>
B. Kaliski:_PKCS #1: RSA Encryption, Version 2.1 

https://datatracker.ietf.org/doc/html/rfc3447 

</td></tr><tr><td>
[RFC3629]

</td><td>
Network Working Group (11/2003): UTF-8, a transformation format of ISO 10646

https://datatracker.ietf.org/doc/html/rfc3629

 

</td></tr><tr><td>
[RFC3927]

</td><td>
Network Working Group (05/2005): Dynamic Configuration of IPv4 Link-Local
Addresses

https://datatracker.ietf.org/doc/html/rfc3927

 

</td></tr><tr><td>
[RFC3986]

</td><td>
Network Working Group (01/2005): Uniform Resource Identifier (URI): Generic
Syntax

</td></tr><tr><td>
[RFC4122]

</td><td>
RFC 4122 (July 2005): A Universelly Unique Identifier UUID URN Namspace

https://datatracker.ietf.org/doc/html/rfc4122

 

</td></tr><tr><td>
[RFC4511]

</td><td>
RFC 4511 (June 2006): Lightweight Directory Access Protocol (LDAP): The Protocol

https://datatracker.ietf.org/doc/html/rfc4511

 

</td></tr><tr><td>
[RFC4632]

</td><td>
Network Working Group (08/2006): Classless Inter-domain Routing (CIDR): The
Internet Address Assignment and Aggregation Plan

https://datatracker.ietf.org/doc/html/rfc4632

 

</td></tr><tr><td>
[RFC5246]

</td><td>
RFC 5246 (August 2008): The Transport Layer Security (TLS) Protocol Version 1.2;

https://datatracker.ietf.org/doc/html/rfc5246

 

</td></tr><tr><td>
[RFC5652]

</td><td>
R. Housley:

Cryptographic Message Syntax (CMS), RFC 5652 (September 2009)

https://datatracker.ietf.org/doc/html/rfc5652

 

</td></tr><tr><td>
[RFC 6598]

</td><td>
RFC 6598 (April 2012): IANA-Reserved IPv4 Prefix for Shared Address Space

https://datatracker.ietf.org/doc/html/rfc6598

 

</td></tr><tr><td>
[RFC6931]

</td><td>
RFC 6931 (April 2013): Additional XML Security Uniform Resource Identifiers
(URIs)

https://datatracker.ietf.org/doc/html/rfc6931

 

</td></tr><tr><td>
[RFC7159]

</td><td>
RFC 7159 (March 2014): The JavaScript Object Notation (JSON) Data Interchange
Format

https://datatracker.ietf.org/doc/html/rfc7159

 

</td></tr><tr><td>
[S/MIME]

</td><td>
RFC 5751  (Januar  2010): Secure/Multipurpose Internet Mail
Extensions  (S/MIME), Version 3.2, Message Specification

https://datatracker.ietf.org/doc/html/rfc5751

 

</td></tr><tr><td>
[SOAP1.1]

</td><td>
Simple Object Access Protocol (SOAP) 1.1

W3C Note (08 May 2000)

https://www.w3.org/TR/2000/NOTE-SOAP-20000508/

 

</td></tr><tr><td>
[SOAP1.2]

</td><td>
SOAP Version 1.2 Part 1: Messaging Framework (Second Edition)

W3C Recommendation (27 April 2007)

http://www.w3.org/TR/2007/REC-soap12-part1-20070427/

</td></tr><tr><td>
[SICCT]

</td><td>
TeleTrusT (17.12.2010): SICCT Secure Interoperable ChipCard Terminal,

Version 1.21

https://www.teletrust.de/fileadmin/docs/projekte/sicct/SICCT-Spezifikation-1.21.pdf

 

</td></tr><tr><td>
[TIFF6]

</td><td>
TIFF Revision 6.0 (Final, June 3, 1992)

https://www.adobe.io/open/standards/TIFF/_jcr_content/
contentbody/download/file.res/TIFF6.pdf.html

 

</td></tr><tr><td>
[WSDL1.1]

</td><td>
W3C Note (15.03.2001):

Web Services Description Language (WSDL) 1.1

http://www.w3.org/TR/wsdl

</td></tr><tr><td>
[XAdES]

</td><td>
European Telecommunications Standards Institute (ETSI): Technical Specication
XML Advanced Electronic Signatures (XAdES). ETSI Technical Specication TS 101
903, Version 1.4.2, 2010

</td></tr><tr><td>
[XMLDSig]

</td><td>
W3C Recommendation (06.2008):

XML-Signature Syntax and Processing

http://www.w3.org/TR/2008/REC-xmldsig-core-20080610/

</td></tr><tr><td>
[XMLEnc]

</td><td>
XML Encryption Syntax and Processing

W3C Recommendation 11 April 2013

http://www.w3.org/TR/xmlenc-core1/

</td></tr><tr><td>
[XPATH]

</td><td>
W3C Recommendation (14 December 2010)

XML Path Language (XPath) 2.0 (Second Edition)

http://www.w3.org/TR/2010/REC-xpath20-20101214/

</td></tr><tr><td>
[XSLT]

</td><td>
W3C Recommendation (23 January 2007)

XSL Transformations (XSLT) Version 2.0

http://www.w3.org/TR/2007/REC-xslt20-20070123/

</td></tr><tr><td>
[XAdES Baseline

Profile]

</td><td>
European Telecommunications Standards Institute (ETSI): Electronic Signatures
and Infrastructure (ESI); XAdES Baseline Profile; ETSI Technical Specification
TS 103 171, Version 2.1.1, 2012-03

</td></tr><tr><td>
[CAdES Baseline

Profile]

</td><td>
European Telecommunications Standards Institute (ETSI): Electronic Signatures
and Infrastructure (ESI); CAdES Baseline Profile; ETSI Technical Specification
TS 103 173, Version 2.1.1, 2013-04

</td></tr><tr><td>
[PAdES Baseline

Profile]

</td><td>
European Telecommunications Standards Institute (ETSI): Electronic Signatures
and Infrastructure (ESI); PAdES Baseline Profile; ETSI Technical Specification
TS 103 172, Version 2.2.2, (2013-04)

</td></tr><tr><td>
[XSL]

</td><td>
W3C Recommendation (05.12.2006):

Extensible Stylesheet language (XSL) Version1.1

http://www.w3.org/TR/2006/REC-xsl11-20061205/

</td></tr><tr><td>
[MTOM]

</td><td>
SOAP Message Transmission Optimization Mechanism

W3C Recommendation 25 January 2005

http://www.w3.org/TR/2005/REC-soap12-mtom-20050125/

</td></tr><tr><td>
[MTOM-SOAP1.1]

</td><td>
W3C Member Submission 05 April 2006

SOAP 1.1 Binding for MTOM 1.0

https://www.w3.org/Submission/soap11mtom10/

</td></tr><tr><td>
[WS-MTOM Policy]

</td><td>
W3C Member Submission 18 November 2007

MTOM Serialization Policy Assertion 1.1

</td></tr><tr><td>
[COS-G2]

</td><td>
Common Criteria Protection Profile, Card Operating System Generation 2, (PP COS
G2), BSI-CC-PP-0082-V2

</td></tr></table>

### 6 Anhang B – Profilierung der Signatur- und Verschlüsselungsformate (normativ)

### 6.1 Profilierung der Verschlüsselungsformate

### 6.2 Profilierung der Signaturformate

<table><tr><th>
Aspekt

(QES/nonQES)

</th><th>
Festlegung

(XML-Signatur/CMS-Signatur/PDF-Signatur)

</th></tr><tr><td>
Zertifikatsreferenz

(QES und nonQES)

</td><td>
XML-Signatur

Bei der Signaturerstellung ist das XML-Element

SigningCertificate

gemäß den Vorgaben aus XAdES Kapitel 7.2.2 „The SigningCertificate
element“ anzulegen.

Bei der Signaturprüfung ist es gemäß XAdES Kapitel G.2.2.5 „Verification
technical rules” [XAdES] zu prüfen. Grundsätzlich sind auch Signaturen zu
prüfen, die keine Zertifikatsreferenz enthalten. Das Prüfergebnis muss dann
widerspiegeln, dass diese Sicherheitsfunktion nicht enthalten war.

CMS-Signatur

Bei der Signaturerstellung ist das Attribut

signing

certificate reference

gemäß CAdES Kapitel 5.7.3 „Signing Certificate Reference Attributes“
[CAdES] anzulegen.

Bei der Signaturprüfung ist es gemäß CAdES Kapitel 5.6.3 „Message signature
verification process“ [CAdES] zu prüfen.

Grundsätzlich sind auch Signaturen zu prüfen, die keine Zertifikatsreferenz
enthalten. Das Prüfergebnis muss dann widerspiegeln, dass diese
Sicherheitsfunktion nicht enthalten war.

PDF-Signatur

Bei der Signaturerstellung ist das Attribut

signing

certificate reference

gemäß den Vorgaben aus [PAdES-3] Kapitel 4.4.3 „Signing Certificate
Reference Attribute“ anzulegen.

Bei der Signaturprüfung ist es gemäß [PAdES-3]Kapitel 4.6.1 „Signing
Certificate Reference Validation“ zu prüfen. Grundsätzlich sind auch
Signaturen zu prüfen, die keine Zertifikatsreferenz enthalten. Das
Prüfergebnis muss dann widerspiegeln, dass diese Sicherheitsfunktion nicht
enthalten war.

</td></tr><tr><td>
Signaturablage

</td><td>
PDF-Signatur

Sie Signatur wird als Incremental Update gemäß [PDF/A-2] Kapitel 7.5.6 an das
Dokument angefügt.

</td></tr><tr><td>
Parallelsignatur

(QES und nonQES)

</td><td>
XML-Signatur

Parallele Signaturen werden durch je ein

ds:signature

-Element pro Signatur abgebildet. Für die Signaturvariante „enveloping“
werden parallele Signaturen nicht angeboten.

CMS-Signatur:

Parallele Signaturen werden durch je einen SignerInfo-Container pro Signatur
realisiert.

PDF-Signatur:

Parallele Signaturen werden nicht angeboten.

</td></tr><tr><td>
Dokumentexkludierende Gegensignatur

(QES und nonQES)

</td><td>
XML-Signatur

Die Implementierung erfolgt mittels Countersignature gemäß [XAdES], Kapitel
7.2.4. Jede vorhandene Parallel-Signatur wird gegensigniert.

CMS-Signatur:

Die Implementierung erfolgt mittels der Countersignature gemäß
CMS-Spezifikation [RFC5652]. Jede vorhandene Parallel-Signatur wird
gegensigniert.

PDF-Signatur:

Dokumentexkludierende Gegensignaturen werden nicht angeboten.

</td></tr><tr><td colspan="1" rowspan="2">
Referenzierung

(QES und nonQES)

</td><td>
XML-Signatur

Bei der Signaturerzeugung verwendet der Konnektor 

in der Signatur nur ID-basierte Referenzen. Bei der Signaturprüfung reagiert
der Konnektor bei Abweichungen hiervon mit Fehler 4208.

</td></tr><tr><td>
XML-Signatur / CMS-Signatur

Bei XML-Dokumenten und XML-Signaturen kann die Referenzierung von Objekten auf
zwei Arten erfolgen: 

– Ist kein XML-Schema vorhanden, so werden die Werte des ID-Attributs des
referenzierten Elements verwendet.

– Wird ein XML-Schema übergeben, so muss dieses die ID-Attribute zur
Referenzierung festlegen.

Bei Abweichungen reagiert der Konnektor mit Fehlercode 4115.

</td></tr><tr><td>
Anzahl unterstützter Signaturen

(QES und nonQES)

</td><td>
XML-Signatur / CMS-Signatur / PDF-Signatur

Es müssen mindestens 20 Signaturen pro Dokument unterstützt werden. Sind mehr
als die unterstützte Anzahl von Signaturen in einem Dokument enthalten, wird
die Operation mit Fehler 4280 abgebrochen.

</td></tr></table>

### 6.3 Profilierung VerificationReport

Anforderung eines ausführlichen Prüfberichts

Folgende Aufrufparameter müssen unterstützt werden:

\<ReturnVerificationReport

xmlns="urn:oasis:names:tc:dss-x:1.0:profiles:verificationreport:schema#"
xmlns:xsi=http://www.w3.org/2001/XMLSchema-instance

xsi:schemaLocation="urn:oasis:names:tc:dss-x:1.0:profiles:verificationreport:schema#

oasis-dssx-1.0-profiles-vr-cd1.xsd"\>

\<IncludeVerifier\>false\</IncludeVerifier\>

\<IncludeCertificateValues\>true\</IncludeCertificateValues\>

\<IncludeRevocationValues\>true\</IncludeRevocationValues\>

\<ExpandBinaryValues\>false\</ExpandBinaryValues\>  

\<ReportDetailLevel\>

urn:oasis:names:tc:dss-x:1.0:profiles:verificationreport:reportdetail:allDetails

\</ReportDetailLevel\>

\</ReturnVerificationReport\>

Verwendung des erzeugten VerificationReport

Für die folgenden Inhalte müssen die angegebenen Strukturen benutzt werden. Im
Standard angegebene Pflichtfelder von erzeugten Strukturen müssen ggf.
zusätzlich gefüllt werden:

 ---> OL

/VerificationReport/

    dss:VerificationTimeInfo/    

        dss:VerificationTime

 ---> OL

/VerificationReport/

    IndividualReport/

        SignedObjectIdentifier/

            SignedProperties/

                SignedSignatureProperties/

                    XAdES:SigningTime

Die Signierzeit SigningTime ist nicht nur für XAdES-Signaturen, sondern
allgemein für Signaturen gemäß AdES-Baseline-Profilierung, also auch für
CAdES und PAdES zu füllen.

 ---> OL

/VerificationReport/    IndividualReport/  
        Details/            dss:VerificationTimeInfo/                dss:VerificationTime

 ---> OL

/VerificationReport/

    IndividualReport/

        SignedObjectIdentifier/

            SignatureValue

 ---> OL

Der signierte Kurztext wird in folgendem XML-Element zurückgegeben:

/VerificationReport/

      IndividualReport/

             SignedObjectIdentifier/

                   SignedProperties/

                        Other/                            SIG:ShortText

Die ungültigen Zeichen müssen aus dem ShortText entfern werden und der
ShortText wird gekürzt, wenn er nicht den Längenvorgaben des Schemas
entspricht. 

 ---> OL

/VerificationReport/

      IndividualReport/

             SignedObjectIdentifier/

                   SignedProperties/

                        Other/                               
SIG:ReferenceToSignerCertificate

 ---> OL

/VerificationReport/

      IndividualReport/

             SignedObjectIdentifier/

                   SignedProperties/

                        Other/                               
SIG:DisplayableAttributes

 ---> OL

/VerificationReport/

    IndividualReport/

        Result

 ---> OL

Properties/

UnsignedProperties/

    Other/

        SIG:CounterSignatureMarker    

und mit

/DetailedSignatureReport/

Properties/

UnsignedProperties/

    Other/

        SIG:CounterSignatureMarker/

SignatureValueReference/

        @IdRef        

auf jede (eine oder mehrere) gegensignierte Signaturen verwiesen.  Dabei
zeigt  IdRef auf den jeweiligen gegensignierten
Signaturwert/VerificationReport/

    IndividualReport/

        SignedObjectIdentifier/

            ds:SignatureValue/

                @Id

 ---> OL

/VerificationReport/

    IndividualReport/

        Details/

            DetailedSignatureReport/

                CertificatePathValidity/

                    PathValiditySummary/

                        ResultMajor

 ---> OL

/VerificationReport/

    IndividualReport/

        Details/

            DetailedSignatureReport/

                CertificatePathValidity/

                    PathValidityDetail/

                        CertificateValidity/

                            CertificateValue

 ---> OL

/VerificationReport/

    IndividualReport/

        Details/

            DetailedSignatureReport/

                SignatureOK/    

                    SignatureAlgorithm    

                        

 ---> OL

Für alle geprüften Zertifikate:

../

vr:CertificateValidity/

        vr:SignatureOK/

            vr:SignatureAlgorithm/

                vr:Suitability/

./ResultMajor= urn:oasis:names:tc:dss:1.0:detail:invalid

./ResultMessage=“Algorithmen seit \<Jahr\> als unsicher eingestuft“

 ---> OL

//CertificateValidity/ChainingOK/ResultMajor (ab dem zweiten Zertifikat in der
Kette)

//CertificateValidity/CertificateStatus/CertStatusOK/ResultMajor

//CertificateValidity/CertificateValue

Für das Feld TrustAnchor ist

“urn:oasis:names:tc:dss-x:1.0:profiles:verificationreport:trustanchor:certDataBase”

zu verwenden.

 ---> OL

/VerificationReport/

    IndividualReport/

        Details/

            DetailedSignatureReport/

                CertificatePathValidity/

                    PathValidityDetail/

                        CertificateValidity/

                            ValidityPeriodOK/

                                ResultMajor

 ---> OL

/VerificationReport/

    IndividualReport/

        Details/

            DetailedSignatureReport/

                CertificatePathValidity/

                    PathValidityDetail/

                        CertificateValidity/

                            ExtensionsOK/

                                ResultMajor

 ---> OL

/VerificationReport/

    IndividualReport/

        Details/

            DetailedSignatureReport/

                CertificatePathValidity/

                        PathValidityDetail/

                            CertificateValidity/

                                CertificateStatus/

                                    RevocationEvidence/

                                        OCSPValidity/

                                            OCSPIdentifier/

            ./XAdES:ResponderID/XAdES:ByName

            ./XAdES:ProducedAt

 ---> OL

/VerificationReport/

    IndividualReport/

        Details/

            /vr:DetailedSignatureReport/

                vr:CertificatePathValidity/

                    vr:PathValidityDetail/

                        vr:CertificateValidity/

                            vr:CertificateStatus/

                                vr:RevocationEvidence/

                                    vr:OCSPValidity/

                                        vr:OCSPValue

Sonderfälle:

Dokument mit parallelen Signaturen

    Für jede Signatur wird ein IndividualReport erzeugt.

Dokument mit Signatur und Gegensignatur

    Für jede Signatur wird ein IndividualReport erzeugt.    

### 6.4 Profilierung der Dokumentenformate und Nachrichten

<table><tr><th>
Dokument / Nachricht

</th><th>
Mindestanforderung

</th></tr><tr><td colspan="1" rowspan="8">
XML-Dokument

</td><td>
Hierarchietiefe des Dokumentenbaums: 30 Ebenen 

</td></tr><tr><td>
Anzahl von XML-Elementen im Dokument: 30.000

</td></tr><tr><td>
Anzahl von XML-Attributen je XML-Element: 20

</td></tr><tr><td>
Anzahl von direkten Kindern eines XML-Elements: 50

</td></tr><tr><td>
Länge von XML-Bezeichnern (z. B. Elementnamen, Attributnamen,
Namespace-Präfixes, usw.): 200

</td></tr><tr><td>
Gesamtanzahl von Transformationen im Dokument: 64

</td></tr><tr><td>
Anzahl von Transformationen pro Reference-Element: 10

</td></tr><tr><td>
Element-Größe pro Einzelknoten im Base64-codierten Dokument: 30 MB

</td></tr></table>

<table><tr><th>
Dokument / Nachricht

</th><th>
Unerlaubte Inhalte

</th></tr><tr><td colspan="1" rowspan="5">
XML-Dokument

</td><td>
Es dürfen keine ENTITY-Deklarationen im XML-Dokument vorkommen.

</td></tr><tr><td>
Zu verifizierende XML-Dokumente dürfen im \<Transforms\>-Teil ihrer Referenzen
weder XPath-Ausdrücke noch XSL-Transformationen enthalten.

</td></tr><tr><td>
Bei Referenzen (ReferenceType) darf das optionale URI-Attribut keine
"xpointer()"-Ausdrücke enthalten.

</td></tr><tr><td colspan="1" rowspan="2">
XInclude-Mechanismen dürfen nicht verwendet werden. Elemente aus dem Namensraum

http://www.w3.org/2001/XInclude

 dürfen in XML-Dokumenten nicht enthalten sein.

</td></tr><tr></tr></table>

### 7 Anhang F – Übersicht Events

<table><tr><th>
Topic Ebene1

/Topic Ebene2

/Topic Ebene3

</th><th>
Typ

</th><th>
Schw

ere

</th><th>
Pr

ot

</th><th>
An

Cli

en

ts

</th><th>
Parameter

</th><th>
Bedeutung

</th><th>
Auslöser

(TUC/Op)

</th></tr><tr><td colspan="8">
Interne Mechanismen

</td></tr><tr><td>
BOOTUP

/

BOOTUP_COMPLETE

</td><td>
Op

</td><td>
Info

</td><td>
x

</td><td>
x

</td><td>
</td><td>
Änderung des Betriebszustandes

</td><td>
</td></tr><tr><td>
OPERATIONAL_STATE

/

EC_CardTerminal_Software_Out_Of_Date

($ctId)

</td><td>
Op

</td><td>
Info

</td><td>
x

</td><td>
x

</td><td>
Value=true/

false;

CtID=$ctId;

Bedeutung=

$EC.description

</td><td>
Änderung des Betriebszustandes

durch Änderung im

Fehlerzustand

(Änderung im

Value).

</td><td>
</td></tr><tr><td>
OPERATIONAL_STATE  
/EC_CardTerminal_gSMC-KT_Certificate_Expires_Soon($ctId)

</td><td>
Op

</td><td>
Info

</td><td>
x

</td><td>
x

</td><td>
Value=true/

false;

CtID=$ctId;

Bedeutung=

$EC.description

</td><td>
Änderung des Betriebszustandes

durch Änderung im

Fehlerzustand

(Änderung im

Value).

</td><td>
TUC_KON_050

</td></tr><tr><td>
OPERATIONAL_STATE

/

EC_Connector_Software_Out_Of_Date

</td><td>
Op

</td><td>
Info

</td><td>
x

</td><td>
x

</td><td>
Value=true/

false;

Bedeutung=

$EC.description

</td><td>
"

</td><td>
</td></tr><tr><td>
OPERATIONAL_STATE

/

EC_FW_Not_Valid_Status_Blocked

</td><td>
Sec

</td><td>
Fatal

</td><td>
x

</td><td>
x

</td><td>
Value=true/

false;

Bedeutung=

$EC.description

</td><td>
"

</td><td>
</td></tr><tr><td>
OPERATIONAL_STATE

/

EC_Time_Sync_Not_Successful

</td><td>
Op

</td><td>
Info

</td><td>
x

</td><td>
x

</td><td>
Value=true/

false;

LastSyncAttempt=

$lastSyncAttempt

Timestamp;

LastSyncSuccess=

$lastSyncSuccess

Timestamp;

Bedeutung=

$EC.description

</td><td>
"

</td><td>
</td></tr><tr><td>
OPERATIONAL_STATE

/

EC_TSL_Update_Not_Successful

</td><td>
Op

</td><td>
Info

</td><td>
x

</td><td>
x

</td><td>
Value=true/

false;

Bedeutung=

$EC.description;

LastUpdateTSL=

$lastUpdate

TSLTimestamp

</td><td>
"

</td><td>
</td></tr><tr><td>
OPERATIONAL_STATE

/

EC_TSL_Expiring

</td><td>
Sec

</td><td>
Info

</td><td>
x

</td><td>
x

</td><td>
Value=true/

false;

NextUpdateTSL=

$NextUpdate-

Element der TSL;

Bedeutung=

$EC.description

</td><td>
"

</td><td>
</td></tr><tr><td>
OPERATIONAL_STATE

/

EC_TSL_Trust_Anchor_Expiring

</td><td>
Sec

</td><td>
Info

</td><td>
x

</td><td>
x

</td><td>
Value=true/

false;

ExpiringDate

TrustAnchor=

Ablaufdatum

der Vertrauens

ankergültigkeit;

Bedeutung=

$EC.description

</td><td>
"

</td><td>
</td></tr><tr><td>
OPERATIONAL_STATE

/

EC_LOG_OVERFLOW

</td><td>
Op

</td><td>
Warning

</td><td>
x

</td><td>
x

</td><td>
Value=true/

false;

Protokoll=$Protokoll;

Bedeutung=

$EC.description

</td><td>
"

</td><td>
TUC_KON_271

</td></tr><tr><td>
OPERATIONAL_STATE

/

EC_CRL_Expiring

</td><td>
Sec

</td><td>
Warning

</td><td>
x

</td><td>
x

</td><td>
Value=true/

false;

NextUpdateTSL=

$NextUpdate-

Element der TSL;

Bedeutung=

$EC.description

</td><td>
"

</td><td>
</td></tr><tr><td>
OPERATIONAL_STATE

/

EC_Time_Sync_Pending_Warning

</td><td>
Sec

</td><td>
Warning

</td><td>
x

</td><td>
x

</td><td>
Value=true/

false;

LastSyncSuccess=

$lastSyncSuccess

Timestamp;

Bedeutung=

$EC.description

</td><td>
"

</td><td>
</td></tr><tr><td>
OPERATIONAL_STATE

/

EC_TSL_Out_Of_Date_Within_Grace_Period

</td><td>
Sec

</td><td>
Warning

</td><td>
x

</td><td>
x

</td><td>
Value=true/

false;

NextUpdateTSL=

$NextUpdate-

Element der TSL;

GracePeriodTSL=

CERT_TSL_

DEFAULT_GRACE_

PERIOD_DAYS;

Bedeutung=

$EC.description

</td><td>
"

</td><td>
</td></tr><tr><td>
OPERATIONAL_STATE

/

EC_CardTerminal_Not_Available($ctId)

</td><td>
Op

</td><td>
Error

</td><td>
x

</td><td>
x

</td><td>
Value=true/

false;

CtID=$ctId;

Bedeutung

=$EC.description

</td><td>
"

</td><td>
</td></tr><tr><td>
OPERATIONAL_STATE

/

EC_No_VPN_TI_Connection

</td><td>
Op

</td><td>
Error

</td><td>
x

</td><td>
x

</td><td>
Value=true/

false;

Bedeutung=

$EC.description

</td><td>
"

</td><td>
</td></tr><tr><td>
OPERATIONAL_STATE

/

EC_No_VPN_SIS_Connection

</td><td>
Op

</td><td>
Error

</td><td>
x

</td><td>
x

</td><td>
Value=true/

false;

Bedeutung=

$EC.description

</td><td>
"

</td><td>
</td></tr><tr><td>
OPERATIONAL_STATE

/

EC_No_Online_Connection

</td><td>
Op

</td><td>
Error

</td><td>
x

</td><td>
x

</td><td>
Value=true/

false;

Bedeutung=

$EC.description

</td><td>
"

</td><td>
</td></tr><tr><td>
OPERATIONAL_STATE

/

EC_IP_Adresses_Not_Available

</td><td>
Sec

</td><td>
Error

</td><td>
x

</td><td>
x

</td><td>
Value=true/

false;

Bedeutung=

$EC.description

</td><td>
"

</td><td>
</td></tr><tr><td>
OPERATIONAL_STATE

/

EC_CRL_Out_Of_Date

</td><td>
Sec

</td><td>
Fatal

</td><td>
x

</td><td>
x

</td><td>
Value=true/

false;

NextUpdateCRL=

$NextUpdate der CRL;

Bedeutung=

$EC.description

</td><td>
"

</td><td>
</td></tr><tr><td>
OPERATIONAL_STATE

/

EC_Firewall_Not_Reliable

</td><td>
Sec

</td><td>
Fatal

</td><td>
x

</td><td>
x

</td><td>
Value=true/

false;

Bedeutung=

$EC.description

</td><td>
"

</td><td>
</td></tr><tr><td>
OPERATIONAL_STATE

/

EC_Random_Generator_Not_Reliable

</td><td>
Sec

</td><td>
Fatal

</td><td>
x

</td><td>
x

</td><td>
Value=true/

false;

Bedeutung=

$EC.description

</td><td>
"

</td><td>
</td></tr><tr><td>
OPERATIONAL_STATE

/

EC_Secure_KeyStore_Not_Available

</td><td>
Sec

</td><td>
Fatal

</td><td>
x

</td><td>
x

</td><td>
Value=true/

false;

Bedeutung=

$EC.description

</td><td>
"

</td><td>
</td></tr><tr><td>
OPERATIONAL_STATE

/

EC_Security_Log_Not_Writable

</td><td>
Op

</td><td>
Fatal

</td><td>
x

</td><td>
x

</td><td>
Value=true/

false;

Bedeutung=

$EC.description

</td><td>
"

</td><td>
</td></tr><tr><td>
OPERATIONAL_STATE

/EC_Software_Integrity_Check_Failed

</td><td>
Sec

</td><td>
Fatal

</td><td>
x

</td><td>
x

</td><td>
Value=true/

false;

Bedeutung=

$EC.description

</td><td>
"

</td><td>
</td></tr><tr><td>
OPERATIONAL_STATE

/EC_Time_Difference_Intolerable

</td><td>
Sec

</td><td>
Fatal

</td><td>
x

</td><td>
x

</td><td>
Value=true/

false;

Bedeutung=

$EC.description;

NtpTimedifference=

Zeitabweichung;

NtpMaxAllowedTime

difference=

NTP_MAX_TIMEDIF

FERENCE;

Bedeutung=

$EC.description

</td><td>
"

</td><td>
</td></tr><tr><td>
OPERATIONAL_STATE

/EC_Time_Sync_Pending_Critical

</td><td>
Sec

</td><td>
Fatal

</td><td>
x

</td><td>
x

</td><td>
Value=true/

false;

LastSyncSuccess=

$lastSyncSuccess

Timestamp;

NtpGracePeriod=

NTP_GRACE_PERIOD;

Bedeutung=

$EC.description

</td><td>
"

</td><td>
</td></tr><tr><td>
OPERATIONAL_STATE

/EC_TSL_Trust_Anchor_Out_Of_Date

</td><td>
Sec

</td><td>
Fatal

</td><td>
x

</td><td>
x

</td><td>
Value=true/

false;

ExpiringDate

TrustAnchor=

Ablaufdatum der

Vertrauensanker

gültigkeit;

Bedeutung=

$EC.description

</td><td>
"

</td><td>
</td></tr><tr><td>
OPERATIONAL_STATE

/EC_TSL_Out_Of_Date_Beyond_Grace_Period

</td><td>
Sec

</td><td>
Fatal

</td><td>
x

</td><td>
x

</td><td>
Value=true/

false;

Next

UpdateTSL=

$NextUpdate-Element der TSL;

GracePeriodTSL=

CERT_TSL_ DEFAULT_

GRACE_PERIOD_DAYS;

Bedeutung=

$EC.description

</td><td>
"

</td><td>
</td></tr><tr><td>
OPERATIONAL_STATE

/

EC_CRYPTOPERATION_ALARM

</td><td>
Sec

</td><td>
Warning

</td><td>
x

</td><td>
x

</td><td>
Value=true/

false;

Operation=

$Operationsname;

Count=$Summenwert;

Arbeitsplatz

=$\<Liste operations-aufrufenden

workplace IDs\>;

Meldung=’

Auffällige

Häufung von

Operationsaufrufen in den letzten

10 Minuten’

</td><td>
"

</td><td>
</td></tr><tr><td>
OPERATIONAL_STATE

/

EC_OTHER_ERROR_STATE($no)

</td><td>
$Type

</td><td>
$Seve

rity

</td><td>
x

</td><td>
x

</td><td>
Value=true/

false;

Bedeutung=

$EC.description

</td><td>
"

</td><td>
</td></tr><tr><td>
OPERATIONAL_STATE

/

EC_BNetzA_VL_Update_Not_Successful

</td><td>
Op

</td><td>
Info

</td><td>
x

</td><td>
x

</td><td>
Value=true/

false;

LastUpdate

BNetzAVL=

$lastUpdateBNetzAVL

Timestamp;

Bedeutung=

$EC.description;

</td><td>
"

</td><td>
</td></tr><tr><td>
OPERATIONAL_STATE

/

EC_BNetzA_VL_not_valid

</td><td>
Sec

</td><td>
Warning

</td><td>
x

</td><td>
x

</td><td>
Value=true/

false;

NextUpdate

BNetzAVL=

$NextUpdate-Element der BNetzA-VL;

Bedeutung=

$EC.description;

</td><td>
"

</td><td>
</td></tr><tr><td>
OPERATIONAL_STATE

/

EC_FW_Update_Available

</td><td>
Op

</td><td>
Info

</td><td>
x

</td><td>
x

</td><td>
Bedeutung=  
$EC.description

</td><td>
I_KSRS_Download::list_  
Updates  
liefert mindestens eine  
UpdateInformation
mit einer UpdateInformation/Firmware/  
FWVersion \> aktuelle Version  
der
Konnektor- oder Kartenterminalsoftware

</td></tr><tr><td>
OPERATIONAL_STATE/EC_NK_Certificate_Expiring

</td><td>
Sec

</td><td>
Warning

</td><td>
x

</td><td>
x

</td><td>
Iccsn=$Iccsn;  
Serial=$Serialnumber;  
Bedeutung=  
$EC.description

</td><td>
Das C.NK.VPN-Zertifikat läuft bald ab.   
Systemzeit t \> (Ablaufdatum
von C.NK.VPN – 180 Tage)

</td></tr><tr><td>
OPERATIONAL_STATE  
/EC_NK_Certificate_Expired

</td><td>
Sec

</td><td>
Fatal

</td><td>
x

</td><td>
x

</td><td>
Iccsn=$Iccsn;  
Serial=$Serialnumber;  
Bedeutung=  
$EC.description

</td><td>
Das C.NK.VPN-Zertifikat ist abgelaufen.  
Systemzeit t \> Ablaufdatum
von C.NK.VPN

</td></tr><tr><td>
OPERATIONAL_STATE  
/EC_TLS_Client_Certificate_Security

</td><td>
Sec

</td><td>
Info

</td><td>
x

</td><td>
x

</td><td>
Bedeutung=  
$EC.description

</td><td>
Das für die Authentifizierung gegenüber dem Clientsystem konfigurierte
Zertifikat hat ein Sicherheitsniveau von weniger als 120bit. Zu verwenden ist
ein RSA -Zertifikat mit mindestens 3000 bit Schlüssellänge oder ein ECC
Zertifikat.

</td></tr><tr><td colspan="8">
Zugriffsberechtigungsdienst

</td></tr><tr></tr><tr><td colspan="8">
Dokumentvalidierungsdienst

</td></tr><tr></tr><tr><td colspan="8">
Dienstverzeichnisdienst

</td></tr><tr><td>
</td><td>
</td><td>
</td><td>
</td><td>
</td><td>
</td><td>
</td><td>
</td></tr><tr><td colspan="8">
Kartenterminaldienst

</td></tr><tr><td>
CT

/

ERROR

</td><td>
$Error

Type

</td><td>
$Seve

rity

</td><td>
x

</td><td>
x

</td><td>
CtID=$CT.ID;

Name=$CT.HOSTNAME;

Error=$Fehlercode;

Bedeutung=

$Fehlertext

</td><td>
Bei der Kommunikation mitdem KT ist ein Fehler aufgetreten

</td><td>
TUC_KON_051

TUC_KON_053

</td></tr><tr><td>
CT

/

CONNECTED

</td><td>
Op

</td><td>
Info

</td><td>
x

</td><td>
x

</td><td>
CtID=$CT.CTID;

Hostname=

$CT.HOSTNAME

</td><td>
Die Verbindung zu einem Kartenterminal wurde hergestellt

</td><td>
</td></tr><tr><td>
CT

/

DISCONNECTED

</td><td>
Op

</td><td>
Info

</td><td>
x

</td><td>
x

</td><td>
CtID=$CT.CTID;

Hostname=

$CT.HOSTNAME

</td><td>
Die Verbindung

zu einem Kartenterminal

wurde unterbrochen

</td><td>
</td></tr><tr><td>
CT

/

TLS_ESTABLISHMENT_FAILURE

</td><td>
$Error

Type

</td><td>
$Seve

rity

</td><td>
x

</td><td>
x

</td><td>
CtID = $CT.ID;

Name=$CT. HOSTNAME;

Error=$Fehlercode;

Bedeutung=

$Fehlertext

</td><td>
Im Rahmen des

Verbindungsaufbaus sind Fehler aufgetreten

</td><td>
TUC_KON_050

</td></tr><tr><td>
CT

/

CT_ADDING_ERROR

</td><td>
$Error

Type

</td><td>
$Seve

rity

</td><td>
x

</td><td>
x

</td><td>
IP=$IP-Adresse;

Name=$Hostname;

Error=$Fehlercode;

Bedeutung=

$Fehlertext

</td><td>
Bei dem Versuch ein KT der Verwaltung zuzufügen ist ein Fehler aufgetreten

</td><td>
TUC_KON_054

</td></tr><tr><td>
CT

/SLOT_FREE

</td><td>
Op

</td><td>
Info

</td><td>
-

</td><td>
-

</td><td>
CtID=$CT.CTID;

SlotNo=

$CT.SLOTS_USED[X]

</td><td>
Internes Event von Kartenterminaldienst

--\> Kartendienst.

Informiert, dass

ein Slot frei wurde. Wird im Kartendienst

ausgewertet und verursacht dort CARD/REMOVED

</td><td>
</td></tr><tr><td>
CT

/

SLOT_IN_USE

</td><td>
Op

</td><td>
Info

</td><td>
-

</td><td>
-

</td><td>
CtID=$CT.CTID;

SlotNo=\<FU-Nummer

aus Ereignisnachricht\>

</td><td>
Internes Event

von Kartenterminaldienst

--\> Kartendienst.

Informiert, dass

ein Slot belegt wurde. Wird im

Kartendienst

ausgewertet und verursacht dort

CARD/INSERTED

</td><td>
</td></tr><tr><td colspan="8">
Kartendienst

</td></tr><tr><td>
CARD

/

INSERTED

</td><td>
Op

</td><td>
Info

</td><td>
x

</td><td>
x

</td><td>
CardHandle=

$CARD.CARDHANDLE;

CardType=$CARD.TYP;

CardVersion=

$CARD.VER;

ICCSN=$CARD.ICCSN;

CtID=$CARD.CTID;

SlotID=

$CARD.SLOTID;

InsertTime=

$CARD.INSERTTIME;

CardHolderName=

$CARD.CARD

HOLDERNAME;

KVNR=$CARD.KVNR

</td><td>
Eine Karte wurde

gesteckt

</td><td>
TUC_KON_001

(als Reaktion auf

CTM

/SLOT_IN_USE)

</td></tr><tr><td>
CARD

/

REMOVED

</td><td>
Op

</td><td>
Info

</td><td>
x

</td><td>
x

</td><td>
CardHandle=

$CARD.CARDHANDLE;

CardType=$CARD.TYP;

CardVersion=

$CARD.VER;

ICCSN=$CARD.ICCSN;

CtID=$CARD.CTID;

SlotID=

$CARD.SLOTID;

InsertTime=

$CARD.INSERTTIME;

CardHolderName=

$CARD.CARDHOLDER

NAME;

KVNR=$CARD.KVNR

</td><td>
Eine Karte wurde

gezogen

</td><td>
Reaktion auf

CTM/SLOT_FREE

</td></tr><tr><td>
CARD

/

PIN

/

VERIFY_STARTED

</td><td>
Op

</td><td>
Info

</td><td>
-

</td><td>
x

</td><td>
</td><td>
</td><td>
</td></tr><tr><td>
CARD

/

PIN

/

VERIFY_FINISHED

</td><td>
Op

</td><td>
Info

</td><td>
-

</td><td>
x

</td><td>
</td><td>
</td><td>
</td></tr><tr><td>
CARD

/

PIN

/

CHANGE_STARTED

</td><td>
Op

</td><td>
Info

</td><td>
-

</td><td>
x

</td><td>
</td><td>
</td><td>
</td></tr><tr><td>
CARD

/

PIN

/

CHANGE_FINISHED

</td><td>
Op

</td><td>
Info

</td><td>
-

</td><td>
x

</td><td>
</td><td>
</td><td>
</td></tr><tr><td>
CARD

/

PIN

/

ENABLE_STARTED

</td><td>
Op

</td><td>
Info

</td><td>
-

</td><td>
x

</td><td>
CardHandle=$;

CardType=$;

ICCSN=$;

CtID=$;

SlotID=$;

PinRef=$PinRef;

PinInputCtID

=$PinInputKT

</td><td>
PIN-Schutz

anschalten beginnt

</td><td>
TUC_KON_027

</td></tr><tr><td>
CARD

/

PIN

/

ENABLE_FINISHED

</td><td>
Op

</td><td>
Info

</td><td>
-

</td><td>
x

</td><td>
CardHandle=$;

CardType=$;

ICCSN=$;

CtID=$;

SlotID=$;

PinRef=$PinRef;

PinInputCtID

=$PinInputKT

</td><td>
PIN-Schutz anschalten wurde beendet

</td><td>
TUC_KON_027

</td></tr><tr><td>
CARD

/

PIN

/

DISABLE_STARTED

</td><td>
Op

</td><td>
Info

</td><td>
-

</td><td>
x

</td><td>
CardHandle=$; CardType=$;

ICCSN=$;

CtID=$;

SlotID=$;

PinRef=$PinRef;

PinInputCtID

=$PinInputKT

</td><td>
PIN-Schutz ausschalten beginnt

</td><td>
TUC_KON_027

</td></tr><tr><td>
CARD

/

PIN

/

DISABLE_FINISHED

</td><td>
Op

</td><td>
Info

</td><td>
-

</td><td>
x

</td><td>
CardHandle=$; CardType=$;

ICCSN=$;

CtID=$;

SlotID=$;

PinRef=$PinRef;

PinInputCtID

=$PinInputKT

</td><td>
PIN-Schutz ausschalten wurde beendet

</td><td>
TUC_KON_027

</td></tr><tr><td colspan="8">
Systeminformationsdienst

</td></tr><tr><td>
</td><td>
</td><td>
</td><td>
</td><td>
</td><td>
</td><td>
</td><td>
</td></tr><tr><td colspan="8">
Verschlüsselungsdienst

</td></tr><tr><td>
</td><td>
</td><td>
</td><td>
</td><td>
</td><td>
</td><td>
</td><td>
</td></tr><tr><td colspan="8">
Signaturdienst

</td></tr><tr><td>
SIG

/

SIGNDOC

/

NEXT_SUCCESSFUL

</td><td>
Op

</td><td>
Info

</td><td>
-

</td><td>
X

</td><td>
$Jobnummer

</td><td>
Die nächste Signatur aus einem

Signaturstapel wurde erfolgreich

erstellt.

</td><td>
TUC_KON_166

„nonQES Signaturen

erstellen“

TUC_KON_154

„QES Signaturen erstellen“

</td></tr><tr><td colspan="8">
Zertifikatsdienst

</td></tr><tr><td>
CERT

/

TSL

/

IMPORT

</td><td>
Op

</td><td>
Error

</td><td>
x

</td><td>
-

</td><td>
$Fehlerbeschreibung

</td><td>
Manueller Import der

TSL fehlgeschlagen

</td><td>
TUC_KON_032

"TSL aktualisieren"

</td></tr><tr><td>
CERT

/

TSL

/

UPDATED

</td><td>
Op

</td><td>
Info

</td><td>
x

</td><td>
-

</td><td>
</td><td>
Eine neue TSL

wurde erfolgreich in den TrustStore eingespielt

</td><td>
TUC_KON_032

"TSL aktualisieren"

</td></tr><tr><td>
CERT

/

CRL

/

INVALID

</td><td>
Op

</td><td>
Error

</td><td>
x

</td><td>
-

</td><td>
</td><td>
Prüfung der Signatur

der CRL fehlgeschlagen

</td><td>
TUC_KON_040

"CRL aktualisieren"

</td></tr><tr><td>
CERT

/

CRL

/

IMPORT

</td><td>
Op

</td><td>
Error

</td><td>
x

</td><td>
-

</td><td>
$Fehlerbeschreibung

</td><td>
Manueller Import der CRL fehlgeschlagen

</td><td>
TUC_KON_040

"CRL aktualisieren"

</td></tr><tr><td>
CERT

/

CRL

/

UPDATED

</td><td>
Op

</td><td>
Info

</td><td>
x

</td><td>
-

</td><td>
</td><td>
Die CRL wurde

erfolgreich aktualisiert

</td><td>
TUC_KON_040

"CRL aktualisieren"

</td></tr><tr><td>
CERT

/

CARD

/

EXPIRATION

</td><td>
Op

</td><td>
Warning

</td><td>
x

</td><td>
x

</td><td>
CARD_TYPE=gSMC-K;

ICCSN=$ICCSN;

Konnektor=

$MGM_KONN_HOSTNAME;

ZertName=\<Name des Zertifikatsobjekts\>;

Expiration

Date=$validity

</td><td>
gSMC-K abgelaufen

</td><td>
TUC_KON_033

"Zertifikatsablauf prüfen"

</td></tr><tr><td>
CERT

/CARD

/

EXPIRATION

</td><td>
Op

</td><td>
Warning

</td><td>
-

</td><td>
x

</td><td>
CARD_TYPE=$Type;

ICCSN=$ICCSN;

CARD_HANDLE=

$CardHandle;

CardHolderName=

$CardHolderName;

ZertName=\<Name des Zertifikatsobjekts\>;

ExpirationDate=

$validity

</td><td>
Sonstige Karte abgelaufen

</td><td>
TUC_KON_033

"Zertifikatsablauf prüfen"

</td></tr><tr><td>
CERT

/

CARD

/

EXPIRATION

</td><td>
Op

</td><td>
Info

</td><td>
-

</td><td>
x

</td><td>
CARD_TYPE=gSMC-K;

ICCSN=$ICCSN;

Konnektor=

$MGM_KONN_HOSTNAME;

ZertName=\<Name des Zertifikatsobjekts\>;

ExpirationDate=

$validity;

DAYS_LEFT=

$validity-$Today

</td><td>
gSMC-K läuft innerhalb von

DAYS_LEFT Tagen ab

</td><td>
TUC_KON_033

"Zertifikatsablauf prüfen"

</td></tr><tr><td>
CERT

/CARD

/

EXPIRATION

</td><td>
Op

</td><td>
Info

</td><td>
-

</td><td>
x

</td><td>
CARD_TYPE=$Type;

ICCSN=$ICCSN;

CARD_HANDLE=

$CardHandle;

CardHolderName=

$CardHolderName;

ZertName=\<Name des Zertifikatsobjekts\>;

ExpirationDate=

$validity;

DAYS_LEFT=

$validity-$Today

</td><td>
Sonstige Karte läuft innerhalb von DAYS_LEFT Tagen ab

</td><td>
TUC_KON_033

"Zertifikatsablauf prüfen"

</td></tr><tr><td>
CERT

/

BNETZA_VL

/

UPDATED

</td><td>
Op

</td><td>
Info

</td><td>
x

</td><td>
-

</td><td>
</td><td>
Eine neue BNetzA-VL wurde erfolgreich in den TrustStore eingespielt

</td><td>
TUC_KON_031

" BNetzA-VL aktualisieren"

</td></tr><tr><td>
CERT

/

BNETZA_VL

/

IMPORT

</td><td>
Op

</td><td>
Error

</td><td>
x

</td><td>
-

</td><td>
$Fehlerbeschreibung

</td><td>
Manueller Import der

BNetzA-VL fehlgeschlagen

</td><td>
TUC_KON_031

" BNetzA-VL aktualisieren"

</td></tr><tr><td colspan="8">
Protokollierungsdienst

</td></tr><tr><td>
LOG

/

ERROR

</td><td>
$Error

Type

</td><td>
$Seve

rity

</td><td>
-

</td><td>
-

</td><td>
Error=$Fehlercode

</td><td>
Im Protokollierungsdienst auftretende Fehler werden verteilt

</td><td>
TUC_KON_271

</td></tr><tr><td>
LOG

/

CRYPTO_OP

</td><td>
Sec

</td><td>
Info

</td><td>
x

</td><td>
-

</td><td>
Operation=

$Operationsname;

\<für alle betroffenen Schlüssel:\>

Karte=$ICCSN;

Keyref=\<Referenz auf den Schlüssel\>;

CARD_HANDLE=

$CardHandle;

CardHolderName=

$CardHolderName

</td><td>
</td><td>
</td></tr><tr><td colspan="8">
TLS-Dienst

</td></tr><tr><td>
</td><td>
</td><td>
</td><td>
</td><td>
</td><td>
</td><td>
</td><td>
</td></tr><tr><td colspan="8">
Anbindung LAN/WAN

</td></tr><tr><td>
ANLW

/

LAN

/IP_CHANGED

</td><td>
Op

</td><td>
Warning

</td><td>
x

</td><td>
-

</td><td>
IP=$dieNeueIP

</td><td>
Wenn der LAN-Adapter eine neue IP oder Netzwerk bekommen hat

</td><td>
DHCP,

Management

schnittstelle

</td></tr><tr><td>
ANLW

/

WAN

/IP_CHANGED

</td><td>
Op

</td><td>
Info

</td><td>
x

</td><td>
-

</td><td>
IP=$dieNeueIP

</td><td>
Wenn der WAN-Adapter eine neue IP oder Netzwerk bekommen hat

</td><td>
DHCP,

Management

schnittstelle

</td></tr><tr><td colspan="8">
DHCP-Server

</td></tr><tr><td>
DHCP

/

SERVER

/

STATECHANGED

</td><td>
Op

</td><td>
Info

</td><td>
x

</td><td>
x

</td><td>
STATE=

$DHCP_SERVER_STATE

</td><td>
</td><td>
Administrator

</td></tr><tr><td colspan="8">
DHCP Client

</td></tr><tr><td>
DHCP

/LAN_CLIENT

/

RENEW

</td><td>
Op

</td><td>
Info

</td><td>
x

</td><td>
x

</td><td>
IP_ADDRESS=

\<Belegung\>

</td><td>
</td><td>
TUC_KON_341

</td></tr><tr><td>
DHCP

/

WAN_CLIENT

/

RENEW

</td><td>
Op

</td><td>
Info

</td><td>
x

</td><td>
x

</td><td>
IP_ADDRESS=

\<Belegung\>

</td><td>
</td><td>
TUC_KON_341

</td></tr><tr><td>
DHCP

/LAN_CLIENT

/

STATECHANGED

</td><td>
Op

</td><td>
Info

</td><td>
x

</td><td>
x

</td><td>
STATE=

$DHCP_CLIENT_

LAN_STATE

</td><td>
</td><td>
</td></tr><tr><td>
DHCP

/

WAN_CLIENT

/

STATECHANGED

</td><td>
Op

</td><td>
Info

</td><td>
x

</td><td>
x

</td><td>
STATE=

$DHCP_CLIENT_

WAN_STATE

</td><td>
</td><td>
</td></tr><tr><td colspan="8">
VPN-Client

</td></tr><tr><td>
NETWORK

/VPN_TI

/

UP

</td><td>
Op

</td><td>
Info

</td><td>
x

</td><td>
x

</td><td>
</td><td>
Wenn der VPN-Tunnel zur TI erfolgreich aufgebaut

worden ist.

</td><td>
</td></tr><tr><td>
NETWORK

/VPN_TI

/

DOWN

</td><td>
Op

</td><td>
Info

</td><td>
x

</td><td>
x

</td><td>
</td><td>
Wenn der VPN-Tunnel zur TI nicht mehr zur Verfügung steht.

</td><td>
AFO

</td></tr><tr><td>
NETWORK

/VPN

/

CONFIG_CHANGED

</td><td>
Op

</td><td>
Info

</td><td>
x

</td><td>
-

</td><td>
</td><td>
Wenn die Konfiguration des VPN-Clients angepasst wurde.

</td><td>
Management

schnittstelle

</td></tr><tr><td>
NETWORK

/VPN_SIS

/

UP

</td><td>
Op

</td><td>
Info

</td><td>
x

</td><td>
x

</td><td>
</td><td>
Wenn der VPN-Tunnel zum

SIS erfolgreich aufgebaut worden ist.

</td><td>
</td></tr><tr><td>
NETWORK

/VPN_SIS

/

DOWN

</td><td>
Op

</td><td>
Info

</td><td>
x

</td><td>
x

</td><td>
</td><td>
Wenn der VPN-Tunnel zum SIS nicht mehr zur

Verfügung steht.

</td><td>
AFO

</td></tr><tr><td colspan="8">
Zeitdienst

</td></tr><tr><td>
NTP

/

ENTERCRITICALSTATE

</td><td>
Op

</td><td>
FATAL

</td><td>
x

</td><td>
-

</td><td>
MESSAGE=

„CRITICALTIME

DEVIATION”

</td><td>
Zeitabweichung von mehr als einer Stunde entdeckt

</td><td>
</td></tr><tr><td colspan="8">
Namensdienst und Dienstlokalisierung

</td></tr><tr><td>
</td><td>
</td><td>
</td><td>
</td><td>
</td><td>
</td><td>
</td><td>
</td></tr><tr><td colspan="8">
Leistungsumfänge und Standalone-Szenarios

</td></tr><tr><td>
MGM

/

ADMINCHANGES

</td><td>
Op

</td><td>
Info

</td><td>
x

</td><td>
-

</td><td>
User=

$AdminUsername;

RefID=$ReferenzID;

NewVal=

$NeuEingestellter

Wert“

</td><td>
Änderungen die der Admin vornimmt werden protokolliert

</td><td>
</td></tr><tr><td>
MGM

/

CONFIG_EXIMPORT

</td><td>
Op

</td><td>
Info

</td><td>
x

</td><td>
-

</td><td>
User=

$AdminUsername;

Mode=

[Export/Import]

</td><td>
Dokumentiert (via Mode), dass die Konnektor

konfiguration

exportiert oder importiert wurde.

</td><td>
</td></tr><tr><td>
MGM

/

FACTORYSETTINGS

</td><td>
Op

</td><td>
Info

</td><td>
x

</td><td>
-

</td><td>
User=

$AdminUsername

</td><td>
Ein ausgelöster Werksreset wird protokolliert

</td><td>
</td></tr><tr><td>
MGM

/

REMOTE_SESSION

</td><td>
Op

</td><td>
Info

</td><td>
x

</td><td>
-

</td><td>
InitUser=

$AdminUsername;

RemoteID=\<Kennung der Gegenstelle\>;

Mode=

[InitSuccess/

InitFail/Exit]

</td><td>
Protokollierung des Versuchs, des Beginns und des Endes einer Remote-

Management Session

</td><td>
</td></tr><tr><td>
MGM

/

LU_CHANGED

/

LU_ONLINE

</td><td>
Op

</td><td>
Info

</td><td>
x

</td><td>
x

</td><td>
Active=

$MGM_LU_ONLINE

</td><td>
Leistungsumfang Online wurde aktiviert/

deaktiviert

</td><td>
Administrator

</td></tr><tr><td>
MGM

/

LU_CHANGED

/

LU_SAK

</td><td>
Op

</td><td>
Info

</td><td>
x

</td><td>
x

</td><td>
Active=

$MGM_LU_SAK

</td><td>
Leistungsumfang Signatur

anwendungs

komponente wurde aktiviert/deaktiviert

</td><td>
Administrator

</td></tr><tr><td>
MGM

/

STANDALONE_CHANGED

</td><td>
Op

</td><td>
Info

</td><td>
x

</td><td>
x

</td><td>
Active=

$MGM_STANDALONE_KON

</td><td>
Festlegung des Konnektors als "Alleinstehend"

wurde geändert

</td><td>
Administrator

</td></tr><tr><td colspan="8">
In- und Außerbetriebnahme, Registrierung

</td></tr><tr><td>
MGM

/

TI_ACCESS_GRANTED

</td><td>
Op

</td><td>
Info

</td><td>
x

</td><td>
x

</td><td>
Active=

$MGM_TI_ACCESS_

GRANTED

</td><td>
Der Konnektor wurde erfolgreich freigeschaltet

</td><td>
Administrator  
TUC_KON_411

</td></tr><tr><td>
SMC_K/REGISTER/ERROR

</td><td>
Op

</td><td>
Error

</td><td>
x

</td><td>
x

</td><td>
Iccsn=$Iccsn;  
Serial=$SerialnumberNK;  
Operation=Register | Deregister; 

Fail=No_Smcb | Other

</td><td>
Fehler bei Registrierung

</td><td>
TUC_KON_411

</td></tr><tr><td colspan="8">
Software- Aktualisierungsdienst (KSR-Client)

</td></tr><tr><td>
KSR

/

ERROR

</td><td>
$Error

Type

</td><td>
$Seve

rity

</td><td>
x

</td><td>
x

</td><td>
Target=Konnektor;

Name=

\<MGM_KONN_HOSTNAME\>;

Error=$Fehlercode;

Bedeutung=

$Fehlertext

</td><td>
Während der Konnektor

aktualisierung ist ein Fehler aufgetreten

</td><td>
TUC_KON_280

</td></tr><tr><td>
KSR

/

ERROR

</td><td>
$Error

Type

</td><td>
$Seve

rity

</td><td>
x

</td><td>
x

</td><td>
Target=KT;

Name=

\<KT-Friendly Name\>;

CtID=$ctID;

Error=$Fehlercode;

Bedeutung=

$Fehlertext

</td><td>
Während einer Kartenterminal

aktualisierung ist ein Fehler aufgetreten

</td><td>
TUC_KON_281

</td></tr><tr><td>
KSR

/

ERROR

</td><td>
$Error

Type

</td><td>
$Seve

rity

</td><td>
x

</td><td>
x

</td><td>
Error=$Fehlercode;

Bedeutung=

$Fehlertext

</td><td>
Im KSR-Client ist ein Fehler aufgetreten

</td><td>
TUC_KON_282

</td></tr><tr><td>
KSR

/

UPDATE

/

START

</td><td>
Sec

</td><td>
Info

</td><td>
x

</td><td>
x

</td><td>
für TUC_KON_280

Target=Konnektor;

Name=

\<MGM_KONN_HOSTNAME\>

für TUC_KON_281

Target=KT;

CtID=$CtID

</td><td>
Ein Updateprozess im Konnektor wird gestartet, Ziel Konnektor oder Kartenterminal

</td><td>
TUC_KON_280

TUC_KON_281

</td></tr><tr><td>
KSR

/

UPDATE

/

SUCCESS

</td><td>
Sec

</td><td>
Info

</td><td>
x

</td><td>
x

</td><td>
für TUC_KON_280

Target=Konnektor;

Name=

\<MGM_KONN_HOSTNAME\>;

NewFirmwareversion=

\<UpdateInformation.

FirmwareVersion\>;

ConfigurationChanged

=\<Ja/Nein\>;

ManualInputNeeded=

\<Ja/Nein\>

für TUC_KON_281

Target=KT;

Name=

\<KT-FriendlyName\>;

CtID=$ctID;

NewFirmwareversion=

\<UpdateInformation.

FirmwareVersion\>

</td><td>
Die Firmware des Konnektors/

eines Kartenterminals wurde erfolgreich aktualisiert

</td><td>
TUC_KON_280

TUC_KON_281

</td></tr><tr><td>
KSR

/

UPDATE

/

END

</td><td>
Sec

</td><td>
Info

</td><td>
x

</td><td>
x

</td><td>
für TUC_KON_280

Target=Konnektor;

Name=

\<MGM_KONN_HOSTNAME\>

für TUC_KON_281

Target=KT;

CtID=$CtID

</td><td>
Ein Updateprozess im Konnektor wurde beendet

</td><td>
TUC_KON_280

TUC_KON_281

</td></tr><tr><td>
KSR

/

UPDATE

/

KONNEKTOR_DOWNLOAD_END

</td><td>
Op

</td><td>
Info

</td><td>
x

</td><td>
x

</td><td>
Je heruntergeladenem FW-Paket:

ProductVendorID=

$UpdateInformation/

ProductVendorID;

 

ProductCode=

$UpdateInformation/

ProductCode;

 

ProductName=

$UpdateInformation/

ProductName;

 

FirmwareVersion=

$UpdateInformation/

Firmware/FWVersion;

 

Deadline=

$UpdateInformation/

DeploymentInformation/

Deadline;

 

FWPriority=

$UpdateInformation/

Firmware/FWPriority;

 

FirmwareReleaseNotes=

$UpdateInformation/

Firmware/

FirmwareReleaseNotes

</td><td>
Download der Konnektor Firmware abgeschlossen

</td><td>
TIP1-A_6025

</td></tr><tr><td>
KSR

/

UPDATES_AVAILABLE

</td><td>
Op

</td><td>
Info

</td><td>
-

</td><td>
x

</td><td>
Je gefundenem

FW-Paket:

ProductVendorID=

$UpdateInformation/

ProductVendorID;

ProductCode=

$UpdateInformation/

ProductCode;

ProductName=

$UpdateInformation/

ProductName;

FirmwareVersion=

$UpdateInformation/

FirmwareVersion;

Deadline=

$UpdateInformation/

DeploymentInformation/

Deadline;

 

FWPriority=

$UpdateInformation/

Firmware/FWPriority;

FirmwareReleaseNotes=

$UpdateInformation/

Firmware/

FirmwareReleaseNotes

</td><td>
Ein oder mehrere Updates auf neuere Versionen sind verfügbar

</td><td>
TIP1-A_4836

</td></tr><tr><td>
KSR

/UPDATE_KONFIG

</td><td>
Op

</td><td>
Info

</td><td>
x

</td><td>
-

</td><td>
AlteVersion, NeueVersion

</td><td>
Aktualisierung Bestandsnetze

</td><td>
TUC_KON_283

</td></tr></table>

Die Abbildungsvorschrift von Fehler- auf Event-Type lautet:

 ---> UL

### 8 Anhang H – Mapping von „Architektur der TI-Plattform“ auf Konnektorspezifikation

<table><tr><th>
Interface

</th><th>
Operation

</th><th>


</th><th>
Funktionsmerkmal

</th><th>
Interface

</th></tr><tr><td>
I_Cert_Verification

</td><td>
verify_Certificate

</td><td>


</td><td>
Zertifikatsdienst

</td><td>
TUC_KON_037

"Zertifikat prüfen"

</td></tr><tr><td rowspan="2">
I_Crypt_Operations

</td><td>
decrypt_Document

</td><td>


</td><td rowspan="2">
Verschlüsselungsdienst

</td><td>
TUC_KON_071

"Daten hybrid entschlüsseln"

</td></tr><tr><td>
encrypt_Document

</td><td>


</td><td>
TUC_KON_070

"Daten hybrid verschlüsseln"

</td></tr><tr><td rowspan="3">
I_DNS_Name_Information

</td><td>
get_FQDN

</td><td>


</td><td rowspan="2">
Namensdienst und Dienstlokalisierung

</td><td>
TUC_KON_364

„DNS Reverse Lookup

durchführen“

</td></tr><tr><td>
get_IP_Address

</td><td>


</td><td>
TUC_KON_361

„DNS Namen auflösen“

</td></tr><tr><td>
get_Service_Information

</td><td>


</td><td>
Namensdienst und

Dienstlokalisierung

</td><td>
TUC_KON_362

„Liste der Dienste abrufen“

TUC_KON_363

„Dienstdetails

abrufen“

</td></tr><tr><td>
I_IP_Transport

</td><td>
send_Data_TI

</td><td>


</td><td>
</td><td>
</td></tr><tr><td>
I_KT_Operations

</td><td>
interact_with_User

</td><td>


</td><td>
Kartenterminaldienst

</td><td>
TUC_KON_051

"Mit Anwender über

Kartenterminal interagieren"

</td></tr><tr><td rowspan="2">
I_KV_Card_Handling

</td><td>
discard_Card_Usage_Reference

</td><td>


</td><td>
---

</td><td>
--- keine Umsetzung

notwendig.

Erfolgt implizit

</td></tr><tr><td>
get_Card_Usage_Reference

</td><td>


</td><td>
---

</td><td>
--- keine Umsetzung

notwendig.

Erfolgt implizit

</td></tr><tr><td rowspan="15">
I_KV_Card_Operations

</td><td>
decrypt_Data

</td><td>


</td><td rowspan="3">
Kartendienst

</td><td>
TUC_KON_219

"Entschlüssele"

</td></tr><tr><td>
do_Reset

</td><td>


</td><td>
TUC_KON_024

"Karte zurücksetzen"

</td></tr><tr><td>
erase_Card_Data

</td><td>


</td><td>
TUC_KON_211

„LöscheRecordInhalt“

TUC_KON_204

„LöscheDateiInhalt“

</td></tr><tr><td>
extract_card_data

</td><td>


</td><td>
Zertifikatsdienst

</td><td>
TUC_KON_034

"Zertifikatsinformationen

extrahieren"

</td></tr><tr><td>
read_Card_Data

</td><td>


</td><td rowspan="11">
Kartendienst

</td><td>
TUC_KON_202

"LeseDatei"

</td></tr><tr><td>
</td><td>


</td><td>
TUC_KON_209

"LeseRecord"

</td></tr><tr><td>
</td><td>


</td><td>
TUC_KON_215

"SucheRecord"

</td></tr><tr><td>
read_KVK

</td><td>


</td><td>
TUC_KON_202

"Lese Datei"

</td></tr><tr><td>
send_APDU

</td><td>


</td><td>
TUC_KON_200

"SendeAPDU"

</td></tr><tr><td>
sign_Data

</td><td>


</td><td>
TUC_KON_218

"Signiere"

</td></tr><tr><td>
verify_eGK

</td><td>


</td><td>
TUC_KON_018

"eGK-Sperrung prüfen"

</td></tr><tr><td>
write_Card_Data

</td><td>


</td><td>
TUC_KON_203

"SchreibeDatei"

</td></tr><tr><td>
</td><td>


</td><td>
TUC_KON_210

"SchreibeRecord"

</td></tr><tr><td>
</td><td>


</td><td>
TUC_KON_214

"FügeHinzuRecord"

</td></tr><tr><td>
write_eGK_Protocol

</td><td>


</td><td>
TUC_KON_006

"Datenzugriffsaudit eGK schreiben"

</td></tr><tr><td>
I_KV_Card_Reservation

</td><td>
handle_Session

</td><td>


</td><td>
Kartendienst

</td><td>
TUC_KON_023

"Karte reservieren"

</td></tr><tr><td rowspan="8">
I_KV_Card_Unlocking

</td><td>
authorize_Card

</td><td>


</td><td rowspan="8">
Kartendienst

</td><td>
TUC_KON_005

"Card-to-Card authentisieren"

</td></tr><tr><td>
change_PIN

</td><td>


</td><td>
TUC_KON_019

"PIN ändern"

</td></tr><tr><td>
enable_PIN

disable_PIN

</td><td>


</td><td>
TUC_KON_027

„PIN-Schutz ein-/

ausschalten”

</td></tr><tr><td>
do_C2C

</td><td>


</td><td>
TUC_KON_005

"Card-to-Card

authentisieren"

</td></tr><tr><td>
get_PIN_Status

</td><td>


</td><td>
TUC_KON_022

"Liefere PIN-Status"

</td></tr><tr><td>
initialize_PIN

</td><td>


</td><td>
TUC_KON_019

"PIN ändern"

</td></tr><tr><td>
unblock_PIN

</td><td>


</td><td>
TUC_KON_021

"PIN entsperren"

</td></tr><tr><td>
verify_PIN

</td><td>


</td><td>
TUC_KON_012

"PIN verifizieren"

</td></tr><tr><td>
I_Notification_From_FM

</td><td>
notify

</td><td>


</td><td>
Systeminformationsdienst

</td><td>
TUC_KON_256

"Systemereignis

absetzen"

</td></tr><tr><td>
I_Local_Storage

</td><td>
write_Data

read_Data

erase_Data

</td><td>


</td><td>
Konnektormanagement

</td><td>
TIP1-A_5484

</td></tr><tr><td rowspan="3">
I_Poll_System_Information

</td><td>
get_Ressource_Information

</td><td>


</td><td rowspan="3">
Systeminformationsdienst

</td><td>
TUC_KON_254

"Liefere

Ressourcendetails"

</td></tr><tr><td>
get_Ressource_List

</td><td>


</td><td>
TUC_KON_252

"Liefere KT_Liste"

</td></tr><tr><td>
get_Ressource_List

</td><td>


</td><td>
TUC_KON_253

"Liefere Karten_Liste"

</td></tr><tr><td>
I_Reg_Notification

</td><td>
register_for_Notifications

</td><td>


</td><td>
---

</td><td>
--- keine Umsetzung

notwendig.

Erfolgt implizit

</td></tr><tr><td>
I_Role_Information

</td><td>
get_Role

</td><td>


</td><td>
Kartendienst

</td><td>
TUC_KON_036

„LiefereFachlicheRolle“

</td></tr><tr><td rowspan="2">
I_SAK_Operations

</td><td>
sign_Document_QES

</td><td>


</td><td rowspan="2">
Signaturdienst

</td><td>
TUC_KON_150

„Dokumente QES

signieren“

</td></tr><tr><td>
verify_Document_QES

</td><td>


</td><td>
TUC_KON_151

"QES Dokumentensignatur prüfen"

</td></tr><tr><td rowspan="4">
I_Sign_Operations

</td><td>
sign_Document

</td><td>


</td><td rowspan="3">
Signaturdienst

</td><td>
TUC_KON_160

„Dokumente nonQES signieren“

</td></tr><tr><td>
external_Authenticate

</td><td>


</td><td>
TUC_KON_160

„Dokumente nonQES signieren“

</td></tr><tr><td>
verify_Document

</td><td>


</td><td>
TUC_KON_161

„nonQES Dokumentsignatur prüfen“

</td></tr><tr><td>
get_Certificate

</td><td>


</td><td>
Kartendienst

</td><td>
TUC_KON_216

„LeseZertifikat“

</td></tr><tr><td rowspan="2">
I_Symm_Crypt_Operations

</td><td>
decrypt_Document_Symmetric

</td><td>


</td><td rowspan="2">
Verschlüsselungsdienst

</td><td>
TUC_KON_073

"Daten symmetrisch

entschlüsseln"

</td></tr><tr><td>
encrypt_Document_Symmetric

</td><td>


</td><td>
TUC_KON_072

"Daten symmetrisch

verschlüsseln"

</td></tr><tr><td>
I_Synchronised_System_Time

</td><td>
get_Time

</td><td>


</td><td>
Zeitdienst

</td><td>
TUC_KON_351

"Liefere Systemzeit"

</td></tr><tr><td rowspan="3">
I_TLS_Client

</td><td>
send_Secure

</td><td>


</td><td rowspan="2">
TLS-Dienst

</td><td>
TUC_KON_110

"Kartenbasierte

TLS-Verbindung

aufbauen"

</td></tr><tr><td>
</td><td>


</td><td>
TUC_KON_111

"Kartenbasierte

TLS-Verbindung

abbauen"

</td></tr><tr><td>
</td><td>


</td><td>
Anbindung LAN/WAN

</td><td>
AFOs: Routing

der IP-Pakete von

Fachmodul

(=Konnektor intern)

--\> VPN_TI

</td></tr><tr><td rowspan="4">
I_Directory_Query

</td><td>
search_Directory

</td><td>


</td><td rowspan="4">
LDAP-Proxy

</td><td>
TUC_KON_290

„LDAP-Verbindung

aufbauen“

</td></tr><tr><td>
</td><td>


</td><td>
TUC_KON_291

„Verzeichnis abfragen“

</td></tr><tr><td>
</td><td>


</td><td>
TUC_KON_292

„LDAP-Verbindung

trennen"

</td></tr><tr><td>
</td><td>


</td><td>
TUC_KON_293

„Verzeichnisabfrage

abbrechen"

</td></tr><tr><td rowspan="2">
I_KSRC_FM_Support

</td><td>
list_available_Packages

</td><td>


</td><td rowspan="2">
Software-Aktualisierung

(KSR-Client)

</td><td>
TUC_KON_285

„UpdateInformationen für Fachmodul beziehen"

</td></tr><tr><td>
load_Package

</td><td>


</td><td>
TUC_KON_286

„Paket für Fachmodul laden“

</td></tr></table>

<table><tr><th>
Interface

</th><th>
Operation

</th><th>


</th><th>
Funktionsmerkmal

</th><th>
Interface:Operation

</th></tr><tr><td rowspan="2">
I_Crypt_Operations

</td><td>
decrypt_Document

</td><td>


</td><td rowspan="2">
Verschlüsselungsdienst

</td><td>
EncryptionService

:DecryptDocument

</td></tr><tr><td>
encrypt_Document

</td><td>


</td><td>
EncryptionService

:EncryptDocument

</td></tr><tr><td rowspan="2">
I_DNS_Name_Resolution

</td><td>
get_FQDN

</td><td>


</td><td rowspan="2">
Namensdienst und Dienstlokalisierung

</td><td>
GetFQDN

</td></tr><tr><td>
get_IP_Address

</td><td>


</td><td>
GetIPAddress

</td></tr><tr><td>
I_IP_Transport

</td><td>
send_Data_External

</td><td>


</td><td>
Anbindung LAN/WAN

</td><td>
AFOs:

Routing der IP-Pakete von Client

--\> VPN_SIS

</td></tr><tr><td rowspan="2">
I_KV_Card_Handling

</td><td>
discard_Card_Usage_Reference

</td><td>


</td><td>
---

</td><td>
--- keine Umsetzung notwendig.

Erfolgt implizit

</td></tr><tr><td>
get_Card_Usage_Reference

</td><td>


</td><td>
---

</td><td>
--- keine Umsetzung

notwendig.

Erfolgt implizit

</td></tr><tr><td rowspan="7">
I_KV_Card_Unlocking

</td><td>
change_PIN

</td><td>


</td><td rowspan="7">
Kartendienst

</td><td>
CardService

:ChangePin

</td></tr><tr><td>
disable_PIN

</td><td>


</td><td>
CardService

:EnablePin

</td></tr><tr><td>
enable_PIN

</td><td>


</td><td>
CardService

:DisablePin

</td></tr><tr><td>
get_PIN_Status

</td><td>


</td><td>
CardService

:GetPinStatus

</td></tr><tr><td>
initialize_PIN

</td><td>


</td><td>
CardService

:ChangePin

</td></tr><tr><td>
unblock_PIN

</td><td>


</td><td>
CardService

:UnblockPin

</td></tr><tr><td>
verify_PIN

</td><td>


</td><td>
CardService

:VerifyPin

</td></tr><tr><td rowspan="3">
I_Poll_System_Information

</td><td>
get_Ressource_Information

</td><td>


</td><td rowspan="3">
Systeminformationsdienst

</td><td>
EventService

:GetResourceInformation

</td></tr><tr><td>
get_Ressource_List

</td><td>


</td><td>
EventService

:GetCardTerminals

</td></tr><tr><td>
get_Ressource_List

</td><td>


</td><td>
EventService

:GetCards

</td></tr><tr><td rowspan="3">
I_Reg_Notification

</td><td>
register_for_Notifications

</td><td>


</td><td rowspan="3">
Systeminformationsdienst

</td><td>
EventService

:Subscribe

</td></tr><tr><td>
</td><td>


</td><td>
EventService

:Unsubscribe

</td></tr><tr><td>
</td><td>


</td><td>
EventService

:GetSubscription

</td></tr><tr><td rowspan="2">
I_SAK_Operations

</td><td>
sign_Document_QES

</td><td>


</td><td rowspan="2">
Signaturdienst

</td><td>
SignatureService

:SignDocument

</td></tr><tr><td>
verify_Document_QES

</td><td>


</td><td>
SignatureService

:VerifyDocument

</td></tr><tr><td rowspan="4">
I_Sign_Operations

</td><td>
sign_Document

</td><td>


</td><td rowspan="2">
Signaturdienst

</td><td>
SignatureService

:SignDocument

</td></tr><tr><td>
verify_Document

</td><td>


</td><td>
SignatureService

:VerifyDocument

</td></tr><tr><td>
external_Authenticate

</td><td>


</td><td>
Authentifizierungsdienst

</td><td>
AuthSignatureService

:ExternalAuthenticate

</td></tr><tr><td>
get_Certificate

</td><td>


</td><td>
Zertifikatsdienst

</td><td>
CertificateService

:ReadCardCertificate

</td></tr><tr><td>
I_NTP_Time_Information

</td><td>
sync_Time

</td><td>


</td><td>
Zeitdienst

</td><td>
I_NTP_Time_Information

:sync_Time

</td></tr><tr><td>
I_Directory_Query

</td><td>
search_Directory

</td><td>


</td><td>
LDAP-Proxy

</td><td>
LDAP-Operation

(TIP1-A_5521)

</td></tr></table>

<table><tr><th>
Interface

</th><th>
Operation

</th><th>


</th><th>
Funktionsmerkmal

</th><th>
Interface:Operation

</th></tr><tr><td rowspan="2">
I_Notification

</td><td>
notify

</td><td>


</td><td>
SICCT

</td><td>
Ereignisdienst

:SICCT-Ereignisnachrichten

</td></tr><tr><td>
</td><td>


</td><td>
SICCT

</td><td>
Ereignisdienst

:ServiceAnnouncement

</td></tr></table>

<table><tr><th>
Interface

</th><th>
Operation

</th><th>
-\>

</th><th>
Funktionsmerkmal

</th><th>
Interface:Operation

</th></tr><tr><td>
I_Change_System_Time

</td><td>
set_System_Time

</td><td>
-\>

</td><td>
Zeitdienst

</td><td>
TIP1-A_4793

Konfigurierbarkeit des

Konnektor NTP-Servers

</td></tr><tr><td rowspan="3">
I_Facade_Access_Configuration

</td><td>
add_Clientsystem

</td><td rowspan="3">
-\>

</td><td rowspan="3">
Fachliche Anbindung der

Clientsysteme

</td><td rowspan="3">
TIP1-A_4518

Konfiguration der Anbindung Clientsysteme

</td></tr><tr><td>
remove_Clientsystem

</td></tr><tr><td>
set_CS_Access_Mode

</td></tr><tr><td>
I_KSRC_Local_Management

</td><td>
do_local_Update

</td><td>
-\>

</td><td>
Software-Aktualisierung

(KSR-Client)

</td><td>
TUC_KON_280 "Konnektoraktualisierung

durchführen"

</td></tr><tr><td rowspan="3">
I_KSRC_Management

</td><td rowspan="2">
do_Update

</td><td rowspan="3">
-\>

</td><td rowspan="3">
Software-Aktualisierung

(KSR-Client)

</td><td>
TUC_KON_280 "Konnektoraktualisierung durchführen"

</td></tr><tr><td>
TUC_KON_281

"Kartenterminalaktualisierung anstoßen"

</td></tr><tr><td>
list_available_Updates

</td><td>
TUC_KON_282

"Update Informationen beziehen"

</td></tr><tr><td rowspan="4">
I_KTV_Management

</td><td rowspan="4">
configure_KTs

</td><td rowspan="4">
-\>

</td><td rowspan="4">
Kartenterminalverwaltung

</td><td>
Managementschnittstelle

:TIP1-A_4555

Manuelles Hinzufügen eines Kartenterminals

</td></tr><tr><td>
Managementschnittstelle

:TIP1-A_4540

Reaktion auf KT Service

Announcement

</td></tr><tr><td>
Managementschnittstelle

:TIP1-A_4556

Pairing mit Kartenterminal

durchführen

</td></tr><tr><td>
Managementschnittstelle

:TIP1-A_4557

Ändern der Korrelationswerte eines Kartenterminals

</td></tr></table>

### 9 Anhang I – Umsetzungshinweise (informativ)

In diesem Anhang finden sich Darstellungen und Informationen, die ein
Konnektorhersteller zur Umsetzung der normativen Anforderungen in ein konkretes
Produkt berücksichtigen kann. Sie wurden im Rahmen der Erhebung der normativen
Anforderungen erarbeitet, um die Umsetzbarkeit der Anforderungen zu bestätigen.

Dieser Anhang soll als Unterstützung für eine Umsetzung verstanden werden und
erhebt keinen Anspruch auf Korrektheit und Vollständigkeit.

### 9.1 Systemüberblick

### 9.1.1 – Hinweise zur Sicherheitsevaluierung nach Common Criteria

Gemäß dem Sicherheitskonzept des Konnektors [gemKPT_Sich_Kon] muss die
Software des Konnektors nach Common Criteria (CC) evaluiert und geprüft werden.

Diese Software erbringt Sicherheitsleistungen in zwei wesentlichen
Funktionsblöcken. Durch diese Aufteilung ist es möglich, dass die einzelnen
Funktionsblöcke zeitlich voneinander unabhängig bzw. sogar von
unterschiedlichen Herstellern implementiert, evaluiert und geprüft werden
können. Es werden zwei Schutzprofile (Protection Profile) für die
Funktionsblöcke des Konnektors erstellt. Es handelt sich dabei um die
Schutzprofile des Netzkonnektors (KONN.NK) sowie des Anwendungskonnektors
(KONN.AK) inklusive der Signaturanwendungskomponente. Das Schutzprofil des
Sicherheitsmoduls für den Konnektor (SM-K) wird in diesem Kapitel nicht
betrachtet.

Diese Schutzprofile definieren eine implementierungsunabhängige Menge von
Sicherheitsanforderungen für die einzelnen Konnektorfunktionsblöcke bzw.
Konnektorbestandteile. Anhand dieser Schutzprofile werden von den Herstellern
der Konnektoren die Sicherheitsvorgaben (Security Targets) für die konkreten
Umgebungen erstellt, welche als Eingangsdokumente für den
Zertifizierungsprozess der jeweiligen konkreten Komponenten eingesetzt werden.
Diese zu evaluierenden Komponenten werden als Evaluierungsgegenstand (EVG)
bezeichnet.

### 9.1.1.1 Separationsmechanismen des Konnektors

Damit es nach einer erfolgreichen Evaluierung eines Konnektors auch weiterhin
möglich bleibt, Software oder Daten, die keinen direkten Einfluss auf
Sicherheitsfunktionen der EVGs aufweisen, ohne eine Re-Evaluierung definiert
auszutauschen, hinzuzufügen oder zu erweitern, ist eine Separation der
Komponenten des EVG dringend anzuraten.

Implementiert der Hersteller keine bzw. nicht ausreichende
Separationsmechanismen, so ist bei bestimmten Update-Arten von einer
aufwändigen Re-Evaluierung des entsprechenden EVGs auszugehen. Die Separation
dient also der Trennung zwischen ausführbarem Code des EVG, welcher
Sicherheitsfunktionen umsetzt, und zusätzlichem ausführbarem Code auf dem
Konnektor, welcher keine Sicherheitsfunktionen umsetzt.

Die Wahl der Separationsmechanismen steht dem Hersteller frei und muss in den
Sicherheitsvorgaben für den EVG beschrieben und als solcher evaluiert werden.
Aus diesen Sicherheitsvorgaben ergibt sich auch, welche Update-Arten bei
welchen Separationsmechanismen eine Re-Evaluierung des EVG erfordern und wie
aufwendig diese Re-Evaluierung ausfällt.

Unter diese Update-Arten können beispielsweise – je nach
Konnektorarchitektur, CC-Dokumentation oder Konnektorimplementierung –
Bestandteile des unter dem Konnektor arbeitenden Betriebsystems, die
Installation dezentraler Komponenten von Fachlogik oder Konfigurationsdaten des
Konnektors fallen.

Als Beispiel für Separationsmechanismen sei auf die folgende informative
Aufzählung verwiesen, welche jedoch keinen Anspruch auf Vollständigkeit
besitzen kann und nur mögliche Alternativen aufzeigt:

 ---> UL

Je nach gewähltem Architekturansatz des Herstellers sind nicht alle hier
genannten Alternativen für die Separation des EVG auf dem Konnektor anwendbar.

Insbesondere sollte der Hersteller den eigentlichen Update-Prozess und die
dafür verantwortliche Komponente mit besonderer Sorgfalt beschreiben,
spezifizieren und implementieren. Bei einer fehlerhaften Implementierung dieser
Komponente besteht die Gefahr einer Schwächung oder des Ausschaltens von
Sicherheitsfunktionen des EVG. Die Update-Komponente muss eine sichere
Zuweisung der Updates zu den separierten Bestandteilen des EVGs gewährleisten.
Auch ist zu betonen, dass der EVG immer die Integrität der Daten des Updates
und die Authentizität des Absenders prüfen muss, bevor ein Update akzeptiert
wird. Der Update-Komponente muss somit besondere Beachtung geschenkt werden.

### 9.1.1.2 Granularität der TSF

Die TSF (TOE Security Functionality) eines EVG besteht aus Subsystemen und
Modulen, wobei ein Modul die genaueste Beschreibung einer Funktionalität
darstellt und unterhalb der Subsysteme angesiedelt ist. Subsysteme beschreiben
das Design des EVG und können wiederum – je nach Komplexität eines EVGs –
aus weiteren Subsystemen bestehen. Ein Entwickler sollte außer der
Modulbeschreibung keine weiteren Informationen zur Implementierung der dort
beschriebenen Funktionalität benötigen.

Die Subsysteme und Module der TSF gliedern sich in drei Klassen:

   (a) SFR-Enforcing Subsysteme und Module. Hierunter fallen die Subsysteme und

        Module, welche eine funktionale Sicherheitsanforderung direkt
durchsetzen.

   (b) SFR-Supporting Subsysteme und Module. Hierunter fallen die Subsysteme
und

        Module, welche bei der Durchsetzung einer funktionalen
Sicherheitsanforderung

        unterstützend wirken.

   (c) SFR-Non-Interfering Subsysteme und Module. Hierunter fallen die
Subsysteme

        und Module, welche keine Leistung bei der Erfüllung einer
funktionalen

        Sicherheitsanforderung erbringen.

Sollte nach einer erfolgreichen CC-Evaluierung eines Konnektors die
Notwendigkeit zur Änderung der Software des Konnektors gegeben sein, so ist
unter Umständen eine Re-Evaluierung des EVG erforderlich. Diese Notwendigkeit
kann sich aus der Behebung von nachträglich erkannten Fehlern, aufgetretenen
Sicherheitslücken, Schwächen eines Standardverfahrens oder einer
erforderlichen Erweiterung der Funktionalität ergeben.

Im Rahmen der Aufzählung der Anforderungen an die Beschreibung des EVG-Design
(ADV_TDS) wird bereits die Aufteilung der TSF auf Subsysteme und Module
beschrieben. Trotzdem soll hiermit ausdrücklich geraten werden, die Aufteilung
der TSF auf die Subsysteme und Module selbst und die Aufteilung der Subsysteme
und Module auf die drei o. g. Klassen möglichst feingranular durchzuführen.

Denn so

 ---> OL

### 9.2 Übergreifende Festlegungen

### 9.2.1 Interne Mechanismen

### 9.2.1.1 Zufallszahlen und Schlüssel

Der Konnektor kann zur Erzeugung von Zufallszahlen und Einmalschlüsseln einen
Hardware- oder Software-Generator verwenden. Als Quelle für Zufallszahlen kann
der Konnektor die gSMC-K verwenden.

### 9.3 Funktionsmerkmale

### 9.3.1 Anwendungskonnektor

### 9.3.1.1 Administration des Informationsmodells

Wie die Administration der persistenten Entitäten und Beziehungen des
Informationsmodells im Detail über die bereitzustellende
Administrationsoberfläche erfolgt, entscheidet der Hersteller.

Es wird folgende Reihenfolge für die Pflege des Informationsmodells empfohlen.

 ---> OL

### 9.3.1.2 Vorgehensvariante für das Handling von CardSessions

Das in der [TIP1-A_4560] „Rahmenbedingungen für Kartensitzungen“ geforderte
Verhalten, ließe sich über folgenden Mechanismus umsetzen:

Verschiedene Clientsystem (oder verschiedene Nutzer an einem Clientsystem)
möchten auf Daten der über CardHandle adressierten Smartcard zugreifen.

Für die Zugriffe müssen, je nach Definition der Zugriffsbedingung in der
Zielkarte, bestimmte Sicherheitszustände erreicht werden (durch Verifikation
einer PIN oder durch C2C). Diese erreichten Sicherheitszustände werden
innerhalb einer Karte jeweils an einen logischen Kanäle (bzw. den Basiskanal)
gebunden, d. h., das Erhöhen oder Absenken eines Sicherheitszustands wirkt
nicht außerhalb des logischen Kanals, in dem die Veränderung verursacht wurde.

Finden nun Clientsystemzugriffe in unterschiedlichen Kontexten (Mandant,
Clientsystem, Arbeitsplatz und Nutzer verschieden) auf die gleiche Karte statt,
so muss sichergestellt sein, dass PIN-Eingaben und durchgeführte C2C nur für
den Kontext wirksam sind, in welchem sie durchgeführt wurden. Dies ließe sich
erreichen, wenn jeder Kontext auf einen eigenen logischen Kanal der Karte
abgebildet würde. Leider unterstützen der HBA und die SMC-B nur vier, die eGK
nur einen logischen Kanal. Mehrere gleichzeitige unterschiedliche Kontexte
wären somit nicht möglich.

Eine mögliche Lösung für beliebig viele gleichzeitige Kontexte:

![Abbildung-23][Abbildung-23]

Der Kartendienst fungiert als Multiplexer. Er spiegelt die Zugriffsrechte der
Karte und wendet deren Regeln selbständig gegen die unterschiedlichen Zugriffe
durch Clientsysteme an.

Für jedes Card-Objekt wird „in Richtung Clientsystem“ pro Kontext genau
eine CardSession erzeugt und verwaltet. Zugriffe des Clientsystems erfolgen
somit „im Kontext“ einer CardSession.

In Richtung Karte verwendet das Card-Object genau zwei Kanäle (zwei logische
oder einen logischen und einen Basiskanal):

 ---> UL

In jeder CardSession werden die in ihrem Kontext erreichten Sicherheitszustände
vermerkt. Das Vorgehen für die Durchführung der Verifikationen und des
Vermerkens der erreichten Sicherheitszustände, sowie der Datenzugriffe folgt
folgenden Regeln (hier für PIN-Verifikation, sinngleich auch für C2C):

 ---> UL

Diese Regeln führen dazu, dass eine durch CardSession Y fehlgeschlagene
Verifikation für PinRef_A die zuvor erfolgreich durch CardSession X
durchgeführt Verifikation nicht beeinflusst. Kartenzugriffe auf dem Datenkanal
sind für CardSession X weiterhin möglich, da der Verlust des erhöhten
Sicherheitszustands durch fehlerhafte Verifikation immer nur im
Verifikationskanal erfolgt.

Dieser Mechanismus funktioniert mit zwei Kanälen zu einer Karte für beliebig
viele CardSessions.

### 9.3.1.3 Darstellung von Terminal-Anzeigen auf einem Kartenterminal

Hiweise für die korrekte Verwendung der zur Verfügung stehenden Datenobjekte
(DO) zur Darstellung von Terminal-Anzeigen an einem Kartenterminal finden sich
in SICCT- (insbesondere in [SICCT#5.5.10.19] und [SICCT#5.5.10.21]) und
eHealth-Kartenterminal-Spezifikationen.

### 10 Anhang K – Szenarien im dezentralen Umfeld

Die folgenden Szenarien für den Einsatz der Produkte der Telematikinfrastruktur
beschreiben informativ Varianten und Optionen, die durch die Spezifikationen
abgedeckt werden.

Die vorliegenden Abbildungen in diesem Anhang fokussieren auf das dezentrale
Umfeld und verzichten daher auf die Darstellung der zentralen Anteile, wie das
zentrale Netzwerk der Telematikinfrastruktur, welches über den
„VPN-Konzentrator TI“ erreichbar ist.

Der Konnektor, sowie die Netzwerkkomponenten Switch und IAG (Internet Access
Gateway) sind in den folgenden Szenarien zum Schutz vor unerlaubtem Zugriff
gemäß den Annahmen des Sicherheitskonzeptes vor unbefugten physischen
Zugriffen geschützt installiert.

Die folgenden Abschnitte stellen jeweils ein Szenario in der Übersicht als
Diagramm, eine Beschreibung sowie eine kurze Auflistung der Voraussetzungen und
Auswirkungen dar.

### 10.1 Szenario 1: Einfache Installation ohne spezielle Anforderungen und ohne bestehende Infrastruktur

![Abbildung-24][Abbildung-24]

### 10.1.1 Beschreibung des Szenarios

Abbildung 25 zeigt ein einfaches Szenario für das dezentrale Umfeld. Es wird
der Konnektor als Default-Gateway für jegliche IP-Kommunikation aus dem LAN in
das WAN eingesetzt. Dabei übernimmt der Konnektor das Routing der
Kommunikation in das Internet über den SIS (Secure Internet Service) und in
die an die TI angeschlossenen Bestandsnetze. Die Bezeichnung IAG (Internet
Access Gateway) steht für die Geräte, die den Internetzugang ermöglichen und
typischerweise vom Internet Service Provider (ISP) zur Verfügung gestellt
werden (z.B. DSL Router und DSL Modem).

Ein oder mehrere Clientsysteme können über den Konnektor Anwendungsfälle der
Telematikinfrastruktur initiieren und über den Konnektor und die zentrale
TI-Plattform in Bestandsnetze kommunizieren (rote gestrichelte Linie). Dabei
ist die Nutzung der Anwendungsfälle der Telematikinfrastruktur je nach
Konfiguration des Konnektors entweder nur authentifizierten Clients möglich
oder beliebigen Clients.

In diesem einfachen Szenario werden über ein einziges Kartenterminal die SMC-B,
der HBA und auch die eGK des Versicherten gelesen, es können dazu alternativ
auch mehrere Kartenterminals genutzt werden.

Darüber hinaus können die Clientsysteme über den SIS (Secure Internet
Service) auf Dienste des Internets zugreifen.

### 10.1.2 Voraussetzungen

 ---> UL

### 10.1.3 Auswirkungen

 ---> UL

### 10.2 Szenario 2: Installation mit mehreren Behandlungsräumen

![Abbildung-25][Abbildung-25]

### 10.2.1 Beschreibung des Szenarios

Mit der in Szenario 1 skizzierten Topologie kann auch ein Szenario bedient
werden, bei dem mehrere Behandlungsräume unterstützt werden (siehe Abbildung
26). Dabei ist in jedem Behandlungsraum mindestens ein Kartenterminal
vorzusehen, so dass die eGK gelesen werden kann.

Auf die Darstellung der Kommunikationswege in zentrale Netze wurde in Abbildung
26 verzichtet, da sich hier keine Änderung gegenüber Szenario 1 ergibt.

Durch die Ressourcenverwaltung des Konnektors wird sichergestellt, dass bei
Anwendungsfällen diejenigen Kartenterminals angesprochen werden, welche dem
Arbeitsplatz zugeordnet sind, von dem aus der Anwendungsfall initiiert wurde.

### 10.2.2 Voraussetzungen

 ---> UL

### 10.2.3 Auswirkungen

 ---> UL

### 10.3 Szenario 3: Integration in bestehende Infrastruktur ohne Netzsegmentierung

![Abbildung-26][Abbildung-26]

### 10.3.1 Beschreibung des Szenarios

Im Falle einer bereits vorhandenen Infrastruktur im dezentralen Bereich können
die Produkte der TI, insbesondere der Konnektor, so in die Infrastruktur
integriert werden, dass Bestandsanwendungen bereits erprobte Kommunikationswege
weiter nutzen können.

Wie in Abbildung 27 beispielhaft dargestellt, existiert bereits eine
Infrastruktur, die sowohl einen Internetzugang für die Arbeitsplätze
ermöglicht (gestrichelte Linie in türkis), als auch eine Nebenstelle über
VPN anbindet (gestrichelte Linie in blau). In diesem Fall wird der Konnektor
als zusätzliches Gerät an das bestehende Netzwerk angeschlossen und nutzt den
bereits vorhandenen Internetanschluss zur Kommunikation in die TI.

Für die Clientsysteme muss in diesem Szenario je nach individuellem
Anforderungsprofil entschieden werden, ob das jeweilige Clientsystem über die
Telematikinfrastruktur kommunizieren können soll und den gesicherten
Internetzugang (SIS) nutzen soll oder nicht.

Soll ein Clientsysteme nicht über die Telematikinfrastruktur kommunizieren,
bleibt der IAG als Default-Gateway dieses Clientsystems konfiguriert. In diesem
Fall routet der IAG die eingehenden IP-Pakete mit öffentlichen Zieladressen
weiter in das Internet. Die gestrichelte Linie in türkis zeigt beispielhaft
einen Zugriff in das Internet.

Soll ein Clientsystem über die Telematikinfrastruktur kommunizieren oder den
gesicherten Internetzugang (SIS) nutzen, muss der Konnektor als Default-Gateway
konfiguriert werden. In diesem Fall routet der Konnektor die eingehenden
IP-Pakete, die nicht für ihn bestimmt sind, entweder durch den VPN-Tunnel der
TI über die Telematikinfrastruktur in ein angeschlossenes Bestandsnetz,
(gestrichelte Linie in rot) oder durch den VPN-Tunnel zum SIS (Secure Internet
Service) in das Internet (gestrichelte Linie in grün). Sollte kein sicherer
Internetzugang konfiguriert sein, so würde der Konnektor den Traffic verwerfen
und ggf. per ICMP dem Client eine anderes Gateway (IAG) vorschlagen. Alternativ
können die von den Clients benötigten Routing-Informationen manuell oder per
DHCP konfiguriert werden.

### 10.3.2 Voraussetzungen

 ---> UL

### 10.3.3 Auswirkungen

 ---> UL

### 10.4 Szenario 4: Integration in bestehende Infrastruktur mit Netzsegmentierung

![Abbildung-27][Abbildung-27]

### 10.4.1 Beschreibung des Szenarios

Das vorliegende Szenario skizziert eine etwas komplexere dezentrale Umgebung, in
der das Netzwerk segmentiert ist und dedizierte Router als Default-Gateway für
die Clientsysteme genutzt werden. In diesem Fall kann die Konfiguration der
Clients unverändert bleiben und der Konnektor wird als zusätzliches Gerät in
das Netzwerk integriert und dem Router bekanntgemacht als Gateway für den
sicheren Internetzugang und den Zugang zu den an die Telematikinfrastruktur
angeschlossenen Bestandsnetze.

### 10.4.2 Voraussetzungen

 ---> UL

### 10.4.3 Auswirkungen

 ---> UL

### 10.5 Szenario 5: Zentral gesteckter HBA

![Abbildung-28][Abbildung-28]

### 10.5.1 Beschreibung des Szenarios

Dieses Szenario zeichnet sich dadurch aus dass ein HBA nicht durch seinen
Inhaber mitgeführt und am Arbeitsplatz gesteckt wird, sondern zentral und
geschützt vor unbefugten physischen Zugriffen gesteckt bleibt.

Der HBA-Inhaber greift über jeden konfigurierten Arbeitsplatz auf seinen HBA
zu. Die Remote-PIN-Eingabe erfolgt unter Verwendung des lokal am Arbeitsplatz
vorhandenen eHealth-Kartenterminals.

Die Mechanismen zum Zugriff auf eine zentral gesteckte SMC-B funktionieren
analog zum HBA.

### 10.5.2 Voraussetzungen

Folgende zusätzliche Punkte müssen erfüllt sein, um dieses Szenario
umzusetzen:

 ---> UL

### 10.5.3 Auswirkung

 ---> UL

### 10.6 Szenario 6: Installation mit zentralem PS

![Abbildung-29][Abbildung-29]

### 10.6.1 Beschreibung des Szenarios

Das Szenario skizziert eine dezentrale Konfiguration, bei der das Primärsystem
aus einem Serveranteil „PS Server“ und mehreren Clientanteilen „PS
Client“ besteht. Die Anbindung zwischen dem „PS Server“ und den „PS
Clients“ ist herstellerspezifisch. Der „PS Server“ fungiert als ein
einziges Clientsystem gegenüber der TI bzw. dem Konnektor (z.B. als
Terminalserver). Die Clientsystemschnittstelle des Konnektors wird
ausschließlich vom „PS Server“ genutzt. Der „PS Server“ muss bei der
Kommunikation mit dem Konnektor eine Übersetzung der zugreifenden „PS
Clients“ auf die entsprechende Entität „Arbeitsplatz“ des Konnektors
durchführen

Beispielhaft zeigt das Szenario zwei Arbeitsplätze mit jeweils einem
Kartenterminal für die eGK sowie zentral gesteckte SMC-B und HBAs. Alternativ
sind auch lokal am Arbeitsplatz gesteckte HBAs möglich.

### 10.6.2 Voraussetzungen

 ---> UL

### 10.6.3 Auswirkungen

 ---> UL

### 10.7 Szenario 7: Mehrere Mandanten

![Abbildung-30][Abbildung-30]

### 10.7.1 Beschreibung des Szenarios

Das Szenario skizziert eine dezentrale Konfiguration, bei der mehrere Mandanten
vorhanden sind, wobei jedem Mandant eine eigene SMC-B zugeordnet ist. Die
SMC-Bs sind zentral zusammen mit dem Konnektor geschützt vor unbefugten
physischen Zugriffen installiert. Die Komponenten Arbeitplätze, Clientsysteme
und Kartenterminals müssen eine Zuordnung zum Mandanten haben, wobei
Zuordnungen zu mehreren Mandaten möglich sind. Das Beispiel zeigt einen
Arbeitplatz mit „Clientsystem 1“ und „KT 1“, der zu unterschiedlichen
Zeiten durch verschiedene Mandaten verwendet wird. Zum Zeitpunkt T=t1 greift
ein Anwender 1 mit HBA 1 über einen Anwendungsfall im Kontext Mandat 1 auf die
TI zu, wobei der Versicherte 1 mit eGK 1 am Anwendungsfall beteiligt ist. Zum
Zeitpunkt T=t2 wird ein anderer Anwendungsfall im Kontext von Mandat 2 durch
einen Anwender 2 ohne HBA initiiert, wobei der Versicherte 2 mit eGK 2 am
Anwendungsfall beteiligt ist. Das Clientsystem stellt hierbei den
Mandantenbezug sowie die Nutzer Authentisierung sicher. Als Variante können
auch mehrere Mandanten eine Zuordnung zu einer einzelnen SMC-B haben. Weiterhin
können auch in diesem Szenario HBAs zentral gesteckt werden.

### 10.7.2 Voraussetzungen

 ---> UL

### 10.7.3 Auswirkungen

 ---> UL

### 10.8 Szenario 9: Standalone Konnektor - Physische Trennung

![Abbildung-31][Abbildung-31]

### 10.8.1 Beschreibung des Szenarios

Dieses Szenario stellt eine Variante des Standalone-Szenarios dar, bei dem eine
physische Trennung der Konnektoren eingesetzt wurde.

Im Standalone-Szenario besteht eine Trennung zwischen den Praxissystemen der
dezentralen Umgebung, welche offline (also, ohne Anbindung an die zentrale
TI-Plattform) betrieben werden und den für das Update der eGK durch die
Fachanwendung VSDM notwendigen Komponenten, welche online (also, mit Verbindung
in die zentrale TI-Plattform) betrieben werden.

Die physische Trennung im Standalone-Szenario zeichnet sich dadurch aus, dass
getrennte Komponenten zum Einsatz kommen. Der Online-Konnektor ist mit der
zentralen TI-Plattform verbunden und ermöglicht das VSDM Update der eGKs. Ein
am Online-Konnektor angebundener Kommunikations-PC kann darüber hinaus über
den sicheren Internetzugang der TI auf das Internet und über den
VPN-Konzentrator TI auf Bestandsnetze zugreifen.

Sollten die Online-/Offline-Systeme nicht netztechnisch voneinander getrennt
sein, so obliegt es dem Administrator der Praxissysteme sicherzustellen, dass
die netztechnische Verbindung keine Gefährdung für die Praxissysteme zur
Folge hat.

Im Offline-Konnektor sind einzelne Funktionen nicht verfügbar, andere haben
einen eingeschränkten Funktionsumfang. So kann z.B. eine QES erzeugt oder
geprüft aber dabei keine aktuelle Statusauskunft (OCSP-Response) für die
eingesetzten Zertifikate eingeholt werden. Dies hat zur Folge, dass bei
Erzeugung einer QES keine Statusauskunft für das Signaturzertifikat in die
Signatur eingebettet werden kann und bei einer Prüfung der QES nur eine
eventuell in die Signatur eingebettet Statusauskunft des Zertifikats
berücksichtigt werden kann.

Der Nutzer muss in diesem Fall selber entscheiden ob der gebotene
Funktionsumfang für seinen Anwendungsfall ausreichend ist.

### 10.8.2 Voraussetzungen

Folgende zusätzliche Punkte müssen erfüllt sein, um dieses Szenario
umzusetzen:

 ---> UL

### 10.8.3 Auswirkung

 ---> UL

### 11 Anhang L – Datentypen von Eingangs- und Ausgangsdaten

<table><tr><th>
Typname

</th><th>
Werteliste

</th></tr><tr><td>
[Boolean]

</td><td>
{true | false}

</td></tr><tr><td>
[EncryptionType]

</td><td>
{CMS | XMLEnc | S/MIME}

</td></tr><tr><td>
[EventType]

</td><td>
{Op | Sec | Perf}

</td></tr><tr><td>
[EventSeverity]

</td><td>
{Debug | Info | Warn | Err | Fatal}

</td></tr><tr><td>
[KtOutputMode]

</td><td>
{Input | OutputWait | OutputConfirm | OutputKeep | OutputErase}

</td></tr><tr><td>
[PinStatus]

</td><td>
{VERIFIED | VERIFYABLE | BLOCKED | TRANSPORT_PIN | EMPTY_PIN | DISABLED}

</td></tr><tr><td>
[PinResult]

</td><td>
{OK | REJECTED | BLOCKED | ERROR}

</td></tr><tr><td>
[PukResult]

</td><td>
{OK | REJECTED | BLOCKED | ERROR}

</td></tr><tr><td>
[VerificationResult]

</td><td>
{VALID | INVALID | INCONCLUSIVE}

</td></tr></table>





[Dokumentinformationen]: #dokumentinformationen
[Inhaltsverzeichnis]:    #inhaltsverzeichnis
[1]:                     #1-einordnung-des-dokumentes
[1.1]:                   #11-zielsetzung
[1.2]:                   #12-zielgruppe
[1.3]:                   #13-geltungsbereich
[1.4]:                   #14-abgrenzung-des-dokuments
[1.5]:                   #15-methodik
[1.5.1]:                 #151-anforderungen
[1.5.2]:                 #152-offene-punkte
[1.5.3]:                 #153-erläuterungen-zur-spezifikation-des-außenverhaltens
[1.5.4]:                 #154-erläuterungen-zur-dokumentenstruktur-und-dokumentenmechanismen
[1.5.4.1]:               #1541-modulare-spezifikation-über-funktionsmerkmale
[1.5.4.2]:               #1542-technische-use-cases---tucs
[1.5.4.3]:               #1543-event-mechanismus
[1.5.4.4]:               #1544-konfigurationsparameter-und-zustandswerte
[2]:                     #2-systemüberblick
[2.1]:                   #21-logische-struktur
[2.2]:                   #22-sicherer-datenspeicher
[2.3]:                   #23-überblick-konnektoridentität
[2.4]:                   #24-mandantenfähigkeit
[2.5]:                   #25-versionierung
[2.6]:                   #26-fachanwendungen
[2.7]:                   #27-netzseitige-einsatzszenarien
[2.7.1]:                 #271-parameter-anlw_anbindungs_modus
[2.7.2]:                 #272-parameter-anlw_internet_modus
[2.8]:                   #28-lokale-und-entfernte-kartenterminals
[2.9]:                   #29-standalone-szenario
[3]:                     #3-übergreifende-festlegungen
[3.1]:                   #31-allgemeine-übergreifende-festlegungen
[3.1.1]:                 #311-dokumentformate
[3.1.2]:                 #312-kartentypen
[3.1.3]:                 #313-übergreifende-festlegungen-zum-aufbau-von-sicheren-verbindungen
[3.2]:                   #32-konnektoridentität-und-gsmc-k
[3.2.1]:                 #321-organisatorische-anforderungen-und-sperrprozesse
[3.3]:                   #33-bootup-phase
[3.4]:                   #34-betriebszustand
[3.4.1]:                 #341-betriebsaspekte
[3.5]:                   #35-fachliche-anbindung-der-clientsysteme
[3.5.1]:                 #351-betriebsaspekte
[3.6]:                   #36-clientsystemschnittstelle
[3.6.1]:                 #361-soap-schnittstelle
[3.6.2]:                 #362-statusrückmeldung-und-fehlerbehandlung
[3.6.3]:                 #363-transport-großer-dokumente
[3.7]:                   #37-verwendung-manuell-importierter-ca-zertifikate
[3.8]:                   #38-testunterstützung
[4]:                     #4-funktionsmerkmale
[4.1]:                   #41-anwendungskonnektor
[4.1.1]:                 #411-zugriffsberechtigungsdienst
[4.1.1.1]:               #4111-funktionsmerkmalweite-aspekte
[4.1.1.2]:               #4112-durch-ereignisse-ausgelöste-reaktionen
[4.1.1.3]:               #4113-interne-tucs-nicht-durch-fachmodule-nutzbar
[4.1.1.4]:               #4114-interne-tucs-auch-durch-fachmodule-nutzbar
[4.1.1.4.1]:             #41141-tuc_kon_000-prüfe-zugriffsberechtigung
[4.1.1.5]:               #4115-operationen-an-der-außenschnittstelle
[4.1.1.6]:               #4116-betriebsaspekte
[4.1.2]:                 #412-dokumentvalidierungsdienst
[4.1.2.1]:               #4121-funktionsmerkmalweite-aspekte
[4.1.2.2]:               #4122-durch-ereignisse-ausgelöste-reaktionen
[4.1.2.3]:               #4123-interne-tucs-nicht-durch-fachmodule-nutzbar
[4.1.2.4]:               #4124-interne-tucs-auch-durch-fachmodule-nutzbar
[4.1.2.4.1]:             #41241-tuc_kon_080-dokument-validieren”
[4.1.2.5]:               #4125-operationen-an-der-außenschnittstelle
[4.1.2.6]:               #4126-betriebsaspekte
[4.1.3]:                 #413-dienstverzeichnisdienst
[4.1.3.1]:               #4131-funktionsmerkmalweite-aspekte
[4.1.3.2]:               #4132-durch-ereignisse-ausgelöste-reaktionen
[4.1.3.3]:               #4133-interne-tucs-nicht-durch-fachmodule-nutzbar
[4.1.3.4]:               #4134-interne-tucs-auch-durch-fachmodule-nutzbar
[4.1.3.4.1]:             #41341-tuc_kon_041-einbringen-der-endpunktinformationen-während-der-bootup-phase
[4.1.3.5]:               #4135-operationen-an-der-außenschnittstelle
[4.1.3.6]:               #4136-betriebsaspekte
[4.1.4]:                 #414-kartenterminaldienst
[4.1.4.1]:               #4141-funktionsmerkmalweite-aspekte
[4.1.4.2]:               #4142-durch-ereignisse-ausgelöste-reaktionen
[4.1.4.3]:               #4143-interne-tucs-nicht-durch-fachmodule-nutzbar
[4.1.4.3.1]:             #41431-tuc_kon_050-beginne-kartenterminalsitzung
[4.1.4.3.2]:             #41432-tuc_kon_054-kartenterminal-hinzufügen
[4.1.4.3.3]:             #41433-tuc_kon_053-paire-kartenterminal
[4.1.4.3.4]:             #41434-tuc_kon_055-befülle-ct-object
[4.1.4.4]:               #4144-interne-tucs-auch-durch-fachmodule-nutzbar
[4.1.4.4.1]:             #41441-tuc_kon_051-mit-anwender-über-kartenterminal-interagieren
[4.1.4.4.2]:             #41442-tuc_kon_056-karte-anfordern
[4.1.4.4.3]:             #41443-tuc_kon_057-karte-auswerfen
[4.1.4.4.4]:             #41444-tuc_kon_058-displaygröße-ermitteln
[4.1.4.5]:               #4145-operationen-an-der-außenschnittstelle
[4.1.4.5.1]:             #41451-requestcard
[4.1.4.5.2]:             #41452-ejectcard
[4.1.4.6]:               #4146-betriebsaspekte
[4.1.4.6.1]:             #41461-allgemeine-betriebsaspekte
[4.1.4.6.2]:             #41462-kartenterminals-pflegen
[4.1.4.6.3]:             #41463-import-der-kartenterminal-informationen
[4.1.5]:                 #415-kartendienst
[4.1.5.1]:               #4151-funktionsmerkmalweite-aspekte
[4.1.5.2]:               #4152-durch-ereignisse-ausgelöste-reaktionen
[4.1.5.3]:               #4153-interne-tucs-nicht-durch-fachmodule-nutzbar
[4.1.5.3.1]:             #41531-tuc_kon_001-karte-öffnen
[4.1.5.4]:               #4154-interne-tucs-auch-durch-fachmodule-nutzbar
[4.1.5.4.1]:             #41541-tuc_kon_026-liefere-cardsession
[4.1.5.4.2]:             #41542-tuc_kon_012-pin-verifizieren
[4.1.5.4.3]:             #41543-tuc_kon_019-pin-ändern
[4.1.5.4.4]:             #41544-tuc_kon_021-pin-entsperren
[4.1.5.4.5]:             #41545-tuc_kon_022-liefere-pin-status
[4.1.5.4.6]:             #41546-tuc_kon_027-pin-schutz-ein-ausschalten
[4.1.5.4.7]:             #41547-tuc_kon_023-karte-reservieren
[4.1.5.4.8]:             #41548-tuc_kon_005-card-to-card-authentisieren
[4.1.5.4.9]:             #41549-tuc_kon_202-lesedatei
[4.1.5.4.10]:            #415410-tuc_kon_203-schreibedatei
[4.1.5.4.11]:            #415411-tuc_kon_204-löschedateiinhalt
[4.1.5.4.12]:            #415412-tuc_kon_209-leserecord
[4.1.5.4.13]:            #415413-tuc_kon_210-schreiberecord
[4.1.5.4.14]:            #415414-tuc_kon_211-löscherecordinhalt
[4.1.5.4.15]:            #415415-tuc_kon_214-fügehinzurecord
[4.1.5.4.16]:            #415416-tuc_kon_215-sucherecord
[4.1.5.4.17]:            #415417-tuc_kon_018-egk-sperrung-prüfen
[4.1.5.4.18]:            #415418-tuc_kon_006-datenzugriffsaudit-egk-schreiben
[4.1.5.4.19]:            #415419-tuc_kon_218-signiere
[4.1.5.4.20]:            #415420-tuc_kon_219-entschlüssele
[4.1.5.4.21]:            #415421-tuc_kon_200-sendeapdu
[4.1.5.4.22]:            #415422-tuc_kon_024-karte-zurücksetzen
[4.1.5.4.23]:            #415423-tuc_kon_216-lesezertifikat
[4.1.5.4.24]:            #415424-tuc_kon_036-lieferefachlicherolle
[4.1.5.5]:               #4155-operationen-an-der-außenschnittstelle
[4.1.5.5.1]:             #41551-verifypin
[4.1.5.5.2]:             #41552-changepin
[4.1.5.5.3]:             #41553-getpinstatus
[4.1.5.5.4]:             #41554-unblockpin
[4.1.5.5.5]:             #41555-enablepin
[4.1.5.5.6]:             #41556-disablepin
[4.1.5.6]:               #4156-betriebsaspekte
[4.1.5.6.1]:             #41561-tuc_kon_025-initialisierung-kartendienst
[4.1.5.6.2]:             #41562-kartenübersicht-und-pin-management
[4.1.6]:                 #416-systeminformationsdienst
[4.1.6.1]:               #4161-funktionsmerkmalweite-aspekte
[4.1.6.2]:               #4162-durch-ereignisse-ausgelöste-reaktionen
[4.1.6.3]:               #4163-interne-tucs-nicht-durch-fachmodule-nutzbar
[4.1.6.4]:               #4164-interne-tucs-auch-durch-fachmodule-nutzbar
[4.1.6.4.1]:             #41641-tuc_kon_256-systemereignis-absetzen
[4.1.6.4.2]:             #41642-tuc_kon_252-liefere-kt_liste
[4.1.6.4.3]:             #41643-tuc_kon_253-liefere-karten_liste
[4.1.6.4.4]:             #41644-tuc_kon_254-liefere-ressourcendetails
[4.1.6.5]:               #4165-operationen-an-der-außenschnittstelle
[4.1.6.5.1]:             #41651-getcardterminals
[4.1.6.5.2]:             #41652-getcards
[4.1.6.5.3]:             #41653-getresourceinformation
[4.1.6.5.4]:             #41654-subscribe
[4.1.6.5.5]:             #41655-unsubscribe
[4.1.6.5.6]:             #41656-renewsubscriptions
[4.1.6.5.7]:             #41657-getsubscription
[4.1.6.6]:               #4166-betriebsaspekte
[4.1.7]:                 #417-verschlüsselungsdienst
[4.1.7.1]:               #4171-funktionsmerkmalweite-aspekte
[4.1.7.2]:               #4172-durch-ereignisse-ausgelöste-reaktionen
[4.1.7.3]:               #4173-interne-tucs-nicht-durch-fachmodule-nutzbar
[4.1.7.4]:               #4174-interne-tucs-auch-durch-fachmodule-nutzbar
[4.1.7.4.1]:             #41741-tuc_kon_070-daten-hybrid-verschlüsseln”
[4.1.7.4.2]:             #41742-tuc_kon_071-daten-hybrid-entschlüsseln”
[4.1.7.4.3]:             #41743-tuc_kon_072-daten-symmetrisch-verschlüsseln”
[4.1.7.4.4]:             #41744-tuc_kon_073-daten-symmetrisch-entschlüsseln”
[4.1.7.4.5]:             #41745-tuc_kon_075-symmetrisch-verschlüsseln
[4.1.7.4.6]:             #41746-tuc_kon_076-symmetrisch-entschlüsseln
[4.1.7.5]:               #4175-operationen-an-der-außenschnittstelle
[4.1.7.5.1]:             #41751-encryptdocument
[4.1.7.5.2]:             #41752-decryptdocument
[4.1.7.6]:               #4176-betriebsaspekte
[4.1.8]:                 #418-signaturdienst
[4.1.8.1]:               #4181-funktionsmerkmalweite-aspekte
[4.1.8.1.1]:             #41811-dokumentensignatur
[4.1.8.1.2]:             #41812-signaturrichtlinien
[4.1.8.1.3]:             #41813-signaturzeitpunkt
[4.1.8.1.4]:             #41814-jobnummer
[4.1.8.1.5]:             #41815-komfortsignatur
[4.1.8.2]:               #4182-durch-ereignisse-ausgelöste-reaktionen
[4.1.8.3]:               #4183-interne-tucs-nicht-durch-fachmodule-nutzbar
[4.1.8.3.1]:             #41831-tuc_kon_155-dokumente-zur-signatur-vorbereiten”
[4.1.8.3.2]:             #41832-tuc_kon_165-signaturvoraussetzungen-für-nonqes-prüfen
[4.1.8.3.3]:             #41833-tuc_kon_166-nonqes-signaturen-erstellen
[4.1.8.3.4]:             #41834-tuc_kon_152-signaturvoraussetzungen-für-qes-prüfen
[4.1.8.3.5]:             #41835-tuc_kon_154-qes-signaturen-erstellen
[4.1.8.3.6]:             #41836-tuc_kon_168-einzelsignatur-qes-erstellen
[4.1.8.3.7]:             #41837-tuc_kon_158-komfortsignaturen-erstellen
[4.1.8.4]:               #4184-interne-tucs-auch-durch-fachmodule-nutzbar
[4.1.8.4.1]:             #41841-tuc_kon_160-dokumente-nonqes-signieren”
[4.1.8.4.2]:             #41842-tuc_kon_161-nonqes-dokumentsignatur-prüfen”
[4.1.8.4.3]:             #41843-tuc_kon_162-kryptographische-prüfung-der-xml-dokumentensignatur”
[4.1.8.4.4]:             #41844-tuc_kon_150-dokumente-qes-signieren”
[4.1.8.4.5]:             #41845-anforderungen-an-die-stapelsignatur
[4.1.8.4.6]:             #41846-tuc_kon_151-qes-dokumentensignatur-prüfen
[4.1.8.4.7]:             #41847-tuc_kon_170-dokumente-mit-komfort-signieren”
[4.1.8.4.8]:             #41848-tuc_kon_171-komfortsignatur-einschalten”
[4.1.8.4.9]:             #41849-tuc_kon_172-komfortsignatur-ausschalten”
[4.1.8.4.10]:            #418410-tuc_kon_173-liefere-signaturmodus”
[4.1.8.5]:               #4185-operationen-an-der-außenschnittstelle
[4.1.8.5.1]:             #41851-signdocument-nonqes-und-qes
[4.1.8.5.2]:             #41852-verifydocument-nonqes-und-qes
[4.1.8.5.3]:             #41853-stopsignature
[4.1.8.5.4]:             #41854-getjobnumber
[4.1.8.5.5]:             #41855-activatecomfortsignature
[4.1.8.5.6]:             #41856-deactivatecomfortsignature
[4.1.8.5.7]:             #41857-getsignaturemode
[4.1.8.6]:               #4186-betriebsaspekte
[4.1.9]:                 #419-zertifikatsdienst
[4.1.9.1]:               #4191-funktionsmerkmalweite-aspekte
[4.1.9.2]:               #4192-durch-ereignisse-ausgelöste-reaktionen
[4.1.9.3]:               #4193-interne-tucs-nicht-durch-fachmodule-nutzbar
[4.1.9.3.1]:             #41931-tuc_kon_032-tsl-aktualisieren
[4.1.9.3.2]:             #41932-tuc_kon_031-bnetza-vl-aktualisieren
[4.1.9.3.3]:             #41933-tuc_kon_040-crl-aktualisieren
[4.1.9.3.4]:             #41934-tuc_kon_033-zertifikatsablauf-prüfen
[4.1.9.4]:               #4194-interne-tucs-auch-durch-fachmodule-nutzbar
[4.1.9.4.1]:             #41941-tuc_kon_037-zertifikat-prüfen
[4.1.9.4.2]:             #41942-tuc_kon_042-cv-zertifikat-prüfen
[4.1.9.4.3]:             #41943-tuc_kon_034-zertifikatsinformationen-extrahieren
[4.1.9.5]:               #4195-operationen-an-der-außenschnittstelle
[4.1.9.5.1]:             #41951-checkcertificateexpiration
[4.1.9.5.2]:             #41952-readcardcertificate
[4.1.9.5.3]:             #41953-verifycertificate
[4.1.9.6]:               #4196-betriebsaspekte
[4.1.9.6.1]:             #41961-tuc_kon_035-zertifikatsdienst-initialisieren
[4.1.10]:                #4110-protokollierungsdienst
[4.1.10.1]:              #41101-funktionsmerkmalweite-aspekte
[4.1.10.2]:              #41102-durch-ereignisse-ausgelöste-reaktionen
[4.1.10.3]:              #41103-interne-tucs-nicht-durch-fachmodule-nutzbar
[4.1.10.4]:              #41104-interne-tucs-auch-durch-fachmodule-nutzbar
[4.1.10.4.1]:            #411041-tuc_kon_271-schreibe-protokolleintrag
[4.1.10.5]:              #41105-operationen-an-der-außenschnittstelle
[4.1.10.6]:              #41106-betriebsaspekte
[4.1.10.6.1]:            #411061-tuc_kon_272-initialisierung-protokollierungsdienst
[4.1.11]:                #4111-tls-dienst
[4.1.11.1]:              #41111-funktionsmerkmalweite-aspekte
[4.1.11.2]:              #41112-durch-ereignisse-ausgelöste-reaktionen
[4.1.11.3]:              #41113-interne-tucs-nicht-durch-fachmodule-nutzbar
[4.1.11.4]:              #41114-interne-tucs-auch-durch-fachmodule-nutzbar
[4.1.11.4.1]:            #411141-tuc_kon_110-kartenbasierte-tls-verbindung-aufbauen
[4.1.11.4.2]:            #411142-tuc_kon_111-kartenbasierte-tls-verbindung-abbauen
[4.1.11.5]:              #41115-operationen-an-der-außenschnittstelle
[4.1.11.6]:              #41116-betriebsaspekte
[4.1.12]:                #4112-ldap-proxy
[4.1.12.1]:              #41121-funktionsmerkmalweite-aspekte
[4.1.12.2]:              #41122-durch-ereignisse-ausgelöste-reaktionen
[4.1.12.3]:              #41123-interne-tucs-nicht-durch-fachmodule-nutzbar
[4.1.12.4]:              #41124-interne-tucs-auch-durch-fachmodule-nutzbar
[4.1.12.4.1]:            #411241-tuc_kon_290-ldap-verbindung-aufbauen
[4.1.12.4.2]:            #411242-tuc_kon_291-verzeichnis-abfragen
[4.1.12.4.3]:            #411243-tuc_kon_292-ldap-verbindung-trennen
[4.1.12.4.4]:            #411244-tuc_kon_293-verzeichnisabfrage-abbrechen
[4.1.12.5]:              #41125-operationen-an-der-außenschnittstelle
[4.1.12.5.1]:            #411251-unterstützte-ldapv3-operationen
[4.1.12.6]:              #41126-betriebsaspekte
[4.1.13]:                #4113-authentifizierungsdienst
[4.1.13.1]:              #41131-funktionsmerkmalweite-aspekte
[4.1.13.1.1]:            #411311-externe-authentisierung
[4.1.13.2]:              #41132-durch-ereignisse-ausgelöste-reaktionen
[4.1.13.3]:              #41133-interne-tucs
[4.1.13.4]:              #41134-operationen-an-der-außenschnittstelle
[4.1.13.4.1]:            #411341-externalauthenticate
[4.1.13.5]:              #41135-betriebsaspekte
[4.1.14]:                #4114-betriebsdatenmeldedienst
[4.2]:                   #42-netzkonnektor
[4.2.1]:                 #421-anbindung-lanwan
[4.2.1.1]:               #4211-funktionsmerkmalweite-aspekte
[4.2.1.1.1]:             #42111-netzwerksegmentierung
[4.2.1.1.2]:             #42112-routing-und-firewall
[4.2.1.2]:               #4212-durch-ereignisse-ausgelöste-reaktionen
[4.2.1.3]:               #4213-interne-tucs-nicht-durch-fachmodule-nutzbar
[4.2.1.3.1]:             #42131-tuc_kon_305-lan-adapter-initialisieren
[4.2.1.3.2]:             #42132-tuc_kon_306-wan-adapter-initialisieren
[4.2.1.3.3]:             #42133-tuc_kon_304-netzwerk-routen-einrichten
[4.2.1.4]:               #4214-interne-tucs-auch-durch-fachmodule-nutzbar
[4.2.1.5]:               #4215-operationen-an-der-außenschnittstelle
[4.2.1.6]:               #4216-betriebsaspekte
[4.2.2]:                 #422-dhcp-server
[4.2.2.1]:               #4221-funktionsmerkmalweite-aspekte
[4.2.2.2]:               #4222-durch-ereignisse-ausgelöste-reaktionen
[4.2.2.3]:               #4223-interne-tucs-nicht-durch-fachmodule-nutzbar
[4.2.2.4]:               #4224-interne-tucs-auch-durch-fachmodule-nutzbar
[4.2.2.5]:               #4225-operationen-an-der-außenschnittstelle
[4.2.2.5.1]:             #42251-liefere-netzwerkinformationen-über-dhcp
[4.2.2.6]:               #4226-betriebsaspekte
[4.2.2.6.1]:             #42261-tuc_kon_343-initialisierung-dhcp-server
[4.2.3]:                 #423-dhcp-client
[4.2.3.1]:               #4231-funktionsmerkmalweite-aspekte
[4.2.3.2]:               #4232-durch-ereignisse-ausgelöste-reaktionen
[4.2.3.3]:               #4233-interne-tucs-nicht-durch-fachmodule-nutzbar
[4.2.3.3.1]:             #42331-tuc_kon_341-dhcp-informationen-beziehen
[4.2.3.4]:               #4234-interne-tucs-auch-durch-fachmodule-nutzbar
[4.2.3.5]:               #4235-operationen-an-der-außenschnittstelle
[4.2.3.6]:               #4236-betriebsaspekte
[4.2.4]:                 #424-vpn-client
[4.2.4.1]:               #4241-funktionsmerkmalweite-aspekte
[4.2.4.2]:               #4242-durch-ereignisse-ausgelöste-reaktionen
[4.2.4.3]:               #4243-interne-tucs-nicht-durch-fachmodule-nutzbar
[4.2.4.3.1]:             #42431-tuc_kon_321-verbindung-zu-dem-vpn-konzentrator-der-ti-aufbauen
[4.2.4.3.2]:             #42432-tuc_kon_322-verbindung-zu-dem-vpn-konzentrator-des-sis-aufbauen
[4.2.4.4]:               #4244-interne-tucs-auch-durch-fachmodule-nutzbar
[4.2.4.5]:               #4245-operationen-an-der-außenschnittstelle
[4.2.4.6]:               #4246-betriebsaspekte
[4.2.5]:                 #425-zeitdienst
[4.2.5.1]:               #4251-funktionsmerkmalweite-aspekte
[4.2.5.2]:               #4252-durch-ereignisse-ausgelöste-reaktionen
[4.2.5.3]:               #4253-interne-tucs-nicht-durch-fachmodule-nutzbar
[4.2.5.4]:               #4254-interne-tucs-auch-durch-fachmodule-nutzbar
[4.2.5.4.1]:             #42541-tuc_kon_351-liefere-systemzeit”
[4.2.5.5]:               #4255-operationen-an-der-außenschnittstelle
[4.2.5.5.1]:             #42551-sync_time
[4.2.5.6]:               #4256-betriebsaspekte
[4.2.5.6.1]:             #42561-tuc_kon_352-initialisierung-zeitdienst
[4.2.6]:                 #426-namensdienst-und-dienstlokalisierung
[4.2.6.1]:               #4261-funktionsmerkmalweite-aspekte
[4.2.6.2]:               #4262-durch-ereignisse-ausgelöste-reaktionen
[4.2.6.3]:               #4263-interne-tucs-nicht-durch-fachmodule-nutzbar
[4.2.6.4]:               #4264-interne-tucs-auch-durch-fachmodule-nutzbar
[4.2.6.4.1]:             #42641-tuc_kon_361-dns-namen-auflösen
[4.2.6.4.2]:             #42642-tuc_kon_362-liste-der-dienste-abrufen
[4.2.6.4.3]:             #42643-tuc_kon_363-dienstdetails-abrufen
[4.2.6.5]:               #4265-operationen-an-der-außenschnittstelle
[4.2.6.5.1]:             #42651-getipaddress
[4.2.6.6]:               #4266-betriebsaspekte
[4.2.7]:                 #427-optionale-verwendung-von-ipv6
[4.3]:                   #43-konnektormanagement
[4.3.1]:                 #431-zugang-und-benutzerverwaltung-des-konnektormanagements
[4.3.2]:                 #432-konnektorname-und-versionsinformationen
[4.3.3]:                 #433-konfigurationsdaten-persistieren-sowie-export-import
[4.3.4]:                 #434-administration-von-fachmodulen
[4.3.5]:                 #435-neustart-und-werksreset
[4.3.6]:                 #436-leistungsumfänge-und-standalone-szenarios
[4.3.7]:                 #437-online-anbindung-verwalten
[4.3.8]:                 #438-re-registrierung-des-konnektors-mit-weiterem-nk-zertifikat
[4.3.9]:                 #439-remote-management-optional
[4.3.10]:                #4310-software--und-konfigurationsaktualisierung-ksr-client
[4.3.10.1]:              #43101-funktionsmerkmalweite-aspekte
[4.3.10.2]:              #43102-durch-ereignisse-ausgelöste-reaktionen
[4.3.10.3]:              #43103-interne-tucs-nicht-durch-fachmodule-nutzbar
[4.3.10.3.1]:            #431031-tuc_kon_280-konnektoraktualisierung-durchführen
[4.3.10.3.2]:            #431032-tuc_kon_281-kartenterminalaktualisierung-anstoßen
[4.3.10.3.3]:            #431033-tuc_kon_282-updateinformationen-beziehen
[4.3.10.3.4]:            #431034-tuc_kon_283-infrastruktur-konfiguration-aktualisieren
[4.3.10.4]:              #43104-interne-tucs-auch-durch-fachmodule-nutzbar
[4.3.10.4.1]:            #431041-tuc_kon_285-updateinformationen-für-fachmodul-beziehen
[4.3.10.4.2]:            #431042-tuc_kon_286-paket-für-fachmodul-laden
[4.3.10.5]:              #43105-operationen-an-der-außenschnittstelle
[4.3.10.6]:              #43106-betriebsaspekte
[4.3.10.6.1]:            #431061-tuc_kon_284-ksr-client-initialisieren
[4.3.11]:                #4311-konnektorstatus
[4.4]:                   #44-hardware-merkmale-des-konnektors
[5]:                     #5-anhang-a-–-verzeichnisse
[5.1]:                   #51-abkürzungen
[5.2]:                   #52-glossar
[5.3]:                   #53-abbildungsverzeichnis
[5.4]:                   #54-tabellenverzeichnis
[5.5]:                   #55-referenzierte-dokumente
[5.5.1]:                 #551-dokumente-der-gematik
[5.5.2]:                 #552-weitere-dokumente
[6]:                     #6-anhang-b-–-profilierung-der-signatur--und-verschlüsselungsformate-normativ
[6.1]:                   #61-profilierung-der-verschlüsselungsformate
[6.2]:                   #62-profilierung-der-signaturformate
[6.3]:                   #63-profilierung-verificationreport
[6.4]:                   #64-profilierung-der-dokumentenformate-und-nachrichten
[7]:                     #7-anhang-f-–-übersicht-events
[8]:                     #8-anhang-h-–-mapping-von-architektur-der-ti-plattform-auf-konnektorspezifikation
[9]:                     #9-anhang-i-–-umsetzungshinweise-informativ
[9.1]:                   #91-systemüberblick
[9.1.1]:                 #911-–-hinweise-zur-sicherheitsevaluierung-nach-common-criteria
[9.1.1.1]:               #9111-separationsmechanismen-des-konnektors
[9.1.1.2]:               #9112-granularität-der-tsf
[9.2]:                   #92-übergreifende-festlegungen
[9.2.1]:                 #921-interne-mechanismen
[9.2.1.1]:               #9211-zufallszahlen-und-schlüssel
[9.3]:                   #93-funktionsmerkmale
[9.3.1]:                 #931-anwendungskonnektor
[9.3.1.1]:               #9311-administration-des-informationsmodells
[9.3.1.2]:               #9312-vorgehensvariante-für-das-handling-von-cardsessions
[9.3.1.3]:               #9313-darstellung-von-terminal-anzeigen-auf-einem-kartenterminal
[10]:                    #10-anhang-k-–-szenarien-im-dezentralen-umfeld
[10.1]:                  #101-szenario-1-einfache-installation-ohne-spezielle-anforderungen-und-ohne-bestehende-infrastruktur
[10.1.1]:                #1011-beschreibung-des-szenarios
[10.1.2]:                #1012-voraussetzungen
[10.1.3]:                #1013-auswirkungen
[10.2]:                  #102-szenario-2-installation-mit-mehreren-behandlungsräumen
[10.2.1]:                #1021-beschreibung-des-szenarios
[10.2.2]:                #1022-voraussetzungen
[10.2.3]:                #1023-auswirkungen
[10.3]:                  #103-szenario-3-integration-in-bestehende-infrastruktur-ohne-netzsegmentierung
[10.3.1]:                #1031-beschreibung-des-szenarios
[10.3.2]:                #1032-voraussetzungen
[10.3.3]:                #1033-auswirkungen
[10.4]:                  #104-szenario-4-integration-in-bestehende-infrastruktur-mit-netzsegmentierung
[10.4.1]:                #1041-beschreibung-des-szenarios
[10.4.2]:                #1042-voraussetzungen
[10.4.3]:                #1043-auswirkungen
[10.5]:                  #105-szenario-5-zentral-gesteckter-hba
[10.5.1]:                #1051-beschreibung-des-szenarios
[10.5.2]:                #1052-voraussetzungen
[10.5.3]:                #1053-auswirkung
[10.6]:                  #106-szenario-6-installation-mit-zentralem-ps
[10.6.1]:                #1061-beschreibung-des-szenarios
[10.6.2]:                #1062-voraussetzungen
[10.6.3]:                #1063-auswirkungen
[10.7]:                  #107-szenario-7-mehrere-mandanten
[10.7.1]:                #1071-beschreibung-des-szenarios
[10.7.2]:                #1072-voraussetzungen
[10.7.3]:                #1073-auswirkungen
[10.8]:                  #108-szenario-9-standalone-konnektor---physische-trennung
[10.8.1]:                #1081-beschreibung-des-szenarios
[10.8.2]:                #1082-voraussetzungen
[10.8.3]:                #1083-auswirkung
[11]:                    #11-anhang-l-–-datentypen-von-eingangs--und-ausgangsdaten
[Abbildung-1]:           gemSpec_Kon_V5.18.0.attachments/11372500556585029303.png
[Abbildung-2]:           gemSpec_Kon_V5.18.0.attachments/597812103449717399.png
[Abbildung-3]:           gemSpec_Kon_V5.18.0.attachments/452543610749890073.png
[Abbildung-4]:           gemSpec_Kon_V5.18.0.attachments/3253016863505255554.emf
[Abbildung-5]:           gemSpec_Kon_V5.18.0.attachments/5885552658699712675.png
[Abbildung-6]:           gemSpec_Kon_V5.18.0.attachments/2737851721132666970.emf
[Img-007]:               gemSpec_Kon_V5.18.0.attachments/5446061706879125634.png
[Img-008]:               gemSpec_Kon_V5.18.0.attachments/8594667462373386135.png
[Abbildung-7]:           gemSpec_Kon_V5.18.0.attachments/8656477943409294784.emf
[Img-010]:               gemSpec_Kon_V5.18.0.attachments/4238673678557912379.emf
[Abbildung-9]:           gemSpec_Kon_V5.18.0.attachments/5553279804750508008.emf
[Img-012]:               gemSpec_Kon_V5.18.0.attachments/15817321983279740541.png
[Img-013]:               gemSpec_Kon_V5.18.0.attachments/10944504007001908949.png
[Img-014]:               gemSpec_Kon_V5.18.0.attachments/5290459653915798835.png
[Img-015]:               gemSpec_Kon_V5.18.0.attachments/3185590376804973755.png
[Img-016]:               gemSpec_Kon_V5.18.0.attachments/16835580620461563295.emf
[Img-017]:               gemSpec_Kon_V5.18.0.attachments/15568104110097020057.png
[Img-018]:               gemSpec_Kon_V5.18.0.attachments/11553882221895609192.png
[Img-019]:               gemSpec_Kon_V5.18.0.attachments/411290757942682148.emf
[Img-020]:               gemSpec_Kon_V5.18.0.attachments/5902004378507810137.png
[Img-021]:               gemSpec_Kon_V5.18.0.attachments/14599410951816816878.emf
[Img-022]:               gemSpec_Kon_V5.18.0.attachments/5981443493873000510.png
[Img-023]:               gemSpec_Kon_V5.18.0.attachments/3437061164560012453.png
[Img-024]:               gemSpec_Kon_V5.18.0.attachments/10548240110596722538.png
[Img-025]:               gemSpec_Kon_V5.18.0.attachments/15326354431292221822.png
[Img-026]:               gemSpec_Kon_V5.18.0.attachments/5103545710943043162.png
[Img-027]:               gemSpec_Kon_V5.18.0.attachments/602714301431283203.png
[Img-028]:               gemSpec_Kon_V5.18.0.attachments/11889156230617616541.png
[Img-029]:               gemSpec_Kon_V5.18.0.attachments/560025191717672503.emf
[Img-030]:               gemSpec_Kon_V5.18.0.attachments/5783398479079037955.png
[Img-031]:               gemSpec_Kon_V5.18.0.attachments/6529874083143031263.png
[Img-032]:               gemSpec_Kon_V5.18.0.attachments/9122339233356279763.png
[Abbildung-13]:          gemSpec_Kon_V5.18.0.attachments/293107814685344665.png
[Img-034]:               gemSpec_Kon_V5.18.0.attachments/4935412250355692970.emf
[Img-035]:               gemSpec_Kon_V5.18.0.attachments/6679711316306839977.png
[Img-036]:               gemSpec_Kon_V5.18.0.attachments/12337063454900755544.png
[Img-037]:               gemSpec_Kon_V5.18.0.attachments/14291834559899981797.png
[Img-038]:               gemSpec_Kon_V5.18.0.attachments/16525367396062298253.png
[Img-039]:               gemSpec_Kon_V5.18.0.attachments/14455609935007825300.png
[Img-040]:               gemSpec_Kon_V5.18.0.attachments/13336711737712518275.png
[Img-041]:               gemSpec_Kon_V5.18.0.attachments/16558876940816782441.png
[Img-042]:               gemSpec_Kon_V5.18.0.attachments/12409259012593558849.png
[Img-043]:               gemSpec_Kon_V5.18.0.attachments/3843101436383260645.png
[Img-044]:               gemSpec_Kon_V5.18.0.attachments/7490794391593505044.png
[Img-045]:               gemSpec_Kon_V5.18.0.attachments/1822796370727429057.png
[Img-046]:               gemSpec_Kon_V5.18.0.attachments/15952798123352973504.png
[Abbildung-15]:          gemSpec_Kon_V5.18.0.attachments/1166144241643877153.png
[Abbildung-16]:          gemSpec_Kon_V5.18.0.attachments/15903632354578786558.emf
[Abbildung-17]:          gemSpec_Kon_V5.18.0.attachments/13571335905733562869.png
[Img-050]:               gemSpec_Kon_V5.18.0.attachments/4615707335606718182.emf
[Img-051]:               gemSpec_Kon_V5.18.0.attachments/1777103963067446278.emf
[Img-052]:               gemSpec_Kon_V5.18.0.attachments/11331385422514879572.PNG
[Img-053]:               gemSpec_Kon_V5.18.0.attachments/9860981445654011760.png
[Img-054]:               gemSpec_Kon_V5.18.0.attachments/5770528265980060112.png
[Img-055]:               gemSpec_Kon_V5.18.0.attachments/8811573663781348543.png
[Img-056]:               gemSpec_Kon_V5.18.0.attachments/10829620091025857987.png
[Img-057]:               gemSpec_Kon_V5.18.0.attachments/2798138632072601579.png
[Img-058]:               gemSpec_Kon_V5.18.0.attachments/4049175659504824259.png
[Img-059]:               gemSpec_Kon_V5.18.0.attachments/5135096985505234212.png
[Img-060]:               gemSpec_Kon_V5.18.0.attachments/13567747219320408400.png
[Img-061]:               gemSpec_Kon_V5.18.0.attachments/10878943948070662179.png
[Img-062]:               gemSpec_Kon_V5.18.0.attachments/10791410257400469312.png
[Img-063]:               gemSpec_Kon_V5.18.0.attachments/11051907521224204060.png
[Img-064]:               gemSpec_Kon_V5.18.0.attachments/15311099311236046815.png
[Img-065]:               gemSpec_Kon_V5.18.0.attachments/6132225471026202669.png
[Img-066]:               gemSpec_Kon_V5.18.0.attachments/252625566752094451.png
[Img-067]:               gemSpec_Kon_V5.18.0.attachments/13738246250475982343.png
[Img-068]:               gemSpec_Kon_V5.18.0.attachments/2790331112089026039.png
[Abbildung-20]:          gemSpec_Kon_V5.18.0.attachments/4679305598564690814.emf
[Img-070]:               gemSpec_Kon_V5.18.0.attachments/16502656005582757420.png
[Img-071]:               gemSpec_Kon_V5.18.0.attachments/15806747652529307859.png
[Img-072]:               gemSpec_Kon_V5.18.0.attachments/8240180235197032516.png
[Abbildung-21]:          gemSpec_Kon_V5.18.0.attachments/377569428305567874.png
[Img-074]:               gemSpec_Kon_V5.18.0.attachments/8792316216455315176.png
[Abbildung-23]:          gemSpec_Kon_V5.18.0.attachments/1680130296516442956.emf
[Abbildung-24]:          gemSpec_Kon_V5.18.0.attachments/17762408187233769204.emf
[Abbildung-25]:          gemSpec_Kon_V5.18.0.attachments/11140954224183461378.emf
[Abbildung-26]:          gemSpec_Kon_V5.18.0.attachments/14159813432999277364.emf
[Abbildung-27]:          gemSpec_Kon_V5.18.0.attachments/5644381610894428272.emf
[Abbildung-28]:          gemSpec_Kon_V5.18.0.attachments/17364015577677169346.emf
[Abbildung-29]:          gemSpec_Kon_V5.18.0.attachments/7972339229766263266.emf
[Abbildung-30]:          gemSpec_Kon_V5.18.0.attachments/3336173011312695993.png
[Abbildung-31]:          gemSpec_Kon_V5.18.0.attachments/7031299863855507289.emf
[Tbl-001]:               #Tbl-001 (&93834789485256)
[Tbl-002]:               #Tbl-002 (&93834801626776)
[Tbl-003]:               #Tbl-003 (&93834801668032)
[Tabelle-1]:             #Tabelle-1 (&93834781697080)
[Tabelle-2]:             #Tabelle-2 (&93834781709400)
[Tabelle-3]:             #Tabelle-3 (&93834767979816)
[Tabelle-4]:             #Tabelle-4 (&93834802330344)
[Tabelle-5]:             #Tabelle-5 (&93834811196672)
[Tabelle-6]:             #Tabelle-6 (&93834799003696)
[Tabelle-7]:             #Tabelle-7 (&93834796643616)
[Tbl-011]:               #Tbl-011 (&93834781550536)
[Tabelle-9]:             #Tabelle-9 (&93834781607992)
[Tabelle-10]:            #Tabelle-10 (&93834778245040)
[Tabelle-11]:            #Tabelle-11 (&93834778304384)
[Tabelle-12]:            #Tabelle-12 (&93834799090208)
[Tabelle-13]:            #Tabelle-13 (&93834775716632)
[Tabelle-14]:            #Tabelle-14 (&93834800000728)
[Tabelle-15]:            #Tabelle-15 (&93834800050032)
[Tabelle-16]:            #Tabelle-16 (&93834765244272)
[Tabelle-17]:            #Tabelle-17 (&93834796393896)
[Tabelle-18]:            #Tabelle-18 (&93834783698880)
[Tabelle-19]:            #Tabelle-19 (&93834783787192)
[Tabelle-20]:            #Tabelle-20 (&93834804548560)
[Tabelle-21]:            #Tabelle-21 (&93834789306480)
[Tabelle-22]:            #Tabelle-22 (&93834771302840)
[Tabelle-23]:            #Tabelle-23 (&93834771390736)
[Tabelle-24]:            #Tabelle-24 (&93834810940176)
[Tbl-028]:               #Tbl-028 (&93834811014104)
[Tabelle-26]:            #Tabelle-26 (&93834768751088)
[Tabelle-27]:            #Tabelle-27 (&93834811073792)
[Tabelle-28]:            #Tabelle-28 (&93834811115600)
[Tbl-032]:               #Tbl-032 (&93834781325808)
[Tabelle-30]:            #Tabelle-30 (&93834789220144)
[Tabelle-31]:            #Tabelle-31 (&93834793546888)
[Tabelle-32]:            #Tabelle-32 (&93834793573128)
[Tabelle-33]:            #Tabelle-33 (&93834793708672)
[Tabelle-34]:            #Tabelle-34 (&93834811394920)
[Tabelle-35]:            #Tabelle-35 (&93834811430464)
[Tabelle-36]:            #Tabelle-36 (&93834796197008)
[Tabelle-37]:            #Tabelle-37 (&93834796232256)
[Tabelle-38]:            #Tabelle-38 (&93834775172840)
[Tabelle-39]:            #Tabelle-39 (&93834775209280)
[Tabelle-40]:            #Tabelle-40 (&93834775286752)
[Tabelle-41]:            #Tabelle-41 (&93834788456152)
[Tabelle-42]:            #Tabelle-42 (&93834788475552)
[Tabelle-43]:            #Tabelle-43 (&93834788555000)
[Tabelle-44]:            #Tabelle-44 (&93834788662120)
[Tabelle-45]:            #Tabelle-45 (&93834775426328)
[Tabelle-46]:            #Tabelle-46 (&93834775484120)
[Tabelle-47]:            #Tabelle-47 (&93834775591864)
[Tabelle-48]:            #Tabelle-48 (&93834775611480)
[Tabelle-49]:            #Tabelle-49 (&93834775646640)
[Tabelle-50]:            #Tabelle-50 (&93834768148328)
[Tabelle-51]:            #Tabelle-51 (&93834768182480)
[Tabelle-52]:            #Tabelle-52 (&93834768256160)
[Tabelle-53]:            #Tabelle-53 (&93834768306736)
[Tabelle-54]:            #Tabelle-54 (&93834768343544)
[Tabelle-55]:            #Tabelle-55 (&93834788692168)
[Tabelle-56]:            #Tabelle-56 (&93834788746112)
[Tabelle-57]:            #Tabelle-57 (&93834788819808)
[Tabelle-58]:            #Tabelle-58 (&93834788924552)
[Tabelle-59]:            #Tabelle-59 (&93834785469944)
[Tabelle-60]:            #Tabelle-60 (&93834785626136)
[Tabelle-61]:            #Tabelle-61 (&93834771549648)
[Tabelle-62]:            #Tabelle-62 (&93834771619408)
[Tabelle-63]:            #Tabelle-63 (&93834771676072)
[Tabelle-64]:            #Tabelle-64 (&93834771695096)
[Tabelle-65]:            #Tabelle-65 (&93834776006448)
[Tabelle-66]:            #Tabelle-66 (&93834776048952)
[Tabelle-67]:            #Tabelle-67 (&93834776181504)
[Tabelle-68]:            #Tabelle-68 (&93834801164968)
[Tabelle-69]:            #Tabelle-69 (&93834801305264)
[Tabelle-70]:            #Tabelle-70 (&93834801433440)
[Tabelle-71]:            #Tabelle-71 (&93834768886840)
[Tabelle-72]:            #Tabelle-72 (&93834768911096)
[Tabelle-73]:            #Tabelle-73 (&93834769102992)
[Tabelle-74]:            #Tabelle-74 (&93834769120568)
[Tabelle-75]:            #Tabelle-75 (&93834769168504)
[Tabelle-76]:            #Tabelle-76 (&93834769232768)
[Tabelle-77]:            #Tabelle-77 (&93834769263696)
[Tabelle-78]:            #Tabelle-78 (&93834769354480)
[Tabelle-79]:            #Tabelle-79 (&93834799339624)
[Tabelle-80]:            #Tabelle-80 (&93834799419120)
[Tabelle-81]:            #Tabelle-81 (&93834799476792)
[Tabelle-82]:            #Tabelle-82 (&93834799597408)
[Tabelle-83]:            #Tabelle-83 (&93834799633376)
[Tabelle-84]:            #Tabelle-84 (&93834799714456)
[Tabelle-85]:            #Tabelle-85 (&93834799766680)
[Tabelle-86]:            #Tabelle-86 (&93834777158744)
[Tabelle-87]:            #Tabelle-87 (&93834777211264)
[Tabelle-88]:            #Tabelle-88 (&93834777281288)
[Tabelle-89]:            #Tabelle-89 (&93834777328360)
[Tabelle-90]:            #Tabelle-90 (&93834777448272)
[Tabelle-91]:            #Tabelle-91 (&93834777495104)
[Tabelle-92]:            #Tabelle-92 (&93834777567016)
[Tabelle-93]:            #Tabelle-93 (&93834798401904)
[Tabelle-94]:            #Tabelle-94 (&93834798521256)
[Tabelle-95]:            #Tabelle-95 (&93834798562096)
[Tabelle-96]:            #Tabelle-96 (&93834798634760)
[Tabelle-97]:            #Tabelle-97 (&93834798676400)
[Tabelle-98]:            #Tabelle-98 (&93834798794392)
[Tabelle-99]:            #Tabelle-99 (&93834798814168)
[Tabelle-100]:           #Tabelle-100 (&93834798876344)
[Tabelle-101]:           #Tabelle-101 (&93834798901056)
[Tabelle-102]:           #Tabelle-102 (&93834784046384)
[Tabelle-103]:           #Tabelle-103 (&93834784452904)
[Tabelle-104]:           #Tabelle-104 (&93834784525328)
[Tabelle-105]:           #Tabelle-105 (&93834784566392)
[Tabelle-106]:           #Tabelle-106 (&93834784633344)
[Tabelle-107]:           #Tabelle-107 (&93834784712864)
[Tabelle-108]:           #Tabelle-108 (&93834784773992)
[Tabelle-109]:           #Tabelle-109 (&93834784798864)
[Tabelle-110]:           #Tabelle-110 (&93834784854480)
[Tabelle-111]:           #Tabelle-111 (&93834784879576)
[Tabelle-112]:           #Tabelle-112 (&93834784998464)
[Tabelle-113]:           #Tabelle-113 (&93834785029208)
[Tabelle-114]:           #Tabelle-114 (&93834785078776)
[Tabelle-115]:           #Tabelle-115 (&93834785209528)
[Tabelle-116]:           #Tabelle-116 (&93834785261672)
[Tabelle-117]:           #Tabelle-117 (&93834785291888)
[Tabelle-118]:           #Tabelle-118 (&93834802846656)
[Tabelle-119]:           #Tabelle-119 (&93834802893088)
[Tabelle-120]:           #Tabelle-120 (&93834802924168)
[Tabelle-121]:           #Tabelle-121 (&93834803169376)
[Tabelle-122]:           #Tabelle-122 (&93834803210240)
[Tabelle-123]:           #Tabelle-123 (&93834803246888)
[Tabelle-124]:           #Tabelle-124 (&93834803375632)
[Tabelle-125]:           #Tabelle-125 (&93834803423424)
[Tabelle-126]:           #Tabelle-126 (&93834803448136)
[Tabelle-127]:           #Tabelle-127 (&93834803575464)
[Tabelle-128]:           #Tabelle-128 (&93834803624376)
[Tabelle-129]:           #Tabelle-129 (&93834803655168)
[Tabelle-130]:           #Tabelle-130 (&93834803732336)
[Tabelle-131]:           #Tabelle-131 (&93834803831600)
[Tabelle-132]:           #Tabelle-132 (&93834803862768)
[Tabelle-133]:           #Tabelle-133 (&93834803878320)
[Tbl-137]:               #Tbl-137 (&93834803976880)
[Tabelle-135]:           #Tabelle-135 (&93834804021824)
[Tabelle-136]:           #Tabelle-136 (&93834794848672)
[Tabelle-137]:           #Tabelle-137 (&93834794867752)
[Tabelle-138]:           #Tabelle-138 (&93834794931960)
[Tabelle-139]:           #Tabelle-139 (&93834795009792)
[Tabelle-140]:           #Tabelle-140 (&93834795029664)
[Tabelle-141]:           #Tabelle-141 (&93834795162104)
[Tabelle-142]:           #Tabelle-142 (&93834795203448)
[Tbl-146]:               #Tbl-146 (&93834795255784)
[Tbl-147]:               #Tbl-147 (&93834781889088)
[Tbl-148]:               #Tbl-148 (&93834781930608)
[Tabelle-146]:           #Tabelle-146 (&93834781948856)
[Tabelle-147]:           #Tabelle-147 (&93834782159720)
[Tabelle-148]:           #Tabelle-148 (&93834782252464)
[Tabelle-149]:           #Tabelle-149 (&93834782271368)
[Tabelle-150]:           #Tabelle-150 (&93834782441768)
[Tabelle-151]:           #Tabelle-151 (&93834782494176)
[Tbl-155]:               #Tbl-155 (&93834782515680)
[Tbl-156]:               #Tbl-156 (&93834782589424)
[Tbl-157]:               #Tbl-157 (&93834782685480)
[Tbl-158]:               #Tbl-158 (&93834782706096)
[Tbl-159]:               #Tbl-159 (&93834782758936)
[Tbl-160]:               #Tbl-160 (&93834783117064)
[Tbl-161]:               #Tbl-161 (&93834783142696)
[Tbl-162]:               #Tbl-162 (&93834783249976)
[Tbl-163]:               #Tbl-163 (&93834783293808)
[Tbl-164]:               #Tbl-164 (&93834783319440)
[Tbl-165]:               #Tbl-165 (&93834769380568)
[Tbl-166]:               #Tbl-166 (&93834769416776)
[Tbl-167]:               #Tbl-167 (&93834769444240)
[Tbl-168]:               #Tbl-168 (&93834769483656)
[Tabelle-166]:           #Tabelle-166 (&93834769510960)
[Tabelle-167]:           #Tabelle-167 (&93834769654392)
[Tabelle-168]:           #Tabelle-168 (&93834769677672)
[Tabelle-169]:           #Tabelle-169 (&93834769813248)
[Tabelle-170]:           #Tabelle-170 (&93834769951848)
[Tabelle-171]:           #Tabelle-171 (&93834769996392)
[Tabelle-172]:           #Tabelle-172 (&93834770062848)
[Tabelle-173]:           #Tabelle-173 (&93834770831672)
[Tabelle-174]:           #Tabelle-174 (&93834770887656)
[Tabelle-175]:           #Tabelle-175 (&93834770907136)
[Tabelle-176]:           #Tabelle-176 (&93834770954016)
[Tabelle-177]:           #Tabelle-177 (&93834770973240)
[Tabelle-178]:           #Tabelle-178 (&93834808982104)
[Tabelle-179]:           #Tabelle-179 (&93834809036856)
[Tabelle-180]:           #Tabelle-180 (&93834809070824)
[Tabelle-181]:           #Tabelle-181 (&93834809250688)
[Tabelle-182]:           #Tabelle-182 (&93834809286640)
[Tabelle-183]:           #Tabelle-183 (&93834809370376)
[Tabelle-184]:           #Tabelle-184 (&93834809436960)
[Tabelle-185]:           #Tabelle-185 (&93834809468400)
[Tabelle-186]:           #Tabelle-186 (&93834809563264)
[Tabelle-187]:           #Tabelle-187 (&93834809613520)
[Tabelle-188]:           #Tabelle-188 (&93834809761224)
[Tabelle-189]:           #Tabelle-189 (&93834809854464)
[Tbl-193]:               #Tbl-193 (&93834809886104)
[Tabelle-191]:           #Tabelle-191 (&93834809982152)
[Tabelle-192]:           #Tabelle-192 (&93834810000712)
[Tabelle-193]:           #Tabelle-193 (&93834810199712)
[Tabelle-194]:           #Tabelle-194 (&93834789799800)
[Tabelle-195]:           #Tabelle-195 (&93834789817552)
[Tabelle-196]:           #Tabelle-196 (&93834789880272)
[Tabelle-197]:           #Tabelle-197 (&93834789893696)
[Tabelle-198]:           #Tabelle-198 (&93834790001400)
[Tabelle-199]:           #Tabelle-199 (&93834790020656)
[Tabelle-200]:           #Tabelle-200 (&93834790078688)
[Tabelle-201]:           #Tabelle-201 (&93834790093376)
[Tabelle-202]:           #Tabelle-202 (&93834790164584)
[Tabelle-203]:           #Tabelle-203 (&93834790720184)
[Tabelle-204]:           #Tabelle-204 (&93834790774824)
[Tabelle-205]:           #Tabelle-205 (&93834790794816)
[Tabelle-206]:           #Tabelle-206 (&93834790878392)
[Tabelle-207]:           #Tabelle-207 (&93834790907640)
[Tabelle-208]:           #Tabelle-208 (&93834791026568)
[Tabelle-209]:           #Tabelle-209 (&93834791056912)
[Tabelle-210]:           #Tabelle-210 (&93834791129888)
[Tabelle-211]:           #Tabelle-211 (&93834791161768)
[Tabelle-212]:           #Tabelle-212 (&93834791362744)
[Tabelle-213]:           #Tabelle-213 (&93834791406016)
[Tabelle-214]:           #Tabelle-214 (&93834791460416)
[Tabelle-215]:           #Tabelle-215 (&93834791494720)
[Tabelle-216]:           #Tabelle-216 (&93834786274784)
[Tabelle-217]:           #Tabelle-217 (&93834786294352)
[Tabelle-218]:           #Tabelle-218 (&93834786394632)
[Tabelle-219]:           #Tabelle-219 (&93834787087520)
[Tabelle-220]:           #Tabelle-220 (&93834787147288)
[Tabelle-221]:           #Tabelle-221 (&93834787268448)
[Tabelle-222]:           #Tabelle-222 (&93834787365008)
[Tabelle-223]:           #Tabelle-223 (&93834787424016)
[Tabelle-224]:           #Tabelle-224 (&93834787527832)
[Tabelle-225]:           #Tabelle-225 (&93834787631064)
[Tabelle-226]:           #Tabelle-226 (&93834787695360)
[Tabelle-227]:           #Tabelle-227 (&93834787741168)
[Tabelle-228]:           #Tabelle-228 (&93834807004480)
[Tabelle-229]:           #Tabelle-229 (&93834807088336)
[Tabelle-230]:           #Tabelle-230 (&93834807152040)
[Tabelle-231]:           #Tabelle-231 (&93834807168168)
[Tabelle-232]:           #Tabelle-232 (&93834807217968)
[Tabelle-233]:           #Tabelle-233 (&93834807571600)
[Tabelle-234]:           #Tabelle-234 (&93834807613952)
[Tabelle-235]:           #Tabelle-235 (&93834807712400)
[Tabelle-236]:           #Tabelle-236 (&93834807941248)
[Tabelle-237]:           #Tabelle-237 (&93834808032520)
[Tabelle-238]:           #Tabelle-238 (&93834808065336)
[Tabelle-239]:           #Tabelle-239 (&93834808099768)
[Tabelle-240]:           #Tabelle-240 (&93834808114984)
[Tabelle-241]:           #Tabelle-241 (&93834808139032)
[Tabelle-242]:           #Tabelle-242 (&93834808222856)
[Tabelle-243]:           #Tabelle-243 (&93834808239944)
[Tabelle-244]:           #Tabelle-244 (&93834808260120)
[Tabelle-245]:           #Tabelle-245 (&93834808299992)
[Tabelle-246]:           #Tabelle-246 (&93834808332448)
[Tabelle-247]:           #Tabelle-247 (&93834808361936)
[Tabelle-248]:           #Tabelle-248 (&93834808449424)
[Tabelle-249]:           #Tabelle-249 (&93834808467496)
[Tabelle-250]:           #Tabelle-250 (&93834808487480)
[Tabelle-251]:           #Tabelle-251 (&93834808548912)
[Tabelle-252]:           #Tabelle-252 (&93834808579704)
[Tabelle-253]:           #Tabelle-253 (&93834808646776)
[Tabelle-254]:           #Tabelle-254 (&93834808689488)
[Tabelle-255]:           #Tabelle-255 (&93834808747440)
[Tabelle-256]:           #Tabelle-256 (&93834808850240)
[Tbl-260]:               #Tbl-260 (&93834791561272)
[Tabelle-258]:           #Tabelle-258 (&93834791611952)
[Tabelle-259]:           #Tabelle-259 (&93834791634016)
[Tabelle-260]:           #Tabelle-260 (&93834791712056)
[Tabelle-261]:           #Tabelle-261 (&93834791766312)
[Tabelle-262]:           #Tabelle-262 (&93834791877672)
[Tabelle-263]:           #Tabelle-263 (&93834791902432)
[Tabelle-264]:           #Tabelle-264 (&93834792299336)
[Tabelle-265]:           #Tabelle-265 (&93834792317344)
[Tabelle-266]:           #Tabelle-266 (&93834792418128)
[Tabelle-267]:           #Tabelle-267 (&93834792497992)
[Tabelle-268]:           #Tabelle-268 (&93834792610792)
[Tabelle-269]:           #Tabelle-269 (&93834792634136)
[Tabelle-270]:           #Tabelle-270 (&93834792751176)
[Tabelle-271]:           #Tabelle-271 (&93834792774000)
[Tabelle-272]:           #Tabelle-272 (&93834792854448)
[Tabelle-273]:           #Tabelle-273 (&93834792890336)
[Tabelle-274]:           #Tabelle-274 (&93834792930592)
[Tabelle-275]:           #Tabelle-275 (&93834793023136)
[Tabelle-276]:           #Tabelle-276 (&93834793065824)
[Tabelle-277]:           #Tabelle-277 (&93834793095288)
[Tabelle-278]:           #Tabelle-278 (&93834793276832)
[Tabelle-279]:           #Tabelle-279 (&93834793318520)
[Tbl-283]:               #Tbl-283 (&93834793355128)
[Tbl-284]:               #Tbl-284 (&93834793460672)
[Tbl-285]:               #Tbl-285 (&93834765410416)
[Tabelle-283]:           #Tabelle-283 (&93834765429416)
[Tabelle-284]:           #Tabelle-284 (&93834765535824)
[Tabelle-285]:           #Tabelle-285 (&93834765548952)
[Tabelle-286]:           #Tabelle-286 (&93834765608576)
[Tabelle-287]:           #Tabelle-287 (&93834765679736)
[Tabelle-288]:           #Tabelle-288 (&93834765801576)
[Tabelle-289]:           #Tabelle-289 (&93834765891272)
[Tabelle-290]:           #Tabelle-290 (&93834766366104)
[Tabelle-291]:           #Tabelle-291 (&93834766414976)
[Tabelle-292]:           #Tabelle-292 (&93834766474848)
[Tabelle-293]:           #Tabelle-293 (&93834766525544)
[Tabelle-294]:           #Tabelle-294 (&93834766647184)
[Tabelle-295]:           #Tabelle-295 (&93834766675232)
[Tabelle-296]:           #Tabelle-296 (&93834766722584)
[Tabelle-297]:           #Tabelle-297 (&93834766759512)
[Tabelle-298]:           #Tabelle-298 (&93834766804160)
[Tabelle-299]:           #Tabelle-299 (&93834766854512)
[Tabelle-300]:           #Tabelle-300 (&93834766956776)
[Tabelle-301]:           #Tabelle-301 (&93834767020696)
[Tabelle-302]:           #Tabelle-302 (&93834767050472)
[Tabelle-303]:           #Tabelle-303 (&93834767084080)
[Tabelle-304]:           #Tabelle-304 (&93834767250840)
[Tabelle-305]:           #Tabelle-305 (&93834767284680)
[Tabelle-306]:           #Tabelle-306 (&93834767306064)
[Tabelle-307]:           #Tabelle-307 (&93834767432000)
[Tabelle-308]:           #Tabelle-308 (&93834767484264)
[Tabelle-309]:           #Tabelle-309 (&93834767496528)
[Tabelle-310]:           #Tabelle-310 (&93834804951528)
[Tabelle-311]:           #Tabelle-311 (&93834805009592)
[Tabelle-312]:           #Tabelle-312 (&93834805034000)
[Tabelle-313]:           #Tabelle-313 (&93834805131120)
[Tabelle-314]:           #Tabelle-314 (&93834805155528)
[Tabelle-315]:           #Tabelle-315 (&93834805252224)
[Tabelle-316]:           #Tabelle-316 (&93834805291616)
[Tabelle-317]:           #Tabelle-317 (&93834805321904)
[Tabelle-318]:           #Tabelle-318 (&93834805345112)
[Tabelle-319]:           #Tabelle-319 (&93834805427944)
[Tabelle-320]:           #Tabelle-320 (&93834805448568)
[Tabelle-321]:           #Tabelle-321 (&93834805564424)
[Tabelle-322]:           #Tabelle-322 (&93834805591672)
[Tbl-326]:               #Tbl-326 (&93834805670320)
[Tabelle-324]:           #Tabelle-324 (&93834805734800)
[Tabelle-325]:           #Tabelle-325 (&93834806092384)
[Tabelle-326]:           #Tabelle-326 (&93834806174928)
[Tabelle-327]:           #Tabelle-327 (&93834806220808)
[Tabelle-328]:           #Tabelle-328 (&93834806257112)
[Tabelle-329]:           #Tabelle-329 (&93834806361264)
[Tabelle-330]:           #Tabelle-330 (&93834806388760)
[Tabelle-331]:           #Tabelle-331 (&93834806454248)
[Tabelle-332]:           #Tabelle-332 (&93834806517608)
[Tabelle-333]:           #Tabelle-333 (&93834806553936)
[Tabelle-334]:           #Tabelle-334 (&93834806664808)
[Tabelle-335]:           #Tabelle-335 (&93834806709720)
[Tabelle-336]:           #Tabelle-336 (&93834806801696)
[Tabelle-337]:           #Tabelle-337 (&93834806829664)
[Tabelle-338]:           #Tabelle-338 (&93834778351824)
[Tabelle-339]:           #Tabelle-339 (&93834778370072)
[Tabelle-340]:           #Tabelle-340 (&93834778403960)
[Tabelle-341]:           #Tabelle-341 (&93834778420456)
[Tabelle-342]:           #Tabelle-342 (&93834778440008)
[Tabelle-343]:           #Tabelle-343 (&93834778498504)
[Tabelle-344]:           #Tabelle-344 (&93834778527480)
[Tabelle-345]:           #Tabelle-345 (&93834778634520)
[Tabelle-346]:           #Tabelle-346 (&93834778675680)
[Tabelle-347]:           #Tabelle-347 (&93834778698720)
[Tabelle-348]:           #Tabelle-348 (&93834778745760)
[Tabelle-349]:           #Tabelle-349 (&93834778770304)
[Tabelle-350]:           #Tabelle-350 (&93834778814640)
[Tabelle-351]:           #Tabelle-351 (&93834778889320)
[Tabelle-352]:           #Tabelle-352 (&93834778939832)
[Tabelle-353]:           #Tabelle-353 (&93834778965808)
[Tabelle-354]:           #Tabelle-354 (&93834778998160)
[Tabelle-355]:           #Tabelle-355 (&93834779036208)
[Tabelle-356]:           #Tabelle-356 (&93834779123696)
[Tabelle-357]:           #Tabelle-357 (&93834779233336)
[Tabelle-358]:           #Tabelle-358 (&93834779257688)
[Tabelle-359]:           #Tabelle-359 (&93834779272808)
[Tabelle-360]:           #Tabelle-360 (&93834779412096)
[Tabelle-361]:           #Tabelle-361 (&93834779446608)
[Tbl-365]:               #Tbl-365 (&93834779479688)
[Tbl-366]:               #Tbl-366 (&93834779505272)
[Tbl-367]:               #Tbl-367 (&93834779521656)
[Tbl-368]:               #Tbl-368 (&93834779534688)
[Tabelle -366]:          #Tabelle -366 (&93834779607584)
[Tbl-370]:               #Tbl-370 (&93834779708880)
[Tabelle-368]:           #Tabelle-368 (&93834779759904)
[Tbl-372]:               #Tbl-372 (&93834779810264)
[Tabelle-370]:           #Tabelle-370 (&93834779883688)
[Tabelle-371]:           #Tabelle-371 (&93834780025928)
[Tabelle-372]:           #Tabelle-372 (&93834780068096)
[Tabelle-373]:           #Tabelle-373 (&93834780259944)
[Tabelle-374]:           #Tabelle-374 (&93834780284832)
[Tabelle-375]:           #Tabelle-375 (&93834780351720)
[Tabelle-376]:           #Tabelle-376 (&93834780381920)
[Tabelle-377]:           #Tabelle-377 (&93834780512576)
[Tabelle-378]:           #Tabelle-378 (&93834780533776)
[Tabelle-379]:           #Tabelle-379 (&93834780607424)
[Tabelle-380]:           #Tabelle-380 (&93834780637672)
[Tabelle-381]:           #Tabelle-381 (&93834780750120)
[Tabelle-382]:           #Tabelle-382 (&93834780791768)
[Tabelle-383]:           #Tabelle-383 (&93834772378616)
[Tabelle-384]:           #Tabelle-384 (&93834772391440)
[Tabelle-385]:           #Tabelle-385 (&93834772423776)
[Tabelle-386]:           #Tabelle-386 (&93834772629888)
[Tabelle-387]:           #Tabelle-387 (&93834772644888)
[Tabelle-388]:           #Tabelle-388 (&93834772659496)
[Tbl-392]:               #Tbl-392 (&93834772672216)
[Tbl-393]:               #Tbl-393 (&93834772874192)
[Tbl-394]:               #Tbl-394 (&93834773602112)
[Tbl-395]:               #Tbl-395 (&93834773682000)
[Tabelle-389]:           #Tabelle-389 (&93834774130888)
[Tabelle-390]:           #Tabelle-390 (&93834774337776)
[Tabelle-391]:           #Tabelle-391 (&93834774351840)
[Tabelle-392]:           #Tabelle-392 (&93834774364128)
[Tabelle-393]:           #Tabelle-393 (&93834813607256)
[Tabelle-394]:           #Tabelle-394 (&93834814422848)
[Tabelle-395]:           #Tabelle-395 (&93834814655232)
[Tabelle-396]:           #Tabelle-396 (&93834814678696)
[Tabelle-397]:           #Tabelle-397 (&93834818845832)
[http://uri.etsi.org/02778/3]: http://uri.etsi.org/02778/3 (&93834807757920)
[urn:ietf:rfc:5751]:     urn:ietf:rfc:5751 (&93834807760928)
[https://github.com/gematik/examples-TelematikInterfaces/tree/master/tslService/detachedSignature]: https://github.com/gematik/examples-TelematikInterfaces/tree/master/tslService/detachedSignature (&93834773679968)
[https://www.bsi.bund.de/SharedDocs/Downloads/EN/BSI/Publications/TechGuidelines/TR03111/BSI-TR-03111_V-2-1_pdf.pdf?__blob=publicationFile&v=2]: https://www.bsi.bund.de/SharedDocs/Downloads/EN/BSI/Publications/TechGuidelines/TR03111/BSI-TR-03111_V-2-1_pdf.pdf?__blob=publicationFile&v=2 (&93834773704304)
[https://www.bsi.bund.de/SharedDocs/Downloads/DE/BSI/ Publikationen/TechnischeRichtlinien/TR03114/BSI-TR-03114.pdf? __blob=publicationFile&v=1]: https://www.bsi.bund.de/SharedDocs/Downloads/DE/BSI/Publikationen/TechnischeRichtlinien/TR03114/BSI-TR-03114.pdf?__blob=publicationFile&v=1 (&93834773708872)
[https://www.bsi.bund.de/SharedDocs/Downloads/DE/BSI/ Publikationen/TechnischeRichtlinien/TR03120/BSI-TR-03120.pdf? __blob=publicationFile&v=1]: https://www.bsi.bund.de/SharedDocs/Downloads/DE/BSI/Publikationen/TechnischeRichtlinien/TR03120/BSI-TR-03120.pdf?__blob=publicationFile&v=1 (&93834773713440)
[http://www.etsi.org]:   http://www.etsi.org (&93834773717704)
[http://www.w3.org/TR/2008/REC-xml-c14n11-20080502/]: http://www.w3.org/TR/2008/REC-xml-c14n11-20080502/ (&93834773721792)
[http://www.t7ev.org/themen/entwickler/common-pki-v20-spezifikation.html]: http://www.t7ev.org/themen/entwickler/common-pki-v20-spezifikation.html (&93834773732616)
[https://www.teletrust.de/fileadmin/files/ ISIS-MTT_Profile_SigGOptions_v1.1.pdf]: https://www.teletrust.de/fileadmin/files/ISIS-MTT_Profile_SigGOptions_v1.1.pdf (&93834773734536)
[https://datatracker.ietf.org/doc/html/rfc5652]: https://datatracker.ietf.org/doc/html/rfc5652 (&93834773739104)
[RFC 2045]:              http://tools.ietf.org/html/rfc2045 (&93834773821648)
[RFC 2046]:              http://tools.ietf.org/html/rfc2046 (&93834773822960)
[RFC 2047]:              http://tools.ietf.org/html/rfc2047 (&93834773824272)
[RFC 2048]:              http://tools.ietf.org/html/rfc2048 (&93834773825584)
[RFC 2049]:              http://tools.ietf.org/html/rfc2049 (&93834773826896)
[https://datatracker.ietf.org/doc/html/rfc5905]: https://datatracker.ietf.org/doc/html/rfc5905 (&93834773830984)
[http://docs.oasis-open.org/dss/v1.0/oasis-dss-profiles-AdES-spec-v1.0-os.pdf]: http://docs.oasis-open.org/dss/v1.0/oasis-dss-profiles-AdES-spec-v1.0-os.pdf (&93834773835976)
[http://docs.oasis-open.org/dss/v1.0/oasis-dss-core-spec-v1.0-os.pdf]: http://docs.oasis-open.org/dss/v1.0/oasis-dss-core-spec-v1.0-os.pdf (&93834773840064)
[https://datatracker.ietf.org/doc/html/rfc792]: https://datatracker.ietf.org/doc/html/rfc792 (&93834773876400)
[https://datatracker.ietf.org/doc/html/rfc1034]: https://datatracker.ietf.org/doc/html/rfc1034 (&93834773880608)
[https://datatracker.ietf.org/doc/html/rfc1122]: https://datatracker.ietf.org/doc/html/rfc1122 (&93834773884816)
[https://datatracker.ietf.org/doc/html/rfc1812]: https://datatracker.ietf.org/doc/html/rfc1812 (&93834773889504)
[https://datatracker.ietf.org/doc/html/rfc1918]: https://datatracker.ietf.org/doc/html/rfc1918 (&93834773893712)
[https://datatracker.ietf.org/doc/html/rfc2131]: https://datatracker.ietf.org/doc/html/rfc2131 (&93834773901824)
[https://datatracker.ietf.org/doc/html/rfc2132]: https://datatracker.ietf.org/doc/html/rfc2132 (&93834773906032)
[https://datatracker.ietf.org/doc/html/rfc2617]: https://datatracker.ietf.org/doc/html/rfc2617 (&93834773914472)
[https://datatracker.ietf.org/doc/html/rfc2818]: https://datatracker.ietf.org/doc/html/rfc2818 (&93834773928712)
[https://datatracker.ietf.org/doc/html/rfc3022]: https://datatracker.ietf.org/doc/html/rfc3022 (&93834773932920)
[https://datatracker.ietf.org/doc/html/rfc3279]: https://datatracker.ietf.org/doc/html/rfc3279 (&93834773942720)
[https://datatracker.ietf.org/doc/html/rfc3629]: https://datatracker.ietf.org/doc/html/rfc3629 (&93834773951136)
[https://datatracker.ietf.org/doc/html/rfc3927]: https://datatracker.ietf.org/doc/html/rfc3927 (&93834773955344)
[https://datatracker.ietf.org/doc/html/rfc4122]: https://datatracker.ietf.org/doc/html/rfc4122 (&93834773962504)
[https://datatracker.ietf.org/doc/html/rfc4511]: https://datatracker.ietf.org/doc/html/rfc4511 (&93834773965688)
[https://datatracker.ietf.org/doc/html/rfc4632]: https://datatracker.ietf.org/doc/html/rfc4632 (&93834773969592)
[https://datatracker.ietf.org/doc/html/rfc5246]: https://datatracker.ietf.org/doc/html/rfc5246 (&93834773973880)
[https://datatracker.ietf.org/doc/html/rfc5652]: https://datatracker.ietf.org/doc/html/rfc5652 (&93834773978688)
[https://datatracker.ietf.org/doc/html/rfc6598]: https://datatracker.ietf.org/doc/html/rfc6598 (&93834773982896)
[https://datatracker.ietf.org/doc/html/rfc6931]: https://datatracker.ietf.org/doc/html/rfc6931 (&93834773987104)
[https://datatracker.ietf.org/doc/html/rfc7159]: https://datatracker.ietf.org/doc/html/rfc7159 (&93834773991312)
[https://datatracker.ietf.org/doc/html/rfc5751]: https://datatracker.ietf.org/doc/html/rfc5751 (&93834773995520)
[https://www.w3.org/TR/2000/NOTE-SOAP-20000508/]: https://www.w3.org/TR/2000/NOTE-SOAP-20000508/ (&93834774000512)
[http://www.w3.org/TR/2007/REC-soap12-part1-20070427/]: http://www.w3.org/TR/2007/REC-soap12-part1-20070427/ (&93834774005864)
[https://www.teletrust.de/fileadmin/docs/projekte/sicct/SICCT-Spezifikation-1.21.pdf]: https://www.teletrust.de/fileadmin/docs/projekte/sicct/SICCT-Spezifikation-1.21.pdf (&93834774010752)
[https://www.adobe.io/open/standards/TIFF/_jcr_content/ contentbody/download/file.res/TIFF6.pdf.html]: https://www.adobe.io/open/standards/TIFF/_jcr_content/contentbody/download/file.res/TIFF6.pdf.html (&93834774015320)
[http://www.w3.org/TR/wsdl]: http://www.w3.org/TR/wsdl (&93834774020672)
[http://www.w3.org/TR/2008/REC-xmldsig-core-20080610/]: http://www.w3.org/TR/2008/REC-xmldsig-core-20080610/ (&93834774028496)
[http://www.w3.org/TR/xmlenc-core1/]: http://www.w3.org/TR/xmlenc-core1/ (&93834774033368)
[http://www.w3.org/TR/2010/REC-xpath20-20101214/]: http://www.w3.org/TR/2010/REC-xpath20-20101214/ (&93834774038240)
[http://www.w3.org/TR/2007/REC-xslt20-20070123/]: http://www.w3.org/TR/2007/REC-xslt20-20070123/ (&93834774043184)
[http://www.w3.org/TR/2006/REC-xsl11-20061205/]: http://www.w3.org/TR/2006/REC-xsl11-20061205/ (&93834774059264)
[http://www.w3.org/TR/2005/REC-soap12-mtom-20050125/]: http://www.w3.org/TR/2005/REC-soap12-mtom-20050125/ (&93834774064136)
[http://www.w3.org/2001/XInclude]: http://www.w3.org/2001/XInclude (&93834774359760)
